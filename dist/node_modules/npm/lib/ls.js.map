{"version":3,"sources":["../../../../node_modules/npm/lib/ls.js"],"names":["module","exports","ls","path","require","url","readPackageTree","archy","semver","color","npa","sortedObject","npm","mutateIntoLogicalTree","computeMetadata","readShrinkwrap","packageId","usage","output","completion","args","silent","cb","dir","resolve","_","physicalTree","package","isTop","andInflate","lsFromTree","inList","list","value","indexOf","fromTree","map","a","name","version","p","ver","rawSpec","validRange","data","asReadInstalled","pruneNestedExtraneous","filterByEnv","filterByLink","unlooped","filterFound","unloop","lite","getLite","long","config","get","json","out","seen","Set","d","JSON","stringify","k","o","has","add","makeParseable","makeArchy","length","_found","process","exitCode","er","problems","join","visited","push","i","dependencies","extraneous","dev","test","production","devKeys","Object","keys","devDependencies","prodKeys","_dependencies","forEach","missing","dependency","link","alphasort","b","toLowerCase","isCruft","error","code","noname","depth","maxDepth","globalDir","invalid","message","_from","from","_resolved","resolved","peerInvalid","deps","dep","optional","requiredBy","required","peerMissing","pdm","requires","reduce","apply","root","queue","current","shift","assign","_deduped","relative","replace","toMark","markPkg","markDeps","depName","_parent","ii","argName","argVersion","argRaw","found","satisfies","parent","toTrim","trimPkg","trimDeps","makeArchy_","unicode","unmet","bgBlack","yellow","red","label","_id","trim","nodes","sort","filter","brightBlack","realName","green","slice","bgRed","brightWhite","type","isGit","ex","getExtras","extras","description","repository","homepage","substr","u","parse","protocol","makeParseable_","concat","x","hasOwnProperty","realPath"],"mappings":"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","file":"ls.js","sourcesContent":["// show the installed versions of packages\n//\n// --parseable creates output like this:\n// <fullpath>:<name@ver>:<realpath>:<flags>\n// Flags are a :-separated list of zero or more indicators\n\nmodule.exports = exports = ls\n\nvar path = require('path')\nvar url = require('url')\nvar readPackageTree = require('read-package-tree')\nvar archy = require('archy')\nvar semver = require('semver')\nvar color = require('ansicolors')\nvar npa = require('npm-package-arg')\nvar sortedObject = require('sorted-object')\nvar npm = require('./npm.js')\nvar mutateIntoLogicalTree = require('./install/mutate-into-logical-tree.js')\nvar computeMetadata = require('./install/deps.js').computeMetadata\nvar readShrinkwrap = require('./install/read-shrinkwrap.js')\nvar packageId = require('./utils/package-id.js')\nvar usage = require('./utils/usage')\nvar output = require('./utils/output.js')\n\nls.usage = usage(\n  'ls',\n  'npm ls [[<@scope>/]<pkg> ...]'\n)\n\nls.completion = require('./utils/completion/installed-deep.js')\n\nfunction ls (args, silent, cb) {\n  if (typeof cb !== 'function') {\n    cb = silent\n    silent = false\n  }\n  var dir = path.resolve(npm.dir, '..')\n  readPackageTree(dir, function (_, physicalTree) {\n    if (!physicalTree) physicalTree = {package: {}, path: dir}\n    physicalTree.isTop = true\n    readShrinkwrap.andInflate(physicalTree, function () {\n      lsFromTree(dir, computeMetadata(physicalTree), args, silent, cb)\n    })\n  })\n}\n\nfunction inList (list, value) {\n  return list.indexOf(value) !== -1\n}\n\nvar lsFromTree = ls.fromTree = function (dir, physicalTree, args, silent, cb) {\n  if (typeof cb !== 'function') {\n    cb = silent\n    silent = false\n  }\n\n  // npm ls 'foo@~1.3' bar 'baz@<2'\n  if (!args) {\n    args = []\n  } else {\n    args = args.map(function (a) {\n      if (typeof a === 'object') {\n        return [a.package.name, a.package.version, a]\n      } else {\n        var p = npa(a)\n        var name = p.name\n        // When version spec is missing, we'll skip using it when filtering.\n        // Otherwise, `semver.validRange` would return '*', which won't\n        // match prerelease versions.\n        var ver = (p.rawSpec &&\n                   (semver.validRange(p.rawSpec) || ''))\n        return [ name, ver, a ]\n      }\n    })\n  }\n\n  var data = mutateIntoLogicalTree.asReadInstalled(physicalTree)\n\n  pruneNestedExtraneous(data)\n  filterByEnv(data)\n  filterByLink(data)\n\n  var unlooped = filterFound(unloop(data), args)\n  var lite = getLite(unlooped)\n\n  if (silent) return cb(null, data, lite)\n\n  var long = npm.config.get('long')\n  var json = npm.config.get('json')\n  var out\n  if (json) {\n    var seen = new Set()\n    var d = long ? unlooped : lite\n    // the raw data can be circular\n    out = JSON.stringify(d, function (k, o) {\n      if (typeof o === 'object') {\n        if (seen.has(o)) return '[Circular]'\n        seen.add(o)\n      }\n      return o\n    }, 2)\n  } else if (npm.config.get('parseable')) {\n    out = makeParseable(unlooped, long, dir)\n  } else if (data) {\n    out = makeArchy(unlooped, long, dir)\n  }\n  output(out)\n\n  if (args.length && !data._found) process.exitCode = 1\n\n  var er\n  // if any errors were found, then complain and exit status 1\n  if (lite.problems && lite.problems.length) {\n    er = lite.problems.join('\\n')\n  }\n  cb(er, data, lite)\n}\n\nfunction pruneNestedExtraneous (data, visited) {\n  visited = visited || []\n  visited.push(data)\n  for (var i in data.dependencies) {\n    if (data.dependencies[i].extraneous) {\n      data.dependencies[i].dependencies = {}\n    } else if (visited.indexOf(data.dependencies[i]) === -1) {\n      pruneNestedExtraneous(data.dependencies[i], visited)\n    }\n  }\n}\n\nfunction filterByEnv (data) {\n  var dev = npm.config.get('dev') || /^dev(elopment)?$/.test(npm.config.get('only'))\n  var production = npm.config.get('production') || /^prod(uction)?$/.test(npm.config.get('only'))\n  var dependencies = {}\n  var devKeys = Object.keys(data.devDependencies || [])\n  var prodKeys = Object.keys(data._dependencies || [])\n  Object.keys(data.dependencies).forEach(function (name) {\n    if (!dev && inList(devKeys, name) && !inList(prodKeys, name) && data.dependencies[name].missing) {\n      return\n    }\n\n    if ((dev && inList(devKeys, name)) || // only --dev\n        (production && inList(prodKeys, name)) || // only --production\n        (!dev && !production)) { // no --production|--dev|--only=xxx\n      dependencies[name] = data.dependencies[name]\n    }\n  })\n  data.dependencies = dependencies\n}\n\nfunction filterByLink (data) {\n  if (npm.config.get('link')) {\n    var dependencies = {}\n    Object.keys(data.dependencies).forEach(function (name) {\n      var dependency = data.dependencies[name]\n      if (dependency.link) {\n        dependencies[name] = dependency\n      }\n    })\n    data.dependencies = dependencies\n  }\n}\n\nfunction alphasort (a, b) {\n  a = a.toLowerCase()\n  b = b.toLowerCase()\n  return a > b ? 1\n    : a < b ? -1 : 0\n}\n\nfunction isCruft (data) {\n  return data.extraneous && data.error && data.error.code === 'ENOTDIR'\n}\n\nfunction getLite (data, noname, depth) {\n  var lite = {}\n\n  if (isCruft(data)) return lite\n\n  var maxDepth = npm.config.get('depth')\n\n  if (typeof depth === 'undefined') depth = 0\n  if (!noname && data.name) lite.name = data.name\n  if (data.version) lite.version = data.version\n  if (data.extraneous) {\n    lite.extraneous = true\n    lite.problems = lite.problems || []\n    lite.problems.push('extraneous: ' + packageId(data) + ' ' + (data.path || ''))\n  }\n\n  if (data.error && data.path !== path.resolve(npm.globalDir, '..') &&\n      (data.error.code !== 'ENOENT' || noname)) {\n    lite.invalid = true\n    lite.problems = lite.problems || []\n    var message = data.error.message\n    lite.problems.push('error in ' + data.path + ': ' + message)\n  }\n\n  if (data._from) {\n    lite.from = data._from\n  }\n\n  if (data._resolved) {\n    lite.resolved = data._resolved\n  }\n\n  if (data.invalid) {\n    lite.invalid = true\n    lite.problems = lite.problems || []\n    lite.problems.push('invalid: ' +\n                       packageId(data) +\n                       ' ' + (data.path || ''))\n  }\n\n  if (data.peerInvalid) {\n    lite.peerInvalid = true\n    lite.problems = lite.problems || []\n    lite.problems.push('peer dep not met: ' +\n                       packageId(data) +\n                       ' ' + (data.path || ''))\n  }\n\n  var deps = (data.dependencies && Object.keys(data.dependencies)) || []\n  if (deps.length) {\n    lite.dependencies = deps.map(function (d) {\n      var dep = data.dependencies[d]\n      if (dep.missing && !dep.optional) {\n        lite.problems = lite.problems || []\n        var p\n        if (data.depth > maxDepth) {\n          p = 'max depth reached: '\n        } else {\n          p = 'missing: '\n        }\n        p += d + '@' + dep.requiredBy +\n            ', required by ' +\n            packageId(data)\n        lite.problems.push(p)\n        if (dep.dependencies) {\n          return [d, getLite(dep, true)]\n        } else {\n          return [d, { required: dep.requiredBy, missing: true }]\n        }\n      } else if (dep.peerMissing) {\n        lite.problems = lite.problems || []\n        dep.peerMissing.forEach(function (missing) {\n          var pdm = 'peer dep missing: ' +\n              missing.requires +\n              ', required by ' +\n              missing.requiredBy\n          lite.problems.push(pdm)\n        })\n        return [d, { required: dep, peerMissing: true }]\n      } else if (npm.config.get('json')) {\n        if (depth === maxDepth) delete dep.dependencies\n        return [d, getLite(dep, true, depth + 1)]\n      }\n      return [d, getLite(dep, true)]\n    }).reduce(function (deps, d) {\n      if (d[1].problems) {\n        lite.problems = lite.problems || []\n        lite.problems.push.apply(lite.problems, d[1].problems)\n      }\n      deps[d[0]] = d[1]\n      return deps\n    }, {})\n  }\n  return lite\n}\n\nfunction unloop (root) {\n  var queue = [root]\n  var seen = new Set()\n  seen.add(root)\n\n  while (queue.length) {\n    var current = queue.shift()\n    var deps = current.dependencies = current.dependencies || {}\n    Object.keys(deps).forEach(function (d) {\n      var dep = deps[d]\n      if (dep.missing && !dep.dependencies) return\n      if (dep.path && seen.has(dep)) {\n        dep = deps[d] = Object.assign({}, dep)\n        dep.dependencies = {}\n        dep._deduped = path.relative(root.path, dep.path).replace(/node_modules\\//g, '')\n        return\n      }\n      seen.add(dep)\n      queue.push(dep)\n    })\n  }\n\n  return root\n}\n\nfunction filterFound (root, args) {\n  if (!args.length) return root\n  if (!root.dependencies) return root\n\n  // Mark all deps\n  var toMark = [root]\n  while (toMark.length) {\n    var markPkg = toMark.shift()\n    var markDeps = markPkg.dependencies\n    if (!markDeps) continue\n    Object.keys(markDeps).forEach(function (depName) {\n      var dep = markDeps[depName]\n      if (dep.peerMissing) return\n      dep._parent = markPkg\n      for (var ii = 0; ii < args.length; ii++) {\n        var argName = args[ii][0]\n        var argVersion = args[ii][1]\n        var argRaw = args[ii][2]\n        var found\n        if (typeof argRaw === 'object') {\n          if (dep.path === argRaw.path) {\n            found = true\n          }\n        } else if (depName === argName && argVersion) {\n          found = semver.satisfies(dep.version, argVersion, true)\n        } else if (depName === argName) {\n          // If version is missing from arg, just do a name match.\n          found = true\n        }\n        if (found) {\n          dep._found = 'explicit'\n          var parent = dep._parent\n          while (parent && !parent._found && !parent._deduped) {\n            parent._found = 'implicit'\n            parent = parent._parent\n          }\n          break\n        }\n      }\n      toMark.push(dep)\n    })\n  }\n  var toTrim = [root]\n  while (toTrim.length) {\n    var trimPkg = toTrim.shift()\n    var trimDeps = trimPkg.dependencies\n    if (!trimDeps) continue\n    trimPkg.dependencies = {}\n    Object.keys(trimDeps).forEach(function (name) {\n      var dep = trimDeps[name]\n      if (!dep._found) return\n      if (dep._found === 'implicit' && dep._deduped) return\n      trimPkg.dependencies[name] = dep\n      toTrim.push(dep)\n    })\n  }\n  return root\n}\n\nfunction makeArchy (data, long, dir) {\n  var out = makeArchy_(data, long, dir, 0)\n  return archy(out, '', { unicode: npm.config.get('unicode') })\n}\n\nfunction makeArchy_ (data, long, dir, depth, parent, d) {\n  if (data.missing) {\n    if (depth - 1 <= npm.config.get('depth')) {\n      // just missing\n      var unmet = 'UNMET ' + (data.optional ? 'OPTIONAL ' : '') + 'DEPENDENCY'\n      if (npm.color) {\n        if (data.optional) {\n          unmet = color.bgBlack(color.yellow(unmet))\n        } else {\n          unmet = color.bgBlack(color.red(unmet))\n        }\n      }\n      var label = data._id || (d + '@' + data.requiredBy)\n      if (data._found === 'explicit' && data._id) {\n        if (npm.color) {\n          label = color.bgBlack(color.yellow(label.trim())) + ' '\n        } else {\n          label = label.trim() + ' '\n        }\n      }\n      return {\n        label: unmet + ' ' + label,\n        nodes: Object.keys(data.dependencies || {})\n          .sort(alphasort).filter(function (d) {\n            return !isCruft(data.dependencies[d])\n          }).map(function (d) {\n            return makeArchy_(sortedObject(data.dependencies[d]), long, dir, depth + 1, data, d)\n          })\n      }\n    } else {\n      return {label: d + '@' + data.requiredBy}\n    }\n  }\n\n  var out = {}\n  // the top level is a bit special.\n  out.label = data._id || ''\n  if (data._found === 'explicit' && data._id) {\n    if (npm.color) {\n      out.label = color.bgBlack(color.yellow(out.label.trim())) + ' '\n    } else {\n      out.label = out.label.trim() + ' '\n    }\n  }\n  if (data.link) out.label += ' -> ' + data.link\n\n  if (data._deduped) {\n    if (npm.color) {\n      out.label += ' ' + color.brightBlack('deduped')\n    } else {\n      out.label += ' deduped'\n    }\n  }\n\n  if (data.invalid) {\n    if (data.realName !== data.name) out.label += ' (' + data.realName + ')'\n    var invalid = 'invalid'\n    if (npm.color) invalid = color.bgBlack(color.red(invalid))\n    out.label += ' ' + invalid\n  }\n\n  if (data.peerInvalid) {\n    var peerInvalid = 'peer invalid'\n    if (npm.color) peerInvalid = color.bgBlack(color.red(peerInvalid))\n    out.label += ' ' + peerInvalid\n  }\n\n  if (data.peerMissing) {\n    var peerMissing = 'UNMET PEER DEPENDENCY'\n\n    if (npm.color) peerMissing = color.bgBlack(color.red(peerMissing))\n    out.label = peerMissing + ' ' + out.label\n  }\n\n  if (data.extraneous && data.path !== dir) {\n    var extraneous = 'extraneous'\n    if (npm.color) extraneous = color.bgBlack(color.green(extraneous))\n    out.label += ' ' + extraneous\n  }\n\n  if (data.error && depth) {\n    var message = data.error.message\n    if (message.indexOf('\\n')) message = message.slice(0, message.indexOf('\\n'))\n    var error = 'error: ' + message\n    if (npm.color) error = color.bgRed(color.brightWhite(error))\n    out.label += ' ' + error\n  }\n\n  // add giturl to name@version\n  if (data._resolved) {\n    try {\n      var type = npa(data._resolved).type\n      var isGit = type === 'git' || type === 'hosted'\n      if (isGit) {\n        out.label += ' (' + data._resolved + ')'\n      }\n    } catch (ex) {\n      // npa threw an exception then it ain't git so whatev\n    }\n  }\n\n  if (long) {\n    if (dir === data.path) out.label += '\\n' + dir\n    out.label += '\\n' + getExtras(data)\n  } else if (dir === data.path) {\n    if (out.label) out.label += ' '\n    out.label += dir\n  }\n\n  // now all the children.\n  out.nodes = []\n  if (depth <= npm.config.get('depth')) {\n    out.nodes = Object.keys(data.dependencies || {})\n      .sort(alphasort).filter(function (d) {\n        return !isCruft(data.dependencies[d])\n      }).map(function (d) {\n        return makeArchy_(sortedObject(data.dependencies[d]), long, dir, depth + 1, data, d)\n      })\n  }\n\n  if (out.nodes.length === 0 && data.path === dir) {\n    out.nodes = ['(empty)']\n  }\n\n  return out\n}\n\nfunction getExtras (data) {\n  var extras = []\n\n  if (data.description) extras.push(data.description)\n  if (data.repository) extras.push(data.repository.url)\n  if (data.homepage) extras.push(data.homepage)\n  if (data._from) {\n    var from = data._from\n    if (from.indexOf(data.name + '@') === 0) {\n      from = from.substr(data.name.length + 1)\n    }\n    var u = url.parse(from)\n    if (u.protocol) extras.push(from)\n  }\n  return extras.join('\\n')\n}\n\nfunction makeParseable (data, long, dir, depth, parent, d) {\n  if (data._deduped) return []\n  depth = depth || 0\n  if (depth > npm.config.get('depth')) return [ makeParseable_(data, long, dir, depth, parent, d) ]\n  return [ makeParseable_(data, long, dir, depth, parent, d) ]\n    .concat(Object.keys(data.dependencies || {})\n      .sort(alphasort).map(function (d) {\n        return makeParseable(data.dependencies[d], long, dir, depth + 1, data, d)\n      }))\n    .filter(function (x) { return x && x.length })\n    .join('\\n')\n}\n\nfunction makeParseable_ (data, long, dir, depth, parent, d) {\n  if (data.hasOwnProperty('_found') && data._found !== 'explicit') return ''\n\n  if (data.missing) {\n    if (depth < npm.config.get('depth')) {\n      data = npm.config.get('long')\n        ? path.resolve(parent.path, 'node_modules', d) +\n             ':' + d + '@' + JSON.stringify(data.requiredBy) + ':INVALID:MISSING'\n        : ''\n    } else {\n      data = path.resolve(dir || '', 'node_modules', d || '') +\n             (npm.config.get('long')\n               ? ':' + d + '@' + JSON.stringify(data.requiredBy) +\n               ':' + // no realpath resolved\n               ':MAXDEPTH'\n               : '')\n    }\n\n    return data\n  }\n\n  if (!npm.config.get('long')) return data.path\n\n  return data.path +\n         ':' + (data._id || '') +\n         ':' + (data.realPath !== data.path ? data.realPath : '') +\n         (data.extraneous ? ':EXTRANEOUS' : '') +\n         (data.error && data.path !== path.resolve(npm.globalDir, '..') ? ':ERROR' : '') +\n         (data.invalid ? ':INVALID' : '') +\n         (data.peerInvalid ? ':PEERINVALID' : '') +\n         (data.peerMissing ? ':PEERINVALID:MISSING' : '')\n}\n"]}