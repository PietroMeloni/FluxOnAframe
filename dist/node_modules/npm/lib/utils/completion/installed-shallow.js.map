{"version":3,"sources":["../../../../../../node_modules/npm/lib/utils/completion/installed-shallow.js"],"names":["module","exports","installedShallow","npm","require","fs","path","readJson","asyncMap","opts","filter","cb","conf","args","argv","remain","length","local","global","localDir","dir","globalDir","config","get","next","readdir","er","pkgs","p","charAt","filterInstalled","fl","fg","join","d","name","map","g","console","error","concat"],"mappings":"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","file":"installed-shallow.js","sourcesContent":["\nmodule.exports = installedShallow\n\nvar npm = require('../../npm.js')\nvar fs = require('graceful-fs')\nvar path = require('path')\nvar readJson = require('read-package-json')\nvar asyncMap = require('slide').asyncMap\n\nfunction installedShallow (opts, filter, cb) {\n  if (typeof cb !== 'function') {\n    cb = filter\n    filter = null\n  }\n  var conf = opts.conf\n  var args = conf.argv.remain\n  if (args.length > 3) return cb()\n  var local\n  var global\n  var localDir = npm.dir\n  var globalDir = npm.globalDir\n  if (npm.config.get('global')) {\n    local = []\n    next()\n  } else {\n    fs.readdir(localDir, function (er, pkgs) {\n      local = (pkgs || []).filter(function (p) {\n        return p.charAt(0) !== '.'\n      })\n      next()\n    })\n  }\n\n  fs.readdir(globalDir, function (er, pkgs) {\n    global = (pkgs || []).filter(function (p) {\n      return p.charAt(0) !== '.'\n    })\n    next()\n  })\n  function next () {\n    if (!local || !global) return\n    filterInstalled(local, global, filter, cb)\n  }\n}\n\nfunction filterInstalled (local, global, filter, cb) {\n  var fl\n  var fg\n\n  if (!filter) {\n    fl = local\n    fg = global\n    return next()\n  }\n\n  asyncMap(local, function (p, cb) {\n    readJson(path.join(npm.dir, p, 'package.json'), function (er, d) {\n      if (!d || !filter(d)) return cb(null, [])\n      return cb(null, d.name)\n    })\n  }, function (er, local) {\n    fl = local || []\n    next()\n  })\n\n  var globalDir = npm.globalDir\n  asyncMap(global, function (p, cb) {\n    readJson(path.join(globalDir, p, 'package.json'), function (er, d) {\n      if (!d || !filter(d)) return cb(null, [])\n      return cb(null, d.name)\n    })\n  }, function (er, global) {\n    fg = global || []\n    next()\n  })\n\n  function next () {\n    if (!fg || !fl) return\n    if (!npm.config.get('global')) {\n      fg = fg.map(function (g) {\n        return [g, '-g']\n      })\n    }\n    console.error('filtered', fl, fg)\n    return cb(null, fl.concat(fg))\n  }\n}\n"]}