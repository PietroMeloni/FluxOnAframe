{"version":3,"sources":["../../../../node_modules/npm/lib/prune.js"],"names":["module","exports","prune","Pruner","usage","npm","require","log","util","moduleName","Installer","isExtraneous","isOnlyDev","removeDeps","loadExtraneous","chain","computeMetadata","completion","args","cb","dryrun","config","get","run","where","call","autoPrune","inherits","prototype","loadAllDepsIntoIdealTree","silly","cg","progress","steps","idealTree","self","excludeDev","test","shouldPrune","child","getModuleName","matchesArg","name","length","indexOf","nameObj","toPrune","children","filter","map","push","newGroup","runPreinstallTopLevelLifecycles","runPostinstallTopLevelLifecycles","saveToDependencies"],"mappings":"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","file":"prune.js","sourcesContent":["// prune extraneous packages.\n\nmodule.exports = prune\nmodule.exports.Pruner = Pruner\n\nprune.usage = 'npm prune [[<@scope>/]<pkg>...] [--production]'\n\nvar npm = require('./npm.js')\nvar log = require('npmlog')\nvar util = require('util')\nvar moduleName = require('./utils/module-name.js')\nvar Installer = require('./install.js').Installer\nvar isExtraneous = require('./install/is-extraneous.js')\nvar isOnlyDev = require('./install/is-only-dev.js')\nvar removeDeps = require('./install/deps.js').removeDeps\nvar loadExtraneous = require('./install/deps.js').loadExtraneous\nvar chain = require('slide').chain\nvar computeMetadata = require('./install/deps.js').computeMetadata\n\nprune.completion = require('./utils/completion/installed-deep.js')\n\nfunction prune (args, cb) {\n  var dryrun = !!npm.config.get('dry-run')\n  new Pruner('.', dryrun, args).run(cb)\n}\n\nfunction Pruner (where, dryrun, args) {\n  Installer.call(this, where, dryrun, args)\n  this.autoPrune = true\n}\nutil.inherits(Pruner, Installer)\n\nPruner.prototype.loadAllDepsIntoIdealTree = function (cb) {\n  log.silly('uninstall', 'loadAllDepsIntoIdealTree')\n\n  var cg = this.progress['loadIdealTree:loadAllDepsIntoIdealTree']\n  var steps = []\n\n  computeMetadata(this.idealTree)\n  var self = this\n  var excludeDev = npm.config.get('production') || /^prod(uction)?$/.test(npm.config.get('only'))\n  function shouldPrune (child) {\n    if (isExtraneous(child)) return true\n    if (!excludeDev) return false\n    return isOnlyDev(child)\n  }\n  function getModuleName (child) {\n    // wrapping because moduleName doesn't like extra args and we're called\n    // from map.\n    return moduleName(child)\n  }\n  function matchesArg (name) {\n    return self.args.length === 0 || self.args.indexOf(name) !== -1\n  }\n  function nameObj (name) {\n    return {name: name}\n  }\n  var toPrune = this.idealTree.children.filter(shouldPrune).map(getModuleName).filter(matchesArg).map(nameObj)\n\n  steps.push(\n    [removeDeps, toPrune, this.idealTree, null],\n    [loadExtraneous, this.idealTree, cg.newGroup('loadExtraneous')])\n  chain(steps, cb)\n}\n\nPruner.prototype.runPreinstallTopLevelLifecycles = function (cb) { cb() }\nPruner.prototype.runPostinstallTopLevelLifecycles = function (cb) { cb() }\nPruner.prototype.saveToDependencies = function (cb) { cb() }\n"]}