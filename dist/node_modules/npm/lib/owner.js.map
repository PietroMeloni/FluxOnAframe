{"version":3,"sources":["../../../../node_modules/npm/lib/owner.js"],"names":["module","exports","owner","npm","require","log","mapToRegistry","readLocalPkg","usage","output","completion","opts","cb","argv","conf","remain","length","subs","partialWord","push","commands","whoami","er","username","un","encodeURIComponent","byUser","theUser","config","uri","auth","console","error","registry","get","d","filter","p","indexOf","mine","theirs","list","Object","keys","n","args","action","shift","ls","add","rm","unknown","pkg","data","msg","owners","maintainers","map","o","name","email","join","user","Error","verbose","mutate","u","i","l","info","found","m","match","mutation","mutate_","JSON","stringify","beforeMutation","_id","_rev","dataPath","replace","params","method","body","request"],"mappings":"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","file":"owner.js","sourcesContent":["/* eslint-disable standard/no-callback-literal */\nmodule.exports = owner\n\nvar npm = require('./npm.js')\nvar log = require('npmlog')\nvar mapToRegistry = require('./utils/map-to-registry.js')\nvar readLocalPkg = require('./utils/read-local-package.js')\nvar usage = require('./utils/usage')\nvar output = require('./utils/output.js')\n\nowner.usage = usage(\n  'owner',\n  'npm owner add <user> [<@scope>/]<pkg>' +\n  '\\nnpm owner rm <user> [<@scope>/]<pkg>' +\n  '\\nnpm owner ls [<@scope>/]<pkg>'\n)\nowner.completion = function (opts, cb) {\n  var argv = opts.conf.argv.remain\n  if (argv.length > 4) return cb()\n  if (argv.length <= 2) {\n    var subs = ['add', 'rm']\n    if (opts.partialWord === 'l') subs.push('ls')\n    else subs.push('ls', 'list')\n    return cb(null, subs)\n  }\n\n  npm.commands.whoami([], true, function (er, username) {\n    if (er) return cb()\n\n    var un = encodeURIComponent(username)\n    var byUser, theUser\n    switch (argv[2]) {\n      case 'ls':\n        // FIXME: there used to be registry completion here, but it stopped\n        // making sense somewhere around 50,000 packages on the registry\n        return cb()\n\n      case 'rm':\n        if (argv.length > 3) {\n          theUser = encodeURIComponent(argv[3])\n          byUser = '-/by-user/' + theUser + '|' + un\n          return mapToRegistry(byUser, npm.config, function (er, uri, auth) {\n            if (er) return cb(er)\n\n            console.error(uri)\n            npm.registry.get(uri, { auth: auth }, function (er, d) {\n              if (er) return cb(er)\n              // return the intersection\n              return cb(null, d[theUser].filter(function (p) {\n                // kludge for server adminery.\n                return un === 'isaacs' || d[un].indexOf(p) === -1\n              }))\n            })\n          })\n        }\n        // else fallthrough\n        /* eslint no-fallthrough:0 */\n      case 'add':\n        if (argv.length > 3) {\n          theUser = encodeURIComponent(argv[3])\n          byUser = '-/by-user/' + theUser + '|' + un\n          return mapToRegistry(byUser, npm.config, function (er, uri, auth) {\n            if (er) return cb(er)\n\n            console.error(uri)\n            npm.registry.get(uri, { auth: auth }, function (er, d) {\n              console.error(uri, er || d)\n              // return mine that they're not already on.\n              if (er) return cb(er)\n              var mine = d[un] || []\n              var theirs = d[theUser] || []\n              return cb(null, mine.filter(function (p) {\n                return theirs.indexOf(p) === -1\n              }))\n            })\n          })\n        }\n        // just list all users who aren't me.\n        return mapToRegistry('-/users', npm.config, function (er, uri, auth) {\n          if (er) return cb(er)\n\n          npm.registry.get(uri, { auth: auth }, function (er, list) {\n            if (er) return cb()\n            return cb(null, Object.keys(list).filter(function (n) {\n              return n !== un\n            }))\n          })\n        })\n\n      default:\n        return cb()\n    }\n  })\n}\n\nfunction owner (args, cb) {\n  var action = args.shift()\n  switch (action) {\n    case 'ls': case 'list': return ls(args[0], cb)\n    case 'add': return add(args[0], args[1], cb)\n    case 'rm': case 'remove': return rm(args[0], args[1], cb)\n    default: return unknown(action, cb)\n  }\n}\n\nfunction ls (pkg, cb) {\n  if (!pkg) {\n    return readLocalPkg(function (er, pkg) {\n      if (er) return cb(er)\n      if (!pkg) return cb(owner.usage)\n      ls(pkg, cb)\n    })\n  }\n\n  mapToRegistry(pkg, npm.config, function (er, uri, auth) {\n    if (er) return cb(er)\n\n    npm.registry.get(uri, { auth: auth }, function (er, data) {\n      var msg = ''\n      if (er) {\n        log.error('owner ls', \"Couldn't get owner data\", pkg)\n        return cb(er)\n      }\n      var owners = data.maintainers\n      if (!owners || !owners.length) {\n        msg = 'admin party!'\n      } else {\n        msg = owners.map(function (o) {\n          return o.name + ' <' + o.email + '>'\n        }).join('\\n')\n      }\n      output(msg)\n      cb(er, owners)\n    })\n  })\n}\n\nfunction add (user, pkg, cb) {\n  if (!user) return cb(owner.usage)\n  if (!pkg) {\n    return readLocalPkg(function (er, pkg) {\n      if (er) return cb(er)\n      if (!pkg) return cb(new Error(owner.usage))\n      add(user, pkg, cb)\n    })\n  }\n\n  log.verbose('owner add', '%s to %s', user, pkg)\n  mutate(pkg, user, function (u, owners) {\n    if (!owners) owners = []\n    for (var i = 0, l = owners.length; i < l; i++) {\n      var o = owners[i]\n      if (o.name === u.name) {\n        log.info(\n          'owner add',\n          'Already a package owner: ' + o.name + ' <' + o.email + '>'\n        )\n        return false\n      }\n    }\n    owners.push(u)\n    return owners\n  }, cb)\n}\n\nfunction rm (user, pkg, cb) {\n  if (!pkg) {\n    return readLocalPkg(function (er, pkg) {\n      if (er) return cb(er)\n      if (!pkg) return cb(new Error(owner.usage))\n      rm(user, pkg, cb)\n    })\n  }\n\n  log.verbose('owner rm', '%s from %s', user, pkg)\n  mutate(pkg, user, function (u, owners) {\n    var found = false\n    var m = owners.filter(function (o) {\n      var match = (o.name === user)\n      found = found || match\n      return !match\n    })\n\n    if (!found) {\n      log.info('owner rm', 'Not a package owner: ' + user)\n      return false\n    }\n\n    if (!m.length) {\n      return new Error(\n        'Cannot remove all owners of a package.  Add someone else first.'\n      )\n    }\n\n    return m\n  }, cb)\n}\n\nfunction mutate (pkg, user, mutation, cb) {\n  if (user) {\n    var byUser = '-/user/org.couchdb.user:' + user\n    mapToRegistry(byUser, npm.config, function (er, uri, auth) {\n      if (er) return cb(er)\n\n      npm.registry.get(uri, { auth: auth }, mutate_)\n    })\n  } else {\n    mutate_(null, null)\n  }\n\n  function mutate_ (er, u) {\n    if (!er && user && (!u || u.error)) {\n      er = new Error(\n        \"Couldn't get user data for \" + user + ': ' + JSON.stringify(u)\n      )\n    }\n\n    if (er) {\n      log.error('owner mutate', 'Error getting user data for %s', user)\n      return cb(er)\n    }\n\n    if (u) u = { name: u.name, email: u.email }\n    mapToRegistry(pkg, npm.config, function (er, uri, auth) {\n      if (er) return cb(er)\n\n      npm.registry.get(uri, { auth: auth }, function (er, data) {\n        if (er) {\n          log.error('owner mutate', 'Error getting package data for %s', pkg)\n          return cb(er)\n        }\n\n        // save the number of maintainers before mutation so that we can figure\n        // out if maintainers were added or removed\n        var beforeMutation = data.maintainers.length\n\n        var m = mutation(u, data.maintainers)\n        if (!m) return cb() // handled\n        if (m instanceof Error) return cb(m) // error\n\n        data = {\n          _id: data._id,\n          _rev: data._rev,\n          maintainers: m\n        }\n        var dataPath = pkg.replace('/', '%2f') + '/-rev/' + data._rev\n        mapToRegistry(dataPath, npm.config, function (er, uri, auth) {\n          if (er) return cb(er)\n\n          var params = {\n            method: 'PUT',\n            body: data,\n            auth: auth\n          }\n          npm.registry.request(uri, params, function (er, data) {\n            if (!er && data.error) {\n              er = new Error('Failed to update package metadata: ' + JSON.stringify(data))\n            }\n\n            if (er) {\n              log.error('owner mutate', 'Failed to update package metadata')\n            } else if (m.length > beforeMutation) {\n              output('+ %s (%s)', user, pkg)\n            } else if (m.length < beforeMutation) {\n              output('- %s (%s)', user, pkg)\n            }\n\n            cb(er, data)\n          })\n        })\n      })\n    })\n  }\n}\n\nfunction unknown (action, cb) {\n  cb('Usage: \\n' + owner.usage)\n}\n"]}