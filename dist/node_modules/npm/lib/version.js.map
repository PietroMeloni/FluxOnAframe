{"version":3,"sources":["../../../../node_modules/npm/lib/version.js"],"names":["BB","require","assert","chain","detectIndent","detectNewline","fs","readFile","promisify","git","lifecycle","log","npm","output","parseJSON","path","semver","stringifyPackage","writeFileAtomic","version","usage","module","exports","args","silent","cb_","length","readPackage","er","data","indent","newline","dump","error","retrieveTagVersion","newVersion","valid","inc","persistVersion","verifyGit","parseLastGitTag","results","localData","hasGit","existingTag","cb","options","env","process","whichAndExec","stdout","message","indexOf","Error","tag","trim","prefix","config","get","slice","lifecycleData","Object","create","_id","name","where","checkGit","updatePackage","commit","packagePath","join","localPrefix","JSON","parse","e","write","updateShrinkwrap","hasShrinkwrap","hasLock","hasPackageLock","_commit","SHRINKWRAP","PKGLOCK","readLockfile","catch","code","shrinkwrap","lockfile","file","err","v","keys","versions","sort","forEach","k","stringify","statGitFolder","stat","callGitStatus","cleanStatusLines","lines","split","filter","line","match","map","checkStatus","checkStdout","doGit","verbose","warn","buildCommitArgs","push","replace","signTag","signCommit","commitArgs","flagForTag","stagePackageFiles","then","exec","nodeify","addLocalFile","ignoreFailure","p"],"mappings":"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","file":"version.js","sourcesContent":["'use strict'\nconst BB = require('bluebird')\n\nconst assert = require('assert')\nconst chain = require('slide').chain\nconst detectIndent = require('detect-indent')\nconst detectNewline = require('detect-newline')\nconst fs = require('graceful-fs')\nconst readFile = BB.promisify(require('graceful-fs').readFile)\nconst git = require('./utils/git.js')\nconst lifecycle = require('./utils/lifecycle.js')\nconst log = require('npmlog')\nconst npm = require('./npm.js')\nconst output = require('./utils/output.js')\nconst parseJSON = require('./utils/parse-json.js')\nconst path = require('path')\nconst semver = require('semver')\nconst stringifyPackage = require('./utils/stringify-package')\nconst writeFileAtomic = require('write-file-atomic')\n\nversion.usage = 'npm version [<newversion> | major | minor | patch | premajor | preminor | prepatch | prerelease | from-git]' +\n                '\\n(run in package dir)\\n' +\n                \"'npm -v' or 'npm --version' to print npm version \" +\n                '(' + npm.version + ')\\n' +\n                \"'npm view <pkg> version' to view a package's \" +\n                'published version\\n' +\n                \"'npm ls' to inspect current package/dependency versions\"\n\n// npm version <newver>\nmodule.exports = version\nfunction version (args, silent, cb_) {\n  if (typeof cb_ !== 'function') {\n    cb_ = silent\n    silent = false\n  }\n  if (args.length > 1) return cb_(version.usage)\n\n  readPackage(function (er, data, indent, newline) {\n    if (!args.length) return dump(data, cb_)\n\n    if (er) {\n      log.error('version', 'No valid package.json found')\n      return cb_(er)\n    }\n\n    if (args[0] === 'from-git') {\n      retrieveTagVersion(silent, data, cb_)\n    } else {\n      var newVersion = semver.valid(args[0])\n      if (!newVersion) newVersion = semver.inc(data.version, args[0])\n      if (!newVersion) return cb_(version.usage)\n      persistVersion(newVersion, silent, data, cb_)\n    }\n  })\n}\n\nfunction retrieveTagVersion (silent, data, cb_) {\n  chain([\n    verifyGit,\n    parseLastGitTag\n  ], function (er, results) {\n    if (er) return cb_(er)\n    var localData = {\n      hasGit: true,\n      existingTag: true\n    }\n\n    var version = results[results.length - 1]\n    persistVersion(version, silent, data, localData, cb_)\n  })\n}\n\nfunction parseLastGitTag (cb) {\n  var options = { env: process.env }\n  git.whichAndExec(['describe', '--abbrev=0'], options, function (er, stdout) {\n    if (er) {\n      if (er.message.indexOf('No names found') !== -1) return cb(new Error('No tags found'))\n      return cb(er)\n    }\n\n    var tag = stdout.trim()\n    var prefix = npm.config.get('tag-version-prefix')\n    // Strip the prefix from the start of the tag:\n    if (tag.indexOf(prefix) === 0) tag = tag.slice(prefix.length)\n    var version = semver.valid(tag)\n    if (!version) return cb(new Error(tag + ' is not a valid version'))\n    cb(null, version)\n  })\n}\n\nfunction persistVersion (newVersion, silent, data, localData, cb_) {\n  if (typeof localData === 'function') {\n    cb_ = localData\n    localData = {}\n  }\n\n  if (!npm.config.get('allow-same-version') && data.version === newVersion) {\n    return cb_(new Error('Version not changed, might want --allow-same-version'))\n  }\n  data.version = newVersion\n  var lifecycleData = Object.create(data)\n  lifecycleData._id = data.name + '@' + newVersion\n\n  var where = npm.prefix\n  chain([\n    !localData.hasGit && [checkGit, localData],\n    [lifecycle, lifecycleData, 'preversion', where],\n    [updatePackage, newVersion, silent],\n    [lifecycle, lifecycleData, 'version', where],\n    [commit, localData, newVersion],\n    [lifecycle, lifecycleData, 'postversion', where]\n  ], cb_)\n}\n\nfunction readPackage (cb) {\n  var packagePath = path.join(npm.localPrefix, 'package.json')\n  fs.readFile(packagePath, 'utf8', function (er, data) {\n    if (er) return cb(new Error(er))\n    var indent\n    var newline\n    try {\n      indent = detectIndent(data).indent\n      newline = detectNewline(data)\n      data = JSON.parse(data)\n    } catch (e) {\n      er = e\n      data = null\n    }\n    cb(er, data, indent, newline)\n  })\n}\n\nfunction updatePackage (newVersion, silent, cb_) {\n  function cb (er) {\n    if (!er && !silent) output('v' + newVersion)\n    cb_(er)\n  }\n\n  readPackage(function (er, data, indent, newline) {\n    if (er) return cb(new Error(er))\n    data.version = newVersion\n    write(data, 'package.json', indent, newline, cb)\n  })\n}\n\nfunction commit (localData, newVersion, cb) {\n  updateShrinkwrap(newVersion, function (er, hasShrinkwrap, hasLock) {\n    if (er || !localData.hasGit) return cb(er)\n    localData.hasShrinkwrap = hasShrinkwrap\n    localData.hasPackageLock = hasLock\n    _commit(newVersion, localData, cb)\n  })\n}\n\nconst SHRINKWRAP = 'npm-shrinkwrap.json'\nconst PKGLOCK = 'package-lock.json'\n\nfunction readLockfile (name) {\n  return readFile(\n    path.join(npm.localPrefix, name), 'utf8'\n  ).catch({code: 'ENOENT'}, () => null)\n}\n\nfunction updateShrinkwrap (newVersion, cb) {\n  BB.join(\n    readLockfile(SHRINKWRAP),\n    readLockfile(PKGLOCK),\n    (shrinkwrap, lockfile) => {\n      if (!shrinkwrap && !lockfile) {\n        return cb(null, false, false)\n      }\n      const file = shrinkwrap ? SHRINKWRAP : PKGLOCK\n      let data\n      let indent\n      let newline\n      try {\n        data = parseJSON(shrinkwrap || lockfile)\n        indent = detectIndent(shrinkwrap || lockfile).indent\n        newline = detectNewline(shrinkwrap || lockfile)\n      } catch (err) {\n        log.error('version', `Bad ${file} data.`)\n        return cb(err)\n      }\n      data.version = newVersion\n      write(data, file, indent, newline, (err) => {\n        if (err) {\n          log.error('version', `Failed to update version in ${file}`)\n          return cb(err)\n        } else {\n          return cb(null, !!shrinkwrap, !!lockfile)\n        }\n      })\n    }\n  )\n}\n\nfunction dump (data, cb) {\n  var v = {}\n\n  if (data && data.name && data.version) v[data.name] = data.version\n  v.npm = npm.version\n  Object.keys(process.versions).sort().forEach(function (k) {\n    v[k] = process.versions[k]\n  })\n\n  if (npm.config.get('json')) v = JSON.stringify(v, null, 2)\n\n  output(v)\n  cb()\n}\n\nfunction statGitFolder (cb) {\n  fs.stat(path.join(npm.localPrefix, '.git'), cb)\n}\n\nfunction callGitStatus (cb) {\n  git.whichAndExec(\n    [ 'status', '--porcelain' ],\n    { env: process.env },\n    cb\n  )\n}\n\nfunction cleanStatusLines (stdout) {\n  var lines = stdout.trim().split('\\n').filter(function (line) {\n    return line.trim() && !line.match(/^\\?\\? /)\n  }).map(function (line) {\n    return line.trim()\n  })\n\n  return lines\n}\n\nfunction verifyGit (cb) {\n  function checkStatus (er) {\n    if (er) return cb(er)\n    callGitStatus(checkStdout)\n  }\n\n  function checkStdout (er, stdout) {\n    if (er) return cb(er)\n    var lines = cleanStatusLines(stdout)\n    if (lines.length > 0) {\n      return cb(new Error(\n        'Git working directory not clean.\\n' + lines.join('\\n')\n      ))\n    }\n\n    cb()\n  }\n\n  statGitFolder(checkStatus)\n}\n\nfunction checkGit (localData, cb) {\n  statGitFolder(function (er) {\n    var doGit = !er && npm.config.get('git-tag-version')\n    if (!doGit) {\n      if (er) log.verbose('version', 'error checking for .git', er)\n      log.verbose('version', 'not tagging in git')\n      return cb(null, false)\n    }\n\n    // check for git\n    callGitStatus(function (er, stdout) {\n      if (er && er.code === 'ENOGIT') {\n        log.warn(\n          'version',\n          'This is a Git checkout, but the git command was not found.',\n          'npm could not create a Git tag for this release!'\n        )\n        return cb(null, false)\n      }\n\n      var lines = cleanStatusLines(stdout)\n      if (lines.length && !npm.config.get('force')) {\n        return cb(new Error(\n          'Git working directory not clean.\\n' + lines.join('\\n')\n        ))\n      }\n      localData.hasGit = true\n      cb(null, true)\n    })\n  })\n}\n\nmodule.exports.buildCommitArgs = buildCommitArgs\nfunction buildCommitArgs (args) {\n  args = args || [ 'commit' ]\n  if (!npm.config.get('commit-hooks')) args.push('-n')\n  return args\n}\n\nfunction _commit (version, localData, cb) {\n  const options = { env: process.env }\n  const message = npm.config.get('message').replace(/%s/g, version)\n  const signTag = npm.config.get('sign-git-tag')\n  const signCommit = npm.config.get('sign-git-commit')\n  const commitArgs = buildCommitArgs([ 'commit', signCommit ? '-S -m' : '-m', message ])\n  const flagForTag = signTag ? '-sm' : '-am'\n\n  stagePackageFiles(localData, options).then(() => {\n    return git.exec(commitArgs, options)\n  }).then(() => {\n    if (!localData.existingTag) {\n      return git.exec([\n        'tag', npm.config.get('tag-version-prefix') + version,\n        flagForTag, message\n      ], options)\n    }\n  }).nodeify(cb)\n}\n\nfunction stagePackageFiles (localData, options) {\n  return addLocalFile('package.json', options, false).then(() => {\n    if (localData.hasShrinkwrap) {\n      return addLocalFile('npm-shrinkwrap.json', options, true)\n    } else if (localData.hasPackageLock) {\n      return addLocalFile('package-lock.json', options, true)\n    }\n  })\n}\n\nfunction addLocalFile (file, options, ignoreFailure) {\n  const p = git.exec(['add', path.join(npm.localPrefix, file)], options)\n  return ignoreFailure\n    ? p.catch(() => {})\n    : p\n}\n\nfunction write (data, file, indent, newline, cb) {\n  assert(data && typeof data === 'object', 'must pass data to version write')\n  assert(typeof file === 'string', 'must pass filename to write to version write')\n\n  log.verbose('version.write', 'data', data, 'to', file)\n  writeFileAtomic(\n    path.join(npm.localPrefix, file),\n    stringifyPackage(data, indent, newline),\n    cb\n  )\n}\n"]}