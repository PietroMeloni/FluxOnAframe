{"version":3,"sources":["../../../../node_modules/npm/lib/config.js"],"names":["module","exports","config","log","require","npm","npmconf","fs","writeFileAtomic","types","defs","ini","editor","os","path","mkdirp","umask","usage","output","noProgressTillDone","tillDone","completion","opts","cb","argv","conf","remain","unshift","length","cmds","partialWord","push","action","Object","keys","args","shift","set","get","del","listJson","list","edit","unknown","e","which","f","Error","save","er","readFile","data","concat","defaults","reduce","arr","key","obj","stringify","replace","split","join","EOL","dirname","where","val","undefined","indexOf","k","trim","info","match","fromString","publicVar","toString","sort","a","b","charAt","getKeys","filter","publicConf","value","JSON","listFromSource","title","long","confKeys","msg","forEach","cli","sources","cliKeys","env","project","user","global","builtin","process","execPath","cwd","HOME","defKeys"],"mappings":"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","file":"config.js","sourcesContent":["/* eslint-disable standard/no-callback-literal */\nmodule.exports = config\n\nvar log = require('npmlog')\nvar npm = require('./npm.js')\nvar npmconf = require('./config/core.js')\nvar fs = require('graceful-fs')\nvar writeFileAtomic = require('write-file-atomic')\nvar types = npmconf.defs.types\nvar ini = require('ini')\nvar editor = require('editor')\nvar os = require('os')\nvar path = require('path')\nvar mkdirp = require('mkdirp')\nvar umask = require('./utils/umask')\nvar usage = require('./utils/usage')\nvar output = require('./utils/output')\nvar noProgressTillDone = require('./utils/no-progress-while-running').tillDone\n\nconfig.usage = usage(\n  'config',\n  'npm config set <key> <value>' +\n  '\\nnpm config get [<key>]' +\n  '\\nnpm config delete <key>' +\n  '\\nnpm config list [--json]' +\n  '\\nnpm config edit' +\n  '\\nnpm set <key> <value>' +\n  '\\nnpm get [<key>]'\n)\nconfig.completion = function (opts, cb) {\n  var argv = opts.conf.argv.remain\n  if (argv[1] !== 'config') argv.unshift('config')\n  if (argv.length === 2) {\n    var cmds = ['get', 'set', 'delete', 'ls', 'rm', 'edit']\n    if (opts.partialWord !== 'l') cmds.push('list')\n    return cb(null, cmds)\n  }\n\n  var action = argv[2]\n  switch (action) {\n    case 'set':\n      // todo: complete with valid values, if possible.\n      if (argv.length > 3) return cb(null, [])\n      // fallthrough\n      /* eslint no-fallthrough:0 */\n    case 'get':\n    case 'delete':\n    case 'rm':\n      return cb(null, Object.keys(types))\n    case 'edit':\n    case 'list':\n    case 'ls':\n      return cb(null, [])\n    default:\n      return cb(null, [])\n  }\n}\n\n// npm config set key value\n// npm config get key\n// npm config list\nfunction config (args, cb) {\n  var action = args.shift()\n  switch (action) {\n    case 'set':\n      return set(args[0], args[1], cb)\n    case 'get':\n      return get(args[0], cb)\n    case 'delete':\n    case 'rm':\n    case 'del':\n      return del(args[0], cb)\n    case 'list':\n    case 'ls':\n      return npm.config.get('json') ? listJson(cb) : list(cb)\n    case 'edit':\n      return edit(cb)\n    default:\n      return unknown(action, cb)\n  }\n}\n\nfunction edit (cb) {\n  var e = npm.config.get('editor')\n  var which = npm.config.get('global') ? 'global' : 'user'\n  var f = npm.config.get(which + 'config')\n  if (!e) return cb(new Error('No EDITOR config or environ set.'))\n  npm.config.save(which, function (er) {\n    if (er) return cb(er)\n    fs.readFile(f, 'utf8', function (er, data) {\n      if (er) data = ''\n      data = [\n        ';;;;',\n        '; npm ' + (npm.config.get('global')\n          ? 'globalconfig' : 'userconfig') + ' file',\n        '; this is a simple ini-formatted file',\n        '; lines that start with semi-colons are comments.',\n        '; read `npm help config` for help on the various options',\n        ';;;;',\n        '',\n        data\n      ].concat([\n        ';;;;',\n        '; all options with default values',\n        ';;;;'\n      ]).concat(Object.keys(npmconf.defaults).reduce(function (arr, key) {\n        var obj = {}\n        obj[key] = npmconf.defaults[key]\n        if (key === 'logstream') return arr\n        return arr.concat(\n          ini.stringify(obj)\n            .replace(/\\n$/m, '')\n            .replace(/^/g, '; ')\n            .replace(/\\n/g, '\\n; ')\n            .split('\\n'))\n      }, []))\n        .concat([''])\n        .join(os.EOL)\n      mkdirp(path.dirname(f), function (er) {\n        if (er) return cb(er)\n        writeFileAtomic(\n          f,\n          data,\n          function (er) {\n            if (er) return cb(er)\n            editor(f, { editor: e }, noProgressTillDone(cb))\n          }\n        )\n      })\n    })\n  })\n}\n\nfunction del (key, cb) {\n  if (!key) return cb(new Error('no key provided'))\n  var where = npm.config.get('global') ? 'global' : 'user'\n  npm.config.del(key, where)\n  npm.config.save(where, cb)\n}\n\nfunction set (key, val, cb) {\n  if (key === undefined) {\n    return unknown('', cb)\n  }\n  if (val === undefined) {\n    if (key.indexOf('=') !== -1) {\n      var k = key.split('=')\n      key = k.shift()\n      val = k.join('=')\n    } else {\n      val = ''\n    }\n  }\n  key = key.trim()\n  val = val.trim()\n  log.info('config', 'set %j %j', key, val)\n  var where = npm.config.get('global') ? 'global' : 'user'\n  if (key.match(/umask/)) val = umask.fromString(val)\n  npm.config.set(key, val, where)\n  npm.config.save(where, cb)\n}\n\nfunction get (key, cb) {\n  if (!key) return list(cb)\n  if (!publicVar(key)) {\n    return cb(new Error('---sekretz---'))\n  }\n  var val = npm.config.get(key)\n  if (key.match(/umask/)) val = umask.toString(val)\n  output(val)\n  cb()\n}\n\nfunction sort (a, b) {\n  return a > b ? 1 : -1\n}\n\nfunction publicVar (k) {\n  return !(k.charAt(0) === '_' || k.indexOf(':_') !== -1)\n}\n\nfunction getKeys (data) {\n  return Object.keys(data).filter(publicVar).sort(sort)\n}\n\nfunction listJson (cb) {\n  const publicConf = npm.config.keys.reduce((publicConf, k) => {\n    var value = npm.config.get(k)\n\n    if (publicVar(k) &&\n        // argv is not really config, it's command config\n        k !== 'argv' &&\n        // logstream is a Stream, and would otherwise produce circular refs\n        k !== 'logstream') publicConf[k] = value\n\n    return publicConf\n  }, {})\n\n  output(JSON.stringify(publicConf, null, 2))\n  return cb()\n}\n\nfunction listFromSource (title, conf, long) {\n  var confKeys = getKeys(conf)\n  var msg = ''\n\n  if (confKeys.length) {\n    msg += '; ' + title + '\\n'\n    confKeys.forEach(function (k) {\n      var val = JSON.stringify(conf[k])\n      if (conf[k] !== npm.config.get(k)) {\n        if (!long) return\n        msg += '; ' + k + ' = ' + val + ' (overridden)\\n'\n      } else msg += k + ' = ' + val + '\\n'\n    })\n    msg += '\\n'\n  }\n\n  return msg\n}\n\nfunction list (cb) {\n  var msg = ''\n  var long = npm.config.get('long')\n\n  var cli = npm.config.sources.cli.data\n  var cliKeys = getKeys(cli)\n  if (cliKeys.length) {\n    msg += '; cli configs\\n'\n    cliKeys.forEach(function (k) {\n      if (cli[k] && typeof cli[k] === 'object') return\n      if (k === 'argv') return\n      msg += k + ' = ' + JSON.stringify(cli[k]) + '\\n'\n    })\n    msg += '\\n'\n  }\n\n  // env configs\n  msg += listFromSource('environment configs', npm.config.sources.env.data, long)\n\n  // project config file\n  var project = npm.config.sources.project\n  msg += listFromSource('project config ' + project.path, project.data, long)\n\n  // user config file\n  msg += listFromSource('userconfig ' + npm.config.get('userconfig'), npm.config.sources.user.data, long)\n\n  // global config file\n  msg += listFromSource('globalconfig ' + npm.config.get('globalconfig'), npm.config.sources.global.data, long)\n\n  // builtin config file\n  var builtin = npm.config.sources.builtin || {}\n  if (builtin && builtin.data) {\n    msg += listFromSource('builtin config ' + builtin.path, builtin.data, long)\n  }\n\n  // only show defaults if --long\n  if (!long) {\n    msg += '; node bin location = ' + process.execPath + '\\n' +\n           '; cwd = ' + process.cwd() + '\\n' +\n           '; HOME = ' + process.env.HOME + '\\n' +\n           '; \"npm config ls -l\" to show all defaults.\\n'\n\n    output(msg)\n    return cb()\n  }\n\n  var defaults = npmconf.defaults\n  var defKeys = getKeys(defaults)\n  msg += '; default values\\n'\n  defKeys.forEach(function (k) {\n    if (defaults[k] && typeof defaults[k] === 'object') return\n    var val = JSON.stringify(defaults[k])\n    if (defaults[k] !== npm.config.get(k)) {\n      msg += '; ' + k + ' = ' + val + ' (overridden)\\n'\n    } else msg += k + ' = ' + val + '\\n'\n  })\n  msg += '\\n'\n\n  output(msg)\n  return cb()\n}\n\nfunction unknown (action, cb) {\n  cb('Usage:\\n' + config.usage)\n}\n"]}