{"version":3,"sources":["../../../../node_modules/npm/lib/pack.js"],"names":["BB","require","byteSize","cacache","columnify","cp","deprCheck","fpm","fs","install","lifecycle","promisify","log","move","npm","output","pacote","pacoteOpts","path","PassThrough","pathIsInside","pipe","prepublishWarning","pinflight","readJson","tar","packlist","ssri","pack","usage","completion","module","exports","args","silent","cb","cwd","process","length","all","map","arg","pack_","then","tarballs","config","get","JSON","stringify","forEach","logContents","f","relative","filename","join","nodeify","pkg","dir","fromNode","mani","name","substr","replace","target","version","_requested","type","tmp","withTmp","tmpPrefix","tmpTarget","basename","prepareDirectory","_resolved","packDirectory","tap","verbose","Promise","packFromPackage","opts","tarball","toFile","extract","getContents","Error","scripts","prepublish","logIt","tarOpt","file","prefix","portable","mtime","Date","gzip","resolve","files","create","notice","bytes","size","value","unit","include","showHeaders","bundled","unpackedSize","shasum","integrity","toString","entryCount","filter","x","bundledWanted","Set","bundleDependencies","bundledDependencies","totalEntries","totalEntrySize","t","onentry","entry","p","startsWith","match","has","add","push","mode","strip","stat","fromStream","createReadStream","algorithms","hexDigest","id","_id","from","_from","parse","Array","PASSTHROUGH_OPTS","packGitDep","manifest","stream","prepare","_spec","cliArgs","reduce","acc","opt","child","spawn","env","NODE","execPath","concat","errData","errDataLen","outData","outDataLen","stdout","on","data","gauge","pulse","stderr","code","signal","err","silly","Buffer","error","tmpTar","catch","emit"],"mappings":"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","file":"pack.js","sourcesContent":["'use strict'\n\n// npm pack <pkg>\n// Packs the specified package into a .tgz file, which can then\n// be installed.\n\nconst BB = require('bluebird')\n\nconst byteSize = require('byte-size')\nconst cacache = require('cacache')\nconst columnify = require('columnify')\nconst cp = require('child_process')\nconst deprCheck = require('./utils/depr-check')\nconst fpm = require('./fetch-package-metadata')\nconst fs = require('graceful-fs')\nconst install = require('./install')\nconst lifecycle = BB.promisify(require('./utils/lifecycle'))\nconst log = require('npmlog')\nconst move = require('move-concurrently')\nconst npm = require('./npm')\nconst output = require('./utils/output')\nconst pacote = require('pacote')\nconst pacoteOpts = require('./config/pacote')\nconst path = require('path')\nconst PassThrough = require('stream').PassThrough\nconst pathIsInside = require('path-is-inside')\nconst pipe = BB.promisify(require('mississippi').pipe)\nconst prepublishWarning = require('./utils/warn-deprecated')('prepublish-on-install')\nconst pinflight = require('promise-inflight')\nconst readJson = BB.promisify(require('read-package-json'))\nconst tar = require('tar')\nconst packlist = require('npm-packlist')\nconst ssri = require('ssri')\n\npack.usage = 'npm pack [[<@scope>/]<pkg>...]'\n\n// if it can be installed, it can be packed.\npack.completion = install.completion\n\nmodule.exports = pack\nfunction pack (args, silent, cb) {\n  const cwd = process.cwd()\n  if (typeof cb !== 'function') {\n    cb = silent\n    silent = false\n  }\n\n  if (args.length === 0) args = ['.']\n\n  BB.all(\n    args.map((arg) => pack_(arg, cwd))\n  ).then((tarballs) => {\n    if (!silent && npm.config.get('json')) {\n      output(JSON.stringify(tarballs, null, 2))\n    } else if (!silent) {\n      tarballs.forEach(logContents)\n      output(tarballs.map((f) => path.relative(cwd, f.filename)).join('\\n'))\n    }\n    return tarballs\n  }).nodeify(cb)\n}\n\nfunction pack_ (pkg, dir) {\n  return BB.fromNode((cb) => fpm(pkg, dir, cb)).then((mani) => {\n    let name = mani.name[0] === '@'\n    // scoped packages get special treatment\n      ? mani.name.substr(1).replace(/\\//g, '-')\n      : mani.name\n    const target = `${name}-${mani.version}.tgz`\n    return pinflight(target, () => {\n      if (mani._requested.type === 'directory') {\n        return cacache.tmp.withTmp(npm.tmp, {tmpPrefix: 'packing'}, (tmp) => {\n          const tmpTarget = path.join(tmp, path.basename(target))\n          return prepareDirectory(mani._resolved)\n            .then(() => {\n              return packDirectory(mani, mani._resolved, tmpTarget, target, true)\n            })\n            .tap(() => {\n              if (npm.config.get('dry-run')) {\n                log.verbose('pack', '--dry-run mode enabled. Skipping write.')\n              } else {\n                return move(tmpTarget, target, {Promise: BB, fs})\n              }\n            })\n        })\n      } else if (npm.config.get('dry-run')) {\n        log.verbose('pack', '--dry-run mode enabled. Skipping write.')\n        return cacache.tmp.withTmp(npm.tmp, {tmpPrefix: 'packing'}, (tmp) => {\n          const tmpTarget = path.join(tmp, path.basename(target))\n          return packFromPackage(pkg, tmpTarget, target)\n        })\n      } else {\n        return packFromPackage(pkg, target, target)\n      }\n    })\n  })\n}\n\nfunction packFromPackage (arg, target, filename) {\n  const opts = pacoteOpts()\n  return pacote.tarball.toFile(arg, target, pacoteOpts())\n    .then(() => cacache.tmp.withTmp(npm.tmp, {tmpPrefix: 'unpacking'}, (tmp) => {\n      const tmpTarget = path.join(tmp, filename)\n      return pacote.extract(arg, tmpTarget, opts)\n        .then(() => readJson(path.join(tmpTarget, 'package.json')))\n    }))\n    .then((pkg) => getContents(pkg, target, filename))\n}\n\nmodule.exports.prepareDirectory = prepareDirectory\nfunction prepareDirectory (dir) {\n  return readJson(path.join(dir, 'package.json')).then((pkg) => {\n    if (!pkg.name) {\n      throw new Error('package.json requires a \"name\" field')\n    }\n    if (!pkg.version) {\n      throw new Error('package.json requires a valid \"version\" field')\n    }\n    if (!pathIsInside(dir, npm.tmp)) {\n      if (pkg.scripts && pkg.scripts.prepublish) {\n        prepublishWarning([\n          'As of npm@5, `prepublish` scripts are deprecated.',\n          'Use `prepare` for build steps and `prepublishOnly` for upload-only.',\n          'See the deprecation note in `npm help scripts` for more information.'\n        ])\n      }\n      if (npm.config.get('ignore-prepublish')) {\n        return lifecycle(pkg, 'prepare', dir).then(() => pkg)\n      } else {\n        return lifecycle(pkg, 'prepublish', dir).then(() => {\n          return lifecycle(pkg, 'prepare', dir)\n        }).then(() => pkg)\n      }\n    }\n    return pkg\n  })\n}\n\nmodule.exports.packDirectory = packDirectory\nfunction packDirectory (mani, dir, target, filename, logIt) {\n  deprCheck(mani)\n  return readJson(path.join(dir, 'package.json')).then((pkg) => {\n    return lifecycle(pkg, 'prepack', dir)\n  }).then(() => {\n    return readJson(path.join(dir, 'package.json'))\n  }).then((pkg) => {\n    return cacache.tmp.withTmp(npm.tmp, {tmpPrefix: 'packing'}, (tmp) => {\n      const tmpTarget = path.join(tmp, path.basename(target))\n\n      const tarOpt = {\n        file: tmpTarget,\n        cwd: dir,\n        prefix: 'package/',\n        portable: true,\n        // Provide a specific date in the 1980s for the benefit of zip,\n        // which is confounded by files dated at the Unix epoch 0.\n        mtime: new Date('1985-10-26T08:15:00.000Z'),\n        gzip: true\n      }\n\n      return BB.resolve(packlist({ path: dir }))\n      // NOTE: node-tar does some Magic Stuff depending on prefixes for files\n      //       specifically with @ signs, so we just neutralize that one\n      //       and any such future \"features\" by prepending `./`\n        .then((files) => tar.create(tarOpt, files.map((f) => `./${f}`)))\n        .then(() => getContents(pkg, tmpTarget, filename, logIt))\n        // thread the content info through\n        .tap(() => move(tmpTarget, target, {Promise: BB, fs}))\n        .tap(() => lifecycle(pkg, 'postpack', dir))\n    })\n  })\n}\n\nmodule.exports.logContents = logContents\nfunction logContents (tarball) {\n  log.notice('')\n  log.notice('', `${npm.config.get('unicode') ? 'ðŸ“¦ ' : 'package:'} ${tarball.name}@${tarball.version}`)\n  log.notice('=== Tarball Contents ===')\n  if (tarball.files.length) {\n    log.notice('', columnify(tarball.files.map((f) => {\n      const bytes = byteSize(f.size)\n      return {path: f.path, size: `${bytes.value}${bytes.unit}`}\n    }), {\n      include: ['size', 'path'],\n      showHeaders: false\n    }))\n  }\n  if (tarball.bundled.length) {\n    log.notice('=== Bundled Dependencies ===')\n    tarball.bundled.forEach((name) => log.notice('', name))\n  }\n  log.notice('=== Tarball Details ===')\n  log.notice('', columnify([\n    {name: 'name:', value: tarball.name},\n    {name: 'version:', value: tarball.version},\n    tarball.filename && {name: 'filename:', value: tarball.filename},\n    {name: 'package size:', value: byteSize(tarball.size)},\n    {name: 'unpacked size:', value: byteSize(tarball.unpackedSize)},\n    {name: 'shasum:', value: tarball.shasum},\n    {\n      name: 'integrity:',\n      value: tarball.integrity.toString().substr(0, 20) + '[...]' + tarball.integrity.toString().substr(80)},\n    tarball.bundled.length && {name: 'bundled deps:', value: tarball.bundled.length},\n    tarball.bundled.length && {name: 'bundled files:', value: tarball.entryCount - tarball.files.length},\n    tarball.bundled.length && {name: 'own files:', value: tarball.files.length},\n    {name: 'total files:', value: tarball.entryCount}\n  ].filter((x) => x), {\n    include: ['name', 'value'],\n    showHeaders: false\n  }))\n  log.notice('', '')\n}\n\nmodule.exports.getContents = getContents\nfunction getContents (pkg, target, filename, silent) {\n  const bundledWanted = new Set(\n    pkg.bundleDependencies ||\n    pkg.bundledDependencies ||\n    []\n  )\n  const files = []\n  const bundled = new Set()\n  let totalEntries = 0\n  let totalEntrySize = 0\n  return tar.t({\n    file: target,\n    onentry (entry) {\n      totalEntries++\n      totalEntrySize += entry.size\n      const p = entry.path\n      if (p.startsWith('package/node_modules/')) {\n        const name = p.match(/^package\\/node_modules\\/((?:@[^/]+\\/)?[^/]+)/)[1]\n        if (bundledWanted.has(name)) {\n          bundled.add(name)\n        }\n      } else {\n        files.push({\n          path: entry.path.replace(/^package\\//, ''),\n          size: entry.size,\n          mode: entry.mode\n        })\n      }\n    },\n    strip: 1\n  })\n    .then(() => BB.all([\n      BB.fromNode((cb) => fs.stat(target, cb)),\n      ssri.fromStream(fs.createReadStream(target), {\n        algorithms: ['sha1', 'sha512']\n      })\n    ]))\n    .then(([stat, integrity]) => {\n      const shasum = integrity['sha1'][0].hexDigest()\n      return {\n        id: pkg._id,\n        name: pkg.name,\n        version: pkg.version,\n        from: pkg._from,\n        size: stat.size,\n        unpackedSize: totalEntrySize,\n        shasum,\n        integrity: ssri.parse(integrity['sha512'][0]),\n        filename,\n        files,\n        entryCount: totalEntries,\n        bundled: Array.from(bundled)\n      }\n    })\n}\n\nconst PASSTHROUGH_OPTS = [\n  'always-auth',\n  'auth-type',\n  'ca',\n  'cafile',\n  'cert',\n  'git',\n  'local-address',\n  'maxsockets',\n  'offline',\n  'prefer-offline',\n  'prefer-online',\n  'proxy',\n  'https-proxy',\n  'registry',\n  'send-metrics',\n  'sso-poll-frequency',\n  'sso-type',\n  'strict-ssl'\n]\n\nmodule.exports.packGitDep = packGitDep\nfunction packGitDep (manifest, dir) {\n  const stream = new PassThrough()\n  readJson(path.join(dir, 'package.json')).then((pkg) => {\n    if (pkg.scripts && pkg.scripts.prepare) {\n      log.verbose('prepareGitDep', `${manifest._spec}: installing devDeps and running prepare script.`)\n      const cliArgs = PASSTHROUGH_OPTS.reduce((acc, opt) => {\n        if (npm.config.get(opt, 'cli') != null) {\n          acc.push(`--${opt}=${npm.config.get(opt)}`)\n        }\n        return acc\n      }, [])\n      const child = cp.spawn(process.env.NODE || process.execPath, [\n        require.resolve('../bin/npm-cli.js'),\n        'install',\n        '--dev',\n        '--prod',\n        '--ignore-prepublish',\n        '--no-progress',\n        '--no-save'\n      ].concat(cliArgs), {\n        cwd: dir,\n        env: process.env\n      })\n      let errData = []\n      let errDataLen = 0\n      let outData = []\n      let outDataLen = 0\n      child.stdout.on('data', (data) => {\n        outData.push(data)\n        outDataLen += data.length\n        log.gauge.pulse('preparing git package')\n      })\n      child.stderr.on('data', (data) => {\n        errData.push(data)\n        errDataLen += data.length\n        log.gauge.pulse('preparing git package')\n      })\n      return BB.fromNode((cb) => {\n        child.on('error', cb)\n        child.on('exit', (code, signal) => {\n          if (code > 0) {\n            const err = new Error(`${signal}: npm exited with code ${code} while attempting to build ${manifest._requested}. Clone the repository manually and run 'npm install' in it for more information.`)\n            err.code = code\n            err.signal = signal\n            cb(err)\n          } else {\n            cb()\n          }\n        })\n      }).then(() => {\n        if (outDataLen > 0) log.silly('prepareGitDep', '1>', Buffer.concat(outData, outDataLen).toString())\n        if (errDataLen > 0) log.silly('prepareGitDep', '2>', Buffer.concat(errData, errDataLen).toString())\n      }, (err) => {\n        if (outDataLen > 0) log.error('prepareGitDep', '1>', Buffer.concat(outData, outDataLen).toString())\n        if (errDataLen > 0) log.error('prepareGitDep', '2>', Buffer.concat(errData, errDataLen).toString())\n        throw err\n      })\n    }\n  }).then(() => {\n    return readJson(path.join(dir, 'package.json'))\n  }).then((pkg) => {\n    return cacache.tmp.withTmp(npm.tmp, {\n      tmpPrefix: 'pacote-packing'\n    }, (tmp) => {\n      const tmpTar = path.join(tmp, 'package.tgz')\n      return packDirectory(manifest, dir, tmpTar).then(() => {\n        return pipe(fs.createReadStream(tmpTar), stream)\n      })\n    })\n  }).catch((err) => stream.emit('error', err))\n  return stream\n}\n"]}