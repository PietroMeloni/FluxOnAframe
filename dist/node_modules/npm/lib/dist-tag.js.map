{"version":3,"sources":["../../../../node_modules/npm/lib/dist-tag.js"],"names":["module","exports","distTag","log","require","npa","semver","npm","mapToRegistry","readLocalPkg","usage","output","completion","opts","cb","argv","conf","remain","length","args","cmd","shift","add","remove","list","spec","tag","thing","pkg","name","version","rawSpec","t","config","get","trim","verbose","validRange","er","Error","fetchTags","tags","warn","uri","auth","base","params","registry","distTags","info","rm","error","msg","Object","keys","map","k","sort","join","fetch"],"mappings":"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","file":"dist-tag.js","sourcesContent":["/* eslint-disable standard/no-callback-literal */\nmodule.exports = distTag\n\nvar log = require('npmlog')\nvar npa = require('npm-package-arg')\nvar semver = require('semver')\n\nvar npm = require('./npm.js')\nvar mapToRegistry = require('./utils/map-to-registry.js')\nvar readLocalPkg = require('./utils/read-local-package.js')\nvar usage = require('./utils/usage')\nvar output = require('./utils/output.js')\n\ndistTag.usage = usage(\n  'dist-tag',\n  'npm dist-tag add <pkg>@<version> [<tag>]' +\n  '\\nnpm dist-tag rm <pkg> <tag>' +\n  '\\nnpm dist-tag ls [<pkg>]'\n)\n\ndistTag.completion = function (opts, cb) {\n  var argv = opts.conf.argv.remain\n  if (argv.length === 2) {\n    return cb(null, ['add', 'rm', 'ls'])\n  }\n\n  switch (argv[2]) {\n    default:\n      return cb()\n  }\n}\n\nfunction distTag (args, cb) {\n  var cmd = args.shift()\n  switch (cmd) {\n    case 'add': case 'a': case 'set': case 's':\n      return add(args[0], args[1], cb)\n    case 'rm': case 'r': case 'del': case 'd': case 'remove':\n      return remove(args[1], args[0], cb)\n    case 'ls': case 'l': case 'sl': case 'list':\n      return list(args[0], cb)\n    default:\n      return cb('Usage:\\n' + distTag.usage)\n  }\n}\n\nfunction add (spec, tag, cb) {\n  var thing = npa(spec || '')\n  var pkg = thing.name\n  var version = thing.rawSpec\n  var t = (tag || npm.config.get('tag')).trim()\n\n  log.verbose('dist-tag add', t, 'to', pkg + '@' + version)\n\n  if (!pkg || !version || !t) return cb('Usage:\\n' + distTag.usage)\n\n  if (semver.validRange(t)) {\n    var er = new Error('Tag name must not be a valid SemVer range: ' + t)\n    return cb(er)\n  }\n\n  fetchTags(pkg, function (er, tags) {\n    if (er) return cb(er)\n\n    if (tags[t] === version) {\n      log.warn('dist-tag add', t, 'is already set to version', version)\n      return cb()\n    }\n    tags[t] = version\n\n    mapToRegistry(pkg, npm.config, function (er, uri, auth, base) {\n      var params = {\n        'package': pkg,\n        distTag: t,\n        version: version,\n        auth: auth\n      }\n\n      npm.registry.distTags.add(base, params, function (er) {\n        if (er) return cb(er)\n\n        output('+' + t + ': ' + pkg + '@' + version)\n        cb()\n      })\n    })\n  })\n}\n\nfunction remove (tag, pkg, cb) {\n  log.verbose('dist-tag del', tag, 'from', pkg)\n\n  fetchTags(pkg, function (er, tags) {\n    if (er) return cb(er)\n\n    if (!tags[tag]) {\n      log.info('dist-tag del', tag, 'is not a dist-tag on', pkg)\n      return cb(new Error(tag + ' is not a dist-tag on ' + pkg))\n    }\n\n    var version = tags[tag]\n    delete tags[tag]\n\n    mapToRegistry(pkg, npm.config, function (er, uri, auth, base) {\n      var params = {\n        'package': pkg,\n        distTag: tag,\n        auth: auth\n      }\n\n      npm.registry.distTags.rm(base, params, function (er) {\n        if (er) return cb(er)\n\n        output('-' + tag + ': ' + pkg + '@' + version)\n        cb()\n      })\n    })\n  })\n}\n\nfunction list (pkg, cb) {\n  if (!pkg) {\n    return readLocalPkg(function (er, pkg) {\n      if (er) return cb(er)\n      if (!pkg) return cb(distTag.usage)\n      list(pkg, cb)\n    })\n  }\n\n  fetchTags(pkg, function (er, tags) {\n    if (er) {\n      log.error('dist-tag ls', \"Couldn't get dist-tag data for\", pkg)\n      return cb(er)\n    }\n    var msg = Object.keys(tags).map(function (k) {\n      return k + ': ' + tags[k]\n    }).sort().join('\\n')\n    output(msg)\n    cb(er, tags)\n  })\n}\n\nfunction fetchTags (pkg, cb) {\n  mapToRegistry(pkg, npm.config, function (er, uri, auth, base) {\n    if (er) return cb(er)\n\n    var params = {\n      'package': pkg,\n      auth: auth\n    }\n    npm.registry.distTags.fetch(base, params, function (er, tags) {\n      if (er) return cb(er)\n      if (!tags || !Object.keys(tags).length) {\n        return cb(new Error('No dist-tags found for ' + pkg))\n      }\n\n      cb(null, tags)\n    })\n  })\n}\n"]}