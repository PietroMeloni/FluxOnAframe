{"version":3,"sources":["../../../../../node_modules/npm/lib/search/all-package-search.js"],"names":["ms","require","allPackageMetadata","packageFilter","module","exports","allPackageSearch","opts","searchSection","unicode","allEntriesStream","staleness","filterStream","streamFilter","pkg","log","gauge","pulse","show","section","logline","name","match","include","exclude","description","pipeline","obj","filter","through","data","enc","cb","push","standardizePkg","maintainers","map","m","username","email","keywords","version","Object","keys","versions","date","time","modified","Date"],"mappings":";;AAAA,IAAIA,KAAKC,QAAQ,aAAR,CAAT;AACA,IAAIC,qBAAqBD,QAAQ,wBAAR,CAAzB;AACA,IAAIE,gBAAgBF,QAAQ,qBAAR,CAApB;;AAEAG,OAAOC,OAAP,GAAiBC,gBAAjB;AACA,SAASA,gBAAT,CAA2BC,IAA3B,EAAiC;AAC/B,MAAIC,gBAAgB,CAACD,KAAKE,OAAL,GAAe,KAAf,GAAuB,EAAxB,IAA8B,QAAlD;;AAEA;AACA;AACA,MAAIC,mBAAmBR,mBAAmBK,KAAKI,SAAxB,CAAvB;;AAEA;AACA,MAAIC,eAAeC,aAAa,UAAUC,GAAV,EAAe;AAC7CP,SAAKQ,GAAL,CAASC,KAAT,CAAeC,KAAf,CAAqB,QAArB;AACAV,SAAKQ,GAAL,CAASC,KAAT,CAAeE,IAAf,CAAoB,EAACC,SAASX,aAAV,EAAyBY,SAAS,cAAcN,IAAIO,IAApD,EAApB;AACA;AACA,QAAIC,QAAQnB,cAAcW,GAAd,EAAmBP,KAAKgB,OAAxB,EAAiChB,KAAKiB,OAAtC,EAA+C;AACzDC,mBAAalB,KAAKkB;AADuC,KAA/C,CAAZ;AAGA,WAAOH,KAAP;AACD,GARkB,CAAnB;AASA,SAAOtB,GAAG0B,QAAH,CAAYC,GAAZ,CAAgBjB,gBAAhB,EAAkCE,YAAlC,CAAP;AACD;;AAED,SAASC,YAAT,CAAuBe,MAAvB,EAA+B;AAC7B,SAAO5B,GAAG6B,OAAH,CAAWF,GAAX,CAAe,UAAUG,IAAV,EAAgBC,GAAhB,EAAqBC,EAArB,EAAyB;AAC7C,QAAIJ,OAAOE,IAAP,CAAJ,EAAkB;AAChB,WAAKG,IAAL,CAAUC,eAAeJ,IAAf,CAAV;AACD;AACDE;AACD,GALM,CAAP;AAMD;;AAED,SAASE,cAAT,CAAyBJ,IAAzB,EAA+B;AAC7B,SAAO;AACLT,UAAMS,KAAKT,IADN;AAELI,iBAAaK,KAAKL,WAFb;AAGLU,iBAAa,CAACL,KAAKK,WAAL,IAAoB,EAArB,EAAyBC,GAAzB,CAA6B,UAAUC,CAAV,EAAa;AACrD,aAAO,EAAEC,UAAUD,EAAEhB,IAAd,EAAoBkB,OAAOF,EAAEE,KAA7B,EAAP;AACD,KAFY,CAHR;AAMLC,cAAUV,KAAKU,QAAL,IAAiB,EANtB;AAOLC,aAASC,OAAOC,IAAP,CAAYb,KAAKc,QAAL,IAAiB,EAA7B,EAAiC,CAAjC,KAAuC,EAP3C;AAQLC,UACEf,KAAKgB,IAAL,IACAhB,KAAKgB,IAAL,CAAUC,QADV,IAEA,IAAIC,IAAJ,CAASlB,KAAKgB,IAAL,CAAUC,QAAnB,CAHI,IAID;AAZA,GAAP;AAcD","file":"all-package-search.js","sourcesContent":["var ms = require('mississippi')\nvar allPackageMetadata = require('./all-package-metadata')\nvar packageFilter = require('./package-filter.js')\n\nmodule.exports = allPackageSearch\nfunction allPackageSearch (opts) {\n  var searchSection = (opts.unicode ? 'ðŸ¤” ' : '') + 'search'\n\n  // Get a stream with *all* the packages. This takes care of dealing\n  // with the local cache as well, but that's an internal detail.\n  var allEntriesStream = allPackageMetadata(opts.staleness)\n\n  // Grab a stream that filters those packages according to given params.\n  var filterStream = streamFilter(function (pkg) {\n    opts.log.gauge.pulse('search')\n    opts.log.gauge.show({section: searchSection, logline: 'scanning ' + pkg.name})\n    // Simply 'true' if the package matches search parameters.\n    var match = packageFilter(pkg, opts.include, opts.exclude, {\n      description: opts.description\n    })\n    return match\n  })\n  return ms.pipeline.obj(allEntriesStream, filterStream)\n}\n\nfunction streamFilter (filter) {\n  return ms.through.obj(function (data, enc, cb) {\n    if (filter(data)) {\n      this.push(standardizePkg(data))\n    }\n    cb()\n  })\n}\n\nfunction standardizePkg (data) {\n  return {\n    name: data.name,\n    description: data.description,\n    maintainers: (data.maintainers || []).map(function (m) {\n      return { username: m.name, email: m.email }\n    }),\n    keywords: data.keywords || [],\n    version: Object.keys(data.versions || {})[0] || [],\n    date: (\n      data.time &&\n      data.time.modified &&\n      new Date(data.time.modified)\n    ) || null\n  }\n}\n"]}