{"version":3,"sources":["../../../../../node_modules/npm/lib/config/pacote.js"],"names":["Buffer","require","crypto","npm","log","pack","path","effectiveOwner","npmSession","randomBytes","toString","verbose","module","exports","pacoteOpts","moreOpts","ownerStats","calculateOwner","opts","cache","join","config","get","ca","cert","defaultTag","dirPacker","packGitDep","hashAlgorithm","includeDeprecated","key","localAddress","maxAge","maxSockets","offline","preferOffline","preferOnline","projectScope","proxy","noProxy","refer","registry","retry","retries","factor","minTimeout","maxTimeout","scope","strictSSL","userAgent","dmode","modes","exec","fmode","file","umask","uid","gid","Object","assign","keys","forEach","k","authMatchGlobal","match","authMatchScoped","nerfDart","val","auth","alwaysAuth","token","password","from","scopeTargets","replace","process","getuid","getgid","env","SUDO_UID","SUDO_GID"],"mappings":"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","file":"pacote.js","sourcesContent":["'use strict'\n\nconst Buffer = require('safe-buffer').Buffer\n\nconst crypto = require('crypto')\nconst npm = require('../npm')\nconst log = require('npmlog')\nlet pack\nconst path = require('path')\n\nlet effectiveOwner\n\nconst npmSession = crypto.randomBytes(8).toString('hex')\nlog.verbose('npm-session', npmSession)\n\nmodule.exports = pacoteOpts\nfunction pacoteOpts (moreOpts) {\n  if (!pack) {\n    pack = require('../pack.js')\n  }\n  const ownerStats = calculateOwner()\n  const opts = {\n    cache: path.join(npm.config.get('cache'), '_cacache'),\n    ca: npm.config.get('ca'),\n    cert: npm.config.get('cert'),\n    defaultTag: npm.config.get('tag'),\n    dirPacker: pack.packGitDep,\n    hashAlgorithm: 'sha1',\n    includeDeprecated: false,\n    key: npm.config.get('key'),\n    localAddress: npm.config.get('local-address'),\n    log: log,\n    maxAge: npm.config.get('cache-min'),\n    maxSockets: npm.config.get('maxsockets'),\n    npmSession: npmSession,\n    offline: npm.config.get('offline'),\n    preferOffline: npm.config.get('prefer-offline') || npm.config.get('cache-min') > 9999,\n    preferOnline: npm.config.get('prefer-online') || npm.config.get('cache-max') <= 0,\n    projectScope: npm.projectScope,\n    proxy: npm.config.get('https-proxy') || npm.config.get('proxy'),\n    noProxy: npm.config.get('no-proxy'),\n    refer: npm.registry.refer,\n    registry: npm.config.get('registry'),\n    retry: {\n      retries: npm.config.get('fetch-retries'),\n      factor: npm.config.get('fetch-retry-factor'),\n      minTimeout: npm.config.get('fetch-retry-mintimeout'),\n      maxTimeout: npm.config.get('fetch-retry-maxtimeout')\n    },\n    scope: npm.config.get('scope'),\n    strictSSL: npm.config.get('strict-ssl'),\n    userAgent: npm.config.get('user-agent'),\n\n    dmode: npm.modes.exec,\n    fmode: npm.modes.file,\n    umask: npm.modes.umask\n  }\n\n  if (ownerStats.uid != null || ownerStats.gid != null) {\n    Object.assign(opts, ownerStats)\n  }\n\n  npm.config.keys.forEach(function (k) {\n    const authMatchGlobal = k.match(\n      /^(_authToken|username|_password|password|email|always-auth|_auth)$/\n    )\n    const authMatchScoped = k[0] === '/' && k.match(\n      /(.*):(_authToken|username|_password|password|email|always-auth|_auth)$/\n    )\n\n    // if it matches scoped it will also match global\n    if (authMatchGlobal || authMatchScoped) {\n      let nerfDart = null\n      let key = null\n      let val = null\n\n      if (!opts.auth) { opts.auth = {} }\n\n      if (authMatchScoped) {\n        nerfDart = authMatchScoped[1]\n        key = authMatchScoped[2]\n        val = npm.config.get(k)\n        if (!opts.auth[nerfDart]) {\n          opts.auth[nerfDart] = {\n            alwaysAuth: !!npm.config.get('always-auth')\n          }\n        }\n      } else {\n        key = authMatchGlobal[1]\n        val = npm.config.get(k)\n        opts.auth.alwaysAuth = !!npm.config.get('always-auth')\n      }\n\n      const auth = authMatchScoped ? opts.auth[nerfDart] : opts.auth\n      if (key === '_authToken') {\n        auth.token = val\n      } else if (key.match(/password$/i)) {\n        auth.password =\n        // the config file stores password auth already-encoded. pacote expects\n        // the actual username/password pair.\n        Buffer.from(val, 'base64').toString('utf8')\n      } else if (key === 'always-auth') {\n        auth.alwaysAuth = val === 'false' ? false : !!val\n      } else {\n        auth[key] = val\n      }\n    }\n\n    if (k[0] === '@') {\n      if (!opts.scopeTargets) { opts.scopeTargets = {} }\n      opts.scopeTargets[k.replace(/:registry$/, '')] = npm.config.get(k)\n    }\n  })\n\n  Object.keys(moreOpts || {}).forEach((k) => {\n    opts[k] = moreOpts[k]\n  })\n\n  return opts\n}\n\nfunction calculateOwner () {\n  if (!effectiveOwner) {\n    effectiveOwner = { uid: 0, gid: 0 }\n\n    // Pretty much only on windows\n    if (!process.getuid) {\n      return effectiveOwner\n    }\n\n    effectiveOwner.uid = +process.getuid()\n    effectiveOwner.gid = +process.getgid()\n\n    if (effectiveOwner.uid === 0) {\n      if (process.env.SUDO_UID) effectiveOwner.uid = +process.env.SUDO_UID\n      if (process.env.SUDO_GID) effectiveOwner.gid = +process.env.SUDO_GID\n    }\n  }\n\n  return effectiveOwner\n}\n"]}