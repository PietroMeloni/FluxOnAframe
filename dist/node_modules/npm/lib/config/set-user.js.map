{"version":3,"sources":["../../../../../node_modules/npm/lib/config/set-user.js"],"names":["module","exports","setUser","assert","require","path","fs","mkdirp","cb","defaultConf","root","Object","prototype","get","process","env","SUDO_UID","user","prefix","resolve","er","stat","st","uid"],"mappings":";;AAAAA,OAAOC,OAAP,GAAiBC,OAAjB;;AAEA,IAAIC,SAASC,QAAQ,QAAR,CAAb;AACA,IAAIC,OAAOD,QAAQ,MAAR,CAAX;AACA,IAAIE,KAAKF,QAAQ,IAAR,CAAT;AACA,IAAIG,SAASH,QAAQ,QAAR,CAAb;;AAEA,SAASF,OAAT,CAAkBM,EAAlB,EAAsB;AACpB,MAAIC,cAAc,KAAKC,IAAvB;AACAP,SAAOM,gBAAgBE,OAAOC,SAA9B;;AAEA;AACA;AACA;AACA,MAAI,KAAKC,GAAL,CAAS,QAAT,CAAJ,EAAwB,OAAOL,IAAP;AACxB,MAAIM,QAAQC,GAAR,CAAYC,QAAhB,EAA0B;AACxBP,gBAAYQ,IAAZ,GAAmB,CAAEH,QAAQC,GAAR,CAAYC,QAAjC;AACA,WAAOR,IAAP;AACD;;AAED,MAAIU,SAASb,KAAKc,OAAL,CAAa,KAAKN,GAAL,CAAS,QAAT,CAAb,CAAb;AACAN,SAAOW,MAAP,EAAe,UAAUE,EAAV,EAAc;AAC3B,QAAIA,EAAJ,EAAQ,OAAOZ,GAAGY,EAAH,CAAP;AACRd,OAAGe,IAAH,CAAQH,MAAR,EAAgB,UAAUE,EAAV,EAAcE,EAAd,EAAkB;AAChCb,kBAAYQ,IAAZ,GAAmBK,MAAMA,GAAGC,GAA5B;AACA,aAAOf,GAAGY,EAAH,CAAP;AACD,KAHD;AAID,GAND;AAOD","file":"set-user.js","sourcesContent":["module.exports = setUser\n\nvar assert = require('assert')\nvar path = require('path')\nvar fs = require('fs')\nvar mkdirp = require('mkdirp')\n\nfunction setUser (cb) {\n  var defaultConf = this.root\n  assert(defaultConf !== Object.prototype)\n\n  // If global, leave it as-is.\n  // If not global, then set the user to the owner of the prefix folder.\n  // Just set the default, so it can be overridden.\n  if (this.get('global')) return cb()\n  if (process.env.SUDO_UID) {\n    defaultConf.user = +(process.env.SUDO_UID)\n    return cb()\n  }\n\n  var prefix = path.resolve(this.get('prefix'))\n  mkdirp(prefix, function (er) {\n    if (er) return cb(er)\n    fs.stat(prefix, function (er, st) {\n      defaultConf.user = st && st.uid\n      return cb(er)\n    })\n  })\n}\n"]}