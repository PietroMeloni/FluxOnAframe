{"version":3,"sources":["../../../../node_modules/npm/lib/access.js"],"names":["resolve","require","readPackageJson","mapToRegistry","npm","output","whoami","module","exports","access","usage","subcommands","completion","opts","cb","argv","conf","remain","length","Error","args","cmd","shift","params","parseParams","err","p","package","config","invokeCmd","uri","auth","base","registry","data","JSON","stringify","undefined","e","message","permissions","indexOf","entity","split","scope","team","getPackage","pkg","user","name","trim","prefix","code"],"mappings":"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","file":"access.js","sourcesContent":["'use strict'\n/* eslint-disable standard/no-callback-literal */\n\nvar resolve = require('path').resolve\n\nvar readPackageJson = require('read-package-json')\nvar mapToRegistry = require('./utils/map-to-registry.js')\nvar npm = require('./npm.js')\nvar output = require('./utils/output.js')\n\nvar whoami = require('./whoami')\n\nmodule.exports = access\n\naccess.usage =\n  'npm access public [<package>]\\n' +\n  'npm access restricted [<package>]\\n' +\n  'npm access grant <read-only|read-write> <scope:team> [<package>]\\n' +\n  'npm access revoke <scope:team> [<package>]\\n' +\n  'npm access ls-packages [<user>|<scope>|<scope:team>]\\n' +\n  'npm access ls-collaborators [<package> [<user>]]\\n' +\n  'npm access edit [<package>]'\n\naccess.subcommands = ['public', 'restricted', 'grant', 'revoke',\n  'ls-packages', 'ls-collaborators', 'edit']\n\naccess.completion = function (opts, cb) {\n  var argv = opts.conf.argv.remain\n  if (argv.length === 2) {\n    return cb(null, access.subcommands)\n  }\n\n  switch (argv[2]) {\n    case 'grant':\n      if (argv.length === 3) {\n        return cb(null, ['read-only', 'read-write'])\n      } else {\n        return cb(null, [])\n      }\n    case 'public':\n    case 'restricted':\n    case 'ls-packages':\n    case 'ls-collaborators':\n    case 'edit':\n      return cb(null, [])\n    case 'revoke':\n      return cb(null, [])\n    default:\n      return cb(new Error(argv[2] + ' not recognized'))\n  }\n}\n\nfunction access (args, cb) {\n  var cmd = args.shift()\n  var params\n  return parseParams(cmd, args, function (err, p) {\n    if (err) { return cb(err) }\n    params = p\n    return mapToRegistry(params.package, npm.config, invokeCmd)\n  })\n\n  function invokeCmd (err, uri, auth, base) {\n    if (err) { return cb(err) }\n    params.auth = auth\n    try {\n      return npm.registry.access(cmd, uri, params, function (err, data) {\n        if (!err && data) {\n          output(JSON.stringify(data, undefined, 2))\n        }\n        cb(err, data)\n      })\n    } catch (e) {\n      cb(e.message + '\\n\\nUsage:\\n' + access.usage)\n    }\n  }\n}\n\nfunction parseParams (cmd, args, cb) {\n  // mapToRegistry will complain if package is undefined,\n  // but it's not needed for ls-packages\n  var params = { 'package': '' }\n  if (cmd === 'grant') {\n    params.permissions = args.shift()\n  }\n  if (['grant', 'revoke', 'ls-packages'].indexOf(cmd) !== -1) {\n    var entity = (args.shift() || '').split(':')\n    params.scope = entity[0]\n    params.team = entity[1]\n  }\n\n  if (cmd === 'ls-packages') {\n    if (!params.scope) {\n      whoami([], true, function (err, scope) {\n        params.scope = scope\n        cb(err, params)\n      })\n    } else {\n      cb(null, params)\n    }\n  } else {\n    getPackage(args.shift(), function (err, pkg) {\n      if (err) return cb(err)\n      params.package = pkg\n\n      if (cmd === 'ls-collaborators') params.user = args.shift()\n      cb(null, params)\n    })\n  }\n}\n\nfunction getPackage (name, cb) {\n  if (name && name.trim()) {\n    cb(null, name.trim())\n  } else {\n    readPackageJson(\n      resolve(npm.prefix, 'package.json'),\n      function (err, data) {\n        if (err) {\n          if (err.code === 'ENOENT') {\n            cb(new Error('no package name passed to command and no package.json found'))\n          } else {\n            cb(err)\n          }\n        } else {\n          cb(null, data.name)\n        }\n      }\n    )\n  }\n}\n"]}