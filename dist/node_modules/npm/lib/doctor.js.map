{"version":3,"sources":["../../../../node_modules/npm/lib/doctor.js"],"names":["ansiTrim","require","chain","color","defaultRegistry","defaults","registry","log","npm","output","path","semver","styles","table","checkFilesPermission","checkPing","getGitPath","getLatestNodejsVersion","getLatestNpmVersion","verifyCachedFiles","globalNodeModules","join","config","globalPrefix","localNodeModules","localPrefix","module","exports","doctor","usage","args","silent","cb","actionsToRun","cache","info","stderr","stdout","message","list","makePretty","outHead","outBody","map","item","underline","red","magenta","outTable","concat","tableOpts","stringLength","s","length","p","ping","npmLTS","nodeLTS","replace","whichGit","readbleCaches","executableGlobalModules","executableLocalModules","cacheStatus","verifiedContent","npmV","version","nodeV","process","get","satisfies"],"mappings":"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","file":"doctor.js","sourcesContent":["'use strict'\n\nconst ansiTrim = require('./utils/ansi-trim')\nconst chain = require('slide').chain\nconst color = require('ansicolors')\nconst defaultRegistry = require('./config/defaults').defaults.registry\nconst log = require('npmlog')\nconst npm = require('./npm')\nconst output = require('./utils/output')\nconst path = require('path')\nconst semver = require('semver')\nconst styles = require('ansistyles')\nconst table = require('text-table')\n\n// steps\nconst checkFilesPermission = require('./doctor/check-files-permission')\nconst checkPing = require('./doctor/check-ping')\nconst getGitPath = require('./doctor/get-git-path')\nconst getLatestNodejsVersion = require('./doctor/get-latest-nodejs-version')\nconst getLatestNpmVersion = require('./doctor/get-latest-npm-version')\nconst verifyCachedFiles = require('./doctor/verify-cached-files')\n\nconst globalNodeModules = path.join(npm.config.globalPrefix, 'lib', 'node_modules')\nconst localNodeModules = path.join(npm.config.localPrefix, 'node_modules')\n\nmodule.exports = doctor\n\ndoctor.usage = 'npm doctor'\n\nfunction doctor (args, silent, cb) {\n  args = args || {}\n  if (typeof cb !== 'function') {\n    cb = silent\n    silent = false\n  }\n\n  const actionsToRun = [\n    [checkPing],\n    [getLatestNpmVersion],\n    [getLatestNodejsVersion, args['node-url']],\n    [getGitPath],\n    [checkFilesPermission, npm.cache, 4, 6],\n    [checkFilesPermission, globalNodeModules, 4, 4],\n    [checkFilesPermission, localNodeModules, 6, 6],\n    [verifyCachedFiles, path.join(npm.cache, '_cacache')]\n  ]\n\n  log.info('doctor', 'Running checkup')\n  chain(actionsToRun, function (stderr, stdout) {\n    if (stderr && stderr.message !== 'not found: git') return cb(stderr)\n    const list = makePretty(stdout)\n    let outHead = ['Check', 'Value', 'Recommendation']\n    let outBody = list\n\n    if (npm.color) {\n      outHead = outHead.map(function (item) {\n        return styles.underline(item)\n      })\n      outBody = outBody.map(function (item) {\n        if (item[2]) {\n          item[0] = color.red(item[0])\n          item[2] = color.magenta(item[2])\n        }\n        return item\n      })\n    }\n\n    const outTable = [outHead].concat(outBody)\n    const tableOpts = {\n      stringLength: function (s) { return ansiTrim(s).length }\n    }\n\n    if (!silent) output(table(outTable, tableOpts))\n\n    cb(null, list)\n  })\n}\n\nfunction makePretty (p) {\n  const ping = p[1]\n  const npmLTS = p[2]\n  const nodeLTS = p[3].replace('v', '')\n  const whichGit = p[4] || 'not installed'\n  const readbleCaches = p[5] ? 'ok' : 'notOk'\n  const executableGlobalModules = p[6] ? 'ok' : 'notOk'\n  const executableLocalModules = p[7] ? 'ok' : 'notOk'\n  const cacheStatus = p[8] ? `verified ${p[8].verifiedContent} tarballs` : 'notOk'\n  const npmV = npm.version\n  const nodeV = process.version.replace('v', '')\n  const registry = npm.config.get('registry')\n  const list = [\n    ['npm ping', ping],\n    ['npm -v', 'v' + npmV],\n    ['node -v', 'v' + nodeV],\n    ['npm config get registry', registry],\n    ['which git', whichGit],\n    ['Perms check on cached files', readbleCaches],\n    ['Perms check on global node_modules', executableGlobalModules],\n    ['Perms check on local node_modules', executableLocalModules],\n    ['Verify cache contents', cacheStatus]\n  ]\n\n  if (p[0] !== 200) list[0][2] = 'Check your internet connection'\n  if (!semver.satisfies(npmV, '>=' + npmLTS)) list[1][2] = 'Use npm v' + npmLTS\n  if (!semver.satisfies(nodeV, '>=' + nodeLTS)) list[2][2] = 'Use node v' + nodeLTS\n  if (registry !== defaultRegistry) list[3][2] = 'Try `npm config set registry ' + defaultRegistry + '`'\n  if (whichGit === 'not installed') list[4][2] = 'Install git and ensure it\\'s in your PATH.'\n  if (readbleCaches !== 'ok') list[5][2] = 'Check the permissions of your files in ' + npm.config.get('cache')\n  if (executableGlobalModules !== 'ok') list[6][2] = globalNodeModules + ' must be readable and writable by the current user.'\n  if (executableLocalModules !== 'ok') list[7][2] = localNodeModules + ' must be readable and writable by the current user.'\n\n  return list\n}\n"]}