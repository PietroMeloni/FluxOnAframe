{"version":3,"sources":["../../../../../node_modules/npm/lib/install/validate-args.js"],"names":["validate","require","asyncMap","chain","npmInstallChecks","iferr","checkEngine","checkPlatform","npm","module","exports","idealTree","args","next","arguments","force","config","get","pkg","done","hasMinimumFields","checkSelf","isInstallable","cb","name","Error","_resolved","version","getWarnings","parent","warnings","nodeVersion","test","replace","strict","thenWarnEngineIssues","warn","push","package","code","er"],"mappings":"AAAA;;AACA,IAAIA,WAAWC,QAAQ,QAAR,CAAf;AACA,IAAIC,WAAWD,QAAQ,OAAR,EAAiBC,QAAhC;AACA,IAAIC,QAAQF,QAAQ,OAAR,EAAiBE,KAA7B;AACA,IAAIC,mBAAmBH,QAAQ,oBAAR,CAAvB;AACA,IAAII,QAAQJ,QAAQ,OAAR,CAAZ;AACA,IAAIK,cAAcF,iBAAiBE,WAAnC;AACA,IAAIC,gBAAgBH,iBAAiBG,aAArC;AACA,IAAIC,MAAMP,QAAQ,WAAR,CAAV;;AAEAQ,OAAOC,OAAP,GAAiB,UAAUC,SAAV,EAAqBC,IAArB,EAA2BC,IAA3B,EAAiC;AAChDb,WAAS,KAAT,EAAgBc,SAAhB;AACA,MAAIC,QAAQP,IAAIQ,MAAJ,CAAWC,GAAX,CAAe,OAAf,CAAZ;;AAEAf,WAASU,IAAT,EAAe,UAAUM,GAAV,EAAeC,IAAf,EAAqB;AAClChB,UAAM,CACJ,CAACiB,gBAAD,EAAmBF,GAAnB,CADI,EAEJ,CAACG,SAAD,EAAYV,SAAZ,EAAuBO,GAAvB,EAA4BH,KAA5B,CAFI,EAGJ,CAACO,aAAD,EAAgBJ,GAAhB,CAHI,CAAN,EAIGC,IAJH;AAKD,GAND,EAMGN,IANH;AAOD,CAXD;;AAaA,SAASO,gBAAT,CAA2BF,GAA3B,EAAgCK,EAAhC,EAAoC;AAClC,MAAIL,IAAIM,IAAJ,KAAa,EAAb,IAAmBN,IAAIM,IAAJ,IAAY,IAAnC,EAAyC;AACvC,WAAOD,GAAG,IAAIE,KAAJ,qBAA2BP,IAAIQ,SAA/B,4BAAH,CAAP;AACD,GAFD,MAEO,IAAIR,IAAIS,OAAJ,KAAgB,EAAhB,IAAsBT,IAAIS,OAAJ,IAAe,IAAzC,EAA+C;AACpD,WAAOJ,GAAG,IAAIE,KAAJ,qBAA2BP,IAAIQ,SAA/B,+BAAH,CAAP;AACD,GAFM,MAEA;AACL,WAAOH,IAAP;AACD;AACF;;AAED,SAASK,WAAT,CAAsBV,GAAtB,EAA2B;AACzB,SAAOA,IAAIW,MAAX;AAAmBX,UAAMA,IAAIW,MAAV;AAAnB,GACA,IAAI,CAACX,IAAIY,QAAT,EAAmBZ,IAAIY,QAAJ,GAAe,EAAf;AACnB,SAAOZ,IAAIY,QAAX;AACD;;AAED,IAAIR,gBAAgBb,OAAOC,OAAP,CAAeY,aAAf,GAA+B,UAAUJ,GAAV,EAAeL,IAAf,EAAqB;AACtE,MAAIE,QAAQP,IAAIQ,MAAJ,CAAWC,GAAX,CAAe,OAAf,CAAZ;AACA,MAAIc,cAAcvB,IAAIQ,MAAJ,CAAWC,GAAX,CAAe,cAAf,CAAlB;AACA,MAAI,IAAIe,IAAJ,CAASD,WAAT,CAAJ,EAA2B;AACzB;AACA;AACAA,kBAAcA,YAAYE,OAAZ,CAAoB,KAApB,EAA2B,EAA3B,CAAd;AACD;AACD,MAAIC,SAAS1B,IAAIQ,MAAJ,CAAWC,GAAX,CAAe,eAAf,CAAb;AACAX,cAAYY,GAAZ,EAAiBV,IAAImB,OAArB,EAA8BI,WAA9B,EAA2ChB,KAA3C,EAAkDmB,MAAlD,EAA0D7B,MAAMQ,IAAN,EAAYsB,oBAAZ,CAA1D;AACA,WAASA,oBAAT,CAA+BC,IAA/B,EAAqC;AACnC,QAAIA,IAAJ,EAAUR,YAAYV,GAAZ,EAAiBmB,IAAjB,CAAsBD,IAAtB;AACV7B,kBAAcW,GAAd,EAAmBH,KAAnB,EAA0BF,IAA1B;AACD;AACF,CAdD;;AAgBA,SAASQ,SAAT,CAAoBV,SAApB,EAA+BO,GAA/B,EAAoCH,KAApC,EAA2CF,IAA3C,EAAiD;AAC/C,MAAIF,UAAU2B,OAAV,IAAqB3B,UAAU2B,OAAV,CAAkBd,IAAlB,KAA2BN,IAAIM,IAAxD,EAA8D,OAAOX,MAAP;AAC9D,MAAIE,KAAJ,EAAW;AACT,QAAIqB,OAAO,IAAIX,KAAJ,CAAU,sBAAsBP,IAAIM,IAA1B,GAAiC,8CAA3C,CAAX;AACAY,SAAKG,IAAL,GAAY,SAAZ;AACA5B,cAAUmB,QAAV,CAAmBO,IAAnB,CAAwBD,IAAxB;AACAvB;AACD,GALD,MAKO;AACL,QAAI2B,KAAK,IAAIf,KAAJ,CAAU,4CAA4CP,IAAIM,IAAhD,GAClB,qBADkB,GAElB,eAFkB,GAEAN,IAAIM,IAFJ,GAEW,yCAFX,GAGlB,2CAHkB,GAIlB,8BAJkB,GAKlB,gFALQ,CAAT;AAMAgB,OAAGD,IAAH,GAAU,SAAV;AACA1B,SAAK2B,EAAL;AACD;AACF","file":"validate-args.js","sourcesContent":["'use strict'\nvar validate = require('aproba')\nvar asyncMap = require('slide').asyncMap\nvar chain = require('slide').chain\nvar npmInstallChecks = require('npm-install-checks')\nvar iferr = require('iferr')\nvar checkEngine = npmInstallChecks.checkEngine\nvar checkPlatform = npmInstallChecks.checkPlatform\nvar npm = require('../npm.js')\n\nmodule.exports = function (idealTree, args, next) {\n  validate('OAF', arguments)\n  var force = npm.config.get('force')\n\n  asyncMap(args, function (pkg, done) {\n    chain([\n      [hasMinimumFields, pkg],\n      [checkSelf, idealTree, pkg, force],\n      [isInstallable, pkg]\n    ], done)\n  }, next)\n}\n\nfunction hasMinimumFields (pkg, cb) {\n  if (pkg.name === '' || pkg.name == null) {\n    return cb(new Error(`Can't install ${pkg._resolved}: Missing package name`))\n  } else if (pkg.version === '' || pkg.version == null) {\n    return cb(new Error(`Can't install ${pkg._resolved}: Missing package version`))\n  } else {\n    return cb()\n  }\n}\n\nfunction getWarnings (pkg) {\n  while (pkg.parent) pkg = pkg.parent\n  if (!pkg.warnings) pkg.warnings = []\n  return pkg.warnings\n}\n\nvar isInstallable = module.exports.isInstallable = function (pkg, next) {\n  var force = npm.config.get('force')\n  var nodeVersion = npm.config.get('node-version')\n  if (/-/.test(nodeVersion)) {\n    // for the purposes of validation, if the node version is a prerelease,\n    // strip that. We check and warn about this sceanrio over in validate-tree.\n    nodeVersion = nodeVersion.replace(/-.*/, '')\n  }\n  var strict = npm.config.get('engine-strict')\n  checkEngine(pkg, npm.version, nodeVersion, force, strict, iferr(next, thenWarnEngineIssues))\n  function thenWarnEngineIssues (warn) {\n    if (warn) getWarnings(pkg).push(warn)\n    checkPlatform(pkg, force, next)\n  }\n}\n\nfunction checkSelf (idealTree, pkg, force, next) {\n  if (idealTree.package && idealTree.package.name !== pkg.name) return next()\n  if (force) {\n    var warn = new Error(\"Wouldn't install \" + pkg.name + ' as a dependency of itself, but being forced')\n    warn.code = 'ENOSELF'\n    idealTree.warnings.push(warn)\n    next()\n  } else {\n    var er = new Error('Refusing to install package with name \"' + pkg.name +\n     '\" under a package\\n' +\n     'also called \"' + pkg.name + '\". Did you name your project the same\\n' +\n     'as the dependency you\\'re installing?\\n\\n' +\n     'For more information, see:\\n' +\n     '    <https://docs.npmjs.com/cli/install#limitations-of-npms-install-algorithm>')\n    er.code = 'ENOSELF'\n    next(er)\n  }\n}\n"]}