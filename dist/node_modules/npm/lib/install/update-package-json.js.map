{"version":3,"sources":["../../../../../node_modules/npm/lib/install/update-package-json.js"],"names":["path","require","writeFileAtomic","moduleName","deepSortObject","sortedObject","isWindows","sortKeys","module","exports","mod","buildpath","next","pkg","package","name","_requiredBy","requiredBy","map","req","devDependencies","dependencies","location","concat","userRequired","sort","_location","_phantomChildren","Object","keys","phantomChildren","forEach","version","_inBundle","fromBundle","key","data","JSON","stringify","resolve","fsync"],"mappings":"AAAA;;AACA,IAAIA,OAAOC,QAAQ,MAAR,CAAX;AACA,IAAIC,kBAAkBD,QAAQ,mBAAR,CAAtB;AACA,IAAIE,aAAaF,QAAQ,yBAAR,CAAjB;AACA,IAAIG,iBAAiBH,QAAQ,8BAAR,CAArB;AACA,IAAII,eAAeJ,QAAQ,eAAR,CAAnB;AACA,IAAIK,YAAYL,QAAQ,wBAAR,CAAhB;;AAEA,IAAIM,WAAW,CACb,cADa,EACG,iBADH,EACsB,oBADtB,EAEb,sBAFa,EAEW,UAFX,EAEuB,SAFvB,EAEkC,SAFlC,EAGb,OAHa,CAAf;;AAMAC,OAAOC,OAAP,GAAiB,UAAUC,GAAV,EAAeC,SAAf,EAA0BC,IAA1B,EAAgC;AAC/C,MAAIC,MAAMR,aAAaK,IAAII,OAAjB,CAAV;AACA,MAAIC,OAAOZ,WAAWO,GAAX,CAAX;AACA;AACA;AACA;AACAG,MAAIG,WAAJ,GACEN,IAAIO,UAAJ,CACGC,GADH,CACO,UAAUC,GAAV,EAAe;AAClB,QACEA,IAAIL,OAAJ,CAAYM,eAAZ,IACAD,IAAIL,OAAJ,CAAYM,eAAZ,CAA4BL,IAA5B,CADA,IAEA,CAACI,IAAIL,OAAJ,CAAYO,YAAZ,CAAyBN,IAAzB,CAHH,EAIE;AACA,aAAO,UAAUI,IAAIG,QAArB;AACD,KAND,MAMO;AACL,aAAOH,IAAIG,QAAX;AACD;AACF,GAXH,EAYGC,MAZH,CAYUb,IAAIc,YAAJ,GAAmB,CAAC,OAAD,CAAnB,GAA+B,EAZzC,EAaGC,IAbH,EADF;AAeAZ,MAAIa,SAAJ,GAAgBhB,IAAIY,QAApB;AACAT,MAAIc,gBAAJ,GAAuB,EAAvB;AACAC,SAAOC,IAAP,CAAYnB,IAAIoB,eAAhB,EAAiCL,IAAjC,GAAwCM,OAAxC,CAAgD,UAAUhB,IAAV,EAAgB;AAC9DF,QAAIc,gBAAJ,CAAqBZ,IAArB,IAA6BL,IAAIoB,eAAJ,CAAoBf,IAApB,EAA0BD,OAA1B,CAAkCkB,OAA/D;AACD,GAFD;AAGAnB,MAAIoB,SAAJ,GAAgB,CAAC,CAACvB,IAAIwB,UAAtB;;AAEA;AACA3B,WAASwB,OAAT,CAAiB,UAAUI,GAAV,EAAe;AAC9B,QAAItB,IAAIsB,GAAJ,KAAY,IAAhB,EAAsBtB,IAAIsB,GAAJ,IAAW/B,eAAeS,IAAIsB,GAAJ,CAAf,CAAX;AACvB,GAFD;;AAIA,MAAIC,OAAOC,KAAKC,SAAL,CAAejC,aAAaQ,GAAb,CAAf,EAAkC,IAAlC,EAAwC,CAAxC,IAA6C,IAAxD;;AAEAX,kBAAgBF,KAAKuC,OAAL,CAAa5B,SAAb,EAAwB,cAAxB,CAAhB,EAAyDyB,IAAzD,EAA+D;AAC7D;AACA;AACA;AACAI,WAAOlC;AAJsD,GAA/D,EAKGM,IALH;AAMD,CAzCD","file":"update-package-json.js","sourcesContent":["'use strict'\nvar path = require('path')\nvar writeFileAtomic = require('write-file-atomic')\nvar moduleName = require('../utils/module-name.js')\nvar deepSortObject = require('../utils/deep-sort-object.js')\nvar sortedObject = require('sorted-object')\nvar isWindows = require('../utils/is-windows.js')\n\nvar sortKeys = [\n  'dependencies', 'devDependencies', 'bundleDependencies',\n  'optionalDependencies', 'keywords', 'engines', 'scripts',\n  'files'\n]\n\nmodule.exports = function (mod, buildpath, next) {\n  var pkg = sortedObject(mod.package)\n  var name = moduleName(mod)\n  // Add our diagnostic keys to the package.json.\n  // Note that there are folks relying on these, for ex, the Visual Studio\n  // Node.js addon.\n  pkg._requiredBy =\n    mod.requiredBy\n      .map(function (req) {\n        if (\n          req.package.devDependencies &&\n          req.package.devDependencies[name] &&\n          !req.package.dependencies[name]\n        ) {\n          return '#DEV:' + req.location\n        } else {\n          return req.location\n        }\n      })\n      .concat(mod.userRequired ? ['#USER'] : [])\n      .sort()\n  pkg._location = mod.location\n  pkg._phantomChildren = {}\n  Object.keys(mod.phantomChildren).sort().forEach(function (name) {\n    pkg._phantomChildren[name] = mod.phantomChildren[name].package.version\n  })\n  pkg._inBundle = !!mod.fromBundle\n\n  // sort keys that are known safe to sort to produce more consistent output\n  sortKeys.forEach(function (key) {\n    if (pkg[key] != null) pkg[key] = deepSortObject(pkg[key])\n  })\n\n  var data = JSON.stringify(sortedObject(pkg), null, 2) + '\\n'\n\n  writeFileAtomic(path.resolve(buildpath, 'package.json'), data, {\n    // We really don't need this guarantee, and fsyncing here is super slow. Except on\n    // Windows where there isn't a big performance difference and it prevents errors when\n    // rolling back optional packages (#17671)\n    fsync: isWindows\n  }, next)\n}\n"]}