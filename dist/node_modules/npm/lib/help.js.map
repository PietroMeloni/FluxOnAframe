{"version":3,"sources":["../../../../node_modules/npm/lib/help.js"],"names":["module","exports","help","completion","opts","cb","conf","argv","remain","length","getSections","path","require","spawn","npm","log","openUrl","glob","didYouMean","cmdList","shorthands","commands","concat","Object","keys","output","args","config","get","cooked","argnum","shift","section","deref","valid","npmUsage","usage","set","level","apihelp","indexOf","pref","filter","n","manroot","resolve","__dirname","compextglob","compextre","f","er","mans","map","man","ext","extname","match","RegExp","basename","viewMan","pickMan","pref_","nre","forEach","sect","i","sort","a","b","an","bn","num","manpath","join","env","process","MANPATH","viewer","stdio","woman","on","htmlMan","manProcess","replace","Error","usages","wrap","version","dirname","maxLen","c","reduce","push","Math","max","item","Array","split","arr","out","l","line","stdout","columns","min","substr","g","files","acc","file"],"mappings":"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","file":"help.js","sourcesContent":["\nmodule.exports = help\n\nhelp.completion = function (opts, cb) {\n  if (opts.conf.argv.remain.length > 2) return cb(null, [])\n  getSections(cb)\n}\n\nvar path = require('path')\nvar spawn = require('./utils/spawn')\nvar npm = require('./npm.js')\nvar log = require('npmlog')\nvar openUrl = require('./utils/open-url')\nvar glob = require('glob')\nvar didYouMean = require('./utils/did-you-mean')\nvar cmdList = require('./config/cmd-list').cmdList\nvar shorthands = require('./config/cmd-list').shorthands\nvar commands = cmdList.concat(Object.keys(shorthands))\nvar output = require('./utils/output.js')\n\nfunction help (args, cb) {\n  var argv = npm.config.get('argv').cooked\n\n  var argnum = 0\n  if (args.length === 2 && ~~args[0]) {\n    argnum = ~~args.shift()\n  }\n\n  // npm help foo bar baz: search topics\n  if (args.length > 1 && args[0]) {\n    return npm.commands['help-search'](args, argnum, cb)\n  }\n\n  var section = npm.deref(args[0]) || args[0]\n\n  // npm help <noargs>:  show basic usage\n  if (!section) {\n    var valid = argv[0] === 'help' ? 0 : 1\n    return npmUsage(valid, cb)\n  }\n\n  // npm <command> -h: show command usage\n  if (npm.config.get('usage') &&\n      npm.commands[section] &&\n      npm.commands[section].usage) {\n    npm.config.set('loglevel', 'silent')\n    log.level = 'silent'\n    output(npm.commands[section].usage)\n    return cb()\n  }\n\n  // npm apihelp <section>: Prefer section 3 over section 1\n  var apihelp = argv.length && argv[0].indexOf('api') !== -1\n  var pref = apihelp ? [3, 1, 5, 7] : [1, 3, 5, 7]\n  if (argnum) {\n    pref = [ argnum ].concat(pref.filter(function (n) {\n      return n !== argnum\n    }))\n  }\n\n  // npm help <section>: Try to find the path\n  var manroot = path.resolve(__dirname, '..', 'man')\n\n  // legacy\n  if (section === 'global') section = 'folders'\n  else if (section === 'json') section = 'package.json'\n\n  // find either /section.n or /npm-section.n\n  // The glob is used in the glob.  The regexp is used much\n  // further down.  Globs and regexps are different\n  var compextglob = '.+(gz|bz2|lzma|[FYzZ]|xz)'\n  var compextre = '\\\\.(gz|bz2|lzma|[FYzZ]|xz)$'\n  var f = '+(npm-' + section + '|' + section + ').[0-9]?(' + compextglob + ')'\n  return glob(manroot + '/*/' + f, function (er, mans) {\n    if (er) return cb(er)\n\n    if (!mans.length) return npm.commands['help-search'](args, cb)\n\n    mans = mans.map(function (man) {\n      var ext = path.extname(man)\n      if (man.match(new RegExp(compextre))) man = path.basename(man, ext)\n\n      return man\n    })\n\n    viewMan(pickMan(mans, pref), cb)\n  })\n}\n\nfunction pickMan (mans, pref_) {\n  var nre = /([0-9]+)$/\n  var pref = {}\n  pref_.forEach(function (sect, i) {\n    pref[sect] = i\n  })\n  mans = mans.sort(function (a, b) {\n    var an = a.match(nre)[1]\n    var bn = b.match(nre)[1]\n    return an === bn ? (a > b ? -1 : 1)\n      : pref[an] < pref[bn] ? -1\n        : 1\n  })\n  return mans[0]\n}\n\nfunction viewMan (man, cb) {\n  var nre = /([0-9]+)$/\n  var num = man.match(nre)[1]\n  var section = path.basename(man, '.' + num)\n\n  // at this point, we know that the specified man page exists\n  var manpath = path.join(__dirname, '..', 'man')\n  var env = {}\n  Object.keys(process.env).forEach(function (i) {\n    env[i] = process.env[i]\n  })\n  env.MANPATH = manpath\n  var viewer = npm.config.get('viewer')\n\n  var conf\n  switch (viewer) {\n    case 'woman':\n      var a = ['-e', '(woman-find-file \\'' + man + '\\')']\n      conf = { env: env, stdio: 'inherit' }\n      var woman = spawn('emacsclient', a, conf)\n      woman.on('close', cb)\n      break\n\n    case 'browser':\n      openUrl(htmlMan(man), 'help available at the following URL', cb)\n      break\n\n    default:\n      conf = { env: env, stdio: 'inherit' }\n      var manProcess = spawn('man', [num, section], conf)\n      manProcess.on('close', cb)\n      break\n  }\n}\n\nfunction htmlMan (man) {\n  var sect = +man.match(/([0-9]+)$/)[1]\n  var f = path.basename(man).replace(/([0-9]+)$/, 'html')\n  switch (sect) {\n    case 1:\n      sect = 'cli'\n      break\n    case 3:\n      sect = 'api'\n      break\n    case 5:\n      sect = 'files'\n      break\n    case 7:\n      sect = 'misc'\n      break\n    default:\n      throw new Error('invalid man section: ' + sect)\n  }\n  return path.resolve(__dirname, '..', 'html', 'doc', sect, f)\n}\n\nfunction npmUsage (valid, cb) {\n  npm.config.set('loglevel', 'silent')\n  log.level = 'silent'\n  output([\n    '\\nUsage: npm <command>',\n    '',\n    'where <command> is one of:',\n    npm.config.get('long') ? usages()\n      : '    ' + wrap(commands),\n    '',\n    'npm <command> -h     quick help on <command>',\n    'npm -l           display full usage info',\n    'npm help <term>  search for help on <term>',\n    'npm help npm     involved overview',\n    '',\n    'Specify configs in the ini-formatted file:',\n    '    ' + npm.config.get('userconfig'),\n    'or on the command line via: npm <command> --key value',\n    'Config info can be viewed via: npm help config',\n    '',\n    'npm@' + npm.version + ' ' + path.dirname(__dirname)\n  ].join('\\n'))\n\n  if (npm.argv.length > 1) {\n    output(didYouMean(npm.argv[1], commands))\n  }\n\n  cb(valid)\n}\n\nfunction usages () {\n  // return a string of <command>: <usage>\n  var maxLen = 0\n  return Object.keys(npm.commands).filter(function (c) {\n    return c === npm.deref(c)\n  }).reduce(function (set, c) {\n    set.push([c, npm.commands[c].usage || ''])\n    maxLen = Math.max(maxLen, c.length)\n    return set\n  }, []).map(function (item) {\n    var c = item[0]\n    var usage = item[1]\n    return '\\n    ' +\n      c + (new Array(maxLen - c.length + 2).join(' ')) +\n      (usage.split('\\n').join('\\n' + (new Array(maxLen + 6).join(' '))))\n  }).join('\\n')\n}\n\nfunction wrap (arr) {\n  var out = ['']\n  var l = 0\n  var line\n\n  line = process.stdout.columns\n  if (!line) {\n    line = 60\n  } else {\n    line = Math.min(60, Math.max(line - 16, 24))\n  }\n\n  arr.sort(function (a, b) { return a < b ? -1 : 1 })\n    .forEach(function (c) {\n      if (out[l].length + c.length + 2 < line) {\n        out[l] += ', ' + c\n      } else {\n        out[l++] += ','\n        out[l] = c\n      }\n    })\n  return out.join('\\n    ').substr(2)\n}\n\nfunction getSections (cb) {\n  var g = path.resolve(__dirname, '../man/man[0-9]/*.[0-9]')\n  glob(g, function (er, files) {\n    if (er) return cb(er)\n\n    cb(null, Object.keys(files.reduce(function (acc, file) {\n      file = path.basename(file).replace(/\\.[0-9]+$/, '')\n      file = file.replace(/^npm-/, '')\n      acc[file] = true\n      return acc\n    }, { help: true })))\n  })\n}\n"]}