{"version":3,"sources":["../../../../../node_modules/npm/node_modules/npm-packlist/index.js"],"names":["bundleWalk","require","BundleWalker","BundleWalkerSync","ignoreWalk","IgnoreWalker","Walker","IgnoreWalkerSync","WalkerSync","rootBuiltinRules","Symbol","packageNecessaryRules","path","defaultRules","npmWalker","opt","ignoreFiles","includeEmpty","process","cwd","follow","basename","parent","bundled","bundledScopes","Array","from","Set","filter","test","f","map","split","rules","join","packageJsonCache","Map","_","entry","partial","p","substr","root","length","pkgre","isRoot","pkg","replace","rootNM","rootPJ","filterEntry","indexOf","ignoreRules","filterEntries","file","then","ig","resolve","has","onPackageJson","get","set","browser","main","isArray","files","st","dir","isSymbolicLink","data","JSON","parse","er","a","b","sort","Class","walkerOpt","on","start","walk","options","callback","Promise","reject","bw","res","walkSync","result","walker","dirname","localeCompare","module","exports","sync"],"mappings":"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","file":"index.js","sourcesContent":["'use strict'\n\n// Do a two-pass walk, first to get the list of packages that need to be\n// bundled, then again to get the actual files and folders.\n// Keep a cache of node_modules content and package.json data, so that the\n// second walk doesn't have to re-do all the same work.\n\nconst bundleWalk = require('npm-bundled')\nconst BundleWalker = bundleWalk.BundleWalker\nconst BundleWalkerSync = bundleWalk.BundleWalkerSync\n\nconst ignoreWalk = require('ignore-walk')\nconst IgnoreWalker = ignoreWalk.Walker\nconst IgnoreWalkerSync = ignoreWalk.WalkerSync\n\nconst rootBuiltinRules = Symbol('root-builtin-rules')\nconst packageNecessaryRules = Symbol('package-necessary-rules')\nconst path = require('path')\n\nconst defaultRules = [\n  '.npmignore',\n  '.gitignore',\n  '**/.git/',\n  '**/.svn/',\n  '**/.hg/',\n  '**/CVS/',\n  '/.lock-wscript',\n  '/.wafpickle-*',\n  '/build/config.gypi',\n  'npm-debug.log',\n  '**/.npmrc',\n  '.*.swp',\n  '.DS_Store',\n  '._*',\n  '*.orig',\n  'package-lock.json'\n]\n\n// a decorator that applies our custom rules to an ignore walker\nconst npmWalker = Class => class Walker extends Class {\n  constructor (opt) {\n    opt = opt || {}\n\n    // the order in which rules are applied.\n    opt.ignoreFiles = [\n      rootBuiltinRules,\n      'package.json',\n      '.npmignore',\n      '.gitignore',\n      packageNecessaryRules\n    ]\n\n    opt.includeEmpty = false\n    opt.path = opt.path || process.cwd()\n    opt.follow = path.basename(opt.path) === 'node_modules'\n    super(opt)\n\n    // ignore a bunch of things by default at the root level.\n    // also ignore anything in node_modules, except bundled dependencies\n    if (!this.parent) {\n      this.bundled = opt.bundled || []\n      this.bundledScopes = Array.from(new Set(\n        this.bundled.filter(f => /^@/.test(f))\n        .map(f => f.split('/')[0])))\n      const rules = defaultRules.join('\\n') + '\\n'\n      this.packageJsonCache = opt.packageJsonCache || new Map()\n      super.onReadIgnoreFile(rootBuiltinRules, rules, _=>_)\n    } else {\n      this.bundled = []\n      this.bundledScopes = []\n      this.packageJsonCache = this.parent.packageJsonCache\n    }\n  }\n\n  filterEntry (entry, partial) {\n    // get the partial path from the root of the walk\n    const p = this.path.substr(this.root.length + 1)\n    const pkgre = /^node_modules\\/(@[^\\/]+\\/?[^\\/]+|[^\\/]+)(\\/.*)?$/\n    const isRoot = !this.parent\n    const pkg = isRoot && pkgre.test(entry) ?\n      entry.replace(pkgre, '$1') : null\n    const rootNM = isRoot && entry === 'node_modules'\n    const rootPJ = isRoot && entry === 'package.json'\n\n    return (\n      // if we're in a bundled package, check with the parent.\n      /^node_modules($|\\/)/i.test(p) ? this.parent.filterEntry(\n          this.basename + '/' + entry, partial)\n\n      // if package is bundled, all files included\n      // also include @scope dirs for bundled scoped deps\n      // they'll be ignored if no files end up in them.\n      // However, this only matters if we're in the root.\n      // node_modules folders elsewhere, like lib/node_modules,\n      // should be included normally unless ignored.\n      : pkg ? -1 !== this.bundled.indexOf(pkg) ||\n        -1 !== this.bundledScopes.indexOf(pkg)\n\n      // only walk top node_modules if we want to bundle something\n      : rootNM ? !!this.bundled.length\n\n      // always include package.json at the root.\n      : rootPJ ? true\n\n      // otherwise, follow ignore-walk's logic\n      : super.filterEntry(entry, partial)\n    )\n  }\n\n  filterEntries () {\n    if (this.ignoreRules['package.json'])\n      this.ignoreRules['.gitignore'] = this.ignoreRules['.npmignore'] = null\n    else if (this.ignoreRules['.npmignore'])\n      this.ignoreRules['.gitignore'] = null\n    this.filterEntries = super.filterEntries\n    super.filterEntries()\n  }\n\n  addIgnoreFile (file, then) {\n    const ig = path.resolve(this.path, file)\n    if (this.packageJsonCache.has(ig))\n      this.onPackageJson(ig, this.packageJsonCache.get(ig), then)\n    else\n      super.addIgnoreFile(file, then)\n  }\n\n  onPackageJson (ig, pkg, then) {\n    this.packageJsonCache.set(ig, pkg)\n\n    // if there's a browser or main, make sure we don't ignore it\n    const rules = [\n      pkg.browser ? '!' + pkg.browser : '',\n      pkg.main ? '!' + pkg.main : '',\n      '!@(readme|license|licence|notice|changes|changelog|history){,.*}'\n    ].filter(f => f).join('\\n') + '\\n'\n    super.onReadIgnoreFile(packageNecessaryRules, rules, _=>_)\n\n    if (Array.isArray(pkg.files))\n      super.onReadIgnoreFile('package.json', '*\\n' + pkg.files.map(\n        f => '!' + f + '\\n!' + f.replace(/\\/+$/, '') + '/**'\n      ).join('\\n') + '\\n', then)\n    else\n      then()\n  }\n\n  // override parent onstat function to nix all symlinks\n  onstat (st, entry, file, dir, then) {\n    if (st.isSymbolicLink())\n      then()\n    else\n      super.onstat(st, entry, file, dir, then)\n  }\n\n  onReadIgnoreFile (file, data, then) {\n    if (file === 'package.json')\n      try {\n        this.onPackageJson(file, JSON.parse(data), then)\n      } catch (er) {\n        // ignore package.json files that are not json\n        then()\n      }\n    else\n      super.onReadIgnoreFile(file, data, then)\n  }\n\n  sort (a, b) {\n    return sort(a, b)\n  }\n}\n\nclass Walker extends npmWalker(IgnoreWalker) {\n  walker (entry, then) {\n    new Walker(this.walkerOpt(entry)).on('done', then).start()\n  }\n}\n\nclass WalkerSync extends npmWalker(IgnoreWalkerSync) {\n  walker (entry, then) {\n    new WalkerSync(this.walkerOpt(entry)).start()\n    then()\n  }\n}\n\nconst walk = (options, callback) => {\n  options = options || {}\n  const p = new Promise((resolve, reject) => {\n    const bw = new BundleWalker(options).start()\n    bw.on('done', bundled => {\n      options.bundled = bundled\n      options.packageJsonCache = bw.packageJsonCache\n      new Walker(options).on('done', resolve).on('error', reject).start()\n    })\n  })\n  return callback ? p.then(res => callback(null, res), callback) : p\n}\n\nconst walkSync = options => {\n  options = options || {}\n  const bw = new BundleWalkerSync(options).start()\n  options.bundled = bw.result\n  options.packageJsonCache = bw.packageJsonCache\n  const walker = new WalkerSync(options)\n  walker.start()\n  return walker.result\n}\n\n// package.json first, node_modules last, files before folders, alphasort\nconst sort = (a, b) =>\n  a === 'package.json' ? -1\n  : b === 'package.json' ? 1\n  : /^node_modules/.test(a) && !/^node_modules/.test(b) ? 1\n  : /^node_modules/.test(b) && !/^node_modules/.test(a) ? -1\n  : path.dirname(a) === '.' && path.dirname(b) !== '.' ? -1\n  : path.dirname(b) === '.' && path.dirname(a) !== '.' ? 1\n  : a.localeCompare(b)\n\nmodule.exports = walk\nwalk.sync = walkSync\nwalk.Walker = Walker\nwalk.WalkerSync = WalkerSync\n"]}