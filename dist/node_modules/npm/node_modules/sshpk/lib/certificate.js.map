{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/sshpk/lib/certificate.js"],"names":["module","exports","Certificate","assert","require","Buffer","algs","crypto","Fingerprint","Signature","errs","util","utils","Key","PrivateKey","Identity","formats","CertificateParseError","InvalidAlgorithmError","opts","object","arrayOfObject","subjects","assertCompatible","subjectKey","issuer","issuerKey","undefined","signatures","buffer","serial","date","validFrom","validUntil","optionalArrayOfString","purposes","_hashCache","prototype","toBuffer","format","options","string","optionalObject","write","toString","fingerprint","algo","type","hash","algorithm","toLowerCase","hashAlgs","createHash","update","digest","isExpired","when","Date","getTime","isSignedBy","issuerCert","equals","length","indexOf","isSignedByKey","matches","fmt","Object","keys","valid","verify","signWith","key","fmts","didOne","i","ret","sign","Error","createSelfSigned","subjectOrSubjects","Array","isArray","forEach","subject","optionalNumber","lifetime","setTime","optionalBuffer","from","push","hostSubjects","filter","userSubjects","cert","toPublic","create","isPrivateKey","ca","parse","data","filename","optionalString","k","read","e","isCertificate","obj","ver","isCompatible","_sshpkApiVersion","_oldVersionDetect"],"mappings":"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","file":"certificate.js","sourcesContent":["// Copyright 2016 Joyent, Inc.\n\nmodule.exports = Certificate;\n\nvar assert = require('assert-plus');\nvar Buffer = require('safer-buffer').Buffer;\nvar algs = require('./algs');\nvar crypto = require('crypto');\nvar Fingerprint = require('./fingerprint');\nvar Signature = require('./signature');\nvar errs = require('./errors');\nvar util = require('util');\nvar utils = require('./utils');\nvar Key = require('./key');\nvar PrivateKey = require('./private-key');\nvar Identity = require('./identity');\n\nvar formats = {};\nformats['openssh'] = require('./formats/openssh-cert');\nformats['x509'] = require('./formats/x509');\nformats['pem'] = require('./formats/x509-pem');\n\nvar CertificateParseError = errs.CertificateParseError;\nvar InvalidAlgorithmError = errs.InvalidAlgorithmError;\n\nfunction Certificate(opts) {\n\tassert.object(opts, 'options');\n\tassert.arrayOfObject(opts.subjects, 'options.subjects');\n\tutils.assertCompatible(opts.subjects[0], Identity, [1, 0],\n\t    'options.subjects');\n\tutils.assertCompatible(opts.subjectKey, Key, [1, 0],\n\t    'options.subjectKey');\n\tutils.assertCompatible(opts.issuer, Identity, [1, 0], 'options.issuer');\n\tif (opts.issuerKey !== undefined) {\n\t\tutils.assertCompatible(opts.issuerKey, Key, [1, 0],\n\t\t    'options.issuerKey');\n\t}\n\tassert.object(opts.signatures, 'options.signatures');\n\tassert.buffer(opts.serial, 'options.serial');\n\tassert.date(opts.validFrom, 'options.validFrom');\n\tassert.date(opts.validUntil, 'optons.validUntil');\n\n\tassert.optionalArrayOfString(opts.purposes, 'options.purposes');\n\n\tthis._hashCache = {};\n\n\tthis.subjects = opts.subjects;\n\tthis.issuer = opts.issuer;\n\tthis.subjectKey = opts.subjectKey;\n\tthis.issuerKey = opts.issuerKey;\n\tthis.signatures = opts.signatures;\n\tthis.serial = opts.serial;\n\tthis.validFrom = opts.validFrom;\n\tthis.validUntil = opts.validUntil;\n\tthis.purposes = opts.purposes;\n}\n\nCertificate.formats = formats;\n\nCertificate.prototype.toBuffer = function (format, options) {\n\tif (format === undefined)\n\t\tformat = 'x509';\n\tassert.string(format, 'format');\n\tassert.object(formats[format], 'formats[format]');\n\tassert.optionalObject(options, 'options');\n\n\treturn (formats[format].write(this, options));\n};\n\nCertificate.prototype.toString = function (format, options) {\n\tif (format === undefined)\n\t\tformat = 'pem';\n\treturn (this.toBuffer(format, options).toString());\n};\n\nCertificate.prototype.fingerprint = function (algo) {\n\tif (algo === undefined)\n\t\talgo = 'sha256';\n\tassert.string(algo, 'algorithm');\n\tvar opts = {\n\t\ttype: 'certificate',\n\t\thash: this.hash(algo),\n\t\talgorithm: algo\n\t};\n\treturn (new Fingerprint(opts));\n};\n\nCertificate.prototype.hash = function (algo) {\n\tassert.string(algo, 'algorithm');\n\talgo = algo.toLowerCase();\n\tif (algs.hashAlgs[algo] === undefined)\n\t\tthrow (new InvalidAlgorithmError(algo));\n\n\tif (this._hashCache[algo])\n\t\treturn (this._hashCache[algo]);\n\n\tvar hash = crypto.createHash(algo).\n\t    update(this.toBuffer('x509')).digest();\n\tthis._hashCache[algo] = hash;\n\treturn (hash);\n};\n\nCertificate.prototype.isExpired = function (when) {\n\tif (when === undefined)\n\t\twhen = new Date();\n\treturn (!((when.getTime() >= this.validFrom.getTime()) &&\n\t\t(when.getTime() < this.validUntil.getTime())));\n};\n\nCertificate.prototype.isSignedBy = function (issuerCert) {\n\tutils.assertCompatible(issuerCert, Certificate, [1, 0], 'issuer');\n\n\tif (!this.issuer.equals(issuerCert.subjects[0]))\n\t\treturn (false);\n\tif (this.issuer.purposes && this.issuer.purposes.length > 0 &&\n\t    this.issuer.purposes.indexOf('ca') === -1) {\n\t\treturn (false);\n\t}\n\n\treturn (this.isSignedByKey(issuerCert.subjectKey));\n};\n\nCertificate.prototype.isSignedByKey = function (issuerKey) {\n\tutils.assertCompatible(issuerKey, Key, [1, 2], 'issuerKey');\n\n\tif (this.issuerKey !== undefined) {\n\t\treturn (this.issuerKey.\n\t\t    fingerprint('sha512').matches(issuerKey));\n\t}\n\n\tvar fmt = Object.keys(this.signatures)[0];\n\tvar valid = formats[fmt].verify(this, issuerKey);\n\tif (valid)\n\t\tthis.issuerKey = issuerKey;\n\treturn (valid);\n};\n\nCertificate.prototype.signWith = function (key) {\n\tutils.assertCompatible(key, PrivateKey, [1, 2], 'key');\n\tvar fmts = Object.keys(formats);\n\tvar didOne = false;\n\tfor (var i = 0; i < fmts.length; ++i) {\n\t\tif (fmts[i] !== 'pem') {\n\t\t\tvar ret = formats[fmts[i]].sign(this, key);\n\t\t\tif (ret === true)\n\t\t\t\tdidOne = true;\n\t\t}\n\t}\n\tif (!didOne) {\n\t\tthrow (new Error('Failed to sign the certificate for any ' +\n\t\t    'available certificate formats'));\n\t}\n};\n\nCertificate.createSelfSigned = function (subjectOrSubjects, key, options) {\n\tvar subjects;\n\tif (Array.isArray(subjectOrSubjects))\n\t\tsubjects = subjectOrSubjects;\n\telse\n\t\tsubjects = [subjectOrSubjects];\n\n\tassert.arrayOfObject(subjects);\n\tsubjects.forEach(function (subject) {\n\t\tutils.assertCompatible(subject, Identity, [1, 0], 'subject');\n\t});\n\n\tutils.assertCompatible(key, PrivateKey, [1, 2], 'private key');\n\n\tassert.optionalObject(options, 'options');\n\tif (options === undefined)\n\t\toptions = {};\n\tassert.optionalObject(options.validFrom, 'options.validFrom');\n\tassert.optionalObject(options.validUntil, 'options.validUntil');\n\tvar validFrom = options.validFrom;\n\tvar validUntil = options.validUntil;\n\tif (validFrom === undefined)\n\t\tvalidFrom = new Date();\n\tif (validUntil === undefined) {\n\t\tassert.optionalNumber(options.lifetime, 'options.lifetime');\n\t\tvar lifetime = options.lifetime;\n\t\tif (lifetime === undefined)\n\t\t\tlifetime = 10*365*24*3600;\n\t\tvalidUntil = new Date();\n\t\tvalidUntil.setTime(validUntil.getTime() + lifetime*1000);\n\t}\n\tassert.optionalBuffer(options.serial, 'options.serial');\n\tvar serial = options.serial;\n\tif (serial === undefined)\n\t\tserial = Buffer.from('0000000000000001', 'hex');\n\n\tvar purposes = options.purposes;\n\tif (purposes === undefined)\n\t\tpurposes = [];\n\n\tif (purposes.indexOf('signature') === -1)\n\t\tpurposes.push('signature');\n\n\t/* Self-signed certs are always CAs. */\n\tif (purposes.indexOf('ca') === -1)\n\t\tpurposes.push('ca');\n\tif (purposes.indexOf('crl') === -1)\n\t\tpurposes.push('crl');\n\n\t/*\n\t * If we weren't explicitly given any other purposes, do the sensible\n\t * thing and add some basic ones depending on the subject type.\n\t */\n\tif (purposes.length <= 3) {\n\t\tvar hostSubjects = subjects.filter(function (subject) {\n\t\t\treturn (subject.type === 'host');\n\t\t});\n\t\tvar userSubjects = subjects.filter(function (subject) {\n\t\t\treturn (subject.type === 'user');\n\t\t});\n\t\tif (hostSubjects.length > 0) {\n\t\t\tif (purposes.indexOf('serverAuth') === -1)\n\t\t\t\tpurposes.push('serverAuth');\n\t\t}\n\t\tif (userSubjects.length > 0) {\n\t\t\tif (purposes.indexOf('clientAuth') === -1)\n\t\t\t\tpurposes.push('clientAuth');\n\t\t}\n\t\tif (userSubjects.length > 0 || hostSubjects.length > 0) {\n\t\t\tif (purposes.indexOf('keyAgreement') === -1)\n\t\t\t\tpurposes.push('keyAgreement');\n\t\t\tif (key.type === 'rsa' &&\n\t\t\t    purposes.indexOf('encryption') === -1)\n\t\t\t\tpurposes.push('encryption');\n\t\t}\n\t}\n\n\tvar cert = new Certificate({\n\t\tsubjects: subjects,\n\t\tissuer: subjects[0],\n\t\tsubjectKey: key.toPublic(),\n\t\tissuerKey: key.toPublic(),\n\t\tsignatures: {},\n\t\tserial: serial,\n\t\tvalidFrom: validFrom,\n\t\tvalidUntil: validUntil,\n\t\tpurposes: purposes\n\t});\n\tcert.signWith(key);\n\n\treturn (cert);\n};\n\nCertificate.create =\n    function (subjectOrSubjects, key, issuer, issuerKey, options) {\n\tvar subjects;\n\tif (Array.isArray(subjectOrSubjects))\n\t\tsubjects = subjectOrSubjects;\n\telse\n\t\tsubjects = [subjectOrSubjects];\n\n\tassert.arrayOfObject(subjects);\n\tsubjects.forEach(function (subject) {\n\t\tutils.assertCompatible(subject, Identity, [1, 0], 'subject');\n\t});\n\n\tutils.assertCompatible(key, Key, [1, 0], 'key');\n\tif (PrivateKey.isPrivateKey(key))\n\t\tkey = key.toPublic();\n\tutils.assertCompatible(issuer, Identity, [1, 0], 'issuer');\n\tutils.assertCompatible(issuerKey, PrivateKey, [1, 2], 'issuer key');\n\n\tassert.optionalObject(options, 'options');\n\tif (options === undefined)\n\t\toptions = {};\n\tassert.optionalObject(options.validFrom, 'options.validFrom');\n\tassert.optionalObject(options.validUntil, 'options.validUntil');\n\tvar validFrom = options.validFrom;\n\tvar validUntil = options.validUntil;\n\tif (validFrom === undefined)\n\t\tvalidFrom = new Date();\n\tif (validUntil === undefined) {\n\t\tassert.optionalNumber(options.lifetime, 'options.lifetime');\n\t\tvar lifetime = options.lifetime;\n\t\tif (lifetime === undefined)\n\t\t\tlifetime = 10*365*24*3600;\n\t\tvalidUntil = new Date();\n\t\tvalidUntil.setTime(validUntil.getTime() + lifetime*1000);\n\t}\n\tassert.optionalBuffer(options.serial, 'options.serial');\n\tvar serial = options.serial;\n\tif (serial === undefined)\n\t\tserial = Buffer.from('0000000000000001', 'hex');\n\n\tvar purposes = options.purposes;\n\tif (purposes === undefined)\n\t\tpurposes = [];\n\n\tif (purposes.indexOf('signature') === -1)\n\t\tpurposes.push('signature');\n\n\tif (options.ca === true) {\n\t\tif (purposes.indexOf('ca') === -1)\n\t\t\tpurposes.push('ca');\n\t\tif (purposes.indexOf('crl') === -1)\n\t\t\tpurposes.push('crl');\n\t}\n\n\tvar hostSubjects = subjects.filter(function (subject) {\n\t\treturn (subject.type === 'host');\n\t});\n\tvar userSubjects = subjects.filter(function (subject) {\n\t\treturn (subject.type === 'user');\n\t});\n\tif (hostSubjects.length > 0) {\n\t\tif (purposes.indexOf('serverAuth') === -1)\n\t\t\tpurposes.push('serverAuth');\n\t}\n\tif (userSubjects.length > 0) {\n\t\tif (purposes.indexOf('clientAuth') === -1)\n\t\t\tpurposes.push('clientAuth');\n\t}\n\tif (userSubjects.length > 0 || hostSubjects.length > 0) {\n\t\tif (purposes.indexOf('keyAgreement') === -1)\n\t\t\tpurposes.push('keyAgreement');\n\t\tif (key.type === 'rsa' &&\n\t\t    purposes.indexOf('encryption') === -1)\n\t\t\tpurposes.push('encryption');\n\t}\n\n\tvar cert = new Certificate({\n\t\tsubjects: subjects,\n\t\tissuer: issuer,\n\t\tsubjectKey: key,\n\t\tissuerKey: issuerKey.toPublic(),\n\t\tsignatures: {},\n\t\tserial: serial,\n\t\tvalidFrom: validFrom,\n\t\tvalidUntil: validUntil,\n\t\tpurposes: purposes\n\t});\n\tcert.signWith(issuerKey);\n\n\treturn (cert);\n};\n\nCertificate.parse = function (data, format, options) {\n\tif (typeof (data) !== 'string')\n\t\tassert.buffer(data, 'data');\n\tif (format === undefined)\n\t\tformat = 'auto';\n\tassert.string(format, 'format');\n\tif (typeof (options) === 'string')\n\t\toptions = { filename: options };\n\tassert.optionalObject(options, 'options');\n\tif (options === undefined)\n\t\toptions = {};\n\tassert.optionalString(options.filename, 'options.filename');\n\tif (options.filename === undefined)\n\t\toptions.filename = '(unnamed)';\n\n\tassert.object(formats[format], 'formats[format]');\n\n\ttry {\n\t\tvar k = formats[format].read(data, options);\n\t\treturn (k);\n\t} catch (e) {\n\t\tthrow (new CertificateParseError(options.filename, format, e));\n\t}\n};\n\nCertificate.isCertificate = function (obj, ver) {\n\treturn (utils.isCompatible(obj, Certificate, ver));\n};\n\n/*\n * API versions for Certificate:\n * [1,0] -- initial ver\n */\nCertificate.prototype._sshpkApiVersion = [1, 0];\n\nCertificate._oldVersionDetect = function (obj) {\n\treturn ([1, 0]);\n};\n"]}