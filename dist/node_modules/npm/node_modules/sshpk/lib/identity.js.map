{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/sshpk/lib/identity.js"],"names":["module","exports","Identity","assert","require","algs","crypto","Fingerprint","Signature","errs","util","utils","asn1","Buffer","DNS_NAME_RE","oids","cn","o","ou","l","s","c","sn","dc","uid","mail","unoids","Object","keys","forEach","k","opts","self","object","arrayOfObject","components","componentLookup","name","oid","undefined","push","length","value","optionalString","type","match","hostname","map","join","email","Error","prototype","toString","toUpperCase","NOT_PRINTABLE","NOT_IA5","toAsn1","der","tag","startSequence","Ber","Constructor","Set","writeOID","asn1type","Utf8String","v","from","writeBuffer","IA5String","writeString","PrintableString","endSequence","globMatch","a","b","aParts","split","bParts","i","equals","other","isIdentity","forHost","string","forUser","forEmail","parseDN","dn","parts","cmps","trim","eqPos","indexOf","slice","toLowerCase","parseAsn1","top","readSequence","end","offset","after","readOID","peek","OctetString","T61String","readString","CharacterString","BMPString","_offset","obj","ver","isCompatible","_sshpkApiVersion","_oldVersionDetect"],"mappings":"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","file":"identity.js","sourcesContent":["// Copyright 2017 Joyent, Inc.\n\nmodule.exports = Identity;\n\nvar assert = require('assert-plus');\nvar algs = require('./algs');\nvar crypto = require('crypto');\nvar Fingerprint = require('./fingerprint');\nvar Signature = require('./signature');\nvar errs = require('./errors');\nvar util = require('util');\nvar utils = require('./utils');\nvar asn1 = require('asn1');\nvar Buffer = require('safer-buffer').Buffer;\n\n/*JSSTYLED*/\nvar DNS_NAME_RE = /^([*]|[a-z0-9][a-z0-9\\-]{0,62})(?:\\.([*]|[a-z0-9][a-z0-9\\-]{0,62}))*$/i;\n\nvar oids = {};\noids.cn = '2.5.4.3';\noids.o = '2.5.4.10';\noids.ou = '2.5.4.11';\noids.l = '2.5.4.7';\noids.s = '2.5.4.8';\noids.c = '2.5.4.6';\noids.sn = '2.5.4.4';\noids.dc = '0.9.2342.19200300.100.1.25';\noids.uid = '0.9.2342.19200300.100.1.1';\noids.mail = '0.9.2342.19200300.100.1.3';\n\nvar unoids = {};\nObject.keys(oids).forEach(function (k) {\n\tunoids[oids[k]] = k;\n});\n\nfunction Identity(opts) {\n\tvar self = this;\n\tassert.object(opts, 'options');\n\tassert.arrayOfObject(opts.components, 'options.components');\n\tthis.components = opts.components;\n\tthis.componentLookup = {};\n\tthis.components.forEach(function (c) {\n\t\tif (c.name && !c.oid)\n\t\t\tc.oid = oids[c.name];\n\t\tif (c.oid && !c.name)\n\t\t\tc.name = unoids[c.oid];\n\t\tif (self.componentLookup[c.name] === undefined)\n\t\t\tself.componentLookup[c.name] = [];\n\t\tself.componentLookup[c.name].push(c);\n\t});\n\tif (this.componentLookup.cn && this.componentLookup.cn.length > 0) {\n\t\tthis.cn = this.componentLookup.cn[0].value;\n\t}\n\tassert.optionalString(opts.type, 'options.type');\n\tif (opts.type === undefined) {\n\t\tif (this.components.length === 1 &&\n\t\t    this.componentLookup.cn &&\n\t\t    this.componentLookup.cn.length === 1 &&\n\t\t    this.componentLookup.cn[0].value.match(DNS_NAME_RE)) {\n\t\t\tthis.type = 'host';\n\t\t\tthis.hostname = this.componentLookup.cn[0].value;\n\n\t\t} else if (this.componentLookup.dc &&\n\t\t    this.components.length === this.componentLookup.dc.length) {\n\t\t\tthis.type = 'host';\n\t\t\tthis.hostname = this.componentLookup.dc.map(\n\t\t\t    function (c) {\n\t\t\t\treturn (c.value);\n\t\t\t}).join('.');\n\n\t\t} else if (this.componentLookup.uid &&\n\t\t    this.components.length ===\n\t\t    this.componentLookup.uid.length) {\n\t\t\tthis.type = 'user';\n\t\t\tthis.uid = this.componentLookup.uid[0].value;\n\n\t\t} else if (this.componentLookup.cn &&\n\t\t    this.componentLookup.cn.length === 1 &&\n\t\t    this.componentLookup.cn[0].value.match(DNS_NAME_RE)) {\n\t\t\tthis.type = 'host';\n\t\t\tthis.hostname = this.componentLookup.cn[0].value;\n\n\t\t} else if (this.componentLookup.uid &&\n\t\t    this.componentLookup.uid.length === 1) {\n\t\t\tthis.type = 'user';\n\t\t\tthis.uid = this.componentLookup.uid[0].value;\n\n\t\t} else if (this.componentLookup.mail &&\n\t\t    this.componentLookup.mail.length === 1) {\n\t\t\tthis.type = 'email';\n\t\t\tthis.email = this.componentLookup.mail[0].value;\n\n\t\t} else if (this.componentLookup.cn &&\n\t\t    this.componentLookup.cn.length === 1) {\n\t\t\tthis.type = 'user';\n\t\t\tthis.uid = this.componentLookup.cn[0].value;\n\n\t\t} else {\n\t\t\tthis.type = 'unknown';\n\t\t}\n\t} else {\n\t\tthis.type = opts.type;\n\t\tif (this.type === 'host')\n\t\t\tthis.hostname = opts.hostname;\n\t\telse if (this.type === 'user')\n\t\t\tthis.uid = opts.uid;\n\t\telse if (this.type === 'email')\n\t\t\tthis.email = opts.email;\n\t\telse\n\t\t\tthrow (new Error('Unknown type ' + this.type));\n\t}\n}\n\nIdentity.prototype.toString = function () {\n\treturn (this.components.map(function (c) {\n\t\treturn (c.name.toUpperCase() + '=' + c.value);\n\t}).join(', '));\n};\n\n/*\n * These are from X.680 -- PrintableString allowed chars are in section 37.4\n * table 8. Spec for IA5Strings is \"1,6 + SPACE + DEL\" where 1 refers to\n * ISO IR #001 (standard ASCII control characters) and 6 refers to ISO IR #006\n * (the basic ASCII character set).\n */\n/* JSSTYLED */\nvar NOT_PRINTABLE = /[^a-zA-Z0-9 '(),+.\\/:=?-]/;\n/* JSSTYLED */\nvar NOT_IA5 = /[^\\x00-\\x7f]/;\n\nIdentity.prototype.toAsn1 = function (der, tag) {\n\tder.startSequence(tag);\n\tthis.components.forEach(function (c) {\n\t\tder.startSequence(asn1.Ber.Constructor | asn1.Ber.Set);\n\t\tder.startSequence();\n\t\tder.writeOID(c.oid);\n\t\t/*\n\t\t * If we fit in a PrintableString, use that. Otherwise use an\n\t\t * IA5String or UTF8String.\n\t\t *\n\t\t * If this identity was parsed from a DN, use the ASN.1 types\n\t\t * from the original representation (otherwise this might not\n\t\t * be a full match for the original in some validators).\n\t\t */\n\t\tif (c.asn1type === asn1.Ber.Utf8String ||\n\t\t    c.value.match(NOT_IA5)) {\n\t\t\tvar v = Buffer.from(c.value, 'utf8');\n\t\t\tder.writeBuffer(v, asn1.Ber.Utf8String);\n\n\t\t} else if (c.asn1type === asn1.Ber.IA5String ||\n\t\t    c.value.match(NOT_PRINTABLE)) {\n\t\t\tder.writeString(c.value, asn1.Ber.IA5String);\n\n\t\t} else {\n\t\t\tvar type = asn1.Ber.PrintableString;\n\t\t\tif (c.asn1type !== undefined)\n\t\t\t\ttype = c.asn1type;\n\t\t\tder.writeString(c.value, type);\n\t\t}\n\t\tder.endSequence();\n\t\tder.endSequence();\n\t});\n\tder.endSequence();\n};\n\nfunction globMatch(a, b) {\n\tif (a === '**' || b === '**')\n\t\treturn (true);\n\tvar aParts = a.split('.');\n\tvar bParts = b.split('.');\n\tif (aParts.length !== bParts.length)\n\t\treturn (false);\n\tfor (var i = 0; i < aParts.length; ++i) {\n\t\tif (aParts[i] === '*' || bParts[i] === '*')\n\t\t\tcontinue;\n\t\tif (aParts[i] !== bParts[i])\n\t\t\treturn (false);\n\t}\n\treturn (true);\n}\n\nIdentity.prototype.equals = function (other) {\n\tif (!Identity.isIdentity(other, [1, 0]))\n\t\treturn (false);\n\tif (other.components.length !== this.components.length)\n\t\treturn (false);\n\tfor (var i = 0; i < this.components.length; ++i) {\n\t\tif (this.components[i].oid !== other.components[i].oid)\n\t\t\treturn (false);\n\t\tif (!globMatch(this.components[i].value,\n\t\t    other.components[i].value)) {\n\t\t\treturn (false);\n\t\t}\n\t}\n\treturn (true);\n};\n\nIdentity.forHost = function (hostname) {\n\tassert.string(hostname, 'hostname');\n\treturn (new Identity({\n\t\ttype: 'host',\n\t\thostname: hostname,\n\t\tcomponents: [ { name: 'cn', value: hostname } ]\n\t}));\n};\n\nIdentity.forUser = function (uid) {\n\tassert.string(uid, 'uid');\n\treturn (new Identity({\n\t\ttype: 'user',\n\t\tuid: uid,\n\t\tcomponents: [ { name: 'uid', value: uid } ]\n\t}));\n};\n\nIdentity.forEmail = function (email) {\n\tassert.string(email, 'email');\n\treturn (new Identity({\n\t\ttype: 'email',\n\t\temail: email,\n\t\tcomponents: [ { name: 'mail', value: email } ]\n\t}));\n};\n\nIdentity.parseDN = function (dn) {\n\tassert.string(dn, 'dn');\n\tvar parts = dn.split(',');\n\tvar cmps = parts.map(function (c) {\n\t\tc = c.trim();\n\t\tvar eqPos = c.indexOf('=');\n\t\tvar name = c.slice(0, eqPos).toLowerCase();\n\t\tvar value = c.slice(eqPos + 1);\n\t\treturn ({ name: name, value: value });\n\t});\n\treturn (new Identity({ components: cmps }));\n};\n\nIdentity.parseAsn1 = function (der, top) {\n\tvar components = [];\n\tder.readSequence(top);\n\tvar end = der.offset + der.length;\n\twhile (der.offset < end) {\n\t\tder.readSequence(asn1.Ber.Constructor | asn1.Ber.Set);\n\t\tvar after = der.offset + der.length;\n\t\tder.readSequence();\n\t\tvar oid = der.readOID();\n\t\tvar type = der.peek();\n\t\tvar value;\n\t\tswitch (type) {\n\t\tcase asn1.Ber.PrintableString:\n\t\tcase asn1.Ber.IA5String:\n\t\tcase asn1.Ber.OctetString:\n\t\tcase asn1.Ber.T61String:\n\t\t\tvalue = der.readString(type);\n\t\t\tbreak;\n\t\tcase asn1.Ber.Utf8String:\n\t\t\tvalue = der.readString(type, true);\n\t\t\tvalue = value.toString('utf8');\n\t\t\tbreak;\n\t\tcase asn1.Ber.CharacterString:\n\t\tcase asn1.Ber.BMPString:\n\t\t\tvalue = der.readString(type, true);\n\t\t\tvalue = value.toString('utf16le');\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow (new Error('Unknown asn1 type ' + type));\n\t\t}\n\t\tcomponents.push({ oid: oid, asn1type: type, value: value });\n\t\tder._offset = after;\n\t}\n\tder._offset = end;\n\treturn (new Identity({\n\t\tcomponents: components\n\t}));\n};\n\nIdentity.isIdentity = function (obj, ver) {\n\treturn (utils.isCompatible(obj, Identity, ver));\n};\n\n/*\n * API versions for Identity:\n * [1,0] -- initial ver\n */\nIdentity.prototype._sshpkApiVersion = [1, 0];\n\nIdentity._oldVersionDetect = function (obj) {\n\treturn ([1, 0]);\n};\n"]}