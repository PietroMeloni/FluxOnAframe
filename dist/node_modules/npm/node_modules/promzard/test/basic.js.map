{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/promzard/test/basic.js"],"names":["tap","require","pz","spawn","test","t","example","resolve","node","process","execPath","expect","console","error","c","customFds","output","stdout","on","d","respond","actual","stderr","match","stdin","write","end","JSON","parse","deepEqual"],"mappings":";;AAAA,IAAIA,MAAMC,QAAQ,KAAR,CAAV;AACA,IAAIC,KAAKD,QAAQ,gBAAR,CAAT;AACA,IAAIE,QAAQF,QAAQ,eAAR,EAAyBE,KAArC;;AAEAH,IAAII,IAAJ,CAAS,iBAAT,EAA4B,UAAUC,CAAV,EAAa;;AAEvC,MAAIC,UAAUL,QAAQM,OAAR,CAAgB,qBAAhB,CAAd;AACA,MAAIC,OAAOC,QAAQC,QAAnB;;AAEA,MAAIC,SAAU;AACZ,YAAQ,SADI;AAEZ,eAAW,OAFC;AAGZ,mBAAe,qBAHH;AAIZ,YAAQ,eAJI;AAKZ,mBAAe;AACb,iBAAW,SADE;AAEb,cAAQ;AAFK,KALH;AASZ,oBAAgB,EATJ;AAUZ,uBAAmB;AACjB,aAAO;AADU,KAVP;AAaZ,eAAW;AACT,cAAQ;AADC,KAbC;AAgBZ,kBAAc;AACZ,cAAQ,KADI;AAEZ,aAAO;AAFK,KAhBF;AAoBZ,gBAAY,qCApBA;AAqBZ,gBAAY,CACV,QADU,EAEV,UAFU,EAGV,SAHU,EAIV,MAJU,CArBA;AA2BZ,cAAU;AACR,cAAQ,gBADA;AAER,eAAS,mBAFD;AAGR,aAAO;AAHC,KA3BE;AAgCZ,eAAW,KAhCC;AAiCZ,cAAU;AACR,cAAQ;AADA;AAjCE,GAAd;;AAsCAC,UAAQC,KAAR,CAAc,OAAd,EAAuBL,IAAvB,EAA6BF,OAA7B;AACA,MAAIQ,IAAIX,MAAMK,IAAN,EAAY,CAACF,OAAD,CAAZ,EAAuB,EAAES,WAAW,CAAC,CAAC,CAAF,EAAI,CAAC,CAAL,EAAO,CAAC,CAAR,CAAb,EAAvB,CAAR;AACA,MAAIC,SAAS,EAAb;AACAF,IAAEG,MAAF,CAASC,EAAT,CAAY,MAAZ,EAAoB,UAAUC,CAAV,EAAa;AAC/BH,cAAUG,CAAV;AACAC;AACD,GAHD;;AAKA,MAAIC,SAAS,EAAb;AACAP,IAAEQ,MAAF,CAASJ,EAAT,CAAY,MAAZ,EAAoB,UAAUC,CAAV,EAAa;AAC/BE,cAAUF,CAAV;AACD,GAFD;;AAIA,WAASC,OAAT,GAAoB;AAClBR,YAAQC,KAAR,CAAc,SAAd,EAAyBG,MAAzB;AACA,QAAIA,OAAOO,KAAP,CAAa,gBAAb,CAAJ,EAAoC;AAClCT,QAAEU,KAAF,CAAQC,KAAR,CAAc,uBAAd;AACA;AACD;AACD,QAAIT,OAAOO,KAAP,CAAa,8BAAb,CAAJ,EAAkD;AAChDT,QAAEU,KAAF,CAAQC,KAAR,CAAc,iBAAd;AACA;AACD;AACD,QAAIT,OAAOO,KAAP,CAAa,aAAb,CAAJ,EAAiC;AAC/BT,QAAEU,KAAF,CAAQC,KAAR,CAAc,gCAAd;AACA;AACA;AACA;AACAX,QAAEU,KAAF,CAAQE,GAAR;AACA;AACD;AACF;;AAEDZ,IAAEI,EAAF,CAAK,MAAL,EAAa,YAAY;AACvBN,YAAQC,KAAR,CAAc,YAAd;AACD,GAFD;;AAIAC,IAAEI,EAAF,CAAK,OAAL,EAAc,YAAY;AACxBN,YAAQC,KAAR,CAAc,QAAd,EAAwBQ,MAAxB;AACAA,aAASM,KAAKC,KAAL,CAAWP,MAAX,CAAT;AACAhB,MAAEwB,SAAF,CAAYR,MAAZ,EAAoBV,MAApB;AACAN,MAAEqB,GAAF;AACD,GALD;AAMD,CAtFD","file":"basic.js","sourcesContent":["var tap = require('tap')\nvar pz = require('../promzard.js')\nvar spawn = require('child_process').spawn\n\ntap.test('run the example', function (t) {\n\n  var example = require.resolve('../example/index.js')\n  var node = process.execPath\n\n  var expect =  {\n    \"name\": \"example\",\n    \"version\": \"0.0.0\",\n    \"description\": \"testing description\",\n    \"main\": \"test-entry.js\",\n    \"directories\": {\n      \"example\": \"example\",\n      \"test\": \"test\"\n    },\n    \"dependencies\": {},\n    \"devDependencies\": {\n      \"tap\": \"~0.2.5\"\n    },\n    \"scripts\": {\n      \"test\": \"tap test/*.js\"\n    },\n    \"repository\": {\n      \"type\": \"git\",\n      \"url\": \"git://github.com/substack/example.git\"\n    },\n    \"homepage\": \"https://github.com/substack/example\",\n    \"keywords\": [\n      \"fugazi\",\n      \"function\",\n      \"waiting\",\n      \"room\"\n    ],\n    \"author\": {\n      \"name\": \"James Halliday\",\n      \"email\": \"mail@substack.net\",\n      \"url\": \"http://substack.net\"\n    },\n    \"license\": \"MIT\",\n    \"engine\": {\n      \"node\": \">=0.6\"\n    }\n  }\n\n  console.error('%s %s', node, example)\n  var c = spawn(node, [example], { customFds: [-1,-1,-1] })\n  var output = ''\n  c.stdout.on('data', function (d) {\n    output += d\n    respond()\n  })\n\n  var actual = ''\n  c.stderr.on('data', function (d) {\n    actual += d\n  })\n\n  function respond () {\n    console.error('respond', output)\n    if (output.match(/description: $/)) {\n      c.stdin.write('testing description\\n')\n      return\n    }\n    if (output.match(/entry point: \\(index\\.js\\) $/)) {\n      c.stdin.write('test-entry.js\\n')\n      return\n    }\n    if (output.match(/keywords: $/)) {\n      c.stdin.write('fugazi function waiting room\\n')\n      // \"read\" module is weird on node >= 0.10 when not a TTY\n      // requires explicit ending for reasons.\n      // could dig in, but really just wanna make tests pass, whatever.\n      c.stdin.end()\n      return\n    }\n  }\n\n  c.on('exit', function () {\n    console.error('exit event')\n  })\n\n  c.on('close', function () {\n    console.error('actual', actual)\n    actual = JSON.parse(actual)\n    t.deepEqual(actual, expect)\n    t.end()\n  })\n})\n"]}