{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/tar/lib/create.js"],"names":["hlo","require","Pack","fs","fsm","t","path","c","module","exports","opt_","files","cb","Array","isArray","length","TypeError","from","opt","sync","file","createFileSync","createFile","createSync","create","p","Sync","stream","WriteStreamSync","mode","pipe","addFilesSync","WriteStream","promise","Promise","res","rej","on","addFilesAsync","then","forEach","charAt","resolve","cwd","substr","noResume","onentry","add","entry","end","shift"],"mappings":"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","file":"create.js","sourcesContent":["'use strict'\n\n// tar -c\nconst hlo = require('./high-level-opt.js')\n\nconst Pack = require('./pack.js')\nconst fs = require('fs')\nconst fsm = require('fs-minipass')\nconst t = require('./list.js')\nconst path = require('path')\n\nconst c = module.exports = (opt_, files, cb) => {\n  if (typeof files === 'function')\n    cb = files\n\n  if (Array.isArray(opt_))\n    files = opt_, opt_ = {}\n\n  if (!files || !Array.isArray(files) || !files.length)\n    throw new TypeError('no files or directories specified')\n\n  files = Array.from(files)\n\n  const opt = hlo(opt_)\n\n  if (opt.sync && typeof cb === 'function')\n    throw new TypeError('callback not supported for sync tar functions')\n\n  if (!opt.file && typeof cb === 'function')\n    throw new TypeError('callback only supported with file option')\n\n  return opt.file && opt.sync ? createFileSync(opt, files)\n    : opt.file ? createFile(opt, files, cb)\n    : opt.sync ? createSync(opt, files)\n    : create(opt, files)\n}\n\nconst createFileSync = (opt, files) => {\n  const p = new Pack.Sync(opt)\n  const stream = new fsm.WriteStreamSync(opt.file, {\n    mode: opt.mode || 0o666\n  })\n  p.pipe(stream)\n  addFilesSync(p, files)\n}\n\nconst createFile = (opt, files, cb) => {\n  const p = new Pack(opt)\n  const stream = new fsm.WriteStream(opt.file, {\n    mode: opt.mode || 0o666\n  })\n  p.pipe(stream)\n\n  const promise = new Promise((res, rej) => {\n    stream.on('error', rej)\n    stream.on('close', res)\n    p.on('error', rej)\n  })\n\n  addFilesAsync(p, files)\n\n  return cb ? promise.then(cb, cb) : promise\n}\n\nconst addFilesSync = (p, files) => {\n  files.forEach(file => {\n    if (file.charAt(0) === '@')\n      t({\n        file: path.resolve(p.cwd, file.substr(1)),\n        sync: true,\n        noResume: true,\n        onentry: entry => p.add(entry)\n      })\n    else\n      p.add(file)\n  })\n  p.end()\n}\n\nconst addFilesAsync = (p, files) => {\n  while (files.length) {\n    const file = files.shift()\n    if (file.charAt(0) === '@')\n      return t({\n        file: path.resolve(p.cwd, file.substr(1)),\n        noResume: true,\n        onentry: entry => p.add(entry)\n      }).then(_ => addFilesAsync(p, files))\n    else\n      p.add(file)\n  }\n  p.end()\n}\n\nconst createSync = (opt, files) => {\n  const p = new Pack.Sync(opt)\n  addFilesSync(p, files)\n  return p\n}\n\nconst create = (opt, files) => {\n  const p = new Pack(opt)\n  addFilesAsync(p, files)\n  return p\n}\n"]}