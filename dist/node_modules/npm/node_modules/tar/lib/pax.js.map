{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/tar/lib/pax.js"],"names":["Buffer","require","Header","path","Pax","obj","global","atime","charset","comment","ctime","gid","gname","linkpath","mtime","size","uid","uname","dev","ino","nlink","body","encodeBody","bodyLen","byteLength","bufLen","Math","ceil","buf","allocUnsafe","i","basename","slice","mode","type","devmaj","devmin","encode","write","length","encodeField","field","undefined","v","Date","getTime","s","byteLen","digits","floor","log","pow","len","parse","string","ex","g","merge","parseKV","a","b","Object","keys","reduce","k","replace","split","parseKVLine","create","set","line","n","parseInt","substr","kv","shift","join","test","module","exports"],"mappings":"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","file":"pax.js","sourcesContent":["'use strict'\nconst Buffer = require('./buffer.js')\nconst Header = require('./header.js')\nconst path = require('path')\n\nclass Pax {\n  constructor (obj, global) {\n    this.atime = obj.atime || null\n    this.charset = obj.charset || null\n    this.comment = obj.comment || null\n    this.ctime = obj.ctime || null\n    this.gid = obj.gid || null\n    this.gname = obj.gname || null\n    this.linkpath = obj.linkpath || null\n    this.mtime = obj.mtime || null\n    this.path = obj.path || null\n    this.size = obj.size || null\n    this.uid = obj.uid || null\n    this.uname = obj.uname || null\n    this.dev = obj.dev || null\n    this.ino = obj.ino || null\n    this.nlink = obj.nlink || null\n    this.global = global || false\n  }\n\n  encode () {\n    const body = this.encodeBody()\n    if (body === '')\n      return null\n\n    const bodyLen = Buffer.byteLength(body)\n    // round up to 512 bytes\n    // add 512 for header\n    const bufLen = 512 * Math.ceil(1 + bodyLen / 512)\n    const buf = Buffer.allocUnsafe(bufLen)\n\n    // 0-fill the header section, it might not hit every field\n    for (let i = 0; i < 512; i++) {\n      buf[i] = 0\n    }\n\n    new Header({\n      // XXX split the path\n      // then the path should be PaxHeader + basename, but less than 99,\n      // prepend with the dirname\n      path: ('PaxHeader/' + path.basename(this.path)).slice(0, 99),\n      mode: this.mode || 0o644,\n      uid: this.uid || null,\n      gid: this.gid || null,\n      size: bodyLen,\n      mtime: this.mtime || null,\n      type: this.global ? 'GlobalExtendedHeader' : 'ExtendedHeader',\n      linkpath: '',\n      uname: this.uname || '',\n      gname: this.gname || '',\n      devmaj: 0,\n      devmin: 0,\n      atime: this.atime || null,\n      ctime: this.ctime || null\n    }).encode(buf)\n\n    buf.write(body, 512, bodyLen, 'utf8')\n\n    // null pad after the body\n    for (let i = bodyLen + 512; i < buf.length; i++) {\n      buf[i] = 0\n    }\n\n    return buf\n  }\n\n  encodeBody () {\n    return (\n      this.encodeField('path') +\n      this.encodeField('ctime') +\n      this.encodeField('atime') +\n      this.encodeField('dev') +\n      this.encodeField('ino') +\n      this.encodeField('nlink') +\n      this.encodeField('charset') +\n      this.encodeField('comment') +\n      this.encodeField('gid') +\n      this.encodeField('gname') +\n      this.encodeField('linkpath') +\n      this.encodeField('mtime') +\n      this.encodeField('size') +\n      this.encodeField('uid') +\n      this.encodeField('uname')\n    )\n  }\n\n  encodeField (field) {\n    if (this[field] === null || this[field] === undefined)\n      return ''\n    const v = this[field] instanceof Date ? this[field].getTime() / 1000\n      : this[field]\n    const s = ' ' +\n      (field === 'dev' || field === 'ino' || field === 'nlink'\n       ? 'SCHILY.' : '') +\n      field + '=' + v + '\\n'\n    const byteLen = Buffer.byteLength(s)\n    // the digits includes the length of the digits in ascii base-10\n    // so if it's 9 characters, then adding 1 for the 9 makes it 10\n    // which makes it 11 chars.\n    let digits = Math.floor(Math.log(byteLen) / Math.log(10)) + 1\n    if (byteLen + digits >= Math.pow(10, digits))\n      digits += 1\n    const len = digits + byteLen\n    return len + s\n  }\n}\n\nPax.parse = (string, ex, g) => new Pax(merge(parseKV(string), ex), g)\n\nconst merge = (a, b) =>\n  b ? Object.keys(a).reduce((s, k) => (s[k] = a[k], s), b) : a\n\nconst parseKV = string =>\n  string\n    .replace(/\\n$/, '')\n    .split('\\n')\n    .reduce(parseKVLine, Object.create(null))\n\nconst parseKVLine = (set, line) => {\n  const n = parseInt(line, 10)\n\n  // XXX Values with \\n in them will fail this.\n  // Refactor to not be a naive line-by-line parse.\n  if (n !== Buffer.byteLength(line) + 1)\n    return set\n\n  line = line.substr((n + ' ').length)\n  const kv = line.split('=')\n  const k = kv.shift().replace(/^SCHILY\\.(dev|ino|nlink)/, '$1')\n  if (!k)\n    return set\n\n  const v = kv.join('=')\n  set[k] = /^([A-Z]+\\.)?([mac]|birth|creation)time$/.test(k)\n    ?  new Date(v * 1000)\n    : /^[0-9]+$/.test(v) ? +v\n    : v\n  return set\n}\n\nmodule.exports = Pax\n"]}