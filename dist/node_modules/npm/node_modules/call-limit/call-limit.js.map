{"version":3,"sources":["../../../../../node_modules/npm/node_modules/call-limit/call-limit.js"],"names":["defaultMaxRunning","limit","module","exports","func","maxRunning","running","queue","limited","self","args","Array","prototype","slice","call","arguments","push","cb","length","pop","cbargs","process","nextTick","apply","next","shift","method","classOrObj","promise","Promise","resolve","runNext","then","finish","err"],"mappings":"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","file":"call-limit.js","sourcesContent":["\"use strict\"\n\nvar defaultMaxRunning = 50\n\nvar limit = module.exports = function (func, maxRunning) {\n  var running = 0\n  var queue = []\n  if (!maxRunning) maxRunning = defaultMaxRunning\n  return function limited () {\n    var self = this\n    var args = Array.prototype.slice.call(arguments)\n    if (running >= maxRunning) {\n      queue.push({self: this, args: args})\n      return\n    }\n    var cb = typeof args[args.length-1] === 'function' && args.pop()\n    ++ running\n    args.push(function () {\n      var cbargs = arguments\n      -- running\n      cb && process.nextTick(function () {\n        cb.apply(self, cbargs)\n      })\n      if (queue.length) {\n        var next = queue.shift()\n        limited.apply(next.self, next.args)\n      }\n    })\n    func.apply(self, args)\n  }\n}\n\nmodule.exports.method = function (classOrObj, method, maxRunning) {\n  if (typeof classOrObj === 'function') {\n    var func = classOrObj.prototype[method]\n    classOrObj.prototype[method] = limit(func, maxRunning)\n  } else {\n    var func = classOrObj[method]\n    classOrObj[method] = limit(func, maxRunning)\n  }\n}\n\nmodule.exports.promise = function (func, maxRunning) {\n  var running = 0\n  var queue = []\n  if (!maxRunning) maxRunning = defaultMaxRunning\n  return function () {\n    var self = this\n    var args = Array.prototype.slice.call(arguments)\n    return new Promise(function (resolve) {\n      if (running >= maxRunning) {\n        queue.push({self: self, args: args, resolve: resolve})\n        return\n      } else {\n        runNext(self, args, resolve)\n      }\n      function runNext (self, args, resolve) {\n        ++ running\n        resolve(\n          func.apply(self, args)\n          .then(finish, function (err) {\n            finish(err)\n            throw err\n           }))\n      }\n\n      function finish () {\n        -- running\n        if (queue.length) {\n          var next = queue.shift()\n          process.nextTick(runNext, next.self, next.args, next.resolve)\n        }\n      }\n    })\n  }\n}\n\nmodule.exports.promise.method = function (classOrObj, method, maxRunning) {\n  if (typeof classOrObj === 'function') {\n    var func = classOrObj.prototype[method]\n    classOrObj.prototype[method] = limit.promise(func, maxRunning)\n  } else {\n    var func = classOrObj[method]\n    classOrObj[method] = limit.promise(func, maxRunning)\n  }\n}\n"]}