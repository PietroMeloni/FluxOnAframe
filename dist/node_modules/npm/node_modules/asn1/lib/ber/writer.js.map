{"version":3,"sources":["../../../../../../../node_modules/npm/node_modules/asn1/lib/ber/writer.js"],"names":["assert","require","ASN1","errors","newInvalidAsn1Error","DEFAULT_OPTS","size","growthFactor","merge","from","to","ok","equal","keys","Object","getOwnPropertyNames","forEach","key","value","getOwnPropertyDescriptor","defineProperty","Writer","options","_buf","Buffer","_size","length","_offset","_options","_seq","prototype","get","InvalidAsn1Error","slice","writeByte","b","TypeError","_ensure","writeInt","i","tag","Integer","sz","writeNull","Null","writeEnumeration","Enumeration","writeBoolean","Boolean","writeString","s","OctetString","len","byteLength","writeLength","write","writeBuffer","buf","isBuffer","copy","writeStringArray","strings","Array","self","writeOID","OID","test","Error","encodeOctet","bytes","octet","push","tmp","split","parseInt","InvalidAsn1ERror","startSequence","Sequence","Constructor","endSequence","seq","pop","start","_shift","shift","undefined","module","exports"],"mappings":"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","file":"writer.js","sourcesContent":["// Copyright 2011 Mark Cavage <mcavage@gmail.com> All rights reserved.\n\nvar assert = require('assert');\nvar ASN1 = require('./types');\nvar errors = require('./errors');\n\n\n///--- Globals\n\nvar newInvalidAsn1Error = errors.newInvalidAsn1Error;\n\nvar DEFAULT_OPTS = {\n  size: 1024,\n  growthFactor: 8\n};\n\n\n///--- Helpers\n\nfunction merge(from, to) {\n  assert.ok(from);\n  assert.equal(typeof(from), 'object');\n  assert.ok(to);\n  assert.equal(typeof(to), 'object');\n\n  var keys = Object.getOwnPropertyNames(from);\n  keys.forEach(function(key) {\n    if (to[key])\n      return;\n\n    var value = Object.getOwnPropertyDescriptor(from, key);\n    Object.defineProperty(to, key, value);\n  });\n\n  return to;\n}\n\n\n\n///--- API\n\nfunction Writer(options) {\n  options = merge(DEFAULT_OPTS, options || {});\n\n  this._buf = new Buffer(options.size || 1024);\n  this._size = this._buf.length;\n  this._offset = 0;\n  this._options = options;\n\n  // A list of offsets in the buffer where we need to insert\n  // sequence tag/len pairs.\n  this._seq = [];\n}\n\nObject.defineProperty(Writer.prototype, 'buffer', {\n  get: function () {\n    if (this._seq.length)\n      throw new InvalidAsn1Error(this._seq.length + ' unended sequence(s)');\n\n    return (this._buf.slice(0, this._offset));\n  }\n});\n\nWriter.prototype.writeByte = function(b) {\n  if (typeof(b) !== 'number')\n    throw new TypeError('argument must be a Number');\n\n  this._ensure(1);\n  this._buf[this._offset++] = b;\n};\n\n\nWriter.prototype.writeInt = function(i, tag) {\n  if (typeof(i) !== 'number')\n    throw new TypeError('argument must be a Number');\n  if (typeof(tag) !== 'number')\n    tag = ASN1.Integer;\n\n  var sz = 4;\n\n  while ((((i & 0xff800000) === 0) || ((i & 0xff800000) === 0xff800000 >> 0)) &&\n         (sz > 1)) {\n    sz--;\n    i <<= 8;\n  }\n\n  if (sz > 4)\n    throw new InvalidAsn1Error('BER ints cannot be > 0xffffffff');\n\n  this._ensure(2 + sz);\n  this._buf[this._offset++] = tag;\n  this._buf[this._offset++] = sz;\n\n  while (sz-- > 0) {\n    this._buf[this._offset++] = ((i & 0xff000000) >>> 24);\n    i <<= 8;\n  }\n\n};\n\n\nWriter.prototype.writeNull = function() {\n  this.writeByte(ASN1.Null);\n  this.writeByte(0x00);\n};\n\n\nWriter.prototype.writeEnumeration = function(i, tag) {\n  if (typeof(i) !== 'number')\n    throw new TypeError('argument must be a Number');\n  if (typeof(tag) !== 'number')\n    tag = ASN1.Enumeration;\n\n  return this.writeInt(i, tag);\n};\n\n\nWriter.prototype.writeBoolean = function(b, tag) {\n  if (typeof(b) !== 'boolean')\n    throw new TypeError('argument must be a Boolean');\n  if (typeof(tag) !== 'number')\n    tag = ASN1.Boolean;\n\n  this._ensure(3);\n  this._buf[this._offset++] = tag;\n  this._buf[this._offset++] = 0x01;\n  this._buf[this._offset++] = b ? 0xff : 0x00;\n};\n\n\nWriter.prototype.writeString = function(s, tag) {\n  if (typeof(s) !== 'string')\n    throw new TypeError('argument must be a string (was: ' + typeof(s) + ')');\n  if (typeof(tag) !== 'number')\n    tag = ASN1.OctetString;\n\n  var len = Buffer.byteLength(s);\n  this.writeByte(tag);\n  this.writeLength(len);\n  if (len) {\n    this._ensure(len);\n    this._buf.write(s, this._offset);\n    this._offset += len;\n  }\n};\n\n\nWriter.prototype.writeBuffer = function(buf, tag) {\n  if (typeof(tag) !== 'number')\n    throw new TypeError('tag must be a number');\n  if (!Buffer.isBuffer(buf))\n    throw new TypeError('argument must be a buffer');\n\n  this.writeByte(tag);\n  this.writeLength(buf.length);\n  this._ensure(buf.length);\n  buf.copy(this._buf, this._offset, 0, buf.length);\n  this._offset += buf.length;\n};\n\n\nWriter.prototype.writeStringArray = function(strings) {\n  if ((!strings instanceof Array))\n    throw new TypeError('argument must be an Array[String]');\n\n  var self = this;\n  strings.forEach(function(s) {\n    self.writeString(s);\n  });\n};\n\n// This is really to solve DER cases, but whatever for now\nWriter.prototype.writeOID = function(s, tag) {\n  if (typeof(s) !== 'string')\n    throw new TypeError('argument must be a string');\n  if (typeof(tag) !== 'number')\n    tag = ASN1.OID;\n\n  if (!/^([0-9]+\\.){3,}[0-9]+$/.test(s))\n    throw new Error('argument is not a valid OID string');\n\n  function encodeOctet(bytes, octet) {\n    if (octet < 128) {\n        bytes.push(octet);\n    } else if (octet < 16384) {\n        bytes.push((octet >>> 7) | 0x80);\n        bytes.push(octet & 0x7F);\n    } else if (octet < 2097152) {\n      bytes.push((octet >>> 14) | 0x80);\n      bytes.push(((octet >>> 7) | 0x80) & 0xFF);\n      bytes.push(octet & 0x7F);\n    } else if (octet < 268435456) {\n      bytes.push((octet >>> 21) | 0x80);\n      bytes.push(((octet >>> 14) | 0x80) & 0xFF);\n      bytes.push(((octet >>> 7) | 0x80) & 0xFF);\n      bytes.push(octet & 0x7F);\n    } else {\n      bytes.push(((octet >>> 28) | 0x80) & 0xFF);\n      bytes.push(((octet >>> 21) | 0x80) & 0xFF);\n      bytes.push(((octet >>> 14) | 0x80) & 0xFF);\n      bytes.push(((octet >>> 7) | 0x80) & 0xFF);\n      bytes.push(octet & 0x7F);\n    }\n  }\n\n  var tmp = s.split('.');\n  var bytes = [];\n  bytes.push(parseInt(tmp[0], 10) * 40 + parseInt(tmp[1], 10));\n  tmp.slice(2).forEach(function(b) {\n    encodeOctet(bytes, parseInt(b, 10));\n  });\n\n  var self = this;\n  this._ensure(2 + bytes.length);\n  this.writeByte(tag);\n  this.writeLength(bytes.length);\n  bytes.forEach(function(b) {\n    self.writeByte(b);\n  });\n};\n\n\nWriter.prototype.writeLength = function(len) {\n  if (typeof(len) !== 'number')\n    throw new TypeError('argument must be a Number');\n\n  this._ensure(4);\n\n  if (len <= 0x7f) {\n    this._buf[this._offset++] = len;\n  } else if (len <= 0xff) {\n    this._buf[this._offset++] = 0x81;\n    this._buf[this._offset++] = len;\n  } else if (len <= 0xffff) {\n    this._buf[this._offset++] = 0x82;\n    this._buf[this._offset++] = len >> 8;\n    this._buf[this._offset++] = len;\n  } else if (len <= 0xffffff) {\n    this._buf[this._offset++] = 0x83;\n    this._buf[this._offset++] = len >> 16;\n    this._buf[this._offset++] = len >> 8;\n    this._buf[this._offset++] = len;\n  } else {\n    throw new InvalidAsn1ERror('Length too long (> 4 bytes)');\n  }\n};\n\nWriter.prototype.startSequence = function(tag) {\n  if (typeof(tag) !== 'number')\n    tag = ASN1.Sequence | ASN1.Constructor;\n\n  this.writeByte(tag);\n  this._seq.push(this._offset);\n  this._ensure(3);\n  this._offset += 3;\n};\n\n\nWriter.prototype.endSequence = function() {\n  var seq = this._seq.pop();\n  var start = seq + 3;\n  var len = this._offset - start;\n\n  if (len <= 0x7f) {\n    this._shift(start, len, -2);\n    this._buf[seq] = len;\n  } else if (len <= 0xff) {\n    this._shift(start, len, -1);\n    this._buf[seq] = 0x81;\n    this._buf[seq + 1] = len;\n  } else if (len <= 0xffff) {\n    this._buf[seq] = 0x82;\n    this._buf[seq + 1] = len >> 8;\n    this._buf[seq + 2] = len;\n  } else if (len <= 0xffffff) {\n    this._shift(start, len, 1);\n    this._buf[seq] = 0x83;\n    this._buf[seq + 1] = len >> 16;\n    this._buf[seq + 2] = len >> 8;\n    this._buf[seq + 3] = len;\n  } else {\n    throw new InvalidAsn1Error('Sequence too long');\n  }\n};\n\n\nWriter.prototype._shift = function(start, len, shift) {\n  assert.ok(start !== undefined);\n  assert.ok(len !== undefined);\n  assert.ok(shift);\n\n  this._buf.copy(this._buf, start + shift, start, start + len);\n  this._offset += shift;\n};\n\nWriter.prototype._ensure = function(len) {\n  assert.ok(len);\n\n  if (this._size - this._offset < len) {\n    var sz = this._size * this._options.growthFactor;\n    if (sz - this._offset < len)\n      sz += len;\n\n    var buf = new Buffer(sz);\n\n    this._buf.copy(buf, 0, 0, this._offset);\n    this._buf = buf;\n    this._size = sz;\n  }\n};\n\n\n\n///--- Exported API\n\nmodule.exports = Writer;\n"]}