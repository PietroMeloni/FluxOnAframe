{"version":3,"sources":["../../../../../node_modules/npm/node_modules/JSONStream/index.js"],"names":["Parser","require","through","exports","parse","path","map","header","footer","parser","stream","chunk","Buffer","write","data","emit","queue","split","e","emitKey","recurse","count","_key","length","onValue","value","root","i","j","emitPath","key","c","stack","check","setHeaderFooter","nextKey","Object","isFrozen","actualPath","slice","element","concat","k","_onToken","onToken","token","onError","err","message","indexOf","x","y","exec","stringify","op","sep","cl","indent","first","anyData","json","JSON","stringifyObject"],"mappings":"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","file":"index.js","sourcesContent":["'use strict'\n\nvar Parser = require('jsonparse')\n  , through = require('through')\n\n/*\n\n  the value of this.stack that creationix's jsonparse has is weird.\n\n  it makes this code ugly, but his problem is way harder that mine,\n  so i'll forgive him.\n\n*/\n\nexports.parse = function (path, map) {\n  var header, footer\n  var parser = new Parser()\n  var stream = through(function (chunk) {\n    if('string' === typeof chunk)\n      chunk = new Buffer(chunk)\n    parser.write(chunk)\n  },\n  function (data) {\n    if(data)\n      stream.write(data)\n    if (header)\n        stream.emit('header', header)\n    if (footer)\n      stream.emit('footer', footer)\n    stream.queue(null)\n  })\n\n  if('string' === typeof path)\n    path = path.split('.').map(function (e) {\n      if (e === '$*')\n        return {emitKey: true}\n      else if (e === '*')\n        return true\n      else if (e === '') // '..'.split('.') returns an empty string\n        return {recurse: true}\n      else\n        return e\n    })\n\n\n  var count = 0, _key\n  if(!path || !path.length)\n    path = null\n\n  parser.onValue = function (value) {\n    if (!this.root)\n      stream.root = value\n\n    if(! path) return\n\n    var i = 0 // iterates on path\n    var j  = 0 // iterates on stack\n    var emitKey = false;\n    var emitPath = false;\n    while (i < path.length) {\n      var key = path[i]\n      var c\n      j++\n\n      if (key && !key.recurse) {\n        c = (j === this.stack.length) ? this : this.stack[j]\n        if (!c) return\n        if (! check(key, c.key)) {\n          setHeaderFooter(c.key, value)\n          return\n        }\n        emitKey = !!key.emitKey;\n        emitPath = !!key.emitPath;\n        i++\n      } else {\n        i++\n        var nextKey = path[i]\n        if (! nextKey) return\n        while (true) {\n          c = (j === this.stack.length) ? this : this.stack[j]\n          if (!c) return\n          if (check(nextKey, c.key)) {\n            i++;\n            if (!Object.isFrozen(this.stack[j]))\n              this.stack[j].value = null\n            break\n          } else {\n            setHeaderFooter(c.key, value)\n          }\n          j++\n        }\n      }\n\n    }\n\n    // emit header\n    if (header) {\n      stream.emit('header', header);\n      header = false;\n    }\n    if (j !== this.stack.length) return\n\n    count ++\n    var actualPath = this.stack.slice(1).map(function(element) { return element.key }).concat([this.key])\n    var data = value\n    if(null != data)\n      if(null != (data = map ? map(data, actualPath) : data)) {\n        if (emitKey || emitPath) {\n          data = { value: data };\n          if (emitKey)\n            data[\"key\"] = this.key;\n          if (emitPath)\n            data[\"path\"] = actualPath;\n        }\n\n        stream.queue(data)\n      }\n    for(var k in this.stack)\n      if (!Object.isFrozen(this.stack[k]))\n        this.stack[k].value = null\n  }\n  parser._onToken = parser.onToken;\n\n  parser.onToken = function (token, value) {\n    parser._onToken(token, value);\n    if (this.stack.length === 0) {\n      if (stream.root) {\n        if(!path)\n          stream.queue(stream.root)\n        count = 0;\n        stream.root = null;\n      }\n    }\n  }\n\n  parser.onError = function (err) {\n    if(err.message.indexOf(\"at position\") > -1)\n      err.message = \"Invalid JSON (\" + err.message + \")\";\n    stream.emit('error', err)\n  }\n\n  return stream\n\n  function setHeaderFooter(key, value) {\n    // header has not been emitted yet\n    if (header !== false) {\n      header = header || {}\n      header[key] = value\n    }\n\n    // footer has not been emitted yet but header has\n    if (footer !== false && header === false) {\n      footer = footer || {}\n      footer[key] = value\n    }\n  }\n}\n\nfunction check (x, y) {\n  if ('string' === typeof x)\n    return y == x\n  else if (x && 'function' === typeof x.exec)\n    return x.exec(y)\n  else if ('boolean' === typeof x || 'object' === typeof x)\n    return x\n  else if ('function' === typeof x)\n    return x(y)\n  return false\n}\n\nexports.stringify = function (op, sep, cl, indent) {\n  indent = indent || 0\n  if (op === false){\n    op = ''\n    sep = '\\n'\n    cl = ''\n  } else if (op == null) {\n\n    op = '[\\n'\n    sep = '\\n,\\n'\n    cl = '\\n]\\n'\n\n  }\n\n  //else, what ever you like\n\n  var stream\n    , first = true\n    , anyData = false\n  stream = through(function (data) {\n    anyData = true\n    try {\n      var json = JSON.stringify(data, null, indent)\n    } catch (err) {\n      return stream.emit('error', err)\n    }\n    if(first) { first = false ; stream.queue(op + json)}\n    else stream.queue(sep + json)\n  },\n  function (data) {\n    if(!anyData)\n      stream.queue(op)\n    stream.queue(cl)\n    stream.queue(null)\n  })\n\n  return stream\n}\n\nexports.stringifyObject = function (op, sep, cl, indent) {\n  indent = indent || 0\n  if (op === false){\n    op = ''\n    sep = '\\n'\n    cl = ''\n  } else if (op == null) {\n\n    op = '{\\n'\n    sep = '\\n,\\n'\n    cl = '\\n}\\n'\n\n  }\n\n  //else, what ever you like\n\n  var first = true\n  var anyData = false\n  var stream = through(function (data) {\n    anyData = true\n    var json = JSON.stringify(data[0]) + ':' + JSON.stringify(data[1], null, indent)\n    if(first) { first = false ; this.queue(op + json)}\n    else this.queue(sep + json)\n  },\n  function (data) {\n    if(!anyData) this.queue(op)\n    this.queue(cl)\n\n    this.queue(null)\n  })\n\n  return stream\n}\n\n\n"]}