{"version":3,"sources":["../../../../../node_modules/npm/node_modules/sorted-union-stream/index.js"],"names":["iterate","require","from","defaultKey","val","key","union","streamA","streamB","toKey","readA","readB","stream","obj","loop","size","cb","err","dataA","nextA","dataB","nextB","keyA","keyB","on","destroy","module","exports"],"mappings":";;AAAA,IAAIA,UAAUC,QAAQ,gBAAR,CAAd;AACA,IAAIC,OAAOD,QAAQ,OAAR,CAAX;;AAEA,IAAIE,aAAa,SAAbA,UAAa,CAAUC,GAAV,EAAe;AAC9B,SAAOA,IAAIC,GAAJ,IAAWD,GAAlB;AACD,CAFD;;AAIA,IAAIE,QAAQ,SAARA,KAAQ,CAAUC,OAAV,EAAmBC,OAAnB,EAA4BC,KAA5B,EAAmC;AAC7C,MAAIC,QAAQV,QAAQO,OAAR,CAAZ;AACA,MAAII,QAAQX,QAAQQ,OAAR,CAAZ;;AAEA,MAAI,CAACC,KAAL,EAAYA,QAAQN,UAAR;;AAEZ,MAAIS,SAASV,KAAKW,GAAL,CAAS,SAASC,IAAT,CAAeC,IAAf,EAAqBC,EAArB,EAAyB;AAC7CN,UAAM,UAAUO,GAAV,EAAeC,KAAf,EAAsBC,KAAtB,EAA6B;AACjC,UAAIF,GAAJ,EAAS,OAAOD,GAAGC,GAAH,CAAP;AACTN,YAAM,UAAUM,GAAV,EAAeG,KAAf,EAAsBC,KAAtB,EAA6B;AACjC,YAAIJ,GAAJ,EAAS,OAAOD,GAAGC,GAAH,CAAP;;AAET,YAAI,CAACC,KAAD,IAAU,CAACE,KAAf,EAAsB,OAAOJ,GAAG,IAAH,EAAS,IAAT,CAAP;;AAEtB,YAAI,CAACE,KAAL,EAAY;AACVG;AACA,iBAAOL,GAAG,IAAH,EAASI,KAAT,CAAP;AACD;;AAED,YAAI,CAACA,KAAL,EAAY;AACVD;AACA,iBAAOH,GAAG,IAAH,EAASE,KAAT,CAAP;AACD;;AAED,YAAII,OAAOb,MAAMS,KAAN,CAAX;AACA,YAAIK,OAAOd,MAAMW,KAAN,CAAX;;AAEA,YAAIE,SAASC,IAAb,EAAmB;AACjBF;AACA,iBAAOP,KAAKC,IAAL,EAAWC,EAAX,CAAP;AACD;;AAED,YAAIM,OAAOC,IAAX,EAAiB;AACfJ;AACA,iBAAOH,GAAG,IAAH,EAASE,KAAT,CAAP;AACD;;AAEDG;AACAL,WAAG,IAAH,EAASI,KAAT;AACD,OA9BD;AA+BD,KAjCD;AAkCD,GAnCY,CAAb;;AAqCAR,SAAOY,EAAP,CAAU,OAAV,EAAmB,YAAY;AAC7B,QAAIjB,QAAQkB,OAAZ,EAAqBlB,QAAQkB,OAAR;AACrB,QAAIjB,QAAQiB,OAAZ,EAAqBjB,QAAQiB,OAAR;AACtB,GAHD;;AAKA,SAAOb,MAAP;AACD,CAjDD;;AAmDAc,OAAOC,OAAP,GAAiBrB,KAAjB","file":"index.js","sourcesContent":["var iterate = require('stream-iterate')\nvar from = require('from2')\n\nvar defaultKey = function (val) {\n  return val.key || val\n}\n\nvar union = function (streamA, streamB, toKey) {\n  var readA = iterate(streamA)\n  var readB = iterate(streamB)\n\n  if (!toKey) toKey = defaultKey\n\n  var stream = from.obj(function loop (size, cb) {\n    readA(function (err, dataA, nextA) {\n      if (err) return cb(err)\n      readB(function (err, dataB, nextB) {\n        if (err) return cb(err)\n\n        if (!dataA && !dataB) return cb(null, null)\n\n        if (!dataA) {\n          nextB()\n          return cb(null, dataB)\n        }\n\n        if (!dataB) {\n          nextA()\n          return cb(null, dataA)\n        }\n\n        var keyA = toKey(dataA)\n        var keyB = toKey(dataB)\n\n        if (keyA === keyB) {\n          nextB()\n          return loop(size, cb)\n        }\n\n        if (keyA < keyB) {\n          nextA()\n          return cb(null, dataA)\n        }\n\n        nextB()\n        cb(null, dataB)\n      })\n    })\n  })\n\n  stream.on('close', function () {\n    if (streamA.destroy) streamA.destroy()\n    if (streamB.destroy) streamB.destroy()\n  })\n\n  return stream\n}\n\nmodule.exports = union\n"]}