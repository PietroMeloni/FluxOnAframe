{"version":3,"sources":["../../../../../../../node_modules/npm/node_modules/retry/test/integration/test-retry-wrap.js"],"names":["common","require","assert","fake","create","retry","dir","lib","getLib","fn1","fn2","fn3","wrapAll","wrap","equal","name","wrapAllPassOptions","retries","options","wrapDefined","notEqual","wrapDefinedAndPassOptions","runWrappedWithoutError","callbackCalled","method","a","b","callback","ok","runWrappedSeveralWithoutError","callbacksCalled","runWrappedWithError","Error","err"],"mappings":"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","file":"test-retry-wrap.js","sourcesContent":["var common = require('../common');\nvar assert = common.assert;\nvar fake = common.fake.create();\nvar retry = require(common.dir.lib + '/retry');\n\nfunction getLib() {\n  return {\n    fn1: function() {},\n    fn2: function() {},\n    fn3: function() {}\n  };\n}\n\n(function wrapAll() {\n  var lib = getLib();\n  retry.wrap(lib);\n  assert.equal(lib.fn1.name, 'bound retryWrapper');\n  assert.equal(lib.fn2.name, 'bound retryWrapper');\n  assert.equal(lib.fn3.name, 'bound retryWrapper');\n}());\n\n(function wrapAllPassOptions() {\n  var lib = getLib();\n  retry.wrap(lib, {retries: 2});\n  assert.equal(lib.fn1.name, 'bound retryWrapper');\n  assert.equal(lib.fn2.name, 'bound retryWrapper');\n  assert.equal(lib.fn3.name, 'bound retryWrapper');\n  assert.equal(lib.fn1.options.retries, 2);\n  assert.equal(lib.fn2.options.retries, 2);\n  assert.equal(lib.fn3.options.retries, 2);\n}());\n\n(function wrapDefined() {\n  var lib = getLib();\n  retry.wrap(lib, ['fn2', 'fn3']);\n  assert.notEqual(lib.fn1.name, 'bound retryWrapper');\n  assert.equal(lib.fn2.name, 'bound retryWrapper');\n  assert.equal(lib.fn3.name, 'bound retryWrapper');\n}());\n\n(function wrapDefinedAndPassOptions() {\n  var lib = getLib();\n  retry.wrap(lib, {retries: 2}, ['fn2', 'fn3']);\n  assert.notEqual(lib.fn1.name, 'bound retryWrapper');\n  assert.equal(lib.fn2.name, 'bound retryWrapper');\n  assert.equal(lib.fn3.name, 'bound retryWrapper');\n  assert.equal(lib.fn2.options.retries, 2);\n  assert.equal(lib.fn3.options.retries, 2);\n}());\n\n(function runWrappedWithoutError() {\n  var callbackCalled;\n  var lib = {method: function(a, b, callback) {\n    assert.equal(a, 1);\n    assert.equal(b, 2);\n    assert.equal(typeof callback, 'function');\n    callback();\n  }};\n  retry.wrap(lib);\n  lib.method(1, 2, function() {\n    callbackCalled = true;\n  });\n  assert.ok(callbackCalled);\n}());\n\n(function runWrappedSeveralWithoutError() {\n  var callbacksCalled = 0;\n  var lib = {\n    fn1: function (a, callback) {\n      assert.equal(a, 1);\n      assert.equal(typeof callback, 'function');\n      callback();\n    },\n    fn2: function (a, callback) {\n      assert.equal(a, 2);\n      assert.equal(typeof callback, 'function');\n      callback();\n    }\n  };\n  retry.wrap(lib, {}, ['fn1', 'fn2']);\n  lib.fn1(1, function() {\n    callbacksCalled++;\n  });\n  lib.fn2(2, function() {\n    callbacksCalled++;\n  });\n  assert.equal(callbacksCalled, 2);\n}());\n\n(function runWrappedWithError() {\n  var callbackCalled;\n  var lib = {method: function(callback) {\n    callback(new Error('Some error'));\n  }};\n  retry.wrap(lib, {retries: 1});\n  lib.method(function(err) {\n    callbackCalled = true;\n    assert.ok(err instanceof Error);\n  });\n  assert.ok(!callbackCalled);\n}());\n"]}