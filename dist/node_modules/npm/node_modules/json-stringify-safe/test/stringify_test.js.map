{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/json-stringify-safe/test/stringify_test.js"],"names":["Sinon","require","stringify","jsonify","obj","JSON","describe","it","name","self","json","must","eql","identity","child","children","push","alice","alice1","alice2","a","b","decycle","spy","callCount","equal","thisValues","args","replacer","bangString","selves","err","key","value","ex","be","an","instanceof","TypeError","circularRef","list","getSerialize","xit","serializer"],"mappings":"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","file":"stringify_test.js","sourcesContent":["var Sinon = require(\"sinon\")\nvar stringify = require(\"..\")\nfunction jsonify(obj) { return JSON.stringify(obj, null, 2) }\n\ndescribe(\"Stringify\", function() {\n  it(\"must stringify circular objects\", function() {\n    var obj = {name: \"Alice\"}\n    obj.self = obj\n    var json = stringify(obj, null, 2)\n    json.must.eql(jsonify({name: \"Alice\", self: \"[Circular ~]\"}))\n  })\n\n  it(\"must stringify circular objects with intermediaries\", function() {\n    var obj = {name: \"Alice\"}\n    obj.identity = {self: obj}\n    var json = stringify(obj, null, 2)\n    json.must.eql(jsonify({name: \"Alice\", identity: {self: \"[Circular ~]\"}}))\n  })\n\n  it(\"must stringify circular objects deeper\", function() {\n    var obj = {name: \"Alice\", child: {name: \"Bob\"}}\n    obj.child.self = obj.child\n\n    stringify(obj, null, 2).must.eql(jsonify({\n      name: \"Alice\",\n      child: {name: \"Bob\", self: \"[Circular ~.child]\"}\n    }))\n  })\n\n  it(\"must stringify circular objects deeper with intermediaries\", function() {\n    var obj = {name: \"Alice\", child: {name: \"Bob\"}}\n    obj.child.identity = {self: obj.child}\n\n    stringify(obj, null, 2).must.eql(jsonify({\n      name: \"Alice\",\n      child: {name: \"Bob\", identity: {self: \"[Circular ~.child]\"}}\n    }))\n  })\n\n  it(\"must stringify circular objects in an array\", function() {\n    var obj = {name: \"Alice\"}\n    obj.self = [obj, obj]\n\n    stringify(obj, null, 2).must.eql(jsonify({\n      name: \"Alice\", self: [\"[Circular ~]\", \"[Circular ~]\"]\n    }))\n  })\n\n  it(\"must stringify circular objects deeper in an array\", function() {\n    var obj = {name: \"Alice\", children: [{name: \"Bob\"}, {name: \"Eve\"}]}\n    obj.children[0].self = obj.children[0]\n    obj.children[1].self = obj.children[1]\n\n    stringify(obj, null, 2).must.eql(jsonify({\n      name: \"Alice\",\n      children: [\n        {name: \"Bob\", self: \"[Circular ~.children.0]\"},\n        {name: \"Eve\", self: \"[Circular ~.children.1]\"}\n      ]\n    }))\n  })\n\n  it(\"must stringify circular arrays\", function() {\n    var obj = []\n    obj.push(obj)\n    obj.push(obj)\n    var json = stringify(obj, null, 2)\n    json.must.eql(jsonify([\"[Circular ~]\", \"[Circular ~]\"]))\n  })\n\n  it(\"must stringify circular arrays with intermediaries\", function() {\n    var obj = []\n    obj.push({name: \"Alice\", self: obj})\n    obj.push({name: \"Bob\", self: obj})\n\n    stringify(obj, null, 2).must.eql(jsonify([\n      {name: \"Alice\", self: \"[Circular ~]\"},\n      {name: \"Bob\", self: \"[Circular ~]\"}\n    ]))\n  })\n\n  it(\"must stringify repeated objects in objects\", function() {\n    var obj = {}\n    var alice = {name: \"Alice\"}\n    obj.alice1 = alice\n    obj.alice2 = alice\n\n    stringify(obj, null, 2).must.eql(jsonify({\n      alice1: {name: \"Alice\"},\n      alice2: {name: \"Alice\"}\n    }))\n  })\n\n  it(\"must stringify repeated objects in arrays\", function() {\n    var alice = {name: \"Alice\"}\n    var obj = [alice, alice]\n    var json = stringify(obj, null, 2)\n    json.must.eql(jsonify([{name: \"Alice\"}, {name: \"Alice\"}]))\n  })\n\n  it(\"must call given decycler and use its output\", function() {\n    var obj = {}\n    obj.a = obj\n    obj.b = obj\n\n    var decycle = Sinon.spy(function() { return decycle.callCount })\n    var json = stringify(obj, null, 2, decycle)\n    json.must.eql(jsonify({a: 1, b: 2}, null, 2))\n\n    decycle.callCount.must.equal(2)\n    decycle.thisValues[0].must.equal(obj)\n    decycle.args[0][0].must.equal(\"a\")\n    decycle.args[0][1].must.equal(obj)\n    decycle.thisValues[1].must.equal(obj)\n    decycle.args[1][0].must.equal(\"b\")\n    decycle.args[1][1].must.equal(obj)\n  })\n\n  it(\"must call replacer and use its output\", function() {\n    var obj = {name: \"Alice\", child: {name: \"Bob\"}}\n\n    var replacer = Sinon.spy(bangString)\n    var json = stringify(obj, replacer, 2)\n    json.must.eql(jsonify({name: \"Alice!\", child: {name: \"Bob!\"}}))\n\n    replacer.callCount.must.equal(4)\n    replacer.args[0][0].must.equal(\"\")\n    replacer.args[0][1].must.equal(obj)\n    replacer.thisValues[1].must.equal(obj)\n    replacer.args[1][0].must.equal(\"name\")\n    replacer.args[1][1].must.equal(\"Alice\")\n    replacer.thisValues[2].must.equal(obj)\n    replacer.args[2][0].must.equal(\"child\")\n    replacer.args[2][1].must.equal(obj.child)\n    replacer.thisValues[3].must.equal(obj.child)\n    replacer.args[3][0].must.equal(\"name\")\n    replacer.args[3][1].must.equal(\"Bob\")\n  })\n\n  it(\"must call replacer after describing circular references\", function() {\n    var obj = {name: \"Alice\"}\n    obj.self = obj\n\n    var replacer = Sinon.spy(bangString)\n    var json = stringify(obj, replacer, 2)\n    json.must.eql(jsonify({name: \"Alice!\", self: \"[Circular ~]!\"}))\n\n    replacer.callCount.must.equal(3)\n    replacer.args[0][0].must.equal(\"\")\n    replacer.args[0][1].must.equal(obj)\n    replacer.thisValues[1].must.equal(obj)\n    replacer.args[1][0].must.equal(\"name\")\n    replacer.args[1][1].must.equal(\"Alice\")\n    replacer.thisValues[2].must.equal(obj)\n    replacer.args[2][0].must.equal(\"self\")\n    replacer.args[2][1].must.equal(\"[Circular ~]\")\n  })\n\n  it(\"must call given decycler and use its output for nested objects\",\n    function() {\n    var obj = {}\n    obj.a = obj\n    obj.b = {self: obj}\n\n    var decycle = Sinon.spy(function() { return decycle.callCount })\n    var json = stringify(obj, null, 2, decycle)\n    json.must.eql(jsonify({a: 1, b: {self: 2}}))\n\n    decycle.callCount.must.equal(2)\n    decycle.args[0][0].must.equal(\"a\")\n    decycle.args[0][1].must.equal(obj)\n    decycle.args[1][0].must.equal(\"self\")\n    decycle.args[1][1].must.equal(obj)\n  })\n\n  it(\"must use decycler's output when it returned null\", function() {\n    var obj = {a: \"b\"}\n    obj.self = obj\n    obj.selves = [obj, obj]\n\n    function decycle() { return null }\n    stringify(obj, null, 2, decycle).must.eql(jsonify({\n      a: \"b\",\n      self: null,\n      selves: [null, null]\n    }))\n  })\n\n  it(\"must use decycler's output when it returned undefined\", function() {\n    var obj = {a: \"b\"}\n    obj.self = obj\n    obj.selves = [obj, obj]\n\n    function decycle() {}\n    stringify(obj, null, 2, decycle).must.eql(jsonify({\n      a: \"b\",\n      selves: [null, null]\n    }))\n  })\n\n  it(\"must throw given a decycler that returns a cycle\", function() {\n    var obj = {}\n    obj.self = obj\n    var err\n    function identity(key, value) { return value }\n    try { stringify(obj, null, 2, identity) } catch (ex) { err = ex }\n    err.must.be.an.instanceof(TypeError)\n  })\n\n  describe(\".getSerialize\", function() {\n    it(\"must stringify circular objects\", function() {\n      var obj = {a: \"b\"}\n      obj.circularRef = obj\n      obj.list = [obj, obj]\n\n      var json = JSON.stringify(obj, stringify.getSerialize(), 2)\n      json.must.eql(jsonify({\n        \"a\": \"b\",\n        \"circularRef\": \"[Circular ~]\",\n        \"list\": [\"[Circular ~]\", \"[Circular ~]\"]\n      }))\n    })\n\n    // This is the behavior as of Mar 3, 2015.\n    // The serializer function keeps state inside the returned function and\n    // so far I'm not sure how to not do that. JSON.stringify's replacer is not\n    // called _after_ serialization.\n    xit(\"must return a function that could be called twice\", function() {\n      var obj = {name: \"Alice\"}\n      obj.self = obj\n\n      var json\n      var serializer = stringify.getSerialize()\n\n      json = JSON.stringify(obj, serializer, 2)\n      json.must.eql(jsonify({name: \"Alice\", self: \"[Circular ~]\"}))\n\n      json = JSON.stringify(obj, serializer, 2)\n      json.must.eql(jsonify({name: \"Alice\", self: \"[Circular ~]\"}))\n    })\n  })\n})\n\nfunction bangString(key, value) {\n  return typeof value == \"string\" ? value + \"!\" : value\n}\n"]}