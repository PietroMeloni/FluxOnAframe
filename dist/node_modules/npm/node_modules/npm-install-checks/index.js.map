{"version":3,"sources":["../../../../../node_modules/npm/node_modules/npm-install-checks/index.js"],"names":["fs","require","path","util","semver","exports","checkEngine","target","npmVer","nodeVer","force","strict","cb","nodev","eng","engines","node","satisfies","npm","er","Error","format","_id","code","required","pkgid","checkPlatform","platform","process","arch","osOk","cpuOk","os","checkList","cpu","value","list","tmp","match","blc","length","i","slice","checkCycle","ancestors","p","Object","getPrototypeOf","name","version","prototype","tree","JSON","parse","stringify","t","THIS_IS_P","push","checkGit","folder","lstat","s","isDirectory","checkGit_","stat","resolve","e"],"mappings":"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","file":"index.js","sourcesContent":["var fs = require('fs')\nvar path = require('path')\nvar util = require('util')\nvar semver = require('semver')\n\nexports.checkEngine = checkEngine\nfunction checkEngine (target, npmVer, nodeVer, force, strict, cb) {\n  var nodev = force ? null : nodeVer\n  var eng = target.engines\n  if (!eng) return cb()\n  if (nodev && eng.node && !semver.satisfies(nodev, eng.node) ||\n      eng.npm && !semver.satisfies(npmVer, eng.npm)) {\n    var er = new Error(util.format('Unsupported engine for %s: wanted: %j (current: %j)',\n      target._id, eng, {node: nodev, npm: npmVer}))\n    er.code = 'ENOTSUP'\n    er.required = eng\n    er.pkgid = target._id\n    if (strict) {\n      return cb(er)\n    } else {\n      return cb(null, er)\n    }\n  }\n  return cb()\n}\n\nexports.checkPlatform = checkPlatform\nfunction checkPlatform (target, force, cb) {\n  var platform = process.platform\n  var arch = process.arch\n  var osOk = true\n  var cpuOk = true\n\n  if (force) {\n    return cb()\n  }\n\n  if (target.os) {\n    osOk = checkList(platform, target.os)\n  }\n  if (target.cpu) {\n    cpuOk = checkList(arch, target.cpu)\n  }\n  if (!osOk || !cpuOk) {\n    var er = new Error(util.format('Unsupported platform for %s: wanted %j (current: %j)',\n      target._id, target, {os: platform, cpu: arch}))\n    er.code = 'EBADPLATFORM'\n    er.os = target.os || ['any']\n    er.cpu = target.cpu || ['any']\n    er.pkgid = target._id\n    return cb(er)\n  }\n  return cb()\n}\n\nfunction checkList (value, list) {\n  var tmp\n  var match = false\n  var blc = 0\n  if (typeof list === 'string') {\n    list = [list]\n  }\n  if (list.length === 1 && list[0] === 'any') {\n    return true\n  }\n  for (var i = 0; i < list.length; ++i) {\n    tmp = list[i]\n    if (tmp[0] === '!') {\n      tmp = tmp.slice(1)\n      if (tmp === value) {\n        return false\n      }\n      ++blc\n    } else {\n      match = match || tmp === value\n    }\n  }\n  return match || blc === list.length\n}\n\nexports.checkCycle = checkCycle\nfunction checkCycle (target, ancestors, cb) {\n  // there are some very rare and pathological edge-cases where\n  // a cycle can cause npm to try to install a never-ending tree\n  // of stuff.\n  // Simplest:\n  //\n  // A -> B -> A' -> B' -> A -> B -> A' -> B' -> A -> ...\n  //\n  // Solution: Simply flat-out refuse to install any name@version\n  // that is already in the prototype tree of the ancestors object.\n  // A more correct, but more complex, solution would be to symlink\n  // the deeper thing into the new location.\n  // Will do that if anyone whines about this irl.\n  //\n  // Note: `npm install foo` inside of the `foo` package will abort\n  // earlier if `--force` is not set.  However, if it IS set, then\n  // we need to still fail here, but just skip the first level. Of\n  // course, it'll still fail eventually if it's a true cycle, and\n  // leave things in an undefined state, but that's what is to be\n  // expected when `--force` is used.  That is why getPrototypeOf\n  // is used *twice* here: to skip the first level of repetition.\n\n  var p = Object.getPrototypeOf(Object.getPrototypeOf(ancestors))\n  var name = target.name\n  var version = target.version\n  while (p && p !== Object.prototype && p[name] !== version) {\n    p = Object.getPrototypeOf(p)\n  }\n  if (p[name] !== version) return cb()\n\n  var er = new Error(target._id + ': Unresolvable cycle detected')\n  var tree = [target._id, JSON.parse(JSON.stringify(ancestors))]\n  var t = Object.getPrototypeOf(ancestors)\n  while (t && t !== Object.prototype) {\n    if (t === p) t.THIS_IS_P = true\n    tree.push(JSON.parse(JSON.stringify(t)))\n    t = Object.getPrototypeOf(t)\n  }\n  er.pkgid = target._id\n  er.code = 'ECYCLE'\n  return cb(er)\n}\n\nexports.checkGit = checkGit\nfunction checkGit (folder, cb) {\n  // if it's a git repo then don't touch it!\n  fs.lstat(folder, function (er, s) {\n    if (er || !s.isDirectory()) return cb()\n    else checkGit_(folder, cb)\n  })\n}\n\nfunction checkGit_ (folder, cb) {\n  fs.stat(path.resolve(folder, '.git'), function (er, s) {\n    if (!er && s.isDirectory()) {\n      var e = new Error(folder + ': Appears to be a git repo or submodule.')\n      e.path = folder\n      e.code = 'EISGIT'\n      return cb(e)\n    }\n    cb()\n  })\n}\n"]}