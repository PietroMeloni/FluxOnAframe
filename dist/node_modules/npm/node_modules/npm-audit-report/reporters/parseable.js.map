{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/npm-audit-report/reporters/parseable.js"],"names":["report","data","options","defaults","severityThreshold","config","Object","assign","exit","actions","accumulator","high","moderate","low","keys","advisories","length","forEach","action","l","recommendation","getRecommendation","cmd","breaking","isBreaking","advisory","resolves","id","sevLevel","severity","title","package","module_name","moreInfo","path","join","resolution","patchedIn","patched_versions","replace","exitCode","metadata","total","vulnerabilities","key","value","isDev","dev","module","target","isMajor","depth","exports"],"mappings":"AAAA;;AAEA,IAAMA,SAAS,SAATA,MAAS,CAAUC,IAAV,EAAgBC,OAAhB,EAAyB;AACtC,MAAMC,WAAW;AACfC,uBAAmB;AADJ,GAAjB;;AAIA,MAAMC,SAASC,OAAOC,MAAP,CAAc,EAAd,EAAkBJ,QAAlB,EAA4BD,OAA5B,CAAf;;AAEA,MAAIM,OAAO,CAAX;;AAEA,MAAMC,UAAU,SAAVA,OAAU,CAAUR,IAAV,EAAgBI,MAAhB,EAAwB;AACtC,QAAIK,cAAc;AAChBC,YAAM,EADU;AAEhBC,gBAAU,EAFM;AAGhBC,WAAK;AAHW,KAAlB;;AAMA,QAAIP,OAAOQ,IAAP,CAAYb,KAAKc,UAAjB,EAA6BC,MAA7B,KAAwC,CAA5C,EAA+C;AAC7Cf,WAAKQ,OAAL,CAAaQ,OAAb,CAAqB,UAACC,MAAD,EAAY;AAC/B,YAAIC,IAAI,EAAR;AACA;AACA,YAAID,OAAOA,MAAP,KAAkB,QAAlB,IAA8BA,OAAOA,MAAP,KAAkB,SAApD,EAA+D;AAC7D,cAAME,iBAAiBC,kBAAkBH,MAAlB,EAA0Bb,MAA1B,CAAvB;AACAc,YAAEC,cAAF,GAAmBA,eAAeE,GAAlC;AACAH,YAAEI,QAAF,GAAaH,eAAeI,UAAf,GAA4B,GAA5B,GAAkC,GAA/C;;AAEA;AACA,cAAMC,WAAWxB,KAAKc,UAAL,CAAgBG,OAAOQ,QAAP,CAAgB,CAAhB,EAAmBC,EAAnC,CAAjB;AACAR,YAAES,QAAF,GAAaH,SAASI,QAAtB;AACAV,YAAEU,QAAF,GAAaJ,SAASK,KAAtB;AACAX,YAAEY,OAAF,GAAYN,SAASO,WAArB;AACAb,YAAEc,QAAF,2CAAmDR,SAASE,EAA5D;AACAR,YAAEe,IAAF,GAAShB,OAAOQ,QAAP,CAAgB,CAAhB,EAAmBQ,IAA5B;;AAEAxB,sBAAYe,SAASI,QAArB,KAAkC,CAACX,OAAOA,MAAR,EAAgBC,EAAEY,OAAlB,EAA2BZ,EAAES,QAA7B,EAAuCT,EAAEC,cAAzC,EAAyDD,EAAEU,QAA3D,EAAqEV,EAAEc,QAAvE,EAAiFd,EAAEe,IAAnF,EAAyFf,EAAEI,QAA3F,EAC/BY,IAD+B,CAC1B,IAD0B,IAClB,IADhB;AAED;;AAED,YAAIjB,OAAOA,MAAP,KAAkB,QAAtB,EAAgC;AAC9BA,iBAAOQ,QAAP,CAAgBT,OAAhB,CAAwB,UAACmB,UAAD,EAAgB;AACtC,gBAAMX,WAAWxB,KAAKc,UAAL,CAAgBqB,WAAWT,EAA3B,CAAjB;;AAEAR,cAAES,QAAF,GAAaH,SAASI,QAAtB;AACAV,cAAEU,QAAF,GAAaJ,SAASK,KAAtB;AACAX,cAAEY,OAAF,GAAYN,SAASO,WAArB;AACAb,cAAEc,QAAF,2CAAmDR,SAASE,EAA5D;AACAR,cAAEkB,SAAF,GAAcZ,SAASa,gBAAT,CAA0BC,OAA1B,CAAkC,GAAlC,EAAuC,EAAvC,MAA+C,QAA/C,GAA0D,oBAA1D,GAAiFd,SAASa,gBAAxG;AACAnB,cAAEe,IAAF,GAASE,WAAWF,IAApB;;AAEAxB,wBAAYe,SAASI,QAArB,KAAkC,CAACX,OAAOA,MAAR,EAAgBC,EAAEY,OAAlB,EAA2BZ,EAAES,QAA7B,EAAuCT,EAAEkB,SAAzC,EAAoDlB,EAAEU,QAAtD,EAAgEV,EAAEc,QAAlE,EAA4Ed,EAAEe,IAA9E,EAAoFC,IAApF,CAAyF,IAAzF,IAAiG,IAAnI;AACD,WAXD,EAD8B,CAY3B;AACJ,SAjC8B,CAiC7B;AACH,OAlCD,EAD6C,CAmC1C;AACJ;AACD,WAAOzB,YAAY,MAAZ,IAAsBA,YAAY,UAAZ,CAAtB,GAAgDA,YAAY,KAAZ,CAAvD;AACD,GA7CD;;AA+CA,MAAM8B,WAAW,SAAXA,QAAW,CAAUC,QAAV,EAAoB;AACnC,QAAIC,QAAQ,CAAZ;AACA,QAAM5B,OAAOR,OAAOQ,IAAP,CAAY2B,SAASE,eAArB,CAAb;AAFmC;AAAA;AAAA;;AAAA;AAGnC,2BAAgB7B,IAAhB,8HAAsB;AAAA,YAAb8B,GAAa;;AACpB,YAAMC,QAAQJ,SAASE,eAAT,CAAyBC,GAAzB,CAAd;AACAF,gBAAQA,QAAQG,KAAhB;AACD;AANkC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAQnC,QAAIH,QAAQ,CAAZ,EAAe;AACblC,aAAO,CAAP;AACD;AACF,GAXD;;AAaAgC,WAASvC,KAAKwC,QAAd;;AAEA,SAAO;AACLzC,YAAQS,QAAQR,IAAR,EAAcI,MAAd,CADH;AAELmC,cAAUhC;AAFL,GAAP;AAID,CA3ED;;AA6EA,IAAMa,oBAAoB,SAApBA,iBAAoB,CAAUH,MAAV,EAAkBb,MAAlB,EAA0B;AAClD,MAAIa,OAAOA,MAAP,KAAkB,SAAtB,EAAiC;AAC/B,QAAM4B,QAAQ5B,OAAOQ,QAAP,CAAgB,CAAhB,EAAmBqB,GAAjC;;AAEA,WAAO;AACLzB,6BAAoBwB,QAAQ,aAAR,GAAwB,EAA5C,IAAiD5B,OAAO8B,MAAxD,SAAkE9B,OAAO+B,MADpE;AAELzB,kBAAYN,OAAOgC;AAFd,KAAP;AAID,GAPD,MAOO;AACL,WAAO;AACL5B,2BAAmBJ,OAAO8B,MAA1B,iBAA4C9B,OAAOiC,KAD9C;AAEL3B,kBAAY;AAFP,KAAP;AAID;AACF,CAdD;;AAgBAwB,OAAOI,OAAP,GAAiBpD,MAAjB","file":"parseable.js","sourcesContent":["'use strict'\n\nconst report = function (data, options) {\n  const defaults = {\n    severityThreshold: 'info'\n  }\n\n  const config = Object.assign({}, defaults, options)\n\n  let exit = 0\n\n  const actions = function (data, config) {\n    let accumulator = {\n      high: '',\n      moderate: '',\n      low: ''\n    }\n\n    if (Object.keys(data.advisories).length !== 0) {\n      data.actions.forEach((action) => {\n        let l = {}\n        // Start with install/update actions\n        if (action.action === 'update' || action.action === 'install') {\n          const recommendation = getRecommendation(action, config)\n          l.recommendation = recommendation.cmd\n          l.breaking = recommendation.isBreaking ? 'Y' : 'N'\n\n          // TODO: Verify: The advisory seems to repeat and be the same for all the 'resolves'. Is it true?\n          const advisory = data.advisories[action.resolves[0].id]\n          l.sevLevel = advisory.severity\n          l.severity = advisory.title\n          l.package = advisory.module_name\n          l.moreInfo = `https://nodesecurity.io/advisories/${advisory.id}`\n          l.path = action.resolves[0].path\n\n          accumulator[advisory.severity] += [action.action, l.package, l.sevLevel, l.recommendation, l.severity, l.moreInfo, l.path, l.breaking]\n            .join('\\t') + '\\n'\n        }\n\n        if (action.action === 'review') {\n          action.resolves.forEach((resolution) => {\n            const advisory = data.advisories[resolution.id]\n\n            l.sevLevel = advisory.severity\n            l.severity = advisory.title\n            l.package = advisory.module_name\n            l.moreInfo = `https://nodesecurity.io/advisories/${advisory.id}`\n            l.patchedIn = advisory.patched_versions.replace(' ', '') === '<0.0.0' ? 'No patch available' : advisory.patched_versions\n            l.path = resolution.path\n\n            accumulator[advisory.severity] += [action.action, l.package, l.sevLevel, l.patchedIn, l.severity, l.moreInfo, l.path].join('\\t') + '\\n'\n          }) // forEach resolves\n        } // is review\n      }) // forEach actions\n    }\n    return accumulator['high'] + accumulator['moderate'] + accumulator['low']\n  }\n\n  const exitCode = function (metadata) {\n    let total = 0\n    const keys = Object.keys(metadata.vulnerabilities)\n    for (let key of keys) {\n      const value = metadata.vulnerabilities[key]\n      total = total + value\n    }\n\n    if (total > 0) {\n      exit = 1\n    }\n  }\n\n  exitCode(data.metadata)\n\n  return {\n    report: actions(data, config),\n    exitCode: exit\n  }\n}\n\nconst getRecommendation = function (action, config) {\n  if (action.action === 'install') {\n    const isDev = action.resolves[0].dev\n\n    return {\n      cmd: `npm install ${isDev ? '--save-dev ' : ''}${action.module}@${action.target}`,\n      isBreaking: action.isMajor\n    }\n  } else {\n    return {\n      cmd: `npm update ${action.module} --depth ${action.depth}`,\n      isBreaking: false\n    }\n  }\n}\n\nmodule.exports = report\n"]}