{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/npm-audit-report/reporters/detail.js"],"names":["summary","require","Table","Utils","report","data","options","defaults","severityThreshold","blankChars","config","Object","assign","output","exit","log","value","footer","total","totalVulnCount","metadata","vulnerabilities","totalDependencies","counts","actions","reduce","acc","action","isMajor","resolves","forEach","id","path","advisories","add","major","review","Set","size","maj","rev","reportTitle","tableOptions","colWidths","chars","table","push","content","vAlign","hAlign","toString","keys","length","reviewFlag","recommendation","getRecommendation","label","color","cmd","withColor","isBreaking","resolution","advisory","wordWrap","withUnicode","severityLabel","severity","title","module_name","split","dev","join","patchedIn","patched_versions","replace","trim","exitCode","isDev","module","target","depth","exports"],"mappings":"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","file":"detail.js","sourcesContent":["'use strict'\n\nconst summary = require('./install.js').summary\nconst Table = require('cli-table3')\nconst Utils = require('../lib/utils')\n\nconst report = function (data, options) {\n  const defaults = {\n    severityThreshold: 'info'\n  }\n\n  const blankChars = {\n    'top': ' ',\n    'top-mid': ' ',\n    'top-left': ' ',\n    'top-right': ' ',\n    'bottom': ' ',\n    'bottom-mid': ' ',\n    'bottom-left': ' ',\n    'bottom-right': ' ',\n    'left': ' ',\n    'left-mid': ' ',\n    'mid': ' ',\n    'mid-mid': ' ',\n    'right': ' ',\n    'right-mid': ' ',\n    'middle': ' '\n  }\n\n  const config = Object.assign({}, defaults, options)\n\n  let output = ''\n  let exit = 0\n\n  const log = function (value) {\n    output = output + value + '\\n'\n  }\n\n  const footer = function (data) {\n    const total = Utils.totalVulnCount(data.metadata.vulnerabilities)\n\n    if (total > 0) {\n      exit = 1\n    }\n    log(`${summary(data, config)} in ${data.metadata.totalDependencies} scanned package${data.metadata.totalDependencies === 1 ? '' : 's'}`)\n    if (total) {\n      const counts = data.actions.reduce((acc, {action, isMajor, resolves}) => {\n        if (action === 'update' || (action === 'install' && !isMajor)) {\n          resolves.forEach(({id, path}) => acc.advisories.add(`${id}::${path}`))\n        }\n        if (isMajor) {\n          resolves.forEach(({id, path}) => acc.major.add(`${id}::${path}`))\n        }\n        if (action === 'review') {\n          resolves.forEach(({id, path}) => acc.review.add(`${id}::${path}`))\n        }\n        return acc\n      }, {advisories: new Set(), major: new Set(), review: new Set()})\n      if (counts.advisories.size) {\n        log(`  run \\`npm audit fix\\` to fix ${counts.advisories.size} of them.`)\n      }\n      if (counts.major.size) {\n        const maj = counts.major.size\n        log(`  ${maj} vulnerabilit${maj === 1 ? 'y' : 'ies'} require${maj === 1 ? 's' : ''} semver-major dependency updates.`)\n      }\n      if (counts.review.size) {\n        const rev = counts.review.size\n        log(`  ${rev} vulnerabilit${rev === 1 ? 'y' : 'ies'} require${rev === 1 ? 's' : ''} manual review. See the full report for details.`)\n      }\n    }\n  }\n\n  const reportTitle = function () {\n    const tableOptions = {\n      colWidths: [78]\n    }\n    tableOptions.chars = blankChars\n    const table = new Table(tableOptions)\n    table.push([{\n      content: '=== npm audit security report ===',\n      vAlign: 'center',\n      hAlign: 'center'\n    }])\n    log(table.toString())\n  }\n\n  const actions = function (data, config) {\n    reportTitle()\n\n    if (Object.keys(data.advisories).length !== 0) {\n      // vulns found display a report.\n\n      let reviewFlag = false\n\n      data.actions.forEach((action) => {\n        if (action.action === 'update' || action.action === 'install') {\n          const recommendation = getRecommendation(action, config)\n          const label = action.resolves.length === 1 ? 'vulnerability' : 'vulnerabilities'\n          log(`# Run ${Utils.color(' ' + recommendation.cmd + ' ', 'inverse', config.withColor)} to resolve ${action.resolves.length} ${label}`)\n          if (recommendation.isBreaking) {\n            log(`SEMVER WARNING: Recommended action is a potentially breaking change`)\n          }\n\n          action.resolves.forEach((resolution) => {\n            const advisory = data.advisories[resolution.id]\n            const tableOptions = {\n              colWidths: [15, 62],\n              wordWrap: true\n            }\n            if (!config.withUnicode) {\n              tableOptions.chars = blankChars\n            }\n            const table = new Table(tableOptions)\n\n            table.push(\n              {[Utils.severityLabel(advisory.severity, config.withColor, true)]: Utils.color(advisory.title, 'bold', config.withColor)},\n              {'Package': advisory.module_name},\n              {'Dependency of': `${resolution.path.split('>')[0]} ${resolution.dev ? '[dev]' : ''}`},\n              {'Path': `${resolution.path.split('>').join(Utils.color(' > ', 'grey', config.withColor))}`},\n              {'More info': `https://nodesecurity.io/advisories/${advisory.id}`}\n            )\n\n            log(table.toString() + '\\n\\n')\n          })\n        }\n        if (action.action === 'review') {\n          if (!reviewFlag) {\n            const tableOptions = {\n              colWidths: [78]\n            }\n            if (!config.withUnicode) {\n              tableOptions.chars = blankChars\n            }\n            const table = new Table(tableOptions)\n            table.push([{\n              content: 'Manual Review\\nSome vulnerabilities require your attention to resolve\\n\\nVisit https://go.npm.me/audit-guide for additional guidance',\n              vAlign: 'center',\n              hAlign: 'center'\n            }])\n\n            log(table.toString())\n          }\n          reviewFlag = true\n\n          action.resolves.forEach((resolution) => {\n            const advisory = data.advisories[resolution.id]\n            const tableOptions = {\n              colWidths: [15, 62],\n              wordWrap: true\n            }\n            if (!config.withUnicode) {\n              tableOptions.chars = blankChars\n            }\n            const table = new Table(tableOptions)\n            const patchedIn = advisory.patched_versions.replace(' ', '') === '<0.0.0' ? 'No patch available' : advisory.patched_versions\n\n            table.push(\n              {[Utils.severityLabel(advisory.severity, config.withColor, true)]: Utils.color(advisory.title, 'bold', config.withColor)},\n              {'Package': advisory.module_name},\n              {'Patched in': patchedIn},\n              {'Dependency of': `${resolution.path.split('>')[0]} ${resolution.dev ? '[dev]' : ''}`},\n              {'Path': `${resolution.path.split('>').join(Utils.color(' > ', 'grey', config.withColor))}`},\n              {'More info': `https://nodesecurity.io/advisories/${advisory.id}`}\n            )\n            log(table.toString())\n          })\n        }\n      })\n    }\n  }\n\n  actions(data, config)\n  footer(data)\n\n  return {\n    report: output.trim(),\n    exitCode: exit\n  }\n}\n\nconst getRecommendation = function (action, config) {\n  if (action.action === 'install') {\n    const isDev = action.resolves[0].dev\n\n    return {\n      cmd: `npm install ${isDev ? '--save-dev ' : ''}${action.module}@${action.target}`,\n      isBreaking: action.isMajor\n    }\n  } else {\n    return {\n      cmd: `npm update ${action.module} --depth ${action.depth}`,\n      isBreaking: false\n    }\n  }\n}\n\nmodule.exports = report\n"]}