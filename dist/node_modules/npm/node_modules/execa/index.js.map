{"version":3,"sources":["../../../../../node_modules/npm/node_modules/execa/index.js"],"names":["childProcess","require","util","crossSpawn","stripEof","npmRunPath","isStream","_getStream","pFinally","onExit","errname","stdio","TEN_MEGABYTES","handleArgs","cmd","args","opts","parsed","env","extendEnv","Object","assign","process","__winShell","command","options","file","original","_parse","maxBuffer","preferLocal","localDir","cwd","encoding","reject","cleanup","handleInput","spawned","input","undefined","pipe","stdin","end","handleOutput","val","handleShell","fn","platform","comspec","windowsVerbatimArguments","shell","getStream","stream","ret","buffer","catch","err","message","module","exports","joinedCmd","Array","isArray","length","join","spawn","Promise","removeExitHandler","kill","timeoutId","timedOut","cleanupTimeout","clearTimeout","timeout","setTimeout","killSignal","processDone","on","code","signal","resolve","destroy","stdout","stderr","promise","all","then","result","arr","output","Error","killed","failed","_enoent","hookChildProcess","bind","apply","arguments","x","sync","TypeError","spawnSync","error","status","shellSync","deprecate"],"mappings":"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","file":"index.js","sourcesContent":["'use strict';\nconst childProcess = require('child_process');\nconst util = require('util');\nconst crossSpawn = require('cross-spawn');\nconst stripEof = require('strip-eof');\nconst npmRunPath = require('npm-run-path');\nconst isStream = require('is-stream');\nconst _getStream = require('get-stream');\nconst pFinally = require('p-finally');\nconst onExit = require('signal-exit');\nconst errname = require('./lib/errname');\nconst stdio = require('./lib/stdio');\n\nconst TEN_MEGABYTES = 1000 * 1000 * 10;\n\nfunction handleArgs(cmd, args, opts) {\n\tlet parsed;\n\n\tif (opts && opts.env && opts.extendEnv !== false) {\n\t\topts.env = Object.assign({}, process.env, opts.env);\n\t}\n\n\tif (opts && opts.__winShell === true) {\n\t\tdelete opts.__winShell;\n\t\tparsed = {\n\t\t\tcommand: cmd,\n\t\t\targs,\n\t\t\toptions: opts,\n\t\t\tfile: cmd,\n\t\t\toriginal: cmd\n\t\t};\n\t} else {\n\t\tparsed = crossSpawn._parse(cmd, args, opts);\n\t}\n\n\topts = Object.assign({\n\t\tmaxBuffer: TEN_MEGABYTES,\n\t\tstripEof: true,\n\t\tpreferLocal: true,\n\t\tlocalDir: parsed.options.cwd || process.cwd(),\n\t\tencoding: 'utf8',\n\t\treject: true,\n\t\tcleanup: true\n\t}, parsed.options);\n\n\topts.stdio = stdio(opts);\n\n\tif (opts.preferLocal) {\n\t\topts.env = npmRunPath.env(Object.assign({}, opts, {cwd: opts.localDir}));\n\t}\n\n\treturn {\n\t\tcmd: parsed.command,\n\t\targs: parsed.args,\n\t\topts,\n\t\tparsed\n\t};\n}\n\nfunction handleInput(spawned, opts) {\n\tconst input = opts.input;\n\n\tif (input === null || input === undefined) {\n\t\treturn;\n\t}\n\n\tif (isStream(input)) {\n\t\tinput.pipe(spawned.stdin);\n\t} else {\n\t\tspawned.stdin.end(input);\n\t}\n}\n\nfunction handleOutput(opts, val) {\n\tif (val && opts.stripEof) {\n\t\tval = stripEof(val);\n\t}\n\n\treturn val;\n}\n\nfunction handleShell(fn, cmd, opts) {\n\tlet file = '/bin/sh';\n\tlet args = ['-c', cmd];\n\n\topts = Object.assign({}, opts);\n\n\tif (process.platform === 'win32') {\n\t\topts.__winShell = true;\n\t\tfile = process.env.comspec || 'cmd.exe';\n\t\targs = ['/s', '/c', `\"${cmd}\"`];\n\t\topts.windowsVerbatimArguments = true;\n\t}\n\n\tif (opts.shell) {\n\t\tfile = opts.shell;\n\t\tdelete opts.shell;\n\t}\n\n\treturn fn(file, args, opts);\n}\n\nfunction getStream(process, stream, encoding, maxBuffer) {\n\tif (!process[stream]) {\n\t\treturn null;\n\t}\n\n\tlet ret;\n\n\tif (encoding) {\n\t\tret = _getStream(process[stream], {\n\t\t\tencoding,\n\t\t\tmaxBuffer\n\t\t});\n\t} else {\n\t\tret = _getStream.buffer(process[stream], {maxBuffer});\n\t}\n\n\treturn ret.catch(err => {\n\t\terr.stream = stream;\n\t\terr.message = `${stream} ${err.message}`;\n\t\tthrow err;\n\t});\n}\n\nmodule.exports = (cmd, args, opts) => {\n\tlet joinedCmd = cmd;\n\n\tif (Array.isArray(args) && args.length > 0) {\n\t\tjoinedCmd += ' ' + args.join(' ');\n\t}\n\n\tconst parsed = handleArgs(cmd, args, opts);\n\tconst encoding = parsed.opts.encoding;\n\tconst maxBuffer = parsed.opts.maxBuffer;\n\n\tlet spawned;\n\ttry {\n\t\tspawned = childProcess.spawn(parsed.cmd, parsed.args, parsed.opts);\n\t} catch (err) {\n\t\treturn Promise.reject(err);\n\t}\n\n\tlet removeExitHandler;\n\tif (parsed.opts.cleanup) {\n\t\tremoveExitHandler = onExit(() => {\n\t\t\tspawned.kill();\n\t\t});\n\t}\n\n\tlet timeoutId = null;\n\tlet timedOut = false;\n\n\tconst cleanupTimeout = () => {\n\t\tif (timeoutId) {\n\t\t\tclearTimeout(timeoutId);\n\t\t\ttimeoutId = null;\n\t\t}\n\t};\n\n\tif (parsed.opts.timeout > 0) {\n\t\ttimeoutId = setTimeout(() => {\n\t\t\ttimeoutId = null;\n\t\t\ttimedOut = true;\n\t\t\tspawned.kill(parsed.opts.killSignal);\n\t\t}, parsed.opts.timeout);\n\t}\n\n\tconst processDone = new Promise(resolve => {\n\t\tspawned.on('exit', (code, signal) => {\n\t\t\tcleanupTimeout();\n\t\t\tresolve({code, signal});\n\t\t});\n\n\t\tspawned.on('error', err => {\n\t\t\tcleanupTimeout();\n\t\t\tresolve({err});\n\t\t});\n\n\t\tif (spawned.stdin) {\n\t\t\tspawned.stdin.on('error', err => {\n\t\t\t\tcleanupTimeout();\n\t\t\t\tresolve({err});\n\t\t\t});\n\t\t}\n\t});\n\n\tfunction destroy() {\n\t\tif (spawned.stdout) {\n\t\t\tspawned.stdout.destroy();\n\t\t}\n\n\t\tif (spawned.stderr) {\n\t\t\tspawned.stderr.destroy();\n\t\t}\n\t}\n\n\tconst promise = pFinally(Promise.all([\n\t\tprocessDone,\n\t\tgetStream(spawned, 'stdout', encoding, maxBuffer),\n\t\tgetStream(spawned, 'stderr', encoding, maxBuffer)\n\t]).then(arr => {\n\t\tconst result = arr[0];\n\t\tconst stdout = arr[1];\n\t\tconst stderr = arr[2];\n\n\t\tlet err = result.err;\n\t\tconst code = result.code;\n\t\tconst signal = result.signal;\n\n\t\tif (removeExitHandler) {\n\t\t\tremoveExitHandler();\n\t\t}\n\n\t\tif (err || code !== 0 || signal !== null) {\n\t\t\tif (!err) {\n\t\t\t\tlet output = '';\n\n\t\t\t\tif (Array.isArray(parsed.opts.stdio)) {\n\t\t\t\t\tif (parsed.opts.stdio[2] !== 'inherit') {\n\t\t\t\t\t\toutput += output.length > 0 ? stderr : `\\n${stderr}`;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (parsed.opts.stdio[1] !== 'inherit') {\n\t\t\t\t\t\toutput += `\\n${stdout}`;\n\t\t\t\t\t}\n\t\t\t\t} else if (parsed.opts.stdio !== 'inherit') {\n\t\t\t\t\toutput = `\\n${stderr}${stdout}`;\n\t\t\t\t}\n\n\t\t\t\terr = new Error(`Command failed: ${joinedCmd}${output}`);\n\t\t\t\terr.code = code < 0 ? errname(code) : code;\n\t\t\t}\n\n\t\t\t// TODO: missing some timeout logic for killed\n\t\t\t// https://github.com/nodejs/node/blob/master/lib/child_process.js#L203\n\t\t\t// err.killed = spawned.killed || killed;\n\t\t\terr.killed = err.killed || spawned.killed;\n\n\t\t\terr.stdout = stdout;\n\t\t\terr.stderr = stderr;\n\t\t\terr.failed = true;\n\t\t\terr.signal = signal || null;\n\t\t\terr.cmd = joinedCmd;\n\t\t\terr.timedOut = timedOut;\n\n\t\t\tif (!parsed.opts.reject) {\n\t\t\t\treturn err;\n\t\t\t}\n\n\t\t\tthrow err;\n\t\t}\n\n\t\treturn {\n\t\t\tstdout: handleOutput(parsed.opts, stdout),\n\t\t\tstderr: handleOutput(parsed.opts, stderr),\n\t\t\tcode: 0,\n\t\t\tfailed: false,\n\t\t\tkilled: false,\n\t\t\tsignal: null,\n\t\t\tcmd: joinedCmd,\n\t\t\ttimedOut: false\n\t\t};\n\t}), destroy);\n\n\tcrossSpawn._enoent.hookChildProcess(spawned, parsed.parsed);\n\n\thandleInput(spawned, parsed.opts);\n\n\tspawned.then = promise.then.bind(promise);\n\tspawned.catch = promise.catch.bind(promise);\n\n\treturn spawned;\n};\n\nmodule.exports.stdout = function () {\n\t// TODO: set `stderr: 'ignore'` when that option is implemented\n\treturn module.exports.apply(null, arguments).then(x => x.stdout);\n};\n\nmodule.exports.stderr = function () {\n\t// TODO: set `stdout: 'ignore'` when that option is implemented\n\treturn module.exports.apply(null, arguments).then(x => x.stderr);\n};\n\nmodule.exports.shell = (cmd, opts) => handleShell(module.exports, cmd, opts);\n\nmodule.exports.sync = (cmd, args, opts) => {\n\tconst parsed = handleArgs(cmd, args, opts);\n\n\tif (isStream(parsed.opts.input)) {\n\t\tthrow new TypeError('The `input` option cannot be a stream in sync mode');\n\t}\n\n\tconst result = childProcess.spawnSync(parsed.cmd, parsed.args, parsed.opts);\n\n\tif (result.error || result.status !== 0) {\n\t\tthrow (result.error || new Error(result.stderr === '' ? result.stdout : result.stderr));\n\t}\n\n\tresult.stdout = handleOutput(parsed.opts, result.stdout);\n\tresult.stderr = handleOutput(parsed.opts, result.stderr);\n\n\treturn result;\n};\n\nmodule.exports.shellSync = (cmd, opts) => handleShell(module.exports.sync, cmd, opts);\n\nmodule.exports.spawn = util.deprecate(module.exports, 'execa.spawn() is deprecated. Use execa() instead.');\n"]}