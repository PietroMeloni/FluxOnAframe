{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/fs-vacuum/test/no-entries-no-purge.js"],"names":["path","require","test","statSync","mkdtemp","dir","mkdirp","vacuum","TEMP_OPTIONS","unsafeCleanup","mode","SHORT_PATH","join","LONG_PATH","messages","log","push","Array","prototype","slice","call","arguments","testPath","testBase","t","er","tmpdir","ifError","resolve","end","purge","base","equal","length","stat","verifyPath","verify","i","throws","notOk","isDirectory","dirname","doesNotThrow","ok"],"mappings":";;AAAA,IAAIA,OAAOC,QAAQ,MAAR,CAAX;;AAEA,IAAIC,OAAOD,QAAQ,KAAR,EAAeC,IAA1B;AACA,IAAIC,WAAWF,QAAQ,aAAR,EAAuBE,QAAtC;AACA,IAAIC,UAAUH,QAAQ,KAAR,EAAeI,GAA7B;AACA,IAAIC,SAASL,QAAQ,QAAR,CAAb;;AAEA,IAAIM,SAASN,QAAQ,cAAR,CAAb;;AAEA;AACA,IAAIO,eAAe;AACjBC,iBAAe,IADE;AAEjBC,QAAM;AAFW,CAAnB;AAIA,IAAIC,aAAaX,KAAKY,IAAL,CAAU,GAAV,EAAe,IAAf,EAAqB,GAArB,EAA0B,MAA1B,CAAjB;AACA,IAAIC,YAAYb,KAAKY,IAAL,CAAUD,UAAV,EAAsB,IAAtB,EAA4B,GAA5B,EAAiC,SAAjC,EAA4C,QAA5C,CAAhB;;AAEA,IAAIG,WAAW,EAAf;AACA,SAASC,GAAT,GAAgB;AAAED,WAASE,IAAT,CAAcC,MAAMC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2BC,SAA3B,EAAsCT,IAAtC,CAA2C,GAA3C,CAAd;AAAgE;;AAElF,IAAIU,QAAJ,EAAcC,QAAd;AACArB,KAAK,eAAL,EAAsB,UAAUsB,CAAV,EAAa;AACjCpB,UAAQI,YAAR,EAAsB,UAAUiB,EAAV,EAAcC,MAAd,EAAsB;AAC1CF,MAAEG,OAAF,CAAUF,EAAV,EAAc,uBAAd;;AAEAF,eAAWvB,KAAK4B,OAAL,CAAaF,MAAb,EAAqBf,UAArB,CAAX;AACAW,eAAWtB,KAAK4B,OAAL,CAAaF,MAAb,EAAqBb,SAArB,CAAX;;AAEAP,WAAOgB,QAAP,EAAiB,UAAUG,EAAV,EAAc;AAC7BD,QAAEG,OAAF,CAAUF,EAAV,EAAc,gBAAd;;AAEAD,QAAEK,GAAF;AACD,KAJD;AAKD,GAXD;AAYD,CAbD;;AAeA3B,KAAK,sBAAL,EAA6B,UAAUsB,CAAV,EAAa;AACxCjB,SAAOe,QAAP,EAAiB,EAACQ,OAAO,KAAR,EAAeC,MAAMR,QAArB,EAA+BR,KAAKA,GAApC,EAAjB,EAA2D,UAAUU,EAAV,EAAc;AACvED,MAAEG,OAAF,CAAUF,EAAV,EAAc,oBAAd;;AAEAD,MAAEQ,KAAF,CAAQlB,SAASmB,MAAjB,EAAyB,CAAzB,EAA4B,kCAA5B;AACAT,MAAEQ,KAAF,CAAQlB,SAAS,CAAT,CAAR,EAAqB,8BAA8BS,QAAnD;;AAEA,QAAIW,IAAJ;AACA,QAAIC,aAAab,QAAjB;AACA,aAASc,MAAT,GAAmB;AAAEF,aAAO/B,SAASgC,UAAT,CAAP;AAA6B;;AAElD,SAAK,IAAIE,IAAI,CAAb,EAAgBA,IAAI,CAApB,EAAuBA,GAAvB,EAA4B;AAC1Bb,QAAEc,MAAF,CAASF,MAAT,EAAiBD,aAAa,oBAA9B;AACAX,QAAEe,KAAF,CAAQL,QAAQA,KAAKM,WAAL,EAAhB,EAAoCL,aAAa,kBAAjD;AACAA,mBAAanC,KAAKyC,OAAL,CAAaN,UAAb,CAAb;AACD;;AAEDX,MAAEkB,YAAF,CAAe,YAAY;AACzBR,aAAO/B,SAASoB,QAAT,CAAP;AACD,KAFD,EAEGA,WAAW,iBAFd;AAGAC,MAAEmB,EAAF,CAAKT,QAAQA,KAAKM,WAAL,EAAb,EAAiCjB,WAAW,uBAA5C;;AAEAC,MAAEK,GAAF;AACD,GAtBD;AAuBD,CAxBD","file":"no-entries-no-purge.js","sourcesContent":["var path = require('path')\n\nvar test = require('tap').test\nvar statSync = require('graceful-fs').statSync\nvar mkdtemp = require('tmp').dir\nvar mkdirp = require('mkdirp')\n\nvar vacuum = require('../vacuum.js')\n\n// CONSTANTS\nvar TEMP_OPTIONS = {\n  unsafeCleanup: true,\n  mode: '0700'\n}\nvar SHORT_PATH = path.join('i', 'am', 'a', 'path')\nvar LONG_PATH = path.join(SHORT_PATH, 'of', 'a', 'certain', 'length')\n\nvar messages = []\nfunction log () { messages.push(Array.prototype.slice.call(arguments).join(' ')) }\n\nvar testPath, testBase\ntest('xXx setup xXx', function (t) {\n  mkdtemp(TEMP_OPTIONS, function (er, tmpdir) {\n    t.ifError(er, 'temp directory exists')\n\n    testBase = path.resolve(tmpdir, SHORT_PATH)\n    testPath = path.resolve(tmpdir, LONG_PATH)\n\n    mkdirp(testPath, function (er) {\n      t.ifError(er, 'made test path')\n\n      t.end()\n    })\n  })\n})\n\ntest('remove up to a point', function (t) {\n  vacuum(testPath, {purge: false, base: testBase, log: log}, function (er) {\n    t.ifError(er, 'cleaned up to base')\n\n    t.equal(messages.length, 5, 'got 4 removal & 1 finish message')\n    t.equal(messages[4], 'finished vacuuming up to ' + testBase)\n\n    var stat\n    var verifyPath = testPath\n    function verify () { stat = statSync(verifyPath) }\n\n    for (var i = 0; i < 4; i++) {\n      t.throws(verify, verifyPath + ' cannot be statted')\n      t.notOk(stat && stat.isDirectory(), verifyPath + ' is totally gone')\n      verifyPath = path.dirname(verifyPath)\n    }\n\n    t.doesNotThrow(function () {\n      stat = statSync(testBase)\n    }, testBase + ' can be statted')\n    t.ok(stat && stat.isDirectory(), testBase + ' is still a directory')\n\n    t.end()\n  })\n})\n"]}