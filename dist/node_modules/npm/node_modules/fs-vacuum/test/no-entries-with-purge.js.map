{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/fs-vacuum/test/no-entries-with-purge.js"],"names":["path","require","test","statSync","writeFileSync","mkdtemp","dir","mkdirp","vacuum","TEMP_OPTIONS","unsafeCleanup","mode","SHORT_PATH","join","LONG_PATH","FIRST_FILE","SECOND_FILE","messages","log","push","Array","prototype","slice","call","arguments","testPath","testBase","t","er","tmpdir","ifError","resolve","Buffer","end","purge","base","equal","length","stat","verifyPath","verify","i","throws","notOk","isDirectory","dirname","doesNotThrow","ok"],"mappings":"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","file":"no-entries-with-purge.js","sourcesContent":["var path = require('path')\n\nvar test = require('tap').test\nvar statSync = require('graceful-fs').statSync\nvar writeFileSync = require('graceful-fs').writeFileSync\nvar mkdtemp = require('tmp').dir\nvar mkdirp = require('mkdirp')\n\nvar vacuum = require('../vacuum.js')\n\n// CONSTANTS\nvar TEMP_OPTIONS = {\n  unsafeCleanup: true,\n  mode: '0700'\n}\nvar SHORT_PATH = path.join('i', 'am', 'a', 'path')\nvar LONG_PATH = path.join(SHORT_PATH, 'of', 'a', 'certain', 'kind')\nvar FIRST_FILE = path.join(LONG_PATH, 'monsieurs')\nvar SECOND_FILE = path.join(LONG_PATH, 'mesdames')\n\nvar messages = []\nfunction log () { messages.push(Array.prototype.slice.call(arguments).join(' ')) }\n\nvar testPath, testBase\ntest('xXx setup xXx', function (t) {\n  mkdtemp(TEMP_OPTIONS, function (er, tmpdir) {\n    t.ifError(er, 'temp directory exists')\n\n    testBase = path.resolve(tmpdir, SHORT_PATH)\n    testPath = path.resolve(tmpdir, LONG_PATH)\n\n    mkdirp(testPath, function (er) {\n      t.ifError(er, 'made test path')\n\n      writeFileSync(path.resolve(tmpdir, FIRST_FILE), new Buffer(\"c'est vraiment joli\"))\n      writeFileSync(path.resolve(tmpdir, SECOND_FILE), new Buffer('oui oui'))\n      t.end()\n    })\n  })\n})\n\ntest('remove up to a point', function (t) {\n  vacuum(testPath, {purge: true, base: testBase, log: log}, function (er) {\n    t.ifError(er, 'cleaned up to base')\n\n    t.equal(messages.length, 5, 'got 4 removal & 1 finish message')\n    t.equal(messages[0], 'purging ' + testPath)\n    t.equal(messages[4], 'finished vacuuming up to ' + testBase)\n\n    var stat\n    var verifyPath = testPath\n    function verify () { stat = statSync(verifyPath) }\n\n    for (var i = 0; i < 4; i++) {\n      t.throws(verify, verifyPath + ' cannot be statted')\n      t.notOk(stat && stat.isDirectory(), verifyPath + ' is totally gone')\n      verifyPath = path.dirname(verifyPath)\n    }\n\n    t.doesNotThrow(function () {\n      stat = statSync(testBase)\n    }, testBase + ' can be statted')\n    t.ok(stat && stat.isDirectory(), testBase + ' is still a directory')\n\n    t.end()\n  })\n})\n"]}