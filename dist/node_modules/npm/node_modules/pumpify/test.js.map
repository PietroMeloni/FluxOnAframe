{"version":3,"sources":["../../../../../node_modules/npm/node_modules/pumpify/test.js"],"names":["tape","require","through","pumpify","stream","duplexify","t","plan","pipeline","data","enc","cb","same","toString","toUpperCase","toLowerCase","write","on","end","test","destroy","ok","err","message","emit","Error","ran","a","b","c","setTimeout","Readable","_read","push","setPipeline","s","resume","ws","Writable","rs","highWaterMark","_write","process","nextTick","pumpifyErr","chunk","_","pipe","setWritable","setImmediate"],"mappings":"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","file":"test.js","sourcesContent":["var tape = require('tape')\nvar through = require('through2')\nvar pumpify = require('./')\nvar stream = require('stream')\nvar duplexify = require('duplexify')\n\ntape('basic', function(t) {\n  t.plan(3)\n\n  var pipeline = pumpify(\n    through(function(data, enc, cb) {\n      t.same(data.toString(), 'hello')\n      cb(null, data.toString().toUpperCase())\n    }),\n    through(function(data, enc, cb) {\n      t.same(data.toString(), 'HELLO')\n      cb(null, data.toString().toLowerCase())\n    })\n  )\n\n  pipeline.write('hello')\n  pipeline.on('data', function(data) {\n    t.same(data.toString(), 'hello')\n    t.end()\n  })\n})\n\ntape('3 times', function(t) {\n  t.plan(4)\n\n  var pipeline = pumpify(\n    through(function(data, enc, cb) {\n      t.same(data.toString(), 'hello')\n      cb(null, data.toString().toUpperCase())\n    }),\n    through(function(data, enc, cb) {\n      t.same(data.toString(), 'HELLO')\n      cb(null, data.toString().toLowerCase())\n    }),\n    through(function(data, enc, cb) {\n      t.same(data.toString(), 'hello')\n      cb(null, data.toString().toUpperCase())\n    })\n  )\n\n  pipeline.write('hello')\n  pipeline.on('data', function(data) {\n    t.same(data.toString(), 'HELLO')\n    t.end()\n  })\n})\n\ntape('destroy', function(t) {\n  var test = through()\n  test.destroy = function() {\n    t.ok(true)\n    t.end()\n  }\n\n  var pipeline = pumpify(through(), test)\n\n  pipeline.destroy()\n})\n\ntape('close', function(t) {\n  var test = through()\n  var pipeline = pumpify(through(), test)\n\n  pipeline.on('error', function(err) {\n    t.same(err.message, 'lol')\n    t.end()\n  })\n\n  test.emit('error', new Error('lol'))\n})\n\ntape('end waits for last one', function(t) {\n  var ran = false\n\n  var a = through()\n  var b = through()\n  var c = through(function(data, enc, cb) {\n    setTimeout(function() {\n      ran = true\n      cb()\n    }, 100)\n  })\n\n  var pipeline = pumpify(a, b, c)\n\n  pipeline.write('foo')\n  pipeline.end(function() {\n    t.ok(ran)\n    t.end()\n  })\n\n  t.ok(!ran)\n})\n\ntape('always wait for finish', function(t) {\n  var a = new stream.Readable()\n  a._read = function() {}\n  a.push('hello')\n\n  var pipeline = pumpify(a, through(), through())\n  var ran = false\n\n  pipeline.on('finish', function() {\n    t.ok(ran)\n    t.end()\n  })\n\n  setTimeout(function() {\n    ran = true\n    a.push(null)\n  }, 100)\n})\n\ntape('async', function(t) {\n  var pipeline = pumpify()\n\n  t.plan(4)\n\n  pipeline.write('hello')\n  pipeline.on('data', function(data) {\n    t.same(data.toString(), 'HELLO')\n    t.end()\n  })\n\n  setTimeout(function() {\n    pipeline.setPipeline(\n      through(function(data, enc, cb) {\n        t.same(data.toString(), 'hello')\n        cb(null, data.toString().toUpperCase())\n      }),\n      through(function(data, enc, cb) {\n        t.same(data.toString(), 'HELLO')\n        cb(null, data.toString().toLowerCase())\n      }),\n      through(function(data, enc, cb) {\n        t.same(data.toString(), 'hello')\n        cb(null, data.toString().toUpperCase())\n      })\n    )\n  }, 100)\n})\n\ntape('early destroy', function(t) {\n  var a = through()\n  var b = through()\n  var c = through()\n\n  b.destroy = function() {\n    t.ok(true)\n    t.end()\n  }\n\n  var pipeline = pumpify()\n\n  pipeline.destroy()\n  setTimeout(function() {\n    pipeline.setPipeline(a, b, c)\n  }, 100)\n})\n\ntape('preserves error', function (t) {\n  var a = through()\n  var b = through(function (data, enc, cb) {\n    cb(new Error('stop'))\n  })\n  var c = through()\n  var s = pumpify()\n\n  s.on('error', function (err) {\n    t.same(err.message, 'stop')\n    t.end()\n  })\n\n  s.setPipeline(a, b, c)\n  s.resume()\n  s.write('hi')\n})\n\ntape('preserves error again', function (t) {\n  var ws = new stream.Writable()\n  var rs = new stream.Readable({highWaterMark: 16})\n\n  ws._write = function (data, enc, cb) {\n    cb(null)\n  }\n\n  rs._read = function () {\n    process.nextTick(function () {\n      rs.push('hello world')\n    })\n  }\n\n  var pumpifyErr = pumpify(\n    through(),\n    through(function(chunk, _, cb) {\n      cb(new Error('test'))\n    }),\n    ws\n  )\n\n  rs.pipe(pumpifyErr)\n    .on('error', function (err) {\n      t.ok(err)\n      t.ok(err.message !== 'premature close', 'does not close with premature close')\n      t.end()\n    })\n})\n\ntape('returns error from duplexify', function (t) {\n  var a = through()\n  var b = duplexify()\n  var s = pumpify()\n\n  s.setPipeline(a, b)\n\n  s.on('error', function (err) {\n    t.same(err.message, 'stop')\n    t.end()\n  })\n\n  s.write('data')\n  // Test passes if `.end()` is not called\n  s.end()\n\n  b.setWritable(through())\n\n  setImmediate(function () {\n    b.destroy(new Error('stop'))\n  })\n})\n"]}