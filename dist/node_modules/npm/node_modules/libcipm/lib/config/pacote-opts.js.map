{"version":3,"sources":["../../../../../../../node_modules/npm/node_modules/libcipm/lib/config/pacote-opts.js"],"names":["Buffer","require","crypto","path","effectiveOwner","npmSession","randomBytes","toString","module","exports","pacoteOpts","npmOpts","moreOpts","ownerStats","calculateOwner","opts","cache","join","get","ca","cert","git","key","localAddress","loglevel","maxSockets","offline","projectScope","rootPkg","getProjectScope","name","proxy","refer","registry","retry","retries","factor","minTimeout","maxTimeout","strictSSL","userAgent","dmode","parseInt","fmode","umask","uid","gid","Object","assign","forEach","Array","from","keys","authMatchGlobal","k","match","authMatchScoped","nerfDart","val","auth","alwaysAuth","token","password","scopeTargets","replace","process","getuid","getgid","env","SUDO_UID","SUDO_GID","pkgName","sep","indexOf","slice"],"mappings":"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","file":"pacote-opts.js","sourcesContent":["'use strict'\n\nconst Buffer = require('safe-buffer').Buffer\n\nconst crypto = require('crypto')\nconst path = require('path')\n\nlet effectiveOwner\n\nconst npmSession = crypto.randomBytes(8).toString('hex')\n\nmodule.exports = pacoteOpts\nfunction pacoteOpts (npmOpts, moreOpts) {\n  const ownerStats = calculateOwner()\n  const opts = {\n    cache: path.join(npmOpts.get('cache'), '_cacache'),\n    ca: npmOpts.get('ca'),\n    cert: npmOpts.get('cert'),\n    git: npmOpts.get('git'),\n    key: npmOpts.get('key'),\n    localAddress: npmOpts.get('local-address'),\n    loglevel: npmOpts.get('loglevel'),\n    maxSockets: +(npmOpts.get('maxsockets') || 15),\n    npmSession: npmSession,\n    offline: npmOpts.get('offline'),\n    projectScope: moreOpts.rootPkg && getProjectScope(moreOpts.rootPkg.name),\n    proxy: npmOpts.get('https-proxy') || npmOpts.get('proxy'),\n    refer: 'cipm',\n    registry: npmOpts.get('registry'),\n    retry: {\n      retries: npmOpts.get('fetch-retries'),\n      factor: npmOpts.get('fetch-retry-factor'),\n      minTimeout: npmOpts.get('fetch-retry-mintimeout'),\n      maxTimeout: npmOpts.get('fetch-retry-maxtimeout')\n    },\n    strictSSL: npmOpts.get('strict-ssl'),\n    userAgent: npmOpts.get('user-agent'),\n\n    dmode: parseInt('0777', 8) & (~npmOpts.get('umask')),\n    fmode: parseInt('0666', 8) & (~npmOpts.get('umask')),\n    umask: npmOpts.get('umask')\n  }\n\n  if (ownerStats.uid != null || ownerStats.gid != null) {\n    Object.assign(opts, ownerStats)\n  }\n\n  (npmOpts.forEach ? Array.from(npmOpts.keys()) : npmOpts.keys).forEach(k => {\n    const authMatchGlobal = k.match(\n      /^(_authToken|username|_password|password|email|always-auth|_auth)$/\n    )\n    const authMatchScoped = k[0] === '/' && k.match(\n      /(.*):(_authToken|username|_password|password|email|always-auth|_auth)$/\n    )\n\n    // if it matches scoped it will also match global\n    if (authMatchGlobal || authMatchScoped) {\n      let nerfDart = null\n      let key = null\n      let val = null\n\n      if (!opts.auth) { opts.auth = {} }\n\n      if (authMatchScoped) {\n        nerfDart = authMatchScoped[1]\n        key = authMatchScoped[2]\n        val = npmOpts.get(k)\n        if (!opts.auth[nerfDart]) {\n          opts.auth[nerfDart] = {\n            alwaysAuth: !!npmOpts.get('always-auth')\n          }\n        }\n      } else {\n        key = authMatchGlobal[1]\n        val = npmOpts.get(k)\n        opts.auth.alwaysAuth = !!npmOpts.get('always-auth')\n      }\n\n      const auth = authMatchScoped ? opts.auth[nerfDart] : opts.auth\n      if (key === '_authToken') {\n        auth.token = val\n      } else if (key.match(/password$/i)) {\n        auth.password =\n        // the config file stores password auth already-encoded. pacote expects\n        // the actual username/password pair.\n        Buffer.from(val, 'base64').toString('utf8')\n      } else if (key === 'always-auth') {\n        auth.alwaysAuth = val === 'false' ? false : !!val\n      } else {\n        auth[key] = val\n      }\n    }\n\n    if (k[0] === '@') {\n      if (!opts.scopeTargets) { opts.scopeTargets = {} }\n      opts.scopeTargets[k.replace(/:registry$/, '')] = npmOpts.get(k)\n    }\n  })\n\n  Object.keys(moreOpts || {}).forEach((k) => {\n    opts[k] = moreOpts[k]\n  })\n\n  return opts\n}\n\nfunction calculateOwner () {\n  if (!effectiveOwner) {\n    effectiveOwner = { uid: 0, gid: 0 }\n\n    // Pretty much only on windows\n    if (!process.getuid) {\n      return effectiveOwner\n    }\n\n    effectiveOwner.uid = +process.getuid()\n    effectiveOwner.gid = +process.getgid()\n\n    if (effectiveOwner.uid === 0) {\n      if (process.env.SUDO_UID) effectiveOwner.uid = +process.env.SUDO_UID\n      if (process.env.SUDO_GID) effectiveOwner.gid = +process.env.SUDO_GID\n    }\n  }\n\n  return effectiveOwner\n}\n\nfunction getProjectScope (pkgName) {\n  const sep = pkgName.indexOf('/')\n  if (sep === -1) {\n    return ''\n  } else {\n    return pkgName.slice(0, sep)\n  }\n}\n"]}