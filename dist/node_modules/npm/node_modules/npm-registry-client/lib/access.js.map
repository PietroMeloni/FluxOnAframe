{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/npm-registry-client/lib/access.js"],"names":["module","exports","access","assert","require","url","npa","subcommands","sub","uri","params","cb","accessAssertions","call","public","setAccess","restricted","request","apiUri","package","method","auth","body","JSON","stringify","grant","reqUri","scope","team","permissions","revoke","type","client","uriParams","err","perms","statusCode","translatePermissions","user","encodeURIComponent","edit","Error","registryUri","path","Array","prototype","slice","arguments","filter","x","map","join","resolve","subcommand","hasOwnProperty","Object","keys","typeChecks","contains","specs","forEach","key","checks","arr","item","indexOf","newPerms"],"mappings":"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","file":"access.js","sourcesContent":["module.exports = access\n\nvar assert = require('assert')\nvar url = require('url')\nvar npa = require('npm-package-arg')\nvar subcommands = {}\n\nfunction access (sub, uri, params, cb) {\n  accessAssertions(sub, uri, params, cb)\n  return subcommands[sub].call(this, uri, params, cb)\n}\n\nsubcommands.public = function (uri, params, cb) {\n  return setAccess.call(this, 'public', uri, params, cb)\n}\nsubcommands.restricted = function (uri, params, cb) {\n  return setAccess.call(this, 'restricted', uri, params, cb)\n}\n\nfunction setAccess (access, uri, params, cb) {\n  return this.request(apiUri(uri, 'package', params.package, 'access'), {\n    method: 'POST',\n    auth: params.auth,\n    body: JSON.stringify({ access: access })\n  }, cb)\n}\n\nsubcommands.grant = function (uri, params, cb) {\n  var reqUri = apiUri(uri, 'team', params.scope, params.team, 'package')\n  return this.request(reqUri, {\n    method: 'PUT',\n    auth: params.auth,\n    body: JSON.stringify({\n      permissions: params.permissions,\n      package: params.package\n    })\n  }, cb)\n}\n\nsubcommands.revoke = function (uri, params, cb) {\n  var reqUri = apiUri(uri, 'team', params.scope, params.team, 'package')\n  return this.request(reqUri, {\n    method: 'DELETE',\n    auth: params.auth,\n    body: JSON.stringify({\n      package: params.package\n    })\n  }, cb)\n}\n\nsubcommands['ls-packages'] = function (uri, params, cb, type) {\n  type = type || (params.team ? 'team' : 'org')\n  var client = this\n  var uriParams = '?format=cli'\n  var reqUri = apiUri(uri, type, params.scope, params.team, 'package')\n  return client.request(reqUri + uriParams, {\n    method: 'GET',\n    auth: params.auth\n  }, function (err, perms) {\n    if (err && err.statusCode === 404 && type === 'org') {\n      subcommands['ls-packages'].call(client, uri, params, cb, 'user')\n    } else {\n      cb(err, perms && translatePermissions(perms))\n    }\n  })\n}\n\nsubcommands['ls-collaborators'] = function (uri, params, cb) {\n  var uriParams = '?format=cli'\n  if (params.user) {\n    uriParams += ('&user=' + encodeURIComponent(params.user))\n  }\n  var reqUri = apiUri(uri, 'package', params.package, 'collaborators')\n  return this.request(reqUri + uriParams, {\n    method: 'GET',\n    auth: params.auth\n  }, function (err, perms) {\n    cb(err, perms && translatePermissions(perms))\n  })\n}\n\nsubcommands.edit = function () {\n  throw new Error('edit subcommand is not implemented yet')\n}\n\nfunction apiUri (registryUri) {\n  var path = Array.prototype.slice.call(arguments, 1)\n    .filter(function (x) { return x })\n    .map(encodeURIComponent)\n    .join('/')\n  return url.resolve(registryUri, '-/' + path)\n}\n\nfunction accessAssertions (subcommand, uri, params, cb) {\n  assert(subcommands.hasOwnProperty(subcommand),\n    'access subcommand must be one of ' +\n         Object.keys(subcommands).join(', '))\n  typeChecks({\n    'uri': [uri, 'string'],\n    'params': [params, 'object'],\n    'auth': [params.auth, 'object'],\n    'callback': [cb, 'function']\n  })\n  if (contains([\n    'public', 'restricted'\n  ], subcommand)) {\n    typeChecks({ 'package': [params.package, 'string'] })\n    assert(!!npa(params.package).scope,\n      'access commands are only accessible for scoped packages')\n  }\n  if (contains(['grant', 'revoke', 'ls-packages'], subcommand)) {\n    typeChecks({ 'scope': [params.scope, 'string'] })\n  }\n  if (contains(['grant', 'revoke'], subcommand)) {\n    typeChecks({ 'team': [params.team, 'string'] })\n  }\n  if (subcommand === 'grant') {\n    typeChecks({ 'permissions': [params.permissions, 'string'] })\n    assert(params.permissions === 'read-only' ||\n           params.permissions === 'read-write',\n    'permissions must be either read-only or read-write')\n  }\n}\n\nfunction typeChecks (specs) {\n  Object.keys(specs).forEach(function (key) {\n    var checks = specs[key]\n    /* eslint valid-typeof:0 */\n    assert(typeof checks[0] === checks[1],\n      key + ' is required and must be of type ' + checks[1])\n  })\n}\n\nfunction contains (arr, item) {\n  return arr.indexOf(item) !== -1\n}\n\nfunction translatePermissions (perms) {\n  var newPerms = {}\n  for (var key in perms) {\n    if (perms.hasOwnProperty(key)) {\n      if (perms[key] === 'read') {\n        newPerms[key] = 'read-only'\n      } else if (perms[key] === 'write') {\n        newPerms[key] = 'read-write'\n      } else {\n        // This shouldn't happen, but let's not break things\n        // if the API starts returning different things.\n        newPerms[key] = perms[key]\n      }\n    }\n  }\n  return newPerms\n}\n"]}