{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/npm-registry-client/lib/star.js"],"names":["module","exports","star","assert","require","uri","params","cb","starred","auth","token","password","username","email","er","Error","code","client","request","fullData","whoami","data","_id","_rev","users","log","info","verbose","options","method","body"],"mappings":";;;;AAAAA,OAAOC,OAAP,GAAiBC,IAAjB;;AAEA,IAAIC,SAASC,QAAQ,QAAR,CAAb;;AAEA,SAASF,IAAT,CAAeG,GAAf,EAAoBC,MAApB,EAA4BC,EAA5B,EAAgC;AAC9BJ,SAAO,OAAOE,GAAP,KAAe,QAAtB,EAAgC,gCAAhC;AACAF,SAAOG,UAAU,QAAOA,MAAP,yCAAOA,MAAP,OAAkB,QAAnC,EAA6C,0BAA7C;AACAH,SAAO,OAAOI,EAAP,KAAc,UAArB,EAAiC,4BAAjC;;AAEA,MAAIC,UAAU,CAAC,CAACF,OAAOE,OAAvB;;AAEA,MAAIC,OAAOH,OAAOG,IAAlB;AACAN,SAAOM,QAAQ,QAAOA,IAAP,yCAAOA,IAAP,OAAgB,QAA/B,EAAyC,wBAAzC;AACA,MAAI,EAAEA,KAAKC,KAAL,IAAeD,KAAKE,QAAL,IAAiBF,KAAKG,QAAtB,IAAkCH,KAAKI,KAAxD,CAAJ,EAAqE;AACnE,QAAIC,KAAK,IAAIC,KAAJ,CAAU,2CAAV,CAAT;AACAD,OAAGE,IAAH,GAAU,WAAV;AACA,WAAOT,GAAGO,EAAH,CAAP;AACD;;AAED,MAAIG,SAAS,IAAb;AACA,OAAKC,OAAL,CAAab,MAAM,aAAnB,EAAkC,EAAEI,MAAMA,IAAR,EAAlC,EAAkD,UAAUK,EAAV,EAAcK,QAAd,EAAwB;AACxE,QAAIL,EAAJ,EAAQ,OAAOP,GAAGO,EAAH,CAAP;;AAERG,WAAOG,MAAP,CAAcf,GAAd,EAAmBC,MAAnB,EAA2B,UAAUQ,EAAV,EAAcF,QAAd,EAAwB;AACjD,UAAIE,EAAJ,EAAQ,OAAOP,GAAGO,EAAH,CAAP;;AAER,UAAIO,OAAO;AACTC,aAAKH,SAASG,GADL;AAETC,cAAMJ,SAASI,IAFN;AAGTC,eAAOL,SAASK,KAAT,IAAkB;AAHhB,OAAX;;AAMA,UAAIhB,OAAJ,EAAa;AACXS,eAAOQ,GAAP,CAAWC,IAAX,CAAgB,UAAhB,EAA4BL,KAAKC,GAAjC;AACAD,aAAKG,KAAL,CAAWZ,QAAX,IAAuB,IAAvB;AACAK,eAAOQ,GAAP,CAAWE,OAAX,CAAmB,UAAnB,EAA+BN,IAA/B;AACD,OAJD,MAIO;AACL,eAAOA,KAAKG,KAAL,CAAWZ,QAAX,CAAP;AACAK,eAAOQ,GAAP,CAAWC,IAAX,CAAgB,YAAhB,EAA8BL,KAAKC,GAAnC;AACAL,eAAOQ,GAAP,CAAWE,OAAX,CAAmB,YAAnB,EAAiCN,IAAjC;AACD;;AAED,UAAIO,UAAU;AACZC,gBAAQ,KADI;AAEZC,cAAMT,IAFM;AAGZZ,cAAMA;AAHM,OAAd;AAKA,aAAOQ,OAAOC,OAAP,CAAeb,GAAf,EAAoBuB,OAApB,EAA6BrB,EAA7B,CAAP;AACD,KAzBD;AA0BD,GA7BD;AA8BD","file":"star.js","sourcesContent":["module.exports = star\n\nvar assert = require('assert')\n\nfunction star (uri, params, cb) {\n  assert(typeof uri === 'string', 'must pass registry URI to star')\n  assert(params && typeof params === 'object', 'must pass params to star')\n  assert(typeof cb === 'function', 'must pass callback to star')\n\n  var starred = !!params.starred\n\n  var auth = params.auth\n  assert(auth && typeof auth === 'object', 'must pass auth to star')\n  if (!(auth.token || (auth.password && auth.username && auth.email))) {\n    var er = new Error('Must be logged in to star/unstar packages')\n    er.code = 'ENEEDAUTH'\n    return cb(er)\n  }\n\n  var client = this\n  this.request(uri + '?write=true', { auth: auth }, function (er, fullData) {\n    if (er) return cb(er)\n\n    client.whoami(uri, params, function (er, username) {\n      if (er) return cb(er)\n\n      var data = {\n        _id: fullData._id,\n        _rev: fullData._rev,\n        users: fullData.users || {}\n      }\n\n      if (starred) {\n        client.log.info('starring', data._id)\n        data.users[username] = true\n        client.log.verbose('starring', data)\n      } else {\n        delete data.users[username]\n        client.log.info('unstarring', data._id)\n        client.log.verbose('unstarring', data)\n      }\n\n      var options = {\n        method: 'PUT',\n        body: data,\n        auth: auth\n      }\n      return client.request(uri, options, cb)\n    })\n  })\n}\n"]}