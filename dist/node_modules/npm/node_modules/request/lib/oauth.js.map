{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/request/lib/oauth.js"],"names":["url","require","qs","caseless","uuid","oauth","crypto","Buffer","OAuth","request","params","prototype","buildParams","_oauth","uri","method","query","form","qsLib","oa","i","oauth_version","oauth_timestamp","Math","floor","Date","now","toString","oauth_nonce","replace","oauth_signature_method","consumer_secret_or_private_key","oauth_consumer_secret","oauth_private_key","token_secret","oauth_token_secret","realm","oauth_realm","oauth_transport_method","baseurl","protocol","host","pathname","parse","concat","stringify","join","oauth_signature","sign","buildBodyHash","body","indexOf","signature_method","emit","Error","shasum","createHash","update","sha1","digest","from","concatParams","sep","wrap","Object","keys","filter","sort","splice","push","map","rfc3986","onRequest","self","headers","contentType","get","formContentType","transport","transport_method","slice","length","body_hash","setHeader","href","path","exports"],"mappings":"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","file":"oauth.js","sourcesContent":["'use strict'\n\nvar url = require('url')\n  , qs = require('qs')\n  , caseless = require('caseless')\n  , uuid = require('uuid')\n  , oauth = require('oauth-sign')\n  , crypto = require('crypto')\n  , Buffer = require('safe-buffer').Buffer\n\n\nfunction OAuth (request) {\n  this.request = request\n  this.params = null\n}\n\nOAuth.prototype.buildParams = function (_oauth, uri, method, query, form, qsLib) {\n  var oa = {}\n  for (var i in _oauth) {\n    oa['oauth_' + i] = _oauth[i]\n  }\n  if (!oa.oauth_version) {\n    oa.oauth_version = '1.0'\n  }\n  if (!oa.oauth_timestamp) {\n    oa.oauth_timestamp = Math.floor( Date.now() / 1000 ).toString()\n  }\n  if (!oa.oauth_nonce) {\n    oa.oauth_nonce = uuid().replace(/-/g, '')\n  }\n  if (!oa.oauth_signature_method) {\n    oa.oauth_signature_method = 'HMAC-SHA1'\n  }\n\n  var consumer_secret_or_private_key = oa.oauth_consumer_secret || oa.oauth_private_key\n  delete oa.oauth_consumer_secret\n  delete oa.oauth_private_key\n\n  var token_secret = oa.oauth_token_secret\n  delete oa.oauth_token_secret\n\n  var realm = oa.oauth_realm\n  delete oa.oauth_realm\n  delete oa.oauth_transport_method\n\n  var baseurl = uri.protocol + '//' + uri.host + uri.pathname\n  var params = qsLib.parse([].concat(query, form, qsLib.stringify(oa)).join('&'))\n\n  oa.oauth_signature = oauth.sign(\n    oa.oauth_signature_method,\n    method,\n    baseurl,\n    params,\n    consumer_secret_or_private_key,\n    token_secret)\n\n  if (realm) {\n    oa.realm = realm\n  }\n\n  return oa\n}\n\nOAuth.prototype.buildBodyHash = function(_oauth, body) {\n  if (['HMAC-SHA1', 'RSA-SHA1'].indexOf(_oauth.signature_method || 'HMAC-SHA1') < 0) {\n    this.request.emit('error', new Error('oauth: ' + _oauth.signature_method +\n      ' signature_method not supported with body_hash signing.'))\n  }\n\n  var shasum = crypto.createHash('sha1')\n  shasum.update(body || '')\n  var sha1 = shasum.digest('hex')\n\n  return Buffer.from(sha1).toString('base64')\n}\n\nOAuth.prototype.concatParams = function (oa, sep, wrap) {\n  wrap = wrap || ''\n\n  var params = Object.keys(oa).filter(function (i) {\n    return i !== 'realm' && i !== 'oauth_signature'\n  }).sort()\n\n  if (oa.realm) {\n    params.splice(0, 0, 'realm')\n  }\n  params.push('oauth_signature')\n\n  return params.map(function (i) {\n    return i + '=' + wrap + oauth.rfc3986(oa[i]) + wrap\n  }).join(sep)\n}\n\nOAuth.prototype.onRequest = function (_oauth) {\n  var self = this\n  self.params = _oauth\n\n  var uri = self.request.uri || {}\n    , method = self.request.method || ''\n    , headers = caseless(self.request.headers)\n    , body = self.request.body || ''\n    , qsLib = self.request.qsLib || qs\n\n  var form\n    , query\n    , contentType = headers.get('content-type') || ''\n    , formContentType = 'application/x-www-form-urlencoded'\n    , transport = _oauth.transport_method || 'header'\n\n  if (contentType.slice(0, formContentType.length) === formContentType) {\n    contentType = formContentType\n    form = body\n  }\n  if (uri.query) {\n    query = uri.query\n  }\n  if (transport === 'body' && (method !== 'POST' || contentType !== formContentType)) {\n    self.request.emit('error', new Error('oauth: transport_method of body requires POST ' +\n      'and content-type ' + formContentType))\n  }\n\n  if (!form && typeof _oauth.body_hash === 'boolean') {\n    _oauth.body_hash = self.buildBodyHash(_oauth, self.request.body.toString())\n  }\n\n  var oa = self.buildParams(_oauth, uri, method, query, form, qsLib)\n\n  switch (transport) {\n    case 'header':\n      self.request.setHeader('Authorization', 'OAuth ' + self.concatParams(oa, ',', '\"'))\n      break\n\n    case 'query':\n      var href = self.request.uri.href += (query ? '&' : '?') + self.concatParams(oa, '&')\n      self.request.uri = url.parse(href)\n      self.request.path = self.request.uri.path\n      break\n\n    case 'body':\n      self.request.body = (form ? form + '&' : '') + self.concatParams(oa, '&')\n      break\n\n    default:\n      self.request.emit('error', new Error('oauth: transport_method invalid'))\n  }\n}\n\nexports.OAuth = OAuth\n"]}