{"version":3,"sources":["../../../../../node_modules/npm/node_modules/fs-minipass/index.js"],"names":["MiniPass","require","EE","EventEmitter","fs","binding","process","writeBuffers","FSReqWrap","_autoClose","Symbol","_close","_ended","_fd","_finished","_flags","_flush","_handleChunk","_makeBuf","_mode","_needDrain","_onerror","_onopen","_onread","_onwrite","_open","_path","_pos","_queue","_read","_readSize","_reading","_remain","_size","_write","_writing","_defaultFlag","ReadStream","path","opt","writable","TypeError","fd","readSize","size","Infinity","autoClose","open","er","emit","Buffer","allocUnsafe","Math","min","buf","length","nextTick","read","br","close","ret","slice","ev","data","ReadStreamSync","threw","openSync","readSync","closeSync","WriteStream","readable","mode","undefined","start","defaultFlag","flags","code","enc","write","Error","push","bw","pop","iovec","writev","WriteStreamSync","writeSync","pos","cb","done","req","oncomplete","exports"],"mappings":"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","file":"index.js","sourcesContent":["'use strict'\nconst MiniPass = require('minipass')\nconst EE = require('events').EventEmitter\nconst fs = require('fs')\n\n// for writev\nconst binding = process.binding('fs')\nconst writeBuffers = binding.writeBuffers\nconst FSReqWrap = binding.FSReqWrap\n\nconst _autoClose = Symbol('_autoClose')\nconst _close = Symbol('_close')\nconst _ended = Symbol('_ended')\nconst _fd = Symbol('_fd')\nconst _finished = Symbol('_finished')\nconst _flags = Symbol('_flags')\nconst _flush = Symbol('_flush')\nconst _handleChunk = Symbol('_handleChunk')\nconst _makeBuf = Symbol('_makeBuf')\nconst _mode = Symbol('_mode')\nconst _needDrain = Symbol('_needDrain')\nconst _onerror = Symbol('_onerror')\nconst _onopen = Symbol('_onopen')\nconst _onread = Symbol('_onread')\nconst _onwrite = Symbol('_onwrite')\nconst _open = Symbol('_open')\nconst _path = Symbol('_path')\nconst _pos = Symbol('_pos')\nconst _queue = Symbol('_queue')\nconst _read = Symbol('_read')\nconst _readSize = Symbol('_readSize')\nconst _reading = Symbol('_reading')\nconst _remain = Symbol('_remain')\nconst _size = Symbol('_size')\nconst _write = Symbol('_write')\nconst _writing = Symbol('_writing')\nconst _defaultFlag = Symbol('_defaultFlag')\n\nclass ReadStream extends MiniPass {\n  constructor (path, opt) {\n    opt = opt || {}\n    super(opt)\n\n    this.writable = false\n\n    if (typeof path !== 'string')\n      throw new TypeError('path must be a string')\n\n    this[_fd] = typeof opt.fd === 'number' ? opt.fd : null\n    this[_path] = path\n    this[_readSize] = opt.readSize || 16*1024*1024\n    this[_reading] = false\n    this[_size] = typeof opt.size === 'number' ? opt.size : Infinity\n    this[_remain] = this[_size]\n    this[_autoClose] = typeof opt.autoClose === 'boolean' ?\n      opt.autoClose : true\n\n    if (typeof this[_fd] === 'number')\n      this[_read]()\n    else\n      this[_open]()\n  }\n\n  get fd () { return this[_fd] }\n  get path () { return this[_path] }\n\n  write () {\n    throw new TypeError('this is a readable stream')\n  }\n\n  end () {\n    throw new TypeError('this is a readable stream')\n  }\n\n  [_open] () {\n    fs.open(this[_path], 'r', (er, fd) => this[_onopen](er, fd))\n  }\n\n  [_onopen] (er, fd) {\n    if (er)\n      this[_onerror](er)\n    else {\n      this[_fd] = fd\n      this.emit('open', fd)\n      this[_read]()\n    }\n  }\n\n  [_makeBuf] () {\n    return Buffer.allocUnsafe(Math.min(this[_readSize], this[_remain]))\n  }\n\n  [_read] () {\n    if (!this[_reading]) {\n      this[_reading] = true\n      const buf = this[_makeBuf]()\n      /* istanbul ignore if */\n      if (buf.length === 0) return process.nextTick(() => this[_onread](null, 0, buf))\n      fs.read(this[_fd], buf, 0, buf.length, null, (er, br, buf) =>\n        this[_onread](er, br, buf))\n    }\n  }\n\n  [_onread] (er, br, buf) {\n    this[_reading] = false\n    if (er)\n      this[_onerror](er)\n    else if (this[_handleChunk](br, buf))\n      this[_read]()\n  }\n\n  [_close] () {\n    if (this[_autoClose] && typeof this[_fd] === 'number') {\n      fs.close(this[_fd], _ => this.emit('close'))\n      this[_fd] = null\n    }\n  }\n\n  [_onerror] (er) {\n    this[_reading] = true\n    this[_close]()\n    this.emit('error', er)\n  }\n\n  [_handleChunk] (br, buf) {\n    let ret = false\n    // no effect if infinite\n    this[_remain] -= br\n    if (br > 0)\n      ret = super.write(br < buf.length ? buf.slice(0, br) : buf)\n\n    if (br === 0 || this[_remain] <= 0) {\n      ret = false\n      this[_close]()\n      super.end()\n    }\n\n    return ret\n  }\n\n  emit (ev, data) {\n    switch (ev) {\n      case 'prefinish':\n      case 'finish':\n        break\n\n      case 'drain':\n        if (typeof this[_fd] === 'number')\n          this[_read]()\n        break\n\n      default:\n        return super.emit(ev, data)\n    }\n  }\n}\n\nclass ReadStreamSync extends ReadStream {\n  [_open] () {\n    let threw = true\n    try {\n      this[_onopen](null, fs.openSync(this[_path], 'r'))\n      threw = false\n    } finally {\n      if (threw)\n        this[_close]()\n    }\n  }\n\n  [_read] () {\n    let threw = true\n    try {\n      if (!this[_reading]) {\n        this[_reading] = true\n        do {\n          const buf = this[_makeBuf]()\n          /* istanbul ignore next */\n          const br = buf.length === 0 ? 0 : fs.readSync(this[_fd], buf, 0, buf.length, null)\n          if (!this[_handleChunk](br, buf))\n            break\n        } while (true)\n        this[_reading] = false\n      }\n      threw = false\n    } finally {\n      if (threw)\n        this[_close]()\n    }\n  }\n\n  [_close] () {\n    if (this[_autoClose] && typeof this[_fd] === 'number') {\n      try {\n        fs.closeSync(this[_fd])\n      } catch (er) {}\n      this[_fd] = null\n      this.emit('close')\n    }\n  }\n}\n\nclass WriteStream extends EE {\n  constructor (path, opt) {\n    opt = opt || {}\n    super(opt)\n    this.readable = false\n    this[_writing] = false\n    this[_ended] = false\n    this[_needDrain] = false\n    this[_queue] = []\n    this[_path] = path\n    this[_fd] = typeof opt.fd === 'number' ? opt.fd : null\n    this[_mode] = opt.mode === undefined ? 0o666 : opt.mode\n    this[_pos] = typeof opt.start === 'number' ? opt.start : null\n    this[_autoClose] = typeof opt.autoClose === 'boolean' ?\n      opt.autoClose : true\n\n    // truncating makes no sense when writing into the middle\n    const defaultFlag = this[_pos] !== null ? 'r+' : 'w'\n    this[_defaultFlag] = opt.flags === undefined\n    this[_flags] = this[_defaultFlag] ? defaultFlag : opt.flags\n\n    if (this[_fd] === null)\n      this[_open]()\n  }\n\n  get fd () { return this[_fd] }\n  get path () { return this[_path] }\n\n  [_onerror] (er) {\n    this[_close]()\n    this[_writing] = true\n    this.emit('error', er)\n  }\n\n  [_open] () {\n    fs.open(this[_path], this[_flags], this[_mode],\n      (er, fd) => this[_onopen](er, fd))\n  }\n\n  [_onopen] (er, fd) {\n    if (this[_defaultFlag] &&\n        this[_flags] === 'r+' &&\n        er && er.code === 'ENOENT') {\n      this[_flags] = 'w'\n      this[_open]()\n    } else if (er)\n      this[_onerror](er)\n    else {\n      this[_fd] = fd\n      this.emit('open', fd)\n      this[_flush]()\n    }\n  }\n\n  end (buf, enc) {\n    if (buf)\n      this.write(buf, enc)\n\n    this[_ended] = true\n\n    // synthetic after-write logic, where drain/finish live\n    if (!this[_writing] && !this[_queue].length &&\n        typeof this[_fd] === 'number')\n      this[_onwrite](null, 0)\n  }\n\n  write (buf, enc) {\n    if (typeof buf === 'string')\n      buf = new Buffer(buf, enc)\n\n    if (this[_ended]) {\n      this.emit('error', new Error('write() after end()'))\n      return false\n    }\n\n    if (this[_fd] === null || this[_writing] || this[_queue].length) {\n      this[_queue].push(buf)\n      this[_needDrain] = true\n      return false\n    }\n\n    this[_writing] = true\n    this[_write](buf)\n    return true\n  }\n\n  [_write] (buf) {\n    fs.write(this[_fd], buf, 0, buf.length, this[_pos], (er, bw) =>\n      this[_onwrite](er, bw))\n  }\n\n  [_onwrite] (er, bw) {\n    if (er)\n      this[_onerror](er)\n    else {\n      if (this[_pos] !== null)\n        this[_pos] += bw\n      if (this[_queue].length)\n        this[_flush]()\n      else {\n        this[_writing] = false\n\n        if (this[_ended] && !this[_finished]) {\n          this[_finished] = true\n          this[_close]()\n          this.emit('finish')\n        } else if (this[_needDrain]) {\n          this[_needDrain] = false\n          this.emit('drain')\n        }\n      }\n    }\n  }\n\n  [_flush] () {\n    if (this[_queue].length === 0) {\n      if (this[_ended])\n        this[_onwrite](null, 0)\n    } else if (this[_queue].length === 1)\n      this[_write](this[_queue].pop())\n    else {\n      const iovec = this[_queue]\n      this[_queue] = []\n      writev(this[_fd], iovec, this[_pos],\n        (er, bw) => this[_onwrite](er, bw))\n    }\n  }\n\n  [_close] () {\n    if (this[_autoClose] && typeof this[_fd] === 'number') {\n      fs.close(this[_fd], _ => this.emit('close'))\n      this[_fd] = null\n    }\n  }\n}\n\nclass WriteStreamSync extends WriteStream {\n  [_open] () {\n    let fd\n    try {\n      fd = fs.openSync(this[_path], this[_flags], this[_mode])\n    } catch (er) {\n      if (this[_defaultFlag] &&\n          this[_flags] === 'r+' &&\n          er && er.code === 'ENOENT') {\n        this[_flags] = 'w'\n        return this[_open]()\n      } else\n        throw er\n    }\n    this[_onopen](null, fd)\n  }\n\n  [_close] () {\n    if (this[_autoClose] && typeof this[_fd] === 'number') {\n      try {\n        fs.closeSync(this[_fd])\n      } catch (er) {}\n      this[_fd] = null\n      this.emit('close')\n    }\n  }\n\n  [_write] (buf) {\n    try {\n      this[_onwrite](null,\n        fs.writeSync(this[_fd], buf, 0, buf.length, this[_pos]))\n    } catch (er) {\n      this[_onwrite](er, 0)\n    }\n  }\n}\n\nconst writev = (fd, iovec, pos, cb) => {\n  const done = (er, bw) => cb(er, bw, iovec)\n  const req = new FSReqWrap()\n  req.oncomplete = done\n  binding.writeBuffers(fd, iovec, pos, req)\n}\n\nexports.ReadStream = ReadStream\nexports.ReadStreamSync = ReadStreamSync\n\nexports.WriteStream = WriteStream\nexports.WriteStreamSync = WriteStreamSync\n"]}