{"version":3,"sources":["../../../../../../../node_modules/npm/node_modules/bluebird/js/release/join.js"],"names":["module","exports","Promise","PromiseArray","tryConvertToPromise","INTERNAL","async","getDomain","util","require","canEvaluate","tryCatch","errorObj","reject","thenCallback","i","Function","replace","promiseSetter","generateHolderClass","total","props","Array","length","assignment","join","cancellationCode","map","prop","passedArguments","name","code","holderClasses","thenCallbacks","promiseSetters","push","reason","_reject","last","arguments","fn","ret","_captureStackTrace","HolderClass","holder","callbacks","maybePromise","_target","bitField","_bitField","_then","undefined","asyncNeeded","call","_value","_reason","_cancel","_isFateSealed","domain","domainBind","_setAsyncGuaranteed","_setOnCancel","$_len","args","$_i","pop","promise","spread"],"mappings":"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","file":"join.js","sourcesContent":["\"use strict\";\nmodule.exports =\nfunction(Promise, PromiseArray, tryConvertToPromise, INTERNAL, async,\n         getDomain) {\nvar util = require(\"./util\");\nvar canEvaluate = util.canEvaluate;\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar reject;\n\nif (!false) {\nif (canEvaluate) {\n    var thenCallback = function(i) {\n        return new Function(\"value\", \"holder\", \"                             \\n\\\n            'use strict';                                                    \\n\\\n            holder.pIndex = value;                                           \\n\\\n            holder.checkFulfillment(this);                                   \\n\\\n            \".replace(/Index/g, i));\n    };\n\n    var promiseSetter = function(i) {\n        return new Function(\"promise\", \"holder\", \"                           \\n\\\n            'use strict';                                                    \\n\\\n            holder.pIndex = promise;                                         \\n\\\n            \".replace(/Index/g, i));\n    };\n\n    var generateHolderClass = function(total) {\n        var props = new Array(total);\n        for (var i = 0; i < props.length; ++i) {\n            props[i] = \"this.p\" + (i+1);\n        }\n        var assignment = props.join(\" = \") + \" = null;\";\n        var cancellationCode= \"var promise;\\n\" + props.map(function(prop) {\n            return \"                                                         \\n\\\n                promise = \" + prop + \";                                      \\n\\\n                if (promise instanceof Promise) {                            \\n\\\n                    promise.cancel();                                        \\n\\\n                }                                                            \\n\\\n            \";\n        }).join(\"\\n\");\n        var passedArguments = props.join(\", \");\n        var name = \"Holder$\" + total;\n\n\n        var code = \"return function(tryCatch, errorObj, Promise, async) {    \\n\\\n            'use strict';                                                    \\n\\\n            function [TheName](fn) {                                         \\n\\\n                [TheProperties]                                              \\n\\\n                this.fn = fn;                                                \\n\\\n                this.asyncNeeded = true;                                     \\n\\\n                this.now = 0;                                                \\n\\\n            }                                                                \\n\\\n                                                                             \\n\\\n            [TheName].prototype._callFunction = function(promise) {          \\n\\\n                promise._pushContext();                                      \\n\\\n                var ret = tryCatch(this.fn)([ThePassedArguments]);           \\n\\\n                promise._popContext();                                       \\n\\\n                if (ret === errorObj) {                                      \\n\\\n                    promise._rejectCallback(ret.e, false);                   \\n\\\n                } else {                                                     \\n\\\n                    promise._resolveCallback(ret);                           \\n\\\n                }                                                            \\n\\\n            };                                                               \\n\\\n                                                                             \\n\\\n            [TheName].prototype.checkFulfillment = function(promise) {       \\n\\\n                var now = ++this.now;                                        \\n\\\n                if (now === [TheTotal]) {                                    \\n\\\n                    if (this.asyncNeeded) {                                  \\n\\\n                        async.invoke(this._callFunction, this, promise);     \\n\\\n                    } else {                                                 \\n\\\n                        this._callFunction(promise);                         \\n\\\n                    }                                                        \\n\\\n                                                                             \\n\\\n                }                                                            \\n\\\n            };                                                               \\n\\\n                                                                             \\n\\\n            [TheName].prototype._resultCancelled = function() {              \\n\\\n                [CancellationCode]                                           \\n\\\n            };                                                               \\n\\\n                                                                             \\n\\\n            return [TheName];                                                \\n\\\n        }(tryCatch, errorObj, Promise, async);                               \\n\\\n        \";\n\n        code = code.replace(/\\[TheName\\]/g, name)\n            .replace(/\\[TheTotal\\]/g, total)\n            .replace(/\\[ThePassedArguments\\]/g, passedArguments)\n            .replace(/\\[TheProperties\\]/g, assignment)\n            .replace(/\\[CancellationCode\\]/g, cancellationCode);\n\n        return new Function(\"tryCatch\", \"errorObj\", \"Promise\", \"async\", code)\n                           (tryCatch, errorObj, Promise, async);\n    };\n\n    var holderClasses = [];\n    var thenCallbacks = [];\n    var promiseSetters = [];\n\n    for (var i = 0; i < 8; ++i) {\n        holderClasses.push(generateHolderClass(i + 1));\n        thenCallbacks.push(thenCallback(i + 1));\n        promiseSetters.push(promiseSetter(i + 1));\n    }\n\n    reject = function (reason) {\n        this._reject(reason);\n    };\n}}\n\nPromise.join = function () {\n    var last = arguments.length - 1;\n    var fn;\n    if (last > 0 && typeof arguments[last] === \"function\") {\n        fn = arguments[last];\n        if (!false) {\n            if (last <= 8 && canEvaluate) {\n                var ret = new Promise(INTERNAL);\n                ret._captureStackTrace();\n                var HolderClass = holderClasses[last - 1];\n                var holder = new HolderClass(fn);\n                var callbacks = thenCallbacks;\n\n                for (var i = 0; i < last; ++i) {\n                    var maybePromise = tryConvertToPromise(arguments[i], ret);\n                    if (maybePromise instanceof Promise) {\n                        maybePromise = maybePromise._target();\n                        var bitField = maybePromise._bitField;\n                        ;\n                        if (((bitField & 50397184) === 0)) {\n                            maybePromise._then(callbacks[i], reject,\n                                               undefined, ret, holder);\n                            promiseSetters[i](maybePromise, holder);\n                            holder.asyncNeeded = false;\n                        } else if (((bitField & 33554432) !== 0)) {\n                            callbacks[i].call(ret,\n                                              maybePromise._value(), holder);\n                        } else if (((bitField & 16777216) !== 0)) {\n                            ret._reject(maybePromise._reason());\n                        } else {\n                            ret._cancel();\n                        }\n                    } else {\n                        callbacks[i].call(ret, maybePromise, holder);\n                    }\n                }\n\n                if (!ret._isFateSealed()) {\n                    if (holder.asyncNeeded) {\n                        var domain = getDomain();\n                        if (domain !== null) {\n                            holder.fn = util.domainBind(domain, holder.fn);\n                        }\n                    }\n                    ret._setAsyncGuaranteed();\n                    ret._setOnCancel(holder);\n                }\n                return ret;\n            }\n        }\n    }\n    var $_len = arguments.length;var args = new Array($_len); for(var $_i = 0; $_i < $_len; ++$_i) {args[$_i] = arguments[$_i];};\n    if (fn) args.pop();\n    var ret = new PromiseArray(args).promise();\n    return fn !== undefined ? ret.spread(fn) : ret;\n};\n\n};\n"]}