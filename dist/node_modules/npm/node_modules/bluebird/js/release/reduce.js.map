{"version":3,"sources":["../../../../../../../node_modules/npm/node_modules/bluebird/js/release/reduce.js"],"names":["module","exports","Promise","PromiseArray","apiRejection","tryConvertToPromise","INTERNAL","debug","getDomain","_getDomain","util","require","tryCatch","ReductionPromiseArray","promises","fn","initialValue","_each","constructor$","domain","_fn","domainBind","undefined","resolve","_attachCancellationCallback","_initialValue","_currentCancellable","_eachValues","Array","_length","_promise","_captureStackTrace","_init$","inherits","prototype","_gotAccum","accum","push","_eachComplete","value","_init","_resolveEmptyArray","_resolve","shouldCopyValues","_resolveCallback","_values","_resultCancelled","sender","_cancel","_isResolved","_resultCancelled$","cancel","_iterate","values","i","length","isRejected","ctx","index","array","_then","gotAccum","completed","reduce","valueOrReason","isFulfilled","_reject","classString","promise","gotValue","call","_pushContext","ret","_boundValue","promiseCreated","_popContext","checkForgottenReturns"],"mappings":"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","file":"reduce.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL,\n                          debug) {\nvar getDomain = Promise._getDomain;\nvar util = require(\"./util\");\nvar tryCatch = util.tryCatch;\n\nfunction ReductionPromiseArray(promises, fn, initialValue, _each) {\n    this.constructor$(promises);\n    var domain = getDomain();\n    this._fn = domain === null ? fn : util.domainBind(domain, fn);\n    if (initialValue !== undefined) {\n        initialValue = Promise.resolve(initialValue);\n        initialValue._attachCancellationCallback(this);\n    }\n    this._initialValue = initialValue;\n    this._currentCancellable = null;\n    if(_each === INTERNAL) {\n        this._eachValues = Array(this._length);\n    } else if (_each === 0) {\n        this._eachValues = null;\n    } else {\n        this._eachValues = undefined;\n    }\n    this._promise._captureStackTrace();\n    this._init$(undefined, -5);\n}\nutil.inherits(ReductionPromiseArray, PromiseArray);\n\nReductionPromiseArray.prototype._gotAccum = function(accum) {\n    if (this._eachValues !== undefined && \n        this._eachValues !== null && \n        accum !== INTERNAL) {\n        this._eachValues.push(accum);\n    }\n};\n\nReductionPromiseArray.prototype._eachComplete = function(value) {\n    if (this._eachValues !== null) {\n        this._eachValues.push(value);\n    }\n    return this._eachValues;\n};\n\nReductionPromiseArray.prototype._init = function() {};\n\nReductionPromiseArray.prototype._resolveEmptyArray = function() {\n    this._resolve(this._eachValues !== undefined ? this._eachValues\n                                                 : this._initialValue);\n};\n\nReductionPromiseArray.prototype.shouldCopyValues = function () {\n    return false;\n};\n\nReductionPromiseArray.prototype._resolve = function(value) {\n    this._promise._resolveCallback(value);\n    this._values = null;\n};\n\nReductionPromiseArray.prototype._resultCancelled = function(sender) {\n    if (sender === this._initialValue) return this._cancel();\n    if (this._isResolved()) return;\n    this._resultCancelled$();\n    if (this._currentCancellable instanceof Promise) {\n        this._currentCancellable.cancel();\n    }\n    if (this._initialValue instanceof Promise) {\n        this._initialValue.cancel();\n    }\n};\n\nReductionPromiseArray.prototype._iterate = function (values) {\n    this._values = values;\n    var value;\n    var i;\n    var length = values.length;\n    if (this._initialValue !== undefined) {\n        value = this._initialValue;\n        i = 0;\n    } else {\n        value = Promise.resolve(values[0]);\n        i = 1;\n    }\n\n    this._currentCancellable = value;\n\n    if (!value.isRejected()) {\n        for (; i < length; ++i) {\n            var ctx = {\n                accum: null,\n                value: values[i],\n                index: i,\n                length: length,\n                array: this\n            };\n            value = value._then(gotAccum, undefined, undefined, ctx, undefined);\n        }\n    }\n\n    if (this._eachValues !== undefined) {\n        value = value\n            ._then(this._eachComplete, undefined, undefined, this, undefined);\n    }\n    value._then(completed, completed, undefined, value, this);\n};\n\nPromise.prototype.reduce = function (fn, initialValue) {\n    return reduce(this, fn, initialValue, null);\n};\n\nPromise.reduce = function (promises, fn, initialValue, _each) {\n    return reduce(promises, fn, initialValue, _each);\n};\n\nfunction completed(valueOrReason, array) {\n    if (this.isFulfilled()) {\n        array._resolve(valueOrReason);\n    } else {\n        array._reject(valueOrReason);\n    }\n}\n\nfunction reduce(promises, fn, initialValue, _each) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n    var array = new ReductionPromiseArray(promises, fn, initialValue, _each);\n    return array.promise();\n}\n\nfunction gotAccum(accum) {\n    this.accum = accum;\n    this.array._gotAccum(accum);\n    var value = tryConvertToPromise(this.value, this.array._promise);\n    if (value instanceof Promise) {\n        this.array._currentCancellable = value;\n        return value._then(gotValue, undefined, undefined, this, undefined);\n    } else {\n        return gotValue.call(this, value);\n    }\n}\n\nfunction gotValue(value) {\n    var array = this.array;\n    var promise = array._promise;\n    var fn = tryCatch(array._fn);\n    promise._pushContext();\n    var ret;\n    if (array._eachValues !== undefined) {\n        ret = fn.call(promise._boundValue(), value, this.index, this.length);\n    } else {\n        ret = fn.call(promise._boundValue(),\n                              this.accum, value, this.index, this.length);\n    }\n    if (ret instanceof Promise) {\n        array._currentCancellable = ret;\n    }\n    var promiseCreated = promise._popContext();\n    debug.checkForgottenReturns(\n        ret,\n        promiseCreated,\n        array._eachValues !== undefined ? \"Promise.each\" : \"Promise.reduce\",\n        promise\n    );\n    return ret;\n}\n};\n"]}