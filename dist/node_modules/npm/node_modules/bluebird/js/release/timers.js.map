{"version":3,"sources":["../../../../../../../node_modules/npm/node_modules/bluebird/js/release/timers.js"],"names":["module","exports","Promise","INTERNAL","debug","util","require","TimeoutError","HandleWrapper","handle","prototype","_resultCancelled","clearTimeout","afterValue","value","delay","thenReturn","ms","ret","undefined","resolve","_then","cancellation","_setOnCancel","setTimeout","_fulfill","_captureStackTrace","_setAsyncGuaranteed","afterTimeout","promise","message","parent","err","Error","markAsOriginatingFromRejection","_attachExtraTrace","_reject","cancel","successClear","failureClear","reason","timeout","handleWrapper","timeoutTimeout","isPending","then"],"mappings":"AAAA;;AACAA,OAAOC,OAAP,GAAiB,UAASC,OAAT,EAAkBC,QAAlB,EAA4BC,KAA5B,EAAmC;AACpD,QAAIC,OAAOC,QAAQ,QAAR,CAAX;AACA,QAAIC,eAAeL,QAAQK,YAA3B;;AAEA,aAASC,aAAT,CAAuBC,MAAvB,EAAgC;AAC5B,aAAKA,MAAL,GAAcA,MAAd;AACH;;AAEDD,kBAAcE,SAAd,CAAwBC,gBAAxB,GAA2C,YAAW;AAClDC,qBAAa,KAAKH,MAAlB;AACH,KAFD;;AAIA,QAAII,aAAa,SAAbA,UAAa,CAASC,KAAT,EAAgB;AAAE,eAAOC,MAAM,CAAC,IAAP,EAAaC,UAAb,CAAwBF,KAAxB,CAAP;AAAwC,KAA3E;AACA,QAAIC,QAAQb,QAAQa,KAAR,GAAgB,UAAUE,EAAV,EAAcH,KAAd,EAAqB;AAC7C,YAAII,GAAJ;AACA,YAAIT,MAAJ;AACA,YAAIK,UAAUK,SAAd,EAAyB;AACrBD,kBAAMhB,QAAQkB,OAAR,CAAgBN,KAAhB,EACGO,KADH,CACSR,UADT,EACqB,IADrB,EAC2B,IAD3B,EACiCI,EADjC,EACqCE,SADrC,CAAN;AAEA,gBAAIf,MAAMkB,YAAN,MAAwBR,iBAAiBZ,OAA7C,EAAsD;AAClDgB,oBAAIK,YAAJ,CAAiBT,KAAjB;AACH;AACJ,SAND,MAMO;AACHI,kBAAM,IAAIhB,OAAJ,CAAYC,QAAZ,CAAN;AACAM,qBAASe,WAAW,YAAW;AAAEN,oBAAIO,QAAJ;AAAiB,aAAzC,EAA2C,CAACR,EAA5C,CAAT;AACA,gBAAIb,MAAMkB,YAAN,EAAJ,EAA0B;AACtBJ,oBAAIK,YAAJ,CAAiB,IAAIf,aAAJ,CAAkBC,MAAlB,CAAjB;AACH;AACDS,gBAAIQ,kBAAJ;AACH;AACDR,YAAIS,mBAAJ;AACA,eAAOT,GAAP;AACH,KAnBD;;AAqBAhB,YAAQQ,SAAR,CAAkBK,KAAlB,GAA0B,UAAUE,EAAV,EAAc;AACpC,eAAOF,MAAME,EAAN,EAAU,IAAV,CAAP;AACH,KAFD;;AAIA,QAAIW,eAAe,SAAfA,YAAe,CAAUC,OAAV,EAAmBC,OAAnB,EAA4BC,MAA5B,EAAoC;AACnD,YAAIC,GAAJ;AACA,YAAI,OAAOF,OAAP,KAAmB,QAAvB,EAAiC;AAC7B,gBAAIA,mBAAmBG,KAAvB,EAA8B;AAC1BD,sBAAMF,OAAN;AACH,aAFD,MAEO;AACHE,sBAAM,IAAIzB,YAAJ,CAAiB,qBAAjB,CAAN;AACH;AACJ,SAND,MAMO;AACHyB,kBAAM,IAAIzB,YAAJ,CAAiBuB,OAAjB,CAAN;AACH;AACDzB,aAAK6B,8BAAL,CAAoCF,GAApC;AACAH,gBAAQM,iBAAR,CAA0BH,GAA1B;AACAH,gBAAQO,OAAR,CAAgBJ,GAAhB;;AAEA,YAAID,UAAU,IAAd,EAAoB;AAChBA,mBAAOM,MAAP;AACH;AACJ,KAlBD;;AAoBA,aAASC,YAAT,CAAsBxB,KAAtB,EAA6B;AACzBF,qBAAa,KAAKH,MAAlB;AACA,eAAOK,KAAP;AACH;;AAED,aAASyB,YAAT,CAAsBC,MAAtB,EAA8B;AAC1B5B,qBAAa,KAAKH,MAAlB;AACA,cAAM+B,MAAN;AACH;;AAEDtC,YAAQQ,SAAR,CAAkB+B,OAAlB,GAA4B,UAAUxB,EAAV,EAAca,OAAd,EAAuB;AAC/Cb,aAAK,CAACA,EAAN;AACA,YAAIC,GAAJ,EAASa,MAAT;;AAEA,YAAIW,gBAAgB,IAAIlC,aAAJ,CAAkBgB,WAAW,SAASmB,cAAT,GAA0B;AACvE,gBAAIzB,IAAI0B,SAAJ,EAAJ,EAAqB;AACjBhB,6BAAaV,GAAb,EAAkBY,OAAlB,EAA2BC,MAA3B;AACH;AACJ,SAJqC,EAInCd,EAJmC,CAAlB,CAApB;;AAMA,YAAIb,MAAMkB,YAAN,EAAJ,EAA0B;AACtBS,qBAAS,KAAKc,IAAL,EAAT;AACA3B,kBAAMa,OAAOV,KAAP,CAAaiB,YAAb,EAA2BC,YAA3B,EACcpB,SADd,EACyBuB,aADzB,EACwCvB,SADxC,CAAN;AAEAD,gBAAIK,YAAJ,CAAiBmB,aAAjB;AACH,SALD,MAKO;AACHxB,kBAAM,KAAKG,KAAL,CAAWiB,YAAX,EAAyBC,YAAzB,EACcpB,SADd,EACyBuB,aADzB,EACwCvB,SADxC,CAAN;AAEH;;AAED,eAAOD,GAAP;AACH,KArBD;AAuBC,CA3FD","file":"timers.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, INTERNAL, debug) {\nvar util = require(\"./util\");\nvar TimeoutError = Promise.TimeoutError;\n\nfunction HandleWrapper(handle)  {\n    this.handle = handle;\n}\n\nHandleWrapper.prototype._resultCancelled = function() {\n    clearTimeout(this.handle);\n};\n\nvar afterValue = function(value) { return delay(+this).thenReturn(value); };\nvar delay = Promise.delay = function (ms, value) {\n    var ret;\n    var handle;\n    if (value !== undefined) {\n        ret = Promise.resolve(value)\n                ._then(afterValue, null, null, ms, undefined);\n        if (debug.cancellation() && value instanceof Promise) {\n            ret._setOnCancel(value);\n        }\n    } else {\n        ret = new Promise(INTERNAL);\n        handle = setTimeout(function() { ret._fulfill(); }, +ms);\n        if (debug.cancellation()) {\n            ret._setOnCancel(new HandleWrapper(handle));\n        }\n        ret._captureStackTrace();\n    }\n    ret._setAsyncGuaranteed();\n    return ret;\n};\n\nPromise.prototype.delay = function (ms) {\n    return delay(ms, this);\n};\n\nvar afterTimeout = function (promise, message, parent) {\n    var err;\n    if (typeof message !== \"string\") {\n        if (message instanceof Error) {\n            err = message;\n        } else {\n            err = new TimeoutError(\"operation timed out\");\n        }\n    } else {\n        err = new TimeoutError(message);\n    }\n    util.markAsOriginatingFromRejection(err);\n    promise._attachExtraTrace(err);\n    promise._reject(err);\n\n    if (parent != null) {\n        parent.cancel();\n    }\n};\n\nfunction successClear(value) {\n    clearTimeout(this.handle);\n    return value;\n}\n\nfunction failureClear(reason) {\n    clearTimeout(this.handle);\n    throw reason;\n}\n\nPromise.prototype.timeout = function (ms, message) {\n    ms = +ms;\n    var ret, parent;\n\n    var handleWrapper = new HandleWrapper(setTimeout(function timeoutTimeout() {\n        if (ret.isPending()) {\n            afterTimeout(ret, message, parent);\n        }\n    }, ms));\n\n    if (debug.cancellation()) {\n        parent = this.then();\n        ret = parent._then(successClear, failureClear,\n                            undefined, handleWrapper, undefined);\n        ret._setOnCancel(handleWrapper);\n    } else {\n        ret = this._then(successClear, failureClear,\n                            undefined, handleWrapper, undefined);\n    }\n\n    return ret;\n};\n\n};\n"]}