{"version":3,"sources":["../../../../../../../node_modules/npm/node_modules/bluebird/js/release/thenables.js"],"names":["module","exports","Promise","INTERNAL","util","require","errorObj","isObject","tryConvertToPromise","obj","context","then","getThen","_pushContext","ret","reject","e","_popContext","isAnyBluebirdPromise","_then","_fulfill","_reject","undefined","doThenable","doGetThen","hasProp","hasOwnProperty","call","x","promise","_captureStackTrace","synchronous","result","tryCatch","resolve","_rejectCallback","value","_resolveCallback","reason"],"mappings":"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","file":"thenables.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar util = require(\"./util\");\nvar errorObj = util.errorObj;\nvar isObject = util.isObject;\n\nfunction tryConvertToPromise(obj, context) {\n    if (isObject(obj)) {\n        if (obj instanceof Promise) return obj;\n        var then = getThen(obj);\n        if (then === errorObj) {\n            if (context) context._pushContext();\n            var ret = Promise.reject(then.e);\n            if (context) context._popContext();\n            return ret;\n        } else if (typeof then === \"function\") {\n            if (isAnyBluebirdPromise(obj)) {\n                var ret = new Promise(INTERNAL);\n                obj._then(\n                    ret._fulfill,\n                    ret._reject,\n                    undefined,\n                    ret,\n                    null\n                );\n                return ret;\n            }\n            return doThenable(obj, then, context);\n        }\n    }\n    return obj;\n}\n\nfunction doGetThen(obj) {\n    return obj.then;\n}\n\nfunction getThen(obj) {\n    try {\n        return doGetThen(obj);\n    } catch (e) {\n        errorObj.e = e;\n        return errorObj;\n    }\n}\n\nvar hasProp = {}.hasOwnProperty;\nfunction isAnyBluebirdPromise(obj) {\n    try {\n        return hasProp.call(obj, \"_promise0\");\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction doThenable(x, then, context) {\n    var promise = new Promise(INTERNAL);\n    var ret = promise;\n    if (context) context._pushContext();\n    promise._captureStackTrace();\n    if (context) context._popContext();\n    var synchronous = true;\n    var result = util.tryCatch(then).call(x, resolve, reject);\n    synchronous = false;\n\n    if (promise && result === errorObj) {\n        promise._rejectCallback(result.e, true, true);\n        promise = null;\n    }\n\n    function resolve(value) {\n        if (!promise) return;\n        promise._resolveCallback(value);\n        promise = null;\n    }\n\n    function reject(reason) {\n        if (!promise) return;\n        promise._rejectCallback(reason, synchronous, true);\n        promise = null;\n    }\n    return ret;\n}\n\nreturn tryConvertToPromise;\n};\n"]}