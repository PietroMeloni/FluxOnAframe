{"version":3,"sources":["../../../../../../../node_modules/npm/node_modules/bluebird/js/release/promise_array.js"],"names":["module","exports","Promise","INTERNAL","tryConvertToPromise","apiRejection","Proxyable","util","require","isArray","toResolutionValue","val","Map","PromiseArray","values","promise","_promise","_propagateFrom","_setOnCancel","_values","_length","_totalResolved","_init","undefined","inherits","prototype","length","init","_","resolveValueIfEmpty","_target","bitField","_bitField","_setAsyncGuaranteed","_then","_reject","_value","_reason","_cancel","asArray","err","classString","reason","_rejectCallback","_resolveEmptyArray","_resolve","_iterate","len","getActualLength","shouldCopyValues","Array","result","isResolved","i","maybePromise","suppressUnhandledRejections","_proxy","_promiseFulfilled","_promiseRejected","_promiseCancelled","_isResolved","value","_fulfill","_isCancellable","index","totalResolved","_resultCancelled","cancel"],"mappings":"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","file":"promise_array.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, INTERNAL, tryConvertToPromise,\n    apiRejection, Proxyable) {\nvar util = require(\"./util\");\nvar isArray = util.isArray;\n\nfunction toResolutionValue(val) {\n    switch(val) {\n    case -2: return [];\n    case -3: return {};\n    case -6: return new Map();\n    }\n}\n\nfunction PromiseArray(values) {\n    var promise = this._promise = new Promise(INTERNAL);\n    if (values instanceof Promise) {\n        promise._propagateFrom(values, 3);\n    }\n    promise._setOnCancel(this);\n    this._values = values;\n    this._length = 0;\n    this._totalResolved = 0;\n    this._init(undefined, -2);\n}\nutil.inherits(PromiseArray, Proxyable);\n\nPromiseArray.prototype.length = function () {\n    return this._length;\n};\n\nPromiseArray.prototype.promise = function () {\n    return this._promise;\n};\n\nPromiseArray.prototype._init = function init(_, resolveValueIfEmpty) {\n    var values = tryConvertToPromise(this._values, this._promise);\n    if (values instanceof Promise) {\n        values = values._target();\n        var bitField = values._bitField;\n        ;\n        this._values = values;\n\n        if (((bitField & 50397184) === 0)) {\n            this._promise._setAsyncGuaranteed();\n            return values._then(\n                init,\n                this._reject,\n                undefined,\n                this,\n                resolveValueIfEmpty\n           );\n        } else if (((bitField & 33554432) !== 0)) {\n            values = values._value();\n        } else if (((bitField & 16777216) !== 0)) {\n            return this._reject(values._reason());\n        } else {\n            return this._cancel();\n        }\n    }\n    values = util.asArray(values);\n    if (values === null) {\n        var err = apiRejection(\n            \"expecting an array or an iterable object but got \" + util.classString(values)).reason();\n        this._promise._rejectCallback(err, false);\n        return;\n    }\n\n    if (values.length === 0) {\n        if (resolveValueIfEmpty === -5) {\n            this._resolveEmptyArray();\n        }\n        else {\n            this._resolve(toResolutionValue(resolveValueIfEmpty));\n        }\n        return;\n    }\n    this._iterate(values);\n};\n\nPromiseArray.prototype._iterate = function(values) {\n    var len = this.getActualLength(values.length);\n    this._length = len;\n    this._values = this.shouldCopyValues() ? new Array(len) : this._values;\n    var result = this._promise;\n    var isResolved = false;\n    var bitField = null;\n    for (var i = 0; i < len; ++i) {\n        var maybePromise = tryConvertToPromise(values[i], result);\n\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            bitField = maybePromise._bitField;\n        } else {\n            bitField = null;\n        }\n\n        if (isResolved) {\n            if (bitField !== null) {\n                maybePromise.suppressUnhandledRejections();\n            }\n        } else if (bitField !== null) {\n            if (((bitField & 50397184) === 0)) {\n                maybePromise._proxy(this, i);\n                this._values[i] = maybePromise;\n            } else if (((bitField & 33554432) !== 0)) {\n                isResolved = this._promiseFulfilled(maybePromise._value(), i);\n            } else if (((bitField & 16777216) !== 0)) {\n                isResolved = this._promiseRejected(maybePromise._reason(), i);\n            } else {\n                isResolved = this._promiseCancelled(i);\n            }\n        } else {\n            isResolved = this._promiseFulfilled(maybePromise, i);\n        }\n    }\n    if (!isResolved) result._setAsyncGuaranteed();\n};\n\nPromiseArray.prototype._isResolved = function () {\n    return this._values === null;\n};\n\nPromiseArray.prototype._resolve = function (value) {\n    this._values = null;\n    this._promise._fulfill(value);\n};\n\nPromiseArray.prototype._cancel = function() {\n    if (this._isResolved() || !this._promise._isCancellable()) return;\n    this._values = null;\n    this._promise._cancel();\n};\n\nPromiseArray.prototype._reject = function (reason) {\n    this._values = null;\n    this._promise._rejectCallback(reason, false);\n};\n\nPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    this._values[index] = value;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        this._resolve(this._values);\n        return true;\n    }\n    return false;\n};\n\nPromiseArray.prototype._promiseCancelled = function() {\n    this._cancel();\n    return true;\n};\n\nPromiseArray.prototype._promiseRejected = function (reason) {\n    this._totalResolved++;\n    this._reject(reason);\n    return true;\n};\n\nPromiseArray.prototype._resultCancelled = function() {\n    if (this._isResolved()) return;\n    var values = this._values;\n    this._cancel();\n    if (values instanceof Promise) {\n        values.cancel();\n    } else {\n        for (var i = 0; i < values.length; ++i) {\n            if (values[i] instanceof Promise) {\n                values[i].cancel();\n            }\n        }\n    }\n};\n\nPromiseArray.prototype.shouldCopyValues = function () {\n    return true;\n};\n\nPromiseArray.prototype.getActualLength = function (len) {\n    return len;\n};\n\nreturn PromiseArray;\n};\n"]}