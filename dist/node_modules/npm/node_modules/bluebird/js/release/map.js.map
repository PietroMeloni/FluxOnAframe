{"version":3,"sources":["../../../../../../../node_modules/npm/node_modules/bluebird/js/release/map.js"],"names":["module","exports","Promise","PromiseArray","apiRejection","tryConvertToPromise","INTERNAL","debug","getDomain","_getDomain","util","require","tryCatch","errorObj","async","_async","MappingPromiseArray","promises","fn","limit","_filter","constructor$","_promise","_captureStackTrace","domain","_callback","domainBind","_preservedValues","Array","length","_limit","_inFlight","_queue","invoke","_asyncInit","undefined","inherits","prototype","_init$","_init","_promiseFulfilled","value","index","values","_values","preservedValues","_drainQueue","_isResolved","push","promise","callback","receiver","_boundValue","_pushContext","ret","call","promiseCreated","_popContext","checkForgottenReturns","_reject","e","maybePromise","_target","bitField","_bitField","_proxy","_value","_reason","_cancel","totalResolved","_totalResolved","_resolve","queue","pop","booleans","len","j","i","map","options","classString","concurrency","reject","TypeError","isFinite"],"mappings":"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","file":"map.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL,\n                          debug) {\nvar getDomain = Promise._getDomain;\nvar util = require(\"./util\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar async = Promise._async;\n\nfunction MappingPromiseArray(promises, fn, limit, _filter) {\n    this.constructor$(promises);\n    this._promise._captureStackTrace();\n    var domain = getDomain();\n    this._callback = domain === null ? fn : util.domainBind(domain, fn);\n    this._preservedValues = _filter === INTERNAL\n        ? new Array(this.length())\n        : null;\n    this._limit = limit;\n    this._inFlight = 0;\n    this._queue = [];\n    async.invoke(this._asyncInit, this, undefined);\n}\nutil.inherits(MappingPromiseArray, PromiseArray);\n\nMappingPromiseArray.prototype._asyncInit = function() {\n    this._init$(undefined, -2);\n};\n\nMappingPromiseArray.prototype._init = function () {};\n\nMappingPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    var values = this._values;\n    var length = this.length();\n    var preservedValues = this._preservedValues;\n    var limit = this._limit;\n\n    if (index < 0) {\n        index = (index * -1) - 1;\n        values[index] = value;\n        if (limit >= 1) {\n            this._inFlight--;\n            this._drainQueue();\n            if (this._isResolved()) return true;\n        }\n    } else {\n        if (limit >= 1 && this._inFlight >= limit) {\n            values[index] = value;\n            this._queue.push(index);\n            return false;\n        }\n        if (preservedValues !== null) preservedValues[index] = value;\n\n        var promise = this._promise;\n        var callback = this._callback;\n        var receiver = promise._boundValue();\n        promise._pushContext();\n        var ret = tryCatch(callback).call(receiver, value, index, length);\n        var promiseCreated = promise._popContext();\n        debug.checkForgottenReturns(\n            ret,\n            promiseCreated,\n            preservedValues !== null ? \"Promise.filter\" : \"Promise.map\",\n            promise\n        );\n        if (ret === errorObj) {\n            this._reject(ret.e);\n            return true;\n        }\n\n        var maybePromise = tryConvertToPromise(ret, this._promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            var bitField = maybePromise._bitField;\n            ;\n            if (((bitField & 50397184) === 0)) {\n                if (limit >= 1) this._inFlight++;\n                values[index] = maybePromise;\n                maybePromise._proxy(this, (index + 1) * -1);\n                return false;\n            } else if (((bitField & 33554432) !== 0)) {\n                ret = maybePromise._value();\n            } else if (((bitField & 16777216) !== 0)) {\n                this._reject(maybePromise._reason());\n                return true;\n            } else {\n                this._cancel();\n                return true;\n            }\n        }\n        values[index] = ret;\n    }\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= length) {\n        if (preservedValues !== null) {\n            this._filter(values, preservedValues);\n        } else {\n            this._resolve(values);\n        }\n        return true;\n    }\n    return false;\n};\n\nMappingPromiseArray.prototype._drainQueue = function () {\n    var queue = this._queue;\n    var limit = this._limit;\n    var values = this._values;\n    while (queue.length > 0 && this._inFlight < limit) {\n        if (this._isResolved()) return;\n        var index = queue.pop();\n        this._promiseFulfilled(values[index], index);\n    }\n};\n\nMappingPromiseArray.prototype._filter = function (booleans, values) {\n    var len = values.length;\n    var ret = new Array(len);\n    var j = 0;\n    for (var i = 0; i < len; ++i) {\n        if (booleans[i]) ret[j++] = values[i];\n    }\n    ret.length = j;\n    this._resolve(ret);\n};\n\nMappingPromiseArray.prototype.preservedValues = function () {\n    return this._preservedValues;\n};\n\nfunction map(promises, fn, options, _filter) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n\n    var limit = 0;\n    if (options !== undefined) {\n        if (typeof options === \"object\" && options !== null) {\n            if (typeof options.concurrency !== \"number\") {\n                return Promise.reject(\n                    new TypeError(\"'concurrency' must be a number but it is \" +\n                                    util.classString(options.concurrency)));\n            }\n            limit = options.concurrency;\n        } else {\n            return Promise.reject(new TypeError(\n                            \"options argument must be an object but it is \" +\n                             util.classString(options)));\n        }\n    }\n    limit = typeof limit === \"number\" &&\n        isFinite(limit) && limit >= 1 ? limit : 0;\n    return new MappingPromiseArray(promises, fn, limit, _filter).promise();\n}\n\nPromise.prototype.map = function (fn, options) {\n    return map(this, fn, options, null);\n};\n\nPromise.map = function (promises, fn, options, _filter) {\n    return map(promises, fn, options, _filter);\n};\n\n\n};\n"]}