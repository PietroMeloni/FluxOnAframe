{"version":3,"sources":["../../../../../../../node_modules/npm/node_modules/bluebird/js/release/promisify.js"],"names":["module","exports","Promise","INTERNAL","THIS","util","require","nodebackForPromise","withAppended","maybeWrapAsError","canEvaluate","TypeError","defaultSuffix","defaultPromisified","__isPromisified__","noCopyProps","noCopyPropsPattern","RegExp","join","defaultFilter","name","isIdentifier","charAt","propsFilter","key","test","isPromisified","fn","e","hasPromisified","obj","suffix","val","getDataPropertyOrDefault","checkValid","ret","suffixRegexp","i","length","keyWithoutAsyncSuffix","replace","j","promisifiableMethods","filter","keys","inheritedDataKeys","value","passesDefaultFilter","push","escapeIdentRegex","str","makeNodePromisifiedEval","switchCaseArgumentOrder","likelyArgumentCount","min","Math","max","argumentSequence","argumentCount","filledRange","parameterDeclaration","parameterCount","callback","receiver","originalName","_","multiArgs","newParameterCount","argumentOrder","shouldProxyThis","generateCallForArgumentCount","count","args","comma","undefined","generateArgumentSwitchCase","getFunctionCode","body","Function","tryCatch","errorObj","notEnumerableProp","makeNodePromisifiedClosure","__","defaultThis","method","promisified","_receiver","promise","_captureStackTrace","cb","apply","arguments","_rejectCallback","_isFateSealed","_setAsyncGuaranteed","makeNodePromisified","promisifyAll","promisifier","methods","len","promisifiedKey","toFastProperties","promisify","options","classString","Object","context","copyDescriptors","target","RangeError","isClass","prototype"],"mappings":"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","file":"promisify.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar THIS = {};\nvar util = require(\"./util\");\nvar nodebackForPromise = require(\"./nodeback\");\nvar withAppended = util.withAppended;\nvar maybeWrapAsError = util.maybeWrapAsError;\nvar canEvaluate = util.canEvaluate;\nvar TypeError = require(\"./errors\").TypeError;\nvar defaultSuffix = \"Async\";\nvar defaultPromisified = {__isPromisified__: true};\nvar noCopyProps = [\n    \"arity\",    \"length\",\n    \"name\",\n    \"arguments\",\n    \"caller\",\n    \"callee\",\n    \"prototype\",\n    \"__isPromisified__\"\n];\nvar noCopyPropsPattern = new RegExp(\"^(?:\" + noCopyProps.join(\"|\") + \")$\");\n\nvar defaultFilter = function(name) {\n    return util.isIdentifier(name) &&\n        name.charAt(0) !== \"_\" &&\n        name !== \"constructor\";\n};\n\nfunction propsFilter(key) {\n    return !noCopyPropsPattern.test(key);\n}\n\nfunction isPromisified(fn) {\n    try {\n        return fn.__isPromisified__ === true;\n    }\n    catch (e) {\n        return false;\n    }\n}\n\nfunction hasPromisified(obj, key, suffix) {\n    var val = util.getDataPropertyOrDefault(obj, key + suffix,\n                                            defaultPromisified);\n    return val ? isPromisified(val) : false;\n}\nfunction checkValid(ret, suffix, suffixRegexp) {\n    for (var i = 0; i < ret.length; i += 2) {\n        var key = ret[i];\n        if (suffixRegexp.test(key)) {\n            var keyWithoutAsyncSuffix = key.replace(suffixRegexp, \"\");\n            for (var j = 0; j < ret.length; j += 2) {\n                if (ret[j] === keyWithoutAsyncSuffix) {\n                    throw new TypeError(\"Cannot promisify an API that has normal methods with '%s'-suffix\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\"\n                        .replace(\"%s\", suffix));\n                }\n            }\n        }\n    }\n}\n\nfunction promisifiableMethods(obj, suffix, suffixRegexp, filter) {\n    var keys = util.inheritedDataKeys(obj);\n    var ret = [];\n    for (var i = 0; i < keys.length; ++i) {\n        var key = keys[i];\n        var value = obj[key];\n        var passesDefaultFilter = filter === defaultFilter\n            ? true : defaultFilter(key, value, obj);\n        if (typeof value === \"function\" &&\n            !isPromisified(value) &&\n            !hasPromisified(obj, key, suffix) &&\n            filter(key, value, obj, passesDefaultFilter)) {\n            ret.push(key, value);\n        }\n    }\n    checkValid(ret, suffix, suffixRegexp);\n    return ret;\n}\n\nvar escapeIdentRegex = function(str) {\n    return str.replace(/([$])/, \"\\\\$\");\n};\n\nvar makeNodePromisifiedEval;\nif (!false) {\nvar switchCaseArgumentOrder = function(likelyArgumentCount) {\n    var ret = [likelyArgumentCount];\n    var min = Math.max(0, likelyArgumentCount - 1 - 3);\n    for(var i = likelyArgumentCount - 1; i >= min; --i) {\n        ret.push(i);\n    }\n    for(var i = likelyArgumentCount + 1; i <= 3; ++i) {\n        ret.push(i);\n    }\n    return ret;\n};\n\nvar argumentSequence = function(argumentCount) {\n    return util.filledRange(argumentCount, \"_arg\", \"\");\n};\n\nvar parameterDeclaration = function(parameterCount) {\n    return util.filledRange(\n        Math.max(parameterCount, 3), \"_arg\", \"\");\n};\n\nvar parameterCount = function(fn) {\n    if (typeof fn.length === \"number\") {\n        return Math.max(Math.min(fn.length, 1023 + 1), 0);\n    }\n    return 0;\n};\n\nmakeNodePromisifiedEval =\nfunction(callback, receiver, originalName, fn, _, multiArgs) {\n    var newParameterCount = Math.max(0, parameterCount(fn) - 1);\n    var argumentOrder = switchCaseArgumentOrder(newParameterCount);\n    var shouldProxyThis = typeof callback === \"string\" || receiver === THIS;\n\n    function generateCallForArgumentCount(count) {\n        var args = argumentSequence(count).join(\", \");\n        var comma = count > 0 ? \", \" : \"\";\n        var ret;\n        if (shouldProxyThis) {\n            ret = \"ret = callback.call(this, {{args}}, nodeback); break;\\n\";\n        } else {\n            ret = receiver === undefined\n                ? \"ret = callback({{args}}, nodeback); break;\\n\"\n                : \"ret = callback.call(receiver, {{args}}, nodeback); break;\\n\";\n        }\n        return ret.replace(\"{{args}}\", args).replace(\", \", comma);\n    }\n\n    function generateArgumentSwitchCase() {\n        var ret = \"\";\n        for (var i = 0; i < argumentOrder.length; ++i) {\n            ret += \"case \" + argumentOrder[i] +\":\" +\n                generateCallForArgumentCount(argumentOrder[i]);\n        }\n\n        ret += \"                                                             \\n\\\n        default:                                                             \\n\\\n            var args = new Array(len + 1);                                   \\n\\\n            var i = 0;                                                       \\n\\\n            for (var i = 0; i < len; ++i) {                                  \\n\\\n               args[i] = arguments[i];                                       \\n\\\n            }                                                                \\n\\\n            args[i] = nodeback;                                              \\n\\\n            [CodeForCall]                                                    \\n\\\n            break;                                                           \\n\\\n        \".replace(\"[CodeForCall]\", (shouldProxyThis\n                                ? \"ret = callback.apply(this, args);\\n\"\n                                : \"ret = callback.apply(receiver, args);\\n\"));\n        return ret;\n    }\n\n    var getFunctionCode = typeof callback === \"string\"\n                                ? (\"this != null ? this['\"+callback+\"'] : fn\")\n                                : \"fn\";\n    var body = \"'use strict';                                                \\n\\\n        var ret = function (Parameters) {                                    \\n\\\n            'use strict';                                                    \\n\\\n            var len = arguments.length;                                      \\n\\\n            var promise = new Promise(INTERNAL);                             \\n\\\n            promise._captureStackTrace();                                    \\n\\\n            var nodeback = nodebackForPromise(promise, \" + multiArgs + \");   \\n\\\n            var ret;                                                         \\n\\\n            var callback = tryCatch([GetFunctionCode]);                      \\n\\\n            switch(len) {                                                    \\n\\\n                [CodeForSwitchCase]                                          \\n\\\n            }                                                                \\n\\\n            if (ret === errorObj) {                                          \\n\\\n                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\\n\\\n            }                                                                \\n\\\n            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \\n\\\n            return promise;                                                  \\n\\\n        };                                                                   \\n\\\n        notEnumerableProp(ret, '__isPromisified__', true);                   \\n\\\n        return ret;                                                          \\n\\\n    \".replace(\"[CodeForSwitchCase]\", generateArgumentSwitchCase())\n        .replace(\"[GetFunctionCode]\", getFunctionCode);\n    body = body.replace(\"Parameters\", parameterDeclaration(newParameterCount));\n    return new Function(\"Promise\",\n                        \"fn\",\n                        \"receiver\",\n                        \"withAppended\",\n                        \"maybeWrapAsError\",\n                        \"nodebackForPromise\",\n                        \"tryCatch\",\n                        \"errorObj\",\n                        \"notEnumerableProp\",\n                        \"INTERNAL\",\n                        body)(\n                    Promise,\n                    fn,\n                    receiver,\n                    withAppended,\n                    maybeWrapAsError,\n                    nodebackForPromise,\n                    util.tryCatch,\n                    util.errorObj,\n                    util.notEnumerableProp,\n                    INTERNAL);\n};\n}\n\nfunction makeNodePromisifiedClosure(callback, receiver, _, fn, __, multiArgs) {\n    var defaultThis = (function() {return this;})();\n    var method = callback;\n    if (typeof method === \"string\") {\n        callback = fn;\n    }\n    function promisified() {\n        var _receiver = receiver;\n        if (receiver === THIS) _receiver = this;\n        var promise = new Promise(INTERNAL);\n        promise._captureStackTrace();\n        var cb = typeof method === \"string\" && this !== defaultThis\n            ? this[method] : callback;\n        var fn = nodebackForPromise(promise, multiArgs);\n        try {\n            cb.apply(_receiver, withAppended(arguments, fn));\n        } catch(e) {\n            promise._rejectCallback(maybeWrapAsError(e), true, true);\n        }\n        if (!promise._isFateSealed()) promise._setAsyncGuaranteed();\n        return promise;\n    }\n    util.notEnumerableProp(promisified, \"__isPromisified__\", true);\n    return promisified;\n}\n\nvar makeNodePromisified = canEvaluate\n    ? makeNodePromisifiedEval\n    : makeNodePromisifiedClosure;\n\nfunction promisifyAll(obj, suffix, filter, promisifier, multiArgs) {\n    var suffixRegexp = new RegExp(escapeIdentRegex(suffix) + \"$\");\n    var methods =\n        promisifiableMethods(obj, suffix, suffixRegexp, filter);\n\n    for (var i = 0, len = methods.length; i < len; i+= 2) {\n        var key = methods[i];\n        var fn = methods[i+1];\n        var promisifiedKey = key + suffix;\n        if (promisifier === makeNodePromisified) {\n            obj[promisifiedKey] =\n                makeNodePromisified(key, THIS, key, fn, suffix, multiArgs);\n        } else {\n            var promisified = promisifier(fn, function() {\n                return makeNodePromisified(key, THIS, key,\n                                           fn, suffix, multiArgs);\n            });\n            util.notEnumerableProp(promisified, \"__isPromisified__\", true);\n            obj[promisifiedKey] = promisified;\n        }\n    }\n    util.toFastProperties(obj);\n    return obj;\n}\n\nfunction promisify(callback, receiver, multiArgs) {\n    return makeNodePromisified(callback, receiver, undefined,\n                                callback, null, multiArgs);\n}\n\nPromise.promisify = function (fn, options) {\n    if (typeof fn !== \"function\") {\n        throw new TypeError(\"expecting a function but got \" + util.classString(fn));\n    }\n    if (isPromisified(fn)) {\n        return fn;\n    }\n    options = Object(options);\n    var receiver = options.context === undefined ? THIS : options.context;\n    var multiArgs = !!options.multiArgs;\n    var ret = promisify(fn, receiver, multiArgs);\n    util.copyDescriptors(fn, ret, propsFilter);\n    return ret;\n};\n\nPromise.promisifyAll = function (target, options) {\n    if (typeof target !== \"function\" && typeof target !== \"object\") {\n        throw new TypeError(\"the target of promisifyAll must be an object or a function\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    options = Object(options);\n    var multiArgs = !!options.multiArgs;\n    var suffix = options.suffix;\n    if (typeof suffix !== \"string\") suffix = defaultSuffix;\n    var filter = options.filter;\n    if (typeof filter !== \"function\") filter = defaultFilter;\n    var promisifier = options.promisifier;\n    if (typeof promisifier !== \"function\") promisifier = makeNodePromisified;\n\n    if (!util.isIdentifier(suffix)) {\n        throw new RangeError(\"suffix must be a valid identifier\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n\n    var keys = util.inheritedDataKeys(target);\n    for (var i = 0; i < keys.length; ++i) {\n        var value = target[keys[i]];\n        if (keys[i] !== \"constructor\" &&\n            util.isClass(value)) {\n            promisifyAll(value.prototype, suffix, filter, promisifier,\n                multiArgs);\n            promisifyAll(value, suffix, filter, promisifier, multiArgs);\n        }\n    }\n\n    return promisifyAll(target, suffix, filter, promisifier, multiArgs);\n};\n};\n\n"]}