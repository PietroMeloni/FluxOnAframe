{"version":3,"sources":["../../../../../../../node_modules/npm/node_modules/bluebird/js/release/context.js"],"names":["module","exports","Promise","longStackTraces","contextStack","prototype","_promiseCreated","_pushContext","_popContext","_peekContext","Context","_trace","CapturedTrace","peekContext","undefined","push","trace","pop","ret","createContext","lastIndex","length","create","deactivateLongStackTraces","activateLongStackTraces","Promise_pushContext","Promise_popContext","Promise_PeekContext","Promise_peekContext","Promise_promiseCreated","ctx"],"mappings":"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","file":"context.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise) {\nvar longStackTraces = false;\nvar contextStack = [];\n\nPromise.prototype._promiseCreated = function() {};\nPromise.prototype._pushContext = function() {};\nPromise.prototype._popContext = function() {return null;};\nPromise._peekContext = Promise.prototype._peekContext = function() {};\n\nfunction Context() {\n    this._trace = new Context.CapturedTrace(peekContext());\n}\nContext.prototype._pushContext = function () {\n    if (this._trace !== undefined) {\n        this._trace._promiseCreated = null;\n        contextStack.push(this._trace);\n    }\n};\n\nContext.prototype._popContext = function () {\n    if (this._trace !== undefined) {\n        var trace = contextStack.pop();\n        var ret = trace._promiseCreated;\n        trace._promiseCreated = null;\n        return ret;\n    }\n    return null;\n};\n\nfunction createContext() {\n    if (longStackTraces) return new Context();\n}\n\nfunction peekContext() {\n    var lastIndex = contextStack.length - 1;\n    if (lastIndex >= 0) {\n        return contextStack[lastIndex];\n    }\n    return undefined;\n}\nContext.CapturedTrace = null;\nContext.create = createContext;\nContext.deactivateLongStackTraces = function() {};\nContext.activateLongStackTraces = function() {\n    var Promise_pushContext = Promise.prototype._pushContext;\n    var Promise_popContext = Promise.prototype._popContext;\n    var Promise_PeekContext = Promise._peekContext;\n    var Promise_peekContext = Promise.prototype._peekContext;\n    var Promise_promiseCreated = Promise.prototype._promiseCreated;\n    Context.deactivateLongStackTraces = function() {\n        Promise.prototype._pushContext = Promise_pushContext;\n        Promise.prototype._popContext = Promise_popContext;\n        Promise._peekContext = Promise_PeekContext;\n        Promise.prototype._peekContext = Promise_peekContext;\n        Promise.prototype._promiseCreated = Promise_promiseCreated;\n        longStackTraces = false;\n    };\n    longStackTraces = true;\n    Promise.prototype._pushContext = Context.prototype._pushContext;\n    Promise.prototype._popContext = Context.prototype._popContext;\n    Promise._peekContext = Promise.prototype._peekContext = peekContext;\n    Promise.prototype._promiseCreated = function() {\n        var ctx = this._peekContext();\n        if (ctx && ctx._promiseCreated == null) ctx._promiseCreated = this;\n    };\n};\nreturn Context;\n};\n"]}