{"version":3,"sources":["../../../../../../../node_modules/npm/node_modules/bluebird/js/release/finally.js"],"names":["module","exports","Promise","tryConvertToPromise","NEXT_FILTER","util","require","CancellationError","errorObj","catchFilter","PassThroughHandlerContext","promise","type","handler","called","cancelPromise","prototype","isFinallyHandler","FinallyHandlerCancelReaction","finallyHandler","_resultCancelled","checkCancel","ctx","reason","arguments","length","_reject","_cancel","succeed","call","_target","_settledValue","fail","e","reasonOrValue","ret","_boundValue","undefined","_setReturnedNonUndefined","maybePromise","_isCancelled","_attachExtraTrace","isPending","_attachCancellationCallback","_then","isRejected","_passThrough","success","then","lastly","tap","tapCatch","handlerOrPredicate","len","catchInstances","Array","j","i","item","isObject","reject","TypeError","classString"],"mappings":"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","file":"finally.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, tryConvertToPromise, NEXT_FILTER) {\nvar util = require(\"./util\");\nvar CancellationError = Promise.CancellationError;\nvar errorObj = util.errorObj;\nvar catchFilter = require(\"./catch_filter\")(NEXT_FILTER);\n\nfunction PassThroughHandlerContext(promise, type, handler) {\n    this.promise = promise;\n    this.type = type;\n    this.handler = handler;\n    this.called = false;\n    this.cancelPromise = null;\n}\n\nPassThroughHandlerContext.prototype.isFinallyHandler = function() {\n    return this.type === 0;\n};\n\nfunction FinallyHandlerCancelReaction(finallyHandler) {\n    this.finallyHandler = finallyHandler;\n}\n\nFinallyHandlerCancelReaction.prototype._resultCancelled = function() {\n    checkCancel(this.finallyHandler);\n};\n\nfunction checkCancel(ctx, reason) {\n    if (ctx.cancelPromise != null) {\n        if (arguments.length > 1) {\n            ctx.cancelPromise._reject(reason);\n        } else {\n            ctx.cancelPromise._cancel();\n        }\n        ctx.cancelPromise = null;\n        return true;\n    }\n    return false;\n}\n\nfunction succeed() {\n    return finallyHandler.call(this, this.promise._target()._settledValue());\n}\nfunction fail(reason) {\n    if (checkCancel(this, reason)) return;\n    errorObj.e = reason;\n    return errorObj;\n}\nfunction finallyHandler(reasonOrValue) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    if (!this.called) {\n        this.called = true;\n        var ret = this.isFinallyHandler()\n            ? handler.call(promise._boundValue())\n            : handler.call(promise._boundValue(), reasonOrValue);\n        if (ret === NEXT_FILTER) {\n            return ret;\n        } else if (ret !== undefined) {\n            promise._setReturnedNonUndefined();\n            var maybePromise = tryConvertToPromise(ret, promise);\n            if (maybePromise instanceof Promise) {\n                if (this.cancelPromise != null) {\n                    if (maybePromise._isCancelled()) {\n                        var reason =\n                            new CancellationError(\"late cancellation observer\");\n                        promise._attachExtraTrace(reason);\n                        errorObj.e = reason;\n                        return errorObj;\n                    } else if (maybePromise.isPending()) {\n                        maybePromise._attachCancellationCallback(\n                            new FinallyHandlerCancelReaction(this));\n                    }\n                }\n                return maybePromise._then(\n                    succeed, fail, undefined, this, undefined);\n            }\n        }\n    }\n\n    if (promise.isRejected()) {\n        checkCancel(this);\n        errorObj.e = reasonOrValue;\n        return errorObj;\n    } else {\n        checkCancel(this);\n        return reasonOrValue;\n    }\n}\n\nPromise.prototype._passThrough = function(handler, type, success, fail) {\n    if (typeof handler !== \"function\") return this.then();\n    return this._then(success,\n                      fail,\n                      undefined,\n                      new PassThroughHandlerContext(this, type, handler),\n                      undefined);\n};\n\nPromise.prototype.lastly =\nPromise.prototype[\"finally\"] = function (handler) {\n    return this._passThrough(handler,\n                             0,\n                             finallyHandler,\n                             finallyHandler);\n};\n\n\nPromise.prototype.tap = function (handler) {\n    return this._passThrough(handler, 1, finallyHandler);\n};\n\nPromise.prototype.tapCatch = function (handlerOrPredicate) {\n    var len = arguments.length;\n    if(len === 1) {\n        return this._passThrough(handlerOrPredicate,\n                                 1,\n                                 undefined,\n                                 finallyHandler);\n    } else {\n         var catchInstances = new Array(len - 1),\n            j = 0, i;\n        for (i = 0; i < len - 1; ++i) {\n            var item = arguments[i];\n            if (util.isObject(item)) {\n                catchInstances[j++] = item;\n            } else {\n                return Promise.reject(new TypeError(\n                    \"tapCatch statement predicate: \"\n                    + \"expecting an object but got \" + util.classString(item)\n                ));\n            }\n        }\n        catchInstances.length = j;\n        var handler = arguments[i];\n        return this._passThrough(catchFilter(catchInstances, handler, this),\n                                 1,\n                                 undefined,\n                                 finallyHandler);\n    }\n\n};\n\nreturn PassThroughHandlerContext;\n};\n"]}