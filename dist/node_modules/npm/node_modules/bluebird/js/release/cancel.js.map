{"version":3,"sources":["../../../../../../../node_modules/npm/node_modules/bluebird/js/release/cancel.js"],"names":["module","exports","Promise","PromiseArray","apiRejection","debug","util","require","tryCatch","errorObj","async","_async","prototype","cancel","cancellation","_warn","promise","child","_isCancellable","_cancelBy","_isFollowing","_followee","_cancelBranched","parent","_cancellationParent","_setWillBeCancelled","_branchHasCancelled","_branchesRemainingToCancel","_enoughBranchesHaveCancelled","undefined","canceller","_invokeOnCancel","_cancel","_setCancelled","invoke","_cancelPromises","_length","_settlePromises","_unsetOnCancel","_onCancelField","isPending","_isCancelled","isCancellable","isCancelled","_doInvokeOnCancel","onCancelCallback","internalOnly","isArray","i","length","e","call","_boundValue","_attachExtraTrace","throwLater","_resultCancelled","_onCancel","_invokeInternalOnCancel"],"mappings":"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","file":"cancel.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, PromiseArray, apiRejection, debug) {\nvar util = require(\"./util\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar async = Promise._async;\n\nPromise.prototype[\"break\"] = Promise.prototype.cancel = function() {\n    if (!debug.cancellation()) return this._warn(\"cancellation is disabled\");\n\n    var promise = this;\n    var child = promise;\n    while (promise._isCancellable()) {\n        if (!promise._cancelBy(child)) {\n            if (child._isFollowing()) {\n                child._followee().cancel();\n            } else {\n                child._cancelBranched();\n            }\n            break;\n        }\n\n        var parent = promise._cancellationParent;\n        if (parent == null || !parent._isCancellable()) {\n            if (promise._isFollowing()) {\n                promise._followee().cancel();\n            } else {\n                promise._cancelBranched();\n            }\n            break;\n        } else {\n            if (promise._isFollowing()) promise._followee().cancel();\n            promise._setWillBeCancelled();\n            child = promise;\n            promise = parent;\n        }\n    }\n};\n\nPromise.prototype._branchHasCancelled = function() {\n    this._branchesRemainingToCancel--;\n};\n\nPromise.prototype._enoughBranchesHaveCancelled = function() {\n    return this._branchesRemainingToCancel === undefined ||\n           this._branchesRemainingToCancel <= 0;\n};\n\nPromise.prototype._cancelBy = function(canceller) {\n    if (canceller === this) {\n        this._branchesRemainingToCancel = 0;\n        this._invokeOnCancel();\n        return true;\n    } else {\n        this._branchHasCancelled();\n        if (this._enoughBranchesHaveCancelled()) {\n            this._invokeOnCancel();\n            return true;\n        }\n    }\n    return false;\n};\n\nPromise.prototype._cancelBranched = function() {\n    if (this._enoughBranchesHaveCancelled()) {\n        this._cancel();\n    }\n};\n\nPromise.prototype._cancel = function() {\n    if (!this._isCancellable()) return;\n    this._setCancelled();\n    async.invoke(this._cancelPromises, this, undefined);\n};\n\nPromise.prototype._cancelPromises = function() {\n    if (this._length() > 0) this._settlePromises();\n};\n\nPromise.prototype._unsetOnCancel = function() {\n    this._onCancelField = undefined;\n};\n\nPromise.prototype._isCancellable = function() {\n    return this.isPending() && !this._isCancelled();\n};\n\nPromise.prototype.isCancellable = function() {\n    return this.isPending() && !this.isCancelled();\n};\n\nPromise.prototype._doInvokeOnCancel = function(onCancelCallback, internalOnly) {\n    if (util.isArray(onCancelCallback)) {\n        for (var i = 0; i < onCancelCallback.length; ++i) {\n            this._doInvokeOnCancel(onCancelCallback[i], internalOnly);\n        }\n    } else if (onCancelCallback !== undefined) {\n        if (typeof onCancelCallback === \"function\") {\n            if (!internalOnly) {\n                var e = tryCatch(onCancelCallback).call(this._boundValue());\n                if (e === errorObj) {\n                    this._attachExtraTrace(e.e);\n                    async.throwLater(e.e);\n                }\n            }\n        } else {\n            onCancelCallback._resultCancelled(this);\n        }\n    }\n};\n\nPromise.prototype._invokeOnCancel = function() {\n    var onCancelCallback = this._onCancel();\n    this._unsetOnCancel();\n    async.invoke(this._doInvokeOnCancel, this, onCancelCallback);\n};\n\nPromise.prototype._invokeInternalOnCancel = function() {\n    if (this._isCancellable()) {\n        this._doInvokeOnCancel(this._onCancel(), true);\n        this._unsetOnCancel();\n    }\n};\n\nPromise.prototype._resultCancelled = function() {\n    this.cancel();\n};\n\n};\n"]}