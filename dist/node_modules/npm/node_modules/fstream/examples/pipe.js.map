{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/fstream/examples/pipe.js"],"names":["fstream","require","path","r","Reader","dirname","__dirname","filter","basename","match","w","Writer","resolve","type","indent","on","appears","console","error","entry","foggy","p","depth","_paused","parent","Error","missile","runaway","liftFog","who","clearTimeout","resume","ended","once","c","process","nextTick","pause","setTimeout","e","Math","random","length","slice","attacks","log","pipe"],"mappings":";;;;AAAA,IAAIA,UAAUC,QAAQ,eAAR,CAAd;AACA,IAAIC,OAAOD,QAAQ,MAAR,CAAX;;AAEA,IAAIE,IAAIH,QAAQI,MAAR,CAAe;AACrBF,QAAMA,KAAKG,OAAL,CAAaC,SAAb,CADe;AAErBC,UAAQ,kBAAY;AAClB,WAAO,CAAC,KAAKC,QAAL,CAAcC,KAAd,CAAoB,KAApB,CAAD,IACL,CAAC,KAAKD,QAAL,CAAcC,KAAd,CAAoB,gBAApB,CADI,IAEL,CAAC,KAAKD,QAAL,CAAcC,KAAd,CAAoB,aAApB,CAFH;AAGD;AANoB,CAAf,CAAR;;AASA,IAAIC,IAAIV,QAAQW,MAAR,CAAe;AACrBT,QAAMA,KAAKU,OAAL,CAAaN,SAAb,EAAwB,WAAxB,CADe;AAErBO,QAAM;AAFe,CAAf,CAAR;;AAKA,IAAIC,SAAS,EAAb;;AAEAX,EAAEY,EAAF,CAAK,OAAL,EAAcC,OAAd;AACAb,EAAEY,EAAF,CAAK,OAAL,EAAc,YAAY;AACxBE,UAAQC,KAAR,CAAc,iBAAd,EAAiCf,EAAED,IAAnC;AACD,CAFD;;AAIA,SAASc,OAAT,CAAkBG,KAAlB,EAAyB;AACvBF,UAAQC,KAAR,CAAcJ,SAAS,eAAvB,EAAwCK,MAAMN,IAA9C,EAAoDM,MAAMX,QAA1D,UAA2EW,MAAMX,QAAjF,GAA2FW,KAA3F;AACA,MAAIC,KAAJ,EAAW;AACTH,YAAQC,KAAR,CAAc,QAAd;AACA,QAAIG,IAAIF,KAAR;AACA,OAAG;AACDF,cAAQC,KAAR,CAAcG,EAAEC,KAAhB,EAAuBD,EAAEnB,IAAzB,EAA+BmB,EAAEE,OAAjC;AACAF,UAAIA,EAAEG,MAAN;AACD,KAHD,QAGSH,CAHT;;AAKA,UAAM,IAAII,KAAJ,CAAU,2CAAV,CAAN;AACD;AACDX,YAAU,IAAV;AACAK,QAAMJ,EAAN,CAAS,MAAT,EAAiBW,QAAQP,KAAR,CAAjB;AACAA,QAAMJ,EAAN,CAAS,KAAT,EAAgBY,QAAQR,KAAR,CAAhB;AACAA,QAAMJ,EAAN,CAAS,OAAT,EAAkBC,OAAlB;AACD;;AAED,IAAII,KAAJ;AACA,SAASM,OAAT,CAAkBP,KAAlB,EAAyB;AACvB,WAASS,OAAT,CAAkBC,GAAlB,EAAuB;AACrB,QAAI,CAACT,KAAL,EAAY;AACZ,QAAIS,GAAJ,EAAS;AACPZ,cAAQC,KAAR,CAAc,sBAAd,EAAsCW,OAAOA,IAAI3B,IAAjD;AACD,KAFD,MAEO;AACLe,cAAQC,KAAR,CAAc,oBAAd;AACD;AACDD,YAAQC,KAAR,CAAc,wBAAd;AACAY,iBAAaV,KAAb;AACAA,YAAQ,IAAR;AACA,QAAID,MAAMI,OAAV,EAAmBJ,MAAMY,MAAN;AACpB;;AAED,MAAIZ,MAAMN,IAAN,KAAe,WAAnB,EAAgC;AAC9B,QAAImB,QAAQ,KAAZ;AACAb,UAAMc,IAAN,CAAW,KAAX,EAAkB,YAAY;AAAED,cAAQ,IAAR;AAAc,KAA9C;AACA,WAAO,UAAUE,CAAV,EAAa;AAClB;AACA;AACAC,cAAQC,QAAR,CAAiB,YAAY;AAC3B,YAAI,CAAChB,KAAD,IAAU,CAACY,KAAf,EAAsB;AAAE;AACtBf,kBAAQC,KAAR,CAAcJ,SAAS,kBAAvB,EAA2CK,MAAMX,QAAjD;AACAS,kBAAQC,KAAR,CAAc,yDAAd;AACAC,gBAAMkB,KAAN;AACAlB,gBAAMc,IAAN,CAAW,QAAX,EAAqBL,OAArB;AACAR,kBAAQkB,WAAWV,OAAX,EAAoB,EAApB,CAAR;AACD;AACF,OARD;AASD,KAZD;AAaD;;AAED,SAAO,UAAUM,CAAV,EAAa;AAClB,QAAIK,IAAIC,KAAKC,MAAL,KAAgB,GAAxB;AACAxB,YAAQC,KAAR,CAAcJ,SAAS,sBAAvB,EACEK,MAAMX,QADR,EAEE+B,IAAI,WAAJ,GAAkB,eAFpB,EAGEL,EAAEQ,MAHJ;AAID,GAND;AAOD;;AAED,SAASf,OAAT,CAAkBR,KAAlB,EAAyB;AACvB,SAAO,YAAY;AACjB,QAAIoB,IAAIC,KAAKC,MAAL,KAAgB,GAAxB;AACAxB,YAAQC,KAAR,CAAcJ,SAAS,OAAvB,EACEK,MAAMX,QADR,EAEE+B,IAAI,eAAJ,GAAsB,gBAFxB;AAGAzB,aAASA,OAAO6B,KAAP,CAAa,CAAb,EAAgB,CAAC,CAAjB,CAAT;AACD,GAND;AAOD;;AAEDjC,EAAEK,EAAF,CAAK,OAAL,EAAc6B,OAAd;AACA;AACA,SAASA,OAAT,CAAkBzB,KAAlB,EAAyB;AACvBF,UAAQC,KAAR,CAAcJ,SAAS,QAAvB,EAAiCK,MAAMX,QAAvC,EACEW,MAAMN,IAAN,KAAe,WAAf,GAA6B,kBAA7B,GAAkD,SADpD;AAEAM,QAAMJ,EAAN,CAAS,OAAT,EAAkB6B,OAAlB;AACD;;AAED,IAAIZ,QAAQ,KAAZ;AACA7B,EAAEY,EAAF,CAAK,KAAL,EAAY,YAAY;AACtB,MAAIK,KAAJ,EAAWU,aAAaV,KAAb;AACXH,UAAQC,KAAR,CAAc,oBAAd;AACAD,UAAQC,KAAR,CAAc,kBAAd;;AAEAD,UAAQ4B,GAAR,CAAY,sBAAZ;AACAb,UAAQ,IAAR;AACD,CAPD;;AASAG,QAAQpB,EAAR,CAAW,MAAX,EAAmB,YAAY;AAC7BE,UAAQ4B,GAAR,CAAY,CAACb,QAAQ,EAAR,GAAa,MAAd,IAAwB,YAApC;AACAf,UAAQ4B,GAAR,CAAY,MAAZ;AACD,CAHD;;AAKA1C,EAAE2C,IAAF,CAAOpC,CAAP","file":"pipe.js","sourcesContent":["var fstream = require('../fstream.js')\nvar path = require('path')\n\nvar r = fstream.Reader({\n  path: path.dirname(__dirname),\n  filter: function () {\n    return !this.basename.match(/^\\./) &&\n      !this.basename.match(/^node_modules$/) &&\n      !this.basename.match(/^deep-copy$/)\n  }\n})\n\nvar w = fstream.Writer({\n  path: path.resolve(__dirname, 'deep-copy'),\n  type: 'Directory'\n})\n\nvar indent = ''\n\nr.on('entry', appears)\nr.on('ready', function () {\n  console.error('ready to begin!', r.path)\n})\n\nfunction appears (entry) {\n  console.error(indent + 'a %s appears!', entry.type, entry.basename, typeof entry.basename, entry)\n  if (foggy) {\n    console.error('FOGGY!')\n    var p = entry\n    do {\n      console.error(p.depth, p.path, p._paused)\n      p = p.parent\n    } while (p)\n\n    throw new Error('\\u001b[mshould not have entries while foggy')\n  }\n  indent += '\\t'\n  entry.on('data', missile(entry))\n  entry.on('end', runaway(entry))\n  entry.on('entry', appears)\n}\n\nvar foggy\nfunction missile (entry) {\n  function liftFog (who) {\n    if (!foggy) return\n    if (who) {\n      console.error('%s breaks the spell!', who && who.path)\n    } else {\n      console.error('the spell expires!')\n    }\n    console.error('\\u001b[mthe fog lifts!\\n')\n    clearTimeout(foggy)\n    foggy = null\n    if (entry._paused) entry.resume()\n  }\n\n  if (entry.type === 'Directory') {\n    var ended = false\n    entry.once('end', function () { ended = true })\n    return function (c) {\n      // throw in some pathological pause()/resume() behavior\n      // just for extra fun.\n      process.nextTick(function () {\n        if (!foggy && !ended) { // && Math.random() < 0.3) {\n          console.error(indent + '%s casts a spell', entry.basename)\n          console.error('\\na slowing fog comes over the battlefield...\\n\\u001b[32m')\n          entry.pause()\n          entry.once('resume', liftFog)\n          foggy = setTimeout(liftFog, 10)\n        }\n      })\n    }\n  }\n\n  return function (c) {\n    var e = Math.random() < 0.5\n    console.error(indent + '%s %s for %d damage!',\n      entry.basename,\n      e ? 'is struck' : 'fires a chunk',\n      c.length)\n  }\n}\n\nfunction runaway (entry) {\n  return function () {\n    var e = Math.random() < 0.5\n    console.error(indent + '%s %s',\n      entry.basename,\n      e ? 'turns to flee' : 'is vanquished!')\n    indent = indent.slice(0, -1)\n  }\n}\n\nw.on('entry', attacks)\n// w.on('ready', function () { attacks(w) })\nfunction attacks (entry) {\n  console.error(indent + '%s %s!', entry.basename,\n    entry.type === 'Directory' ? 'calls for backup' : 'attacks')\n  entry.on('entry', attacks)\n}\n\nvar ended = false\nr.on('end', function () {\n  if (foggy) clearTimeout(foggy)\n  console.error(\"\\u001b[mIT'S OVER!!\")\n  console.error('A WINNAR IS YOU!')\n\n  console.log('ok 1 A WINNAR IS YOU')\n  ended = true\n})\n\nprocess.on('exit', function () {\n  console.log((ended ? '' : 'not ') + 'ok 2 ended')\n  console.log('1..2')\n})\n\nr.pipe(w)\n"]}