{"version":3,"sources":["../../../../../node_modules/npm/node_modules/gauge/render-template.js"],"names":["align","require","validate","objectAssign","wideTruncate","error","TemplateItem","renderValueWithValues","values","item","renderValue","renderTemplate","module","exports","width","template","items","prepareItems","rendered","map","join","left","preType","cappedTypeName","type","toUpperCase","slice","postType","hasPreOrPost","generatePreAndPost","baseItem","parentValues","Object","create","pre","post","push","value","minLength","length","maxLength","$1","$2","cloneAndObjectify","index","arr","cloned","default","MissingTemplateValue","first","last","output","filter","outputLength","remainingSpace","variableCount","consumeSpace","finishSizing","finished","Internal","Infinity","getBaseLength","getLength","forEach","kerning","prevPadRight","padRight","padLeft","resized","resizing","hunkSize","Math","round","getMaxLength","getMinLength","renderFunction","arguments","alignWith","leftPadding","rightPadding","right","truncated","String","aligned"],"mappings":"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","file":"render-template.js","sourcesContent":["'use strict'\nvar align = require('wide-align')\nvar validate = require('aproba')\nvar objectAssign = require('object-assign')\nvar wideTruncate = require('./wide-truncate')\nvar error = require('./error')\nvar TemplateItem = require('./template-item')\n\nfunction renderValueWithValues (values) {\n  return function (item) {\n    return renderValue(item, values)\n  }\n}\n\nvar renderTemplate = module.exports = function (width, template, values) {\n  var items = prepareItems(width, template, values)\n  var rendered = items.map(renderValueWithValues(values)).join('')\n  return align.left(wideTruncate(rendered, width), width)\n}\n\nfunction preType (item) {\n  var cappedTypeName = item.type[0].toUpperCase() + item.type.slice(1)\n  return 'pre' + cappedTypeName\n}\n\nfunction postType (item) {\n  var cappedTypeName = item.type[0].toUpperCase() + item.type.slice(1)\n  return 'post' + cappedTypeName\n}\n\nfunction hasPreOrPost (item, values) {\n  if (!item.type) return\n  return values[preType(item)] || values[postType(item)]\n}\n\nfunction generatePreAndPost (baseItem, parentValues) {\n  var item = objectAssign({}, baseItem)\n  var values = Object.create(parentValues)\n  var template = []\n  var pre = preType(item)\n  var post = postType(item)\n  if (values[pre]) {\n    template.push({value: values[pre]})\n    values[pre] = null\n  }\n  item.minLength = null\n  item.length = null\n  item.maxLength = null\n  template.push(item)\n  values[item.type] = values[item.type]\n  if (values[post]) {\n    template.push({value: values[post]})\n    values[post] = null\n  }\n  return function ($1, $2, length) {\n    return renderTemplate(length, template, values)\n  }\n}\n\nfunction prepareItems (width, template, values) {\n  function cloneAndObjectify (item, index, arr) {\n    var cloned = new TemplateItem(item, width)\n    var type = cloned.type\n    if (cloned.value == null) {\n      if (!(type in values)) {\n        if (cloned.default == null) {\n          throw new error.MissingTemplateValue(cloned, values)\n        } else {\n          cloned.value = cloned.default\n        }\n      } else {\n        cloned.value = values[type]\n      }\n    }\n    if (cloned.value == null || cloned.value === '') return null\n    cloned.index = index\n    cloned.first = index === 0\n    cloned.last = index === arr.length - 1\n    if (hasPreOrPost(cloned, values)) cloned.value = generatePreAndPost(cloned, values)\n    return cloned\n  }\n\n  var output = template.map(cloneAndObjectify).filter(function (item) { return item != null })\n\n  var outputLength = 0\n  var remainingSpace = width\n  var variableCount = output.length\n\n  function consumeSpace (length) {\n    if (length > remainingSpace) length = remainingSpace\n    outputLength += length\n    remainingSpace -= length\n  }\n\n  function finishSizing (item, length) {\n    if (item.finished) throw new error.Internal('Tried to finish template item that was already finished')\n    if (length === Infinity) throw new error.Internal('Length of template item cannot be infinity')\n    if (length != null) item.length = length\n    item.minLength = null\n    item.maxLength = null\n    --variableCount\n    item.finished = true\n    if (item.length == null) item.length = item.getBaseLength()\n    if (item.length == null) throw new error.Internal('Finished template items must have a length')\n    consumeSpace(item.getLength())\n  }\n\n  output.forEach(function (item) {\n    if (!item.kerning) return\n    var prevPadRight = item.first ? 0 : output[item.index - 1].padRight\n    if (!item.first && prevPadRight < item.kerning) item.padLeft = item.kerning - prevPadRight\n    if (!item.last) item.padRight = item.kerning\n  })\n\n  // Finish any that have a fixed (literal or intuited) length\n  output.forEach(function (item) {\n    if (item.getBaseLength() == null) return\n    finishSizing(item)\n  })\n\n  var resized = 0\n  var resizing\n  var hunkSize\n  do {\n    resizing = false\n    hunkSize = Math.round(remainingSpace / variableCount)\n    output.forEach(function (item) {\n      if (item.finished) return\n      if (!item.maxLength) return\n      if (item.getMaxLength() < hunkSize) {\n        finishSizing(item, item.maxLength)\n        resizing = true\n      }\n    })\n  } while (resizing && resized++ < output.length)\n  if (resizing) throw new error.Internal('Resize loop iterated too many times while determining maxLength')\n\n  resized = 0\n  do {\n    resizing = false\n    hunkSize = Math.round(remainingSpace / variableCount)\n    output.forEach(function (item) {\n      if (item.finished) return\n      if (!item.minLength) return\n      if (item.getMinLength() >= hunkSize) {\n        finishSizing(item, item.minLength)\n        resizing = true\n      }\n    })\n  } while (resizing && resized++ < output.length)\n  if (resizing) throw new error.Internal('Resize loop iterated too many times while determining minLength')\n\n  hunkSize = Math.round(remainingSpace / variableCount)\n  output.forEach(function (item) {\n    if (item.finished) return\n    finishSizing(item, hunkSize)\n  })\n\n  return output\n}\n\nfunction renderFunction (item, values, length) {\n  validate('OON', arguments)\n  if (item.type) {\n    return item.value(values, values[item.type + 'Theme'] || {}, length)\n  } else {\n    return item.value(values, {}, length)\n  }\n}\n\nfunction renderValue (item, values) {\n  var length = item.getBaseLength()\n  var value = typeof item.value === 'function' ? renderFunction(item, values, length) : item.value\n  if (value == null || value === '') return ''\n  var alignWith = align[item.align] || align.left\n  var leftPadding = item.padLeft ? align.left('', item.padLeft) : ''\n  var rightPadding = item.padRight ? align.right('', item.padRight) : ''\n  var truncated = wideTruncate(String(value), length)\n  var aligned = alignWith(truncated, length)\n  return leftPadding + aligned + rightPadding\n}\n"]}