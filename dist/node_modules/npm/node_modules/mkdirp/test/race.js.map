{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/mkdirp/test/race.js"],"names":["mkdirp","require","path","fs","exists","test","_0777","parseInt","_0755","t","plan","ps","i","dir","Math","floor","random","pow","toString","push","file","join","res","mk","cb","err","ifError","ex","ok","stat","equal","mode","isDirectory"],"mappings":";;AAAA,IAAIA,SAASC,QAAQ,KAAR,EAAeD,MAA5B;AACA,IAAIE,OAAOD,QAAQ,MAAR,CAAX;AACA,IAAIE,KAAKF,QAAQ,IAAR,CAAT;AACA,IAAIG,SAASD,GAAGC,MAAH,IAAaF,KAAKE,MAA/B;AACA,IAAIC,OAAOJ,QAAQ,KAAR,EAAeI,IAA1B;AACA,IAAIC,QAAQC,SAAS,MAAT,EAAiB,CAAjB,CAAZ;AACA,IAAIC,QAAQD,SAAS,MAAT,EAAiB,CAAjB,CAAZ;;AAEAF,KAAK,MAAL,EAAa,UAAUI,CAAV,EAAa;AACtBA,MAAEC,IAAF,CAAO,EAAP;AACA,QAAIC,KAAK,CAAE,EAAF,EAAM,KAAN,CAAT;;AAEA,SAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAI,EAApB,EAAwBA,GAAxB,EAA6B;AACzB,YAAIC,MAAMC,KAAKC,KAAL,CAAWD,KAAKE,MAAL,KAAgBF,KAAKG,GAAL,CAAS,EAAT,EAAY,CAAZ,CAA3B,EAA2CC,QAA3C,CAAoD,EAApD,CAAV;AACAP,WAAGQ,IAAH,CAAQN,GAAR;AACH;AACD,QAAIO,OAAOT,GAAGU,IAAH,CAAQ,GAAR,CAAX;;AAEA,QAAIC,MAAM,CAAV;AACAC,OAAGH,IAAH;;AAEAG,OAAGH,IAAH;;AAEA,aAASG,EAAT,CAAaH,IAAb,EAAmBI,EAAnB,EAAuB;AACnBxB,eAAOoB,IAAP,EAAaZ,KAAb,EAAoB,UAAUiB,GAAV,EAAe;AAC/BhB,cAAEiB,OAAF,CAAUD,GAAV;AACArB,mBAAOgB,IAAP,EAAa,UAAUO,EAAV,EAAc;AACvBlB,kBAAEmB,EAAF,CAAKD,EAAL,EAAS,cAAT;AACAxB,mBAAG0B,IAAH,CAAQT,IAAR,EAAc,UAAUK,GAAV,EAAeI,IAAf,EAAqB;AAC/BpB,sBAAEiB,OAAF,CAAUD,GAAV;AACAhB,sBAAEqB,KAAF,CAAQD,KAAKE,IAAL,GAAYzB,KAApB,EAA2BE,KAA3B;AACAC,sBAAEmB,EAAF,CAAKC,KAAKG,WAAL,EAAL,EAAyB,wBAAzB;AACH,iBAJD;AAKH,aAPD;AAQH,SAVD;AAWH;AACJ,CA5BD","file":"race.js","sourcesContent":["var mkdirp = require('../').mkdirp;\nvar path = require('path');\nvar fs = require('fs');\nvar exists = fs.exists || path.exists;\nvar test = require('tap').test;\nvar _0777 = parseInt('0777', 8);\nvar _0755 = parseInt('0755', 8);\n\ntest('race', function (t) {\n    t.plan(10);\n    var ps = [ '', 'tmp' ];\n    \n    for (var i = 0; i < 25; i++) {\n        var dir = Math.floor(Math.random() * Math.pow(16,4)).toString(16);\n        ps.push(dir);\n    }\n    var file = ps.join('/');\n    \n    var res = 2;\n    mk(file);\n    \n    mk(file);\n    \n    function mk (file, cb) {\n        mkdirp(file, _0755, function (err) {\n            t.ifError(err);\n            exists(file, function (ex) {\n                t.ok(ex, 'file created');\n                fs.stat(file, function (err, stat) {\n                    t.ifError(err);\n                    t.equal(stat.mode & _0777, _0755);\n                    t.ok(stat.isDirectory(), 'target not a directory');\n                });\n            })\n        });\n    }\n});\n"]}