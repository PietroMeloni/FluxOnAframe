{"version":3,"sources":["../../../../../node_modules/npm/node_modules/end-of-stream/index.js"],"names":["once","require","noop","isRequest","stream","setHeader","abort","isChildProcess","stdio","Array","isArray","length","eos","opts","callback","ws","_writableState","rs","_readableState","readable","writable","onlegacyfinish","onfinish","call","onend","onexit","exitCode","Error","onerror","err","onclose","ended","onrequest","req","on","error","removeListener","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["var once = require('once');\n\nvar noop = function() {};\n\nvar isRequest = function(stream) {\n\treturn stream.setHeader && typeof stream.abort === 'function';\n};\n\nvar isChildProcess = function(stream) {\n\treturn stream.stdio && Array.isArray(stream.stdio) && stream.stdio.length === 3\n};\n\nvar eos = function(stream, opts, callback) {\n\tif (typeof opts === 'function') return eos(stream, null, opts);\n\tif (!opts) opts = {};\n\n\tcallback = once(callback || noop);\n\n\tvar ws = stream._writableState;\n\tvar rs = stream._readableState;\n\tvar readable = opts.readable || (opts.readable !== false && stream.readable);\n\tvar writable = opts.writable || (opts.writable !== false && stream.writable);\n\n\tvar onlegacyfinish = function() {\n\t\tif (!stream.writable) onfinish();\n\t};\n\n\tvar onfinish = function() {\n\t\twritable = false;\n\t\tif (!readable) callback.call(stream);\n\t};\n\n\tvar onend = function() {\n\t\treadable = false;\n\t\tif (!writable) callback.call(stream);\n\t};\n\n\tvar onexit = function(exitCode) {\n\t\tcallback.call(stream, exitCode ? new Error('exited with error code: ' + exitCode) : null);\n\t};\n\n\tvar onerror = function(err) {\n\t\tcallback.call(stream, err);\n\t};\n\n\tvar onclose = function() {\n\t\tif (readable && !(rs && rs.ended)) return callback.call(stream, new Error('premature close'));\n\t\tif (writable && !(ws && ws.ended)) return callback.call(stream, new Error('premature close'));\n\t};\n\n\tvar onrequest = function() {\n\t\tstream.req.on('finish', onfinish);\n\t};\n\n\tif (isRequest(stream)) {\n\t\tstream.on('complete', onfinish);\n\t\tstream.on('abort', onclose);\n\t\tif (stream.req) onrequest();\n\t\telse stream.on('request', onrequest);\n\t} else if (writable && !ws) { // legacy streams\n\t\tstream.on('end', onlegacyfinish);\n\t\tstream.on('close', onlegacyfinish);\n\t}\n\n\tif (isChildProcess(stream)) stream.on('exit', onexit);\n\n\tstream.on('end', onend);\n\tstream.on('finish', onfinish);\n\tif (opts.error !== false) stream.on('error', onerror);\n\tstream.on('close', onclose);\n\n\treturn function() {\n\t\tstream.removeListener('complete', onfinish);\n\t\tstream.removeListener('abort', onclose);\n\t\tstream.removeListener('request', onrequest);\n\t\tif (stream.req) stream.req.removeListener('finish', onfinish);\n\t\tstream.removeListener('end', onlegacyfinish);\n\t\tstream.removeListener('close', onlegacyfinish);\n\t\tstream.removeListener('finish', onfinish);\n\t\tstream.removeListener('exit', onexit);\n\t\tstream.removeListener('end', onend);\n\t\tstream.removeListener('error', onerror);\n\t\tstream.removeListener('close', onclose);\n\t};\n};\n\nmodule.exports = eos;\n"]}