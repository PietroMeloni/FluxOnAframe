{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/delayed-stream/lib/delayed_stream.js"],"names":["Stream","require","util","module","exports","DelayedStream","source","dataSize","maxDataSize","pauseStream","_maxDataSizeExceeded","_released","_bufferedEvents","inherits","create","options","delayedStream","option","realEmit","emit","_handleEmit","arguments","apply","on","pause","Object","defineProperty","prototype","configurable","enumerable","get","readable","setEncoding","resume","release","forEach","args","bind","pipe","r","length","_checkIfMaxDataSizeExceeded","push","message","Error"],"mappings":"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","file":"delayed_stream.js","sourcesContent":["var Stream = require('stream').Stream;\nvar util = require('util');\n\nmodule.exports = DelayedStream;\nfunction DelayedStream() {\n  this.source = null;\n  this.dataSize = 0;\n  this.maxDataSize = 1024 * 1024;\n  this.pauseStream = true;\n\n  this._maxDataSizeExceeded = false;\n  this._released = false;\n  this._bufferedEvents = [];\n}\nutil.inherits(DelayedStream, Stream);\n\nDelayedStream.create = function(source, options) {\n  var delayedStream = new this();\n\n  options = options || {};\n  for (var option in options) {\n    delayedStream[option] = options[option];\n  }\n\n  delayedStream.source = source;\n\n  var realEmit = source.emit;\n  source.emit = function() {\n    delayedStream._handleEmit(arguments);\n    return realEmit.apply(source, arguments);\n  };\n\n  source.on('error', function() {});\n  if (delayedStream.pauseStream) {\n    source.pause();\n  }\n\n  return delayedStream;\n};\n\nObject.defineProperty(DelayedStream.prototype, 'readable', {\n  configurable: true,\n  enumerable: true,\n  get: function() {\n    return this.source.readable;\n  }\n});\n\nDelayedStream.prototype.setEncoding = function() {\n  return this.source.setEncoding.apply(this.source, arguments);\n};\n\nDelayedStream.prototype.resume = function() {\n  if (!this._released) {\n    this.release();\n  }\n\n  this.source.resume();\n};\n\nDelayedStream.prototype.pause = function() {\n  this.source.pause();\n};\n\nDelayedStream.prototype.release = function() {\n  this._released = true;\n\n  this._bufferedEvents.forEach(function(args) {\n    this.emit.apply(this, args);\n  }.bind(this));\n  this._bufferedEvents = [];\n};\n\nDelayedStream.prototype.pipe = function() {\n  var r = Stream.prototype.pipe.apply(this, arguments);\n  this.resume();\n  return r;\n};\n\nDelayedStream.prototype._handleEmit = function(args) {\n  if (this._released) {\n    this.emit.apply(this, args);\n    return;\n  }\n\n  if (args[0] === 'data') {\n    this.dataSize += args[1].length;\n    this._checkIfMaxDataSizeExceeded();\n  }\n\n  this._bufferedEvents.push(args);\n};\n\nDelayedStream.prototype._checkIfMaxDataSizeExceeded = function() {\n  if (this._maxDataSizeExceeded) {\n    return;\n  }\n\n  if (this.dataSize <= this.maxDataSize) {\n    return;\n  }\n\n  this._maxDataSizeExceeded = true;\n  var message =\n    'DelayedStream#maxDataSize of ' + this.maxDataSize + ' bytes exceeded.'\n  this.emit('error', new Error(message));\n};\n"]}