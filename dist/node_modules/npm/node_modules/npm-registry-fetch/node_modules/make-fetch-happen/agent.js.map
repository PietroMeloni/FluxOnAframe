{"version":3,"sources":["../../../../../../../node_modules/npm/node_modules/npm-registry-fetch/node_modules/make-fetch-happen/agent.js"],"names":["LRU","require","url","AGENT_CACHE","max","HttpsAgent","HttpAgent","module","exports","getAgent","uri","opts","parsedUri","parse","isHttps","protocol","pxuri","getProxyUri","key","host","port","localAddress","strictSSL","ca","cert","join","agent","peek","get","proxy","getProxy","set","agentTimeout","timeout","maxSockets","rejectUnauthorized","checkNoProxy","hostname","split","reverse","noproxy","noProxy","getProcessEnv","some","noParts","no","filter","x","length","i","env","value","Array","isArray","e","process","toUpperCase","toLowerCase","parsedProxy","HttpProxyAgent","HttpsProxyAgent","SocksProxyAgent","proxyUrl","popts","path","auth","startsWith"],"mappings":"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","file":"agent.js","sourcesContent":["'use strict'\nconst LRU = require('lru-cache')\nconst url = require('url')\n\nlet AGENT_CACHE = new LRU({ max: 50 })\nlet HttpsAgent\nlet HttpAgent\n\nmodule.exports = getAgent\n\nfunction getAgent (uri, opts) {\n  const parsedUri = url.parse(typeof uri === 'string' ? uri : uri.url)\n  const isHttps = parsedUri.protocol === 'https:'\n  const pxuri = getProxyUri(uri, opts)\n\n  const key = [\n    `https:${isHttps}`,\n    pxuri\n      ? `proxy:${pxuri.protocol}//${pxuri.host}:${pxuri.port}`\n      : '>no-proxy<',\n    `local-address:${opts.localAddress || '>no-local-address<'}`,\n    `strict-ssl:${isHttps ? !!opts.strictSSL : '>no-strict-ssl<'}`,\n    `ca:${(isHttps && opts.ca) || '>no-ca<'}`,\n    `cert:${(isHttps && opts.cert) || '>no-cert<'}`,\n    `key:${(isHttps && opts.key) || '>no-key<'}`\n  ].join(':')\n\n  if (opts.agent != null) { // `agent: false` has special behavior!\n    return opts.agent\n  }\n\n  if (AGENT_CACHE.peek(key)) {\n    return AGENT_CACHE.get(key)\n  }\n\n  if (pxuri) {\n    const proxy = getProxy(pxuri, opts, isHttps)\n    AGENT_CACHE.set(key, proxy)\n    return proxy\n  }\n\n  if (isHttps && !HttpsAgent) {\n    HttpsAgent = require('agentkeepalive').HttpsAgent\n  } else if (!isHttps && !HttpAgent) {\n    HttpAgent = require('agentkeepalive')\n  }\n\n  // If opts.timeout is zero, set the agentTimeout to zero as well. A timeout\n  // of zero disables the timeout behavior (OS limits still apply). Else, if\n  // opts.timeout is a non-zero value, set it to timeout + 1, to ensure that\n  // the node-fetch-npm timeout will always fire first, giving us more\n  // consistent errors.\n  const agentTimeout = opts.timeout === 0 ? 0 : opts.timeout + 1\n\n  const agent = isHttps ? new HttpsAgent({\n    maxSockets: opts.maxSockets || 15,\n    ca: opts.ca,\n    cert: opts.cert,\n    key: opts.key,\n    localAddress: opts.localAddress,\n    rejectUnauthorized: opts.strictSSL,\n    timeout: agentTimeout\n  }) : new HttpAgent({\n    maxSockets: opts.maxSockets || 15,\n    localAddress: opts.localAddress,\n    timeout: agentTimeout\n  })\n  AGENT_CACHE.set(key, agent)\n  return agent\n}\n\nfunction checkNoProxy (uri, opts) {\n  const host = url.parse(uri).hostname.split('.').reverse()\n  let noproxy = (opts.noProxy || getProcessEnv('no_proxy'))\n  if (typeof noproxy === 'string') {\n    noproxy = noproxy.split(/\\s*,\\s*/g)\n  }\n  return noproxy && noproxy.some(no => {\n    const noParts = no.split('.').filter(x => x).reverse()\n    if (!noParts.length) { return false }\n    for (let i = 0; i < noParts.length; i++) {\n      if (host[i] !== noParts[i]) {\n        return false\n      }\n    }\n    return true\n  })\n}\n\nmodule.exports.getProcessEnv = getProcessEnv\n\nfunction getProcessEnv (env) {\n  if (!env) { return }\n\n  let value\n\n  if (Array.isArray(env)) {\n    for (let e of env) {\n      value = process.env[e] ||\n        process.env[e.toUpperCase()] ||\n        process.env[e.toLowerCase()]\n      if (typeof value !== 'undefined') { break }\n    }\n  }\n\n  if (typeof env === 'string') {\n    value = process.env[env] ||\n      process.env[env.toUpperCase()] ||\n      process.env[env.toLowerCase()]\n  }\n\n  return value\n}\n\nfunction getProxyUri (uri, opts) {\n  const protocol = url.parse(uri).protocol\n\n  const proxy = opts.proxy || (\n    protocol === 'https:' && getProcessEnv('https_proxy')\n  ) || (\n      protocol === 'http:' && getProcessEnv(['https_proxy', 'http_proxy', 'proxy'])\n    )\n  if (!proxy) { return null }\n\n  const parsedProxy = (typeof proxy === 'string') ? url.parse(proxy) : proxy\n\n  return !checkNoProxy(uri, opts) && parsedProxy\n}\n\nlet HttpProxyAgent\nlet HttpsProxyAgent\nlet SocksProxyAgent\nfunction getProxy (proxyUrl, opts, isHttps) {\n  let popts = {\n    host: proxyUrl.hostname,\n    port: proxyUrl.port,\n    protocol: proxyUrl.protocol,\n    path: proxyUrl.path,\n    auth: proxyUrl.auth,\n    ca: opts.ca,\n    cert: opts.cert,\n    key: opts.key,\n    timeout: opts.timeout === 0 ? 0 : opts.timeout + 1,\n    localAddress: opts.localAddress,\n    maxSockets: opts.maxSockets || 15,\n    rejectUnauthorized: opts.strictSSL\n  }\n\n  if (proxyUrl.protocol === 'http:' || proxyUrl.protocol === 'https:') {\n    if (!isHttps) {\n      if (!HttpProxyAgent) {\n        HttpProxyAgent = require('http-proxy-agent')\n      }\n\n      return new HttpProxyAgent(popts)\n    } else {\n      if (!HttpsProxyAgent) {\n        HttpsProxyAgent = require('https-proxy-agent')\n      }\n\n      return new HttpsProxyAgent(popts)\n    }\n  }\n  if (proxyUrl.protocol.startsWith('socks')) {\n    if (!SocksProxyAgent) {\n      SocksProxyAgent = require('socks-proxy-agent')\n    }\n\n    return new SocksProxyAgent(popts)\n  }\n}\n"]}