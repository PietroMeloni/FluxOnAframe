'use strict';

var fetchManifest = require('./lib/fetch').manifest;
var finalizeManifest = require('./lib/finalize-manifest');
var optCheck = require('./lib/util/opt-check');
var pinflight = require('promise-inflight');
var npa = require('npm-package-arg');

module.exports = manifest;
function manifest(spec, opts) {
  opts = optCheck(opts);
  spec = npa(spec, opts.where);

  var label = [spec.name, spec.saveSpec || spec.fetchSpec, spec.type, opts.cache, opts.registry, opts.scope].join(':');
  return pinflight(label, function () {
    var startTime = Date.now();
    return fetchManifest(spec, opts).then(function (rawManifest) {
      return finalizeManifest(rawManifest, spec, opts);
    }).then(function (manifest) {
      if (opts.annotate) {
        manifest._from = spec.saveSpec || spec.raw;
        manifest._requested = spec;
        manifest._spec = spec.raw;
        manifest._where = opts.where;
      }
      var elapsedTime = Date.now() - startTime;
      opts.log.silly('pacote', spec.type + ' manifest for ' + spec.name + '@' + (spec.saveSpec || spec.fetchSpec) + ' fetched in ' + elapsedTime + 'ms');
      return manifest;
    });
  });
}
//# sourceMappingURL=manifest.js.map