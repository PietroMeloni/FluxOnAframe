{"version":3,"sources":["../../../../../node_modules/npm/node_modules/duplexify/test.js"],"names":["tape","require","through","concat","net","duplexify","t","plan","pt","dup","end","on","ok","pipe","data","same","toString","obj","highWaterMark","enc","cb","setTimeout","write","readExpected","writeExpected","length","readable","writable","shift","slice","forEach","setWritable","setReadable","read","destroy","err","message","emit","Error","toUpperCase","passthrough","upper","once","cork","uncork","prefinished","server","createServer","socket","chunk","Buffer","close","listen","connect","address","port"],"mappings":"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","file":"test.js","sourcesContent":["var tape = require('tape')\nvar through = require('through2')\nvar concat = require('concat-stream')\nvar net = require('net')\nvar duplexify = require('./')\n\ntape('passthrough', function(t) {\n  t.plan(2)\n\n  var pt = through()\n  var dup = duplexify(pt, pt)\n\n  dup.end('hello world')\n  dup.on('finish', function() {\n    t.ok(true, 'should finish')\n  })\n  dup.pipe(concat(function(data) {\n    t.same(data.toString(), 'hello world', 'same in as out')\n  }))\n})\n\ntape('passthrough + double end', function(t) {\n  t.plan(2)\n\n  var pt = through()\n  var dup = duplexify(pt, pt)\n\n  dup.end('hello world')\n  dup.end()\n\n  dup.on('finish', function() {\n    t.ok(true, 'should finish')\n  })\n  dup.pipe(concat(function(data) {\n    t.same(data.toString(), 'hello world', 'same in as out')\n  }))\n})\n\ntape('async passthrough + end', function(t) {\n  t.plan(2)\n\n  var pt = through.obj({highWaterMark:1}, function(data, enc, cb) {\n    setTimeout(function() {\n      cb(null, data)\n    }, 100)\n  })\n\n  var dup = duplexify(pt, pt)\n\n  dup.write('hello ')\n  dup.write('world')\n  dup.end()\n\n  dup.on('finish', function() {\n    t.ok(true, 'should finish')\n  })\n  dup.pipe(concat(function(data) {\n    t.same(data.toString(), 'hello world', 'same in as out')\n  }))\n})\n\ntape('duplex', function(t) {\n  var readExpected = ['read-a', 'read-b', 'read-c']\n  var writeExpected = ['write-a', 'write-b', 'write-c']\n\n  t.plan(readExpected.length+writeExpected.length+2)\n\n  var readable = through.obj()\n  var writable = through.obj(function(data, enc, cb) {\n    t.same(data, writeExpected.shift(), 'onwrite should match')\n    cb()\n  })\n\n  var dup = duplexify.obj(writable, readable)\n\n  readExpected.slice().forEach(function(data) {\n    readable.write(data)\n  })\n  readable.end()\n\n  writeExpected.slice().forEach(function(data) {\n    dup.write(data)\n  })\n  dup.end()\n\n  dup.on('data', function(data) {\n    t.same(data, readExpected.shift(), 'ondata should match')\n  })\n  dup.on('end', function() {\n    t.ok(true, 'should end')\n  })\n  dup.on('finish', function() {\n    t.ok(true, 'should finish')\n  })\n})\n\ntape('async', function(t) {\n  var dup = duplexify()\n  var pt = through()\n\n  dup.pipe(concat(function(data) {\n    t.same(data.toString(), 'i was async', 'same in as out')\n    t.end()\n  }))\n\n  dup.write('i')\n  dup.write(' was ')\n  dup.end('async')\n\n  setTimeout(function() {\n    dup.setWritable(pt)\n    setTimeout(function() {\n      dup.setReadable(pt)\n    }, 50)\n  }, 50)\n})\n\ntape('destroy', function(t) {\n  t.plan(2)\n\n  var write = through()\n  var read = through()\n  var dup = duplexify(write, read)\n\n  write.destroy = function() {\n    t.ok(true, 'write destroyed')\n  }\n\n  dup.on('close', function() {\n    t.ok(true, 'close emitted')\n  })\n\n  dup.destroy()\n  dup.destroy() // should only work once\n})\n\ntape('destroy both', function(t) {\n  t.plan(3)\n\n  var write = through()\n  var read = through()\n  var dup = duplexify(write, read)\n\n  write.destroy = function() {\n    t.ok(true, 'write destroyed')\n  }\n\n  read.destroy = function() {\n    t.ok(true, 'read destroyed')\n  }\n\n  dup.on('close', function() {\n    t.ok(true, 'close emitted')\n  })\n\n  dup.destroy()\n  dup.destroy() // should only work once\n})\n\ntape('bubble read errors', function(t) {\n  t.plan(2)\n\n  var write = through()\n  var read = through()\n  var dup = duplexify(write, read)\n\n  dup.on('error', function(err) {\n    t.same(err.message, 'read-error', 'received read error')\n  })\n  dup.on('close', function() {\n    t.ok(true, 'close emitted')\n  })\n\n  read.emit('error', new Error('read-error'))\n  write.emit('error', new Error('write-error')) // only emit first error\n})\n\ntape('bubble write errors', function(t) {\n  t.plan(2)\n\n  var write = through()\n  var read = through()\n  var dup = duplexify(write, read)\n\n  dup.on('error', function(err) {\n    t.same(err.message, 'write-error', 'received write error')\n  })\n  dup.on('close', function() {\n    t.ok(true, 'close emitted')\n  })\n\n  write.emit('error', new Error('write-error'))\n  read.emit('error', new Error('read-error')) // only emit first error\n})\n\ntape('reset writable / readable', function(t) {\n  t.plan(3)\n\n  var toUpperCase = function(data, enc, cb) {\n    cb(null, data.toString().toUpperCase())\n  }\n\n  var passthrough = through()\n  var upper = through(toUpperCase)\n  var dup = duplexify(passthrough, passthrough)\n\n  dup.once('data', function(data) {\n    t.same(data.toString(), 'hello')\n    dup.setWritable(upper)\n    dup.setReadable(upper)\n    dup.once('data', function(data) {\n      t.same(data.toString(), 'HELLO')\n      dup.once('data', function(data) {\n        t.same(data.toString(), 'HI')\n        t.end()\n      })\n    })\n    dup.write('hello')\n    dup.write('hi')\n  })\n  dup.write('hello')\n})\n\ntape('cork', function(t) {\n  var passthrough = through()\n  var dup = duplexify(passthrough, passthrough)\n  var ok = false\n\n  dup.on('prefinish', function() {\n    dup.cork()\n    setTimeout(function() {\n      ok = true\n      dup.uncork()\n    }, 100)\n  })\n  dup.on('finish', function() {\n    t.ok(ok)\n    t.end()\n  })\n  dup.end()\n})\n\ntape('prefinish not twice', function(t) {\n  var passthrough = through()\n  var dup = duplexify(passthrough, passthrough)\n  var prefinished = false\n\n  dup.on('prefinish', function() {\n    t.ok(!prefinished, 'only prefinish once')\n    prefinished = true\n  })\n\n  dup.on('finish', function() {\n    t.end()\n  })\n\n  dup.end()\n})\n\ntape('close', function(t) {\n  var passthrough = through()\n  var dup = duplexify(passthrough, passthrough)\n\n  passthrough.emit('close')\n  dup.on('close', function() {\n    t.ok(true, 'should forward close')\n    t.end()\n  })\n})\n\ntape('works with node native streams (net)', function(t) {\n  t.plan(1)\n\n  var server = net.createServer(function(socket) {\n    var dup = duplexify(socket, socket)\n\n    dup.once('data', function(chunk) {\n      t.same(chunk, Buffer('hello world'))\n      server.close()\n      socket.end()\n      t.end()\n    })\n  })\n\n  server.listen(0, function () {\n    var socket = net.connect(server.address().port)\n    var dup = duplexify(socket, socket)\n\n    dup.write(Buffer('hello world'))\n  })\n})\n"]}