{"version":3,"sources":["../../../../../node_modules/npm/node_modules/are-we-there-yet/tracker-group.js"],"names":["util","require","TrackerBase","Tracker","TrackerStream","TrackerGroup","module","exports","name","call","parentGroup","trackers","completion","weight","totalWeight","finished","bubbleChange","inherits","trackerGroup","completed","tracker","id","emit","prototype","nameInTree","names","from","unshift","join","addUnit","unit","toTest","Error","push","on","length","valPerWeight","ii","trackerId","newGroup","newItem","todo","newStream","finish","removeListener","buffer","debug","depth","indent","substr","output","forEach"],"mappings":"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","file":"tracker-group.js","sourcesContent":["'use strict'\nvar util = require('util')\nvar TrackerBase = require('./tracker-base.js')\nvar Tracker = require('./tracker.js')\nvar TrackerStream = require('./tracker-stream.js')\n\nvar TrackerGroup = module.exports = function (name) {\n  TrackerBase.call(this, name)\n  this.parentGroup = null\n  this.trackers = []\n  this.completion = {}\n  this.weight = {}\n  this.totalWeight = 0\n  this.finished = false\n  this.bubbleChange = bubbleChange(this)\n}\nutil.inherits(TrackerGroup, TrackerBase)\n\nfunction bubbleChange (trackerGroup) {\n  return function (name, completed, tracker) {\n    trackerGroup.completion[tracker.id] = completed\n    if (trackerGroup.finished) return\n    trackerGroup.emit('change', name || trackerGroup.name, trackerGroup.completed(), trackerGroup)\n  }\n}\n\nTrackerGroup.prototype.nameInTree = function () {\n  var names = []\n  var from = this\n  while (from) {\n    names.unshift(from.name)\n    from = from.parentGroup\n  }\n  return names.join('/')\n}\n\nTrackerGroup.prototype.addUnit = function (unit, weight) {\n  if (unit.addUnit) {\n    var toTest = this\n    while (toTest) {\n      if (unit === toTest) {\n        throw new Error(\n          'Attempted to add tracker group ' +\n          unit.name + ' to tree that already includes it ' +\n          this.nameInTree(this))\n      }\n      toTest = toTest.parentGroup\n    }\n    unit.parentGroup = this\n  }\n  this.weight[unit.id] = weight || 1\n  this.totalWeight += this.weight[unit.id]\n  this.trackers.push(unit)\n  this.completion[unit.id] = unit.completed()\n  unit.on('change', this.bubbleChange)\n  if (!this.finished) this.emit('change', unit.name, this.completion[unit.id], unit)\n  return unit\n}\n\nTrackerGroup.prototype.completed = function () {\n  if (this.trackers.length === 0) return 0\n  var valPerWeight = 1 / this.totalWeight\n  var completed = 0\n  for (var ii = 0; ii < this.trackers.length; ii++) {\n    var trackerId = this.trackers[ii].id\n    completed += valPerWeight * this.weight[trackerId] * this.completion[trackerId]\n  }\n  return completed\n}\n\nTrackerGroup.prototype.newGroup = function (name, weight) {\n  return this.addUnit(new TrackerGroup(name), weight)\n}\n\nTrackerGroup.prototype.newItem = function (name, todo, weight) {\n  return this.addUnit(new Tracker(name, todo), weight)\n}\n\nTrackerGroup.prototype.newStream = function (name, todo, weight) {\n  return this.addUnit(new TrackerStream(name, todo), weight)\n}\n\nTrackerGroup.prototype.finish = function () {\n  this.finished = true\n  if (!this.trackers.length) this.addUnit(new Tracker(), 1, true)\n  for (var ii = 0; ii < this.trackers.length; ii++) {\n    var tracker = this.trackers[ii]\n    tracker.finish()\n    tracker.removeListener('change', this.bubbleChange)\n  }\n  this.emit('change', this.name, 1, this)\n}\n\nvar buffer = '                                  '\nTrackerGroup.prototype.debug = function (depth) {\n  depth = depth || 0\n  var indent = depth ? buffer.substr(0, depth) : ''\n  var output = indent + (this.name || 'top') + ': ' + this.completed() + '\\n'\n  this.trackers.forEach(function (tracker) {\n    if (tracker instanceof TrackerGroup) {\n      output += tracker.debug(depth + 1)\n    } else {\n      output += indent + ' ' + tracker.name + ': ' + tracker.completed() + '\\n'\n    }\n  })\n  return output\n}\n"]}