{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/genfun/lib/genfun.js"],"names":["Method","require","Role","util","kCache","Symbol","kDefaultMethod","kMethods","kNoNext","module","exports","genfun","opts","gf","length","func","apply","arguments","applyGenfun","Object","setPrototypeOf","Genfun","prototype","key","methods","state","STATES","UNINITIALIZED","add","default","name","defineProperty","value","noNextMethod","Function","isGenfun","MONOMORPHIC","POLYMORPHIC","MEGAMORPHIC","MAX_CACHE_SIZE","addMethod","selector","slice","call","i","hasOwnProperty","method","push","rm","removeMethod","Error","hasMethod","getApplicableMethods","noApplicableMethod","thisArg","args","msg","map","arg","exec","toString","join","err","newThis","applicableMethods","idx","nextMethod","Array","next","pop","maybeMethods","cachedMethods","computeApplicableMethods","cacheArgs","proto","cacheableProto","unshift","dispatchable","dispatchableObject","roleKeyName","j","role","getPrototypeOf","protos","matchCachedMethods","discoveredMethods","findAndRankRoles","object","hierarchyPosition","index","roles","forEach","position","indexOf","clearRank","setRankHierarchyPosition","isObjectProto","minimalSelector","getPrecedenceList","obj","filter","_rank","isFullySpecified","sort","a","b","score","precedenceList","nextObj"],"mappings":"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","file":"genfun.js","sourcesContent":["'use strict'\n\nconst Method = require('./method')\nconst Role = require('./role')\nconst util = require('./util')\n\nconst kCache = Symbol('cache')\nconst kDefaultMethod = Symbol('defaultMethod')\nconst kMethods = Symbol('methods')\nconst kNoNext = Symbol('noNext')\n\nmodule.exports = function genfun (opts) {\n  function gf () {\n    if (!gf[kMethods].length && gf[kDefaultMethod]) {\n      return gf[kDefaultMethod].func.apply(this, arguments)\n    } else {\n      return gf.applyGenfun(this, arguments)\n    }\n  }\n  Object.setPrototypeOf(gf, Genfun.prototype)\n  gf[kMethods] = []\n  gf[kCache] = {key: [], methods: [], state: STATES.UNINITIALIZED}\n  if (opts && typeof opts === 'function') {\n    gf.add(opts)\n  } else if (opts && opts.default) {\n    gf.add(opts.default)\n  }\n  if (opts && opts.name) {\n    Object.defineProperty(gf, 'name', {\n      value: opts.name\n    })\n  }\n  if (opts && opts.noNextMethod) {\n    gf[kNoNext] = true\n  }\n  return gf\n}\n\nclass Genfun extends Function {}\nGenfun.prototype.isGenfun = true\n\nconst STATES = {\n  UNINITIALIZED: 0,\n  MONOMORPHIC: 1,\n  POLYMORPHIC: 2,\n  MEGAMORPHIC: 3\n}\n\nconst MAX_CACHE_SIZE = 32\n\n/**\n * Defines a method on a generic function.\n *\n * @function\n * @param {Array-like} selector - Selector array for dispatching the method.\n * @param {Function} methodFunction - Function to execute when the method\n *                                    successfully dispatches.\n */\nGenfun.prototype.add = function addMethod (selector, func) {\n  if (!func && typeof selector === 'function') {\n    func = selector\n    selector = []\n  }\n  selector = [].slice.call(selector)\n  for (var i = 0; i < selector.length; i++) {\n    if (!selector.hasOwnProperty(i)) {\n      selector[i] = Object.prototype\n    }\n  }\n  this[kCache] = {key: [], methods: [], state: STATES.UNINITIALIZED}\n  let method = new Method(this, selector, func)\n  if (selector.length) {\n    this[kMethods].push(method)\n  } else {\n    this[kDefaultMethod] = method\n  }\n  return this\n}\n\n/**\n * Removes a previously-defined method on `genfun` that matches\n * `selector` exactly.\n *\n * @function\n * @param {Genfun} genfun - Genfun to remove a method from.\n * @param {Array-like} selector - Objects to match on when finding a\n *                                    method to remove.\n */\nGenfun.prototype.rm = function removeMethod () {\n  throw new Error('not yet implemented')\n}\n\n/**\n * Returns true if there are methods that apply to the given arguments on\n * `genfun`. Additionally, makes sure the cache is warmed up for the given\n * arguments.\n *\n */\nGenfun.prototype.hasMethod = function hasMethod () {\n  const methods = this.getApplicableMethods(arguments)\n  return !!(methods && methods.length)\n}\n\n/**\n * This generic function is called when `genfun` has been called and no\n * applicable method was found. The default method throws an `Error`.\n *\n * @function\n * @param {Genfun} genfun - Generic function instance that was called.\n * @param {*} newthis - value of `this` the genfun was called with.\n * @param {Array} callArgs - Arguments the genfun was called with.\n */\nmodule.exports.noApplicableMethod = module.exports()\nmodule.exports.noApplicableMethod.add([], (gf, thisArg, args) => {\n  let msg =\n        'No applicable method found when called with arguments of types: (' +\n        [].map.call(args, (arg) => {\n          return (/\\[object ([a-zA-Z0-9]+)\\]/)\n            .exec(({}).toString.call(arg))[1]\n        }).join(', ') + ')'\n  let err = new Error(msg)\n  err.genfun = gf\n  err.thisArg = thisArg\n  err.args = args\n  throw err\n})\n\n/*\n * Internal\n */\nGenfun.prototype.applyGenfun = function applyGenfun (newThis, args) {\n  let applicableMethods = this.getApplicableMethods(args)\n  if (applicableMethods.length === 1 || this[kNoNext]) {\n    return applicableMethods[0].func.apply(newThis, args)\n  } else if (applicableMethods.length > 1) {\n    let idx = 0\n    const nextMethod = function nextMethod () {\n      if (arguments.length) {\n        // Replace args if passed in explicitly\n        args = arguments\n        Array.prototype.push.call(args, nextMethod)\n      }\n      const next = applicableMethods[idx++]\n      if (idx >= applicableMethods.length) {\n        Array.prototype.pop.call(args)\n      }\n      return next.func.apply(newThis, args)\n    }\n    Array.prototype.push.call(args, nextMethod)\n    return nextMethod()\n  } else {\n    return module.exports.noApplicableMethod(this, newThis, args)\n  }\n}\n\nGenfun.prototype.getApplicableMethods = function getApplicableMethods (args) {\n  if (!args.length || !this[kMethods].length) {\n    return this[kDefaultMethod] ? [this[kDefaultMethod]] : []\n  }\n  let applicableMethods\n  let maybeMethods = cachedMethods(this, args)\n  if (maybeMethods) {\n    applicableMethods = maybeMethods\n  } else {\n    applicableMethods = computeApplicableMethods(this, args)\n    cacheArgs(this, args, applicableMethods)\n  }\n  return applicableMethods\n}\n\nfunction cacheArgs (genfun, args, methods) {\n  if (genfun[kCache].state === STATES.MEGAMORPHIC) { return }\n  var key = []\n  var proto\n  for (var i = 0; i < args.length; i++) {\n    proto = cacheableProto(genfun, args[i])\n    if (proto) {\n      key[i] = proto\n    } else {\n      return null\n    }\n  }\n  genfun[kCache].key.unshift(key)\n  genfun[kCache].methods.unshift(methods)\n  if (genfun[kCache].key.length === 1) {\n    genfun[kCache].state = STATES.MONOMORPHIC\n  } else if (genfun[kCache].key.length < MAX_CACHE_SIZE) {\n    genfun[kCache].state = STATES.POLYMORPHIC\n  } else {\n    genfun[kCache].state = STATES.MEGAMORPHIC\n  }\n}\n\nfunction cacheableProto (genfun, arg) {\n  var dispatchable = util.dispatchableObject(arg)\n  if (Object.hasOwnProperty.call(dispatchable, Role.roleKeyName)) {\n    for (var j = 0; j < dispatchable[Role.roleKeyName].length; j++) {\n      var role = dispatchable[Role.roleKeyName][j]\n      if (role.method.genfun === genfun) {\n        return null\n      }\n    }\n  }\n  return Object.getPrototypeOf(dispatchable)\n}\n\nfunction cachedMethods (genfun, args) {\n  if (genfun[kCache].state === STATES.UNINITIALIZED ||\n      genfun[kCache].state === STATES.MEGAMORPHIC) {\n    return null\n  }\n  var protos = []\n  var proto\n  for (var i = 0; i < args.length; i++) {\n    proto = cacheableProto(genfun, args[i])\n    if (proto) {\n      protos[i] = proto\n    } else {\n      return\n    }\n  }\n  for (i = 0; i < genfun[kCache].key.length; i++) {\n    if (matchCachedMethods(genfun[kCache].key[i], protos)) {\n      return genfun[kCache].methods[i]\n    }\n  }\n}\n\nfunction matchCachedMethods (key, protos) {\n  if (key.length !== protos.length) { return false }\n  for (var i = 0; i < key.length; i++) {\n    if (key[i] !== protos[i]) {\n      return false\n    }\n  }\n  return true\n}\n\nfunction computeApplicableMethods (genfun, args) {\n  args = [].slice.call(args)\n  let discoveredMethods = []\n  function findAndRankRoles (object, hierarchyPosition, index) {\n    var roles = Object.hasOwnProperty.call(object, Role.roleKeyName)\n    ? object[Role.roleKeyName]\n    : []\n    roles.forEach(role => {\n      if (role.method.genfun === genfun && index === role.position) {\n        if (discoveredMethods.indexOf(role.method) < 0) {\n          Method.clearRank(role.method)\n          discoveredMethods.push(role.method)\n        }\n        Method.setRankHierarchyPosition(role.method, index, hierarchyPosition)\n      }\n    })\n    // When a discovered method would receive more arguments than\n    // were specialized, we pretend all extra arguments have a role\n    // on Object.prototype.\n    if (util.isObjectProto(object)) {\n      discoveredMethods.forEach(method => {\n        if (method.minimalSelector <= index) {\n          Method.setRankHierarchyPosition(method, index, hierarchyPosition)\n        }\n      })\n    }\n  }\n  args.forEach((arg, index) => {\n    getPrecedenceList(util.dispatchableObject(arg))\n      .forEach((obj, hierarchyPosition) => {\n        findAndRankRoles(obj, hierarchyPosition, index)\n      })\n  })\n  let applicableMethods = discoveredMethods.filter(method => {\n    return (args.length === method._rank.length &&\n            Method.isFullySpecified(method))\n  })\n  applicableMethods.sort((a, b) => Method.score(a) - Method.score(b))\n  if (genfun[kDefaultMethod]) {\n    applicableMethods.push(genfun[kDefaultMethod])\n  }\n  return applicableMethods\n}\n\n/*\n * Helper function for getting an array representing the entire\n * inheritance/precedence chain for an object by navigating its\n * prototype pointers.\n */\nfunction getPrecedenceList (obj) {\n  var precedenceList = []\n  var nextObj = obj\n  while (nextObj) {\n    precedenceList.push(nextObj)\n    nextObj = Object.getPrototypeOf(nextObj)\n  }\n  return precedenceList\n}\n"]}