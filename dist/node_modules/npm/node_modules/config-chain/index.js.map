{"version":3,"sources":["../../../../../node_modules/npm/node_modules/config-chain/index.js"],"names":["ProtoList","require","path","fs","ini","EE","EventEmitter","url","http","exports","module","args","slice","call","arguments","conf","ConfigChain","length","a","shift","push","json","find","rel","join","apply","start","file","statSync","err","dirname","__dirname","parse","content","type","JSON","er","emit","filter","arg","readFileSync","env","prefix","process","obj","l","k","indexOf","substring","_awaiting","_saving","sources","extras","constructor","value","Object","keys","prototype","forEach","getOwnPropertyDescriptor","create","del","key","where","target","data","Error","i","list","set","get","hasOwnProperty","undefined","save","cb","source","pref","stringify","writeFile","bind","addFile","name","marker","__source__","_await","readFile","addString","addEnv","add","addUrl","req","href","format","request","res","c","ct","headers","match","on","Buffer","concat","end","splice","_resolve","nextTick"],"mappings":";;;;AAAA,IAAIA,YAAYC,QAAQ,YAAR,CAAhB;AAAA,IACIC,OAAOD,QAAQ,MAAR,CADX;AAAA,IAEIE,KAAKF,QAAQ,IAAR,CAFT;AAAA,IAGIG,MAAMH,QAAQ,KAAR,CAHV;AAAA,IAIII,KAAKJ,QAAQ,QAAR,EAAkBK,YAJ3B;AAAA,IAKIC,MAAMN,QAAQ,KAAR,CALV;AAAA,IAMIO,OAAOP,QAAQ,MAAR,CANX;;AAQA,IAAIQ,WAAUC,OAAOD,OAAP,GAAiB,YAAY;AACzC,MAAIE,OAAO,GAAGC,KAAH,CAASC,IAAT,CAAcC,SAAd,CAAX;AAAA,MACIC,OAAO,IAAIC,WAAJ,EADX;;AAGA,SAAML,KAAKM,MAAX,EAAmB;AACjB,QAAIC,IAAIP,KAAKQ,KAAL,EAAR;AACA,QAAGD,CAAH,EAAMH,KAAKK,IAAL,CACE,aAAa,OAAOF,CAApB,GACEG,KAAKH,CAAL,CADF,GAEEA,CAHJ;AAIP;;AAED,SAAOH,IAAP;AACD,CAbD;;AAeA;;AAEA,IAAIO,OAAOb,SAAQa,IAAR,GAAe,YAAY;AACpC,MAAIC,MAAMrB,KAAKsB,IAAL,CAAUC,KAAV,CAAgB,IAAhB,EAAsB,GAAGb,KAAH,CAASC,IAAT,CAAcC,SAAd,CAAtB,CAAV;;AAEA,WAASQ,IAAT,CAAcI,KAAd,EAAqBH,GAArB,EAA0B;AACxB,QAAII,OAAOzB,KAAKsB,IAAL,CAAUE,KAAV,EAAiBH,GAAjB,CAAX;AACA,QAAI;AACFpB,SAAGyB,QAAH,CAAYD,IAAZ;AACA,aAAOA,IAAP;AACD,KAHD,CAGE,OAAOE,GAAP,EAAY;AACZ,UAAG3B,KAAK4B,OAAL,CAAaJ,KAAb,MAAwBA,KAA3B,EAAkC;AAChC,eAAOJ,KAAKpB,KAAK4B,OAAL,CAAaJ,KAAb,CAAL,EAA0BH,GAA1B,CAAP;AACH;AACF;AACD,SAAOD,KAAKS,SAAL,EAAgBR,GAAhB,CAAP;AACD,CAdD;;AAgBA,IAAIS,QAAQvB,SAAQuB,KAAR,GAAgB,UAAUC,OAAV,EAAmBN,IAAnB,EAAyBO,IAAzB,EAA+B;AACzDD,YAAU,KAAKA,OAAf;AACA;AACA;AACA,MAAI,CAACC,IAAL,EAAW;AACT,QAAI;AAAE,aAAOC,KAAKH,KAAL,CAAWC,OAAX,CAAP;AAA4B,KAAlC,CACA,OAAOG,EAAP,EAAW;AAAE,aAAOhC,IAAI4B,KAAJ,CAAUC,OAAV,CAAP;AAA2B;AACzC,GAHD,MAGO,IAAIC,SAAS,MAAb,EAAqB;AAC1B,QAAI,KAAKG,IAAT,EAAe;AACb,UAAI;AAAE,eAAOF,KAAKH,KAAL,CAAWC,OAAX,CAAP;AAA4B,OAAlC,CACA,OAAOG,EAAP,EAAW;AAAE,aAAKC,IAAL,CAAU,OAAV,EAAmBD,EAAnB;AAAwB;AACtC,KAHD,MAGO;AACL,aAAOD,KAAKH,KAAL,CAAWC,OAAX,CAAP;AACD;AACF,GAPM,MAOA;AACL,WAAO7B,IAAI4B,KAAJ,CAAUC,OAAV,CAAP;AACD;AACF,CAjBD;;AAmBA,IAAIZ,OAAOZ,SAAQY,IAAR,GAAe,YAAY;AACpC,MAAIV,OAAO,GAAGC,KAAH,CAASC,IAAT,CAAcC,SAAd,EAAyBwB,MAAzB,CAAgC,UAAUC,GAAV,EAAe;AAAE,WAAOA,OAAO,IAAd;AAAoB,GAArE,CAAX;AACA,MAAIZ,OAAOzB,KAAKsB,IAAL,CAAUC,KAAV,CAAgB,IAAhB,EAAsBd,IAAtB,CAAX;AACA,MAAIsB,OAAJ;AACA,MAAI;AACFA,cAAU9B,GAAGqC,YAAH,CAAgBb,IAAhB,EAAqB,OAArB,CAAV;AACD,GAFD,CAEE,OAAOE,GAAP,EAAY;AACZ;AACD;AACD,SAAOG,MAAMC,OAAN,EAAeN,IAAf,EAAqB,MAArB,CAAP;AACD,CAVD;;AAYA,IAAIc,MAAMhC,SAAQgC,GAAR,GAAc,UAAUC,MAAV,EAAkBD,GAAlB,EAAuB;AAC7CA,QAAMA,OAAOE,QAAQF,GAArB;AACA,MAAIG,MAAM,EAAV;AACA,MAAIC,IAAIH,OAAOzB,MAAf;AACA,OAAI,IAAI6B,CAAR,IAAaL,GAAb,EAAkB;AAChB,QAAGK,EAAEC,OAAF,CAAUL,MAAV,MAAsB,CAAzB,EACEE,IAAIE,EAAEE,SAAF,CAAYH,CAAZ,CAAJ,IAAsBJ,IAAIK,CAAJ,CAAtB;AACH;;AAED,SAAOF,GAAP;AACD,CAVD;;AAYAnC,SAAQO,WAAR,GAAsBA,WAAtB;AACA,SAASA,WAAT,GAAwB;AACtBX,KAAGoB,KAAH,CAAS,IAAT;AACAzB,YAAUyB,KAAV,CAAgB,IAAhB,EAAsBX,SAAtB;AACA,OAAKmC,SAAL,GAAiB,CAAjB;AACA,OAAKC,OAAL,GAAe,CAAf;AACA,OAAKC,OAAL,GAAe,EAAf;AACD;;AAED;AACA,IAAIC,SAAS;AACXC,eAAa,EAAEC,OAAOtC,WAAT;AADF,CAAb;AAGAuC,OAAOC,IAAP,CAAYnD,GAAGoD,SAAf,EAA0BC,OAA1B,CAAkC,UAAUZ,CAAV,EAAa;AAC7CM,SAAON,CAAP,IAAYS,OAAOI,wBAAP,CAAgCtD,GAAGoD,SAAnC,EAA8CX,CAA9C,CAAZ;AACD,CAFD;AAGA9B,YAAYyC,SAAZ,GAAwBF,OAAOK,MAAP,CAAc5D,UAAUyD,SAAxB,EAAmCL,MAAnC,CAAxB;;AAEApC,YAAYyC,SAAZ,CAAsBI,GAAtB,GAA4B,UAAUC,GAAV,EAAeC,KAAf,EAAsB;AAChD;AACA;AACA,MAAIA,KAAJ,EAAW;AACT,QAAIC,SAAS,KAAKb,OAAL,CAAaY,KAAb,CAAb;AACAC,aAASA,UAAUA,OAAOC,IAA1B;AACA,QAAI,CAACD,MAAL,EAAa;AACX,aAAO,KAAK3B,IAAL,CAAU,OAAV,EAAmB,IAAI6B,KAAJ,CAAU,eAAaH,KAAvB,CAAnB,CAAP;AACD;AACD,WAAOC,OAAOF,GAAP,CAAP;AACD,GAPD,MAOO;AACL,SAAK,IAAIK,IAAI,CAAR,EAAWtB,IAAI,KAAKuB,IAAL,CAAUnD,MAA9B,EAAsCkD,IAAItB,CAA1C,EAA6CsB,GAA7C,EAAmD;AACjD,aAAO,KAAKC,IAAL,CAAUD,CAAV,EAAaL,GAAb,CAAP;AACD;AACF;AACD,SAAO,IAAP;AACD,CAhBD;;AAkBA9C,YAAYyC,SAAZ,CAAsBY,GAAtB,GAA4B,UAAUP,GAAV,EAAeR,KAAf,EAAsBS,KAAtB,EAA6B;AACvD,MAAIC,MAAJ;;AAEA,MAAID,KAAJ,EAAW;AACTC,aAAS,KAAKb,OAAL,CAAaY,KAAb,CAAT;AACAC,aAASA,UAAUA,OAAOC,IAA1B;AACA,QAAI,CAACD,MAAL,EAAa;AACX,aAAO,KAAK3B,IAAL,CAAU,OAAV,EAAmB,IAAI6B,KAAJ,CAAU,eAAaH,KAAvB,CAAnB,CAAP;AACD;AACF,GAND,MAMO;AACLC,aAAS,KAAKI,IAAL,CAAU,CAAV,CAAT;AACA,QAAI,CAACJ,MAAL,EAAa;AACX,aAAO,KAAK3B,IAAL,CAAU,OAAV,EAAmB,IAAI6B,KAAJ,CAAU,uBAAV,CAAnB,CAAP;AACD;AACF;AACDF,SAAOF,GAAP,IAAcR,KAAd;AACA,SAAO,IAAP;AACD,CAjBD;;AAmBAtC,YAAYyC,SAAZ,CAAsBa,GAAtB,GAA4B,UAAUR,GAAV,EAAeC,KAAf,EAAsB;AAChD,MAAIA,KAAJ,EAAW;AACTA,YAAQ,KAAKZ,OAAL,CAAaY,KAAb,CAAR;AACA,QAAIA,KAAJ,EAAWA,QAAQA,MAAME,IAAd;AACX,QAAIF,SAASR,OAAOgB,cAAP,CAAsB1D,IAAtB,CAA2BkD,KAA3B,EAAkCD,GAAlC,CAAb,EAAqD,OAAOC,MAAMD,GAAN,CAAP;AACrD,WAAOU,SAAP;AACD;AACD,SAAO,KAAKJ,IAAL,CAAU,CAAV,EAAaN,GAAb,CAAP;AACD,CARD;;AAUA9C,YAAYyC,SAAZ,CAAsBgB,IAAtB,GAA6B,UAAUV,KAAV,EAAiB7B,IAAjB,EAAuBwC,EAAvB,EAA2B;AACtD,MAAI,OAAOxC,IAAP,KAAgB,UAApB,EAAgCwC,KAAKxC,IAAL,EAAWA,OAAO,IAAlB;AAChC,MAAI8B,SAAS,KAAKb,OAAL,CAAaY,KAAb,CAAb;AACA,MAAI,CAACC,MAAD,IAAW,EAAEA,OAAO9D,IAAP,IAAe8D,OAAOW,MAAxB,CAAX,IAA8C,CAACX,OAAOC,IAA1D,EAAgE;AAC9D;AACA;AACA,WAAO,KAAK5B,IAAL,CAAU,OAAV,EAAmB,IAAI6B,KAAJ,CAAU,sBAAoBH,KAA9B,CAAnB,CAAP;AACD;;AAED,MAAIC,OAAOW,MAAX,EAAmB;AACjB,QAAIC,OAAOZ,OAAOtB,MAAP,IAAiB,EAA5B;AACAa,WAAOC,IAAP,CAAYQ,OAAOC,IAAnB,EAAyBP,OAAzB,CAAiC,UAAUZ,CAAV,EAAa;AAC5CkB,aAAOW,MAAP,CAAcC,OAAO9B,CAArB,IAA0BkB,OAAOC,IAAP,CAAYnB,CAAZ,CAA1B;AACD,KAFD;AAGA,WAAO,IAAP;AACD;;AAED,MAAIZ,OAAOA,QAAQ8B,OAAO9B,IAA1B;AACA,MAAI+B,OAAOD,OAAOC,IAAlB;AACA,MAAID,OAAO9B,IAAP,KAAgB,MAApB,EAA4B;AAC1B+B,WAAO9B,KAAK0C,SAAL,CAAeZ,IAAf,CAAP;AACD,GAFD,MAEO;AACLA,WAAO7D,IAAIyE,SAAJ,CAAcZ,IAAd,CAAP;AACD;;AAED,OAAKf,OAAL;AACA/C,KAAG2E,SAAH,CAAad,OAAO9D,IAApB,EAA0B+D,IAA1B,EAAgC,MAAhC,EAAwC,UAAU7B,EAAV,EAAc;AACpD,SAAKc,OAAL;AACA,QAAId,EAAJ,EAAQ;AACN,UAAIsC,EAAJ,EAAQ,OAAOA,GAAGtC,EAAH,CAAP,CAAR,KACK,OAAO,KAAKC,IAAL,CAAU,OAAV,EAAmBD,EAAnB,CAAP;AACN;AACD,QAAI,KAAKc,OAAL,KAAiB,CAArB,EAAwB;AACtB,UAAIwB,EAAJ,EAAQA;AACR,WAAKrC,IAAL,CAAU,MAAV;AACD;AACF,GAVuC,CAUtC0C,IAVsC,CAUjC,IAViC,CAAxC;AAWA,SAAO,IAAP;AACD,CAtCD;;AAwCA/D,YAAYyC,SAAZ,CAAsBuB,OAAtB,GAAgC,UAAUrD,IAAV,EAAgBO,IAAhB,EAAsB+C,IAAtB,EAA4B;AAC1DA,SAAOA,QAAQtD,IAAf;AACA,MAAIuD,SAAS,EAACC,YAAWF,IAAZ,EAAb;AACA,OAAK9B,OAAL,CAAa8B,IAAb,IAAqB,EAAE/E,MAAMyB,IAAR,EAAcO,MAAMA,IAApB,EAArB;AACA,OAAKd,IAAL,CAAU8D,MAAV;AACA,OAAKE,MAAL;AACAjF,KAAGkF,QAAH,CAAY1D,IAAZ,EAAkB,MAAlB,EAA0B,UAAUS,EAAV,EAAc6B,IAAd,EAAoB;AAC5C,QAAI7B,EAAJ,EAAQ,KAAKC,IAAL,CAAU,OAAV,EAAmBD,EAAnB;AACR,SAAKkD,SAAL,CAAerB,IAAf,EAAqBtC,IAArB,EAA2BO,IAA3B,EAAiCgD,MAAjC;AACD,GAHyB,CAGxBH,IAHwB,CAGnB,IAHmB,CAA1B;AAIA,SAAO,IAAP;AACD,CAXD;;AAaA/D,YAAYyC,SAAZ,CAAsB8B,MAAtB,GAA+B,UAAU7C,MAAV,EAAkBD,GAAlB,EAAuBwC,IAAvB,EAA6B;AAC1DA,SAAOA,QAAQ,KAAf;AACA,MAAIhB,OAAOxD,SAAQgC,GAAR,CAAYC,MAAZ,EAAoBD,GAApB,CAAX;AACA,OAAKU,OAAL,CAAa8B,IAAb,IAAqB,EAAEhB,MAAMA,IAAR,EAAcU,QAAQlC,GAAtB,EAA2BC,QAAQA,MAAnC,EAArB;AACA,SAAO,KAAK8C,GAAL,CAASvB,IAAT,EAAegB,IAAf,CAAP;AACD,CALD;;AAOAjE,YAAYyC,SAAZ,CAAsBgC,MAAtB,GAA+B,UAAUC,GAAV,EAAexD,IAAf,EAAqB+C,IAArB,EAA2B;AACxD,OAAKG,MAAL;AACA,MAAIO,OAAOpF,IAAIqF,MAAJ,CAAWF,GAAX,CAAX;AACAT,SAAOA,QAAQU,IAAf;AACA,MAAIT,SAAS,EAACC,YAAWF,IAAZ,EAAb;AACA,OAAK9B,OAAL,CAAa8B,IAAb,IAAqB,EAAEU,MAAMA,IAAR,EAAczD,MAAMA,IAApB,EAArB;AACA,OAAKd,IAAL,CAAU8D,MAAV;AACA1E,OAAKqF,OAAL,CAAaH,GAAb,EAAkB,UAAUI,GAAV,EAAe;AAC/B,QAAIC,IAAI,EAAR;AACA,QAAIC,KAAKF,IAAIG,OAAJ,CAAY,cAAZ,CAAT;AACA,QAAI,CAAC/D,IAAL,EAAW;AACTA,aAAO8D,GAAGjD,OAAH,CAAW,MAAX,MAAuB,CAAC,CAAxB,GAA4B,MAA5B,GACAiD,GAAGjD,OAAH,CAAW,KAAX,MAAsB,CAAC,CAAvB,GAA2B,KAA3B,GACA4C,KAAKO,KAAL,CAAW,SAAX,IAAwB,MAAxB,GACAP,KAAKO,KAAL,CAAW,QAAX,IAAuB,KAAvB,GACA,IAJP;AAKAhB,aAAOhD,IAAP,GAAcA,IAAd;AACD;;AAED4D,QAAIK,EAAJ,CAAO,MAAP,EAAeJ,EAAE3E,IAAF,CAAO2D,IAAP,CAAYgB,CAAZ,CAAf,EACCI,EADD,CACI,KADJ,EACW,YAAY;AACrB,WAAKb,SAAL,CAAec,OAAOC,MAAP,CAAcN,CAAd,CAAf,EAAiCJ,IAAjC,EAAuCzD,IAAvC,EAA6CgD,MAA7C;AACD,KAFU,CAETH,IAFS,CAEJ,IAFI,CADX,EAICoB,EAJD,CAII,OAJJ,EAIa,KAAK9D,IAAL,CAAU0C,IAAV,CAAe,IAAf,EAAqB,OAArB,CAJb;AAMD,GAlBiB,CAkBhBA,IAlBgB,CAkBX,IAlBW,CAAlB,EAmBCoB,EAnBD,CAmBI,OAnBJ,EAmBa,KAAK9D,IAAL,CAAU0C,IAAV,CAAe,IAAf,EAAqB,OAArB,CAnBb,EAoBCuB,GApBD;;AAsBA,SAAO,IAAP;AACD,CA9BD;;AAgCAtF,YAAYyC,SAAZ,CAAsB6B,SAAtB,GAAkC,UAAUrB,IAAV,EAAgBtC,IAAhB,EAAsBO,IAAtB,EAA4BgD,MAA5B,EAAoC;AACpEjB,SAAO,KAAKjC,KAAL,CAAWiC,IAAX,EAAiBtC,IAAjB,EAAuBO,IAAvB,CAAP;AACA,OAAKsD,GAAL,CAASvB,IAAT,EAAeiB,MAAf;AACA,SAAO,IAAP;AACD,CAJD;;AAMAlE,YAAYyC,SAAZ,CAAsB+B,GAAtB,GAA4B,UAAUvB,IAAV,EAAgBiB,MAAhB,EAAwB;AAClD,MAAIA,UAAU,QAAOA,MAAP,yCAAOA,MAAP,OAAkB,QAAhC,EAA0C;AACxC,QAAIf,IAAI,KAAKC,IAAL,CAAUrB,OAAV,CAAkBmC,MAAlB,CAAR;AACA,QAAIf,MAAM,CAAC,CAAX,EAAc;AACZ,aAAO,KAAK9B,IAAL,CAAU,OAAV,EAAmB,IAAI6B,KAAJ,CAAU,YAAV,CAAnB,CAAP;AACD;AACD,SAAKqC,MAAL,CAAYpC,CAAZ,EAAe,CAAf,EAAkBF,IAAlB;AACAiB,aAASA,OAAOC,UAAhB;AACA,SAAKhC,OAAL,CAAa+B,MAAb,IAAuB,KAAK/B,OAAL,CAAa+B,MAAb,KAAwB,EAA/C;AACA,SAAK/B,OAAL,CAAa+B,MAAb,EAAqBjB,IAArB,GAA4BA,IAA5B;AACA;AACA,SAAKuC,QAAL;AACD,GAXD,MAWO;AACL,QAAI,OAAOtB,MAAP,KAAkB,QAAtB,EAAgC;AAC9B,WAAK/B,OAAL,CAAa+B,MAAb,IAAuB,KAAK/B,OAAL,CAAa+B,MAAb,KAAwB,EAA/C;AACA,WAAK/B,OAAL,CAAa+B,MAAb,EAAqBjB,IAArB,GAA4BA,IAA5B;AACD;AACD;AACA,SAAKmB,MAAL;AACA,SAAKhE,IAAL,CAAU6C,IAAV;AACAtB,YAAQ8D,QAAR,CAAiB,KAAKD,QAAL,CAAczB,IAAd,CAAmB,IAAnB,CAAjB;AACD;AACD,SAAO,IAAP;AACD,CAvBD;;AAyBA/D,YAAYyC,SAAZ,CAAsBzB,KAAtB,GAA8BvB,SAAQuB,KAAtC;;AAEAhB,YAAYyC,SAAZ,CAAsB2B,MAAtB,GAA+B,YAAY;AACzC,OAAKnC,SAAL;AACD,CAFD;;AAIAjC,YAAYyC,SAAZ,CAAsB+C,QAAtB,GAAiC,YAAY;AAC3C,OAAKvD,SAAL;AACA,MAAI,KAAKA,SAAL,KAAmB,CAAvB,EAA0B,KAAKZ,IAAL,CAAU,MAAV,EAAkB,IAAlB;AAC3B,CAHD","file":"index.js","sourcesContent":["var ProtoList = require('proto-list')\n  , path = require('path')\n  , fs = require('fs')\n  , ini = require('ini')\n  , EE = require('events').EventEmitter\n  , url = require('url')\n  , http = require('http')\n\nvar exports = module.exports = function () {\n  var args = [].slice.call(arguments)\n    , conf = new ConfigChain()\n\n  while(args.length) {\n    var a = args.shift()\n    if(a) conf.push\n          ( 'string' === typeof a\n            ? json(a)\n            : a )\n  }\n\n  return conf\n}\n\n//recursively find a file...\n\nvar find = exports.find = function () {\n  var rel = path.join.apply(null, [].slice.call(arguments))\n\n  function find(start, rel) {\n    var file = path.join(start, rel)\n    try {\n      fs.statSync(file)\n      return file\n    } catch (err) {\n      if(path.dirname(start) !== start) // root\n        return find(path.dirname(start), rel)\n    }\n  }\n  return find(__dirname, rel)\n}\n\nvar parse = exports.parse = function (content, file, type) {\n  content = '' + content\n  // if we don't know what it is, try json and fall back to ini\n  // if we know what it is, then it must be that.\n  if (!type) {\n    try { return JSON.parse(content) }\n    catch (er) { return ini.parse(content) }\n  } else if (type === 'json') {\n    if (this.emit) {\n      try { return JSON.parse(content) }\n      catch (er) { this.emit('error', er) }\n    } else {\n      return JSON.parse(content)\n    }\n  } else {\n    return ini.parse(content)\n  }\n}\n\nvar json = exports.json = function () {\n  var args = [].slice.call(arguments).filter(function (arg) { return arg != null })\n  var file = path.join.apply(null, args)\n  var content\n  try {\n    content = fs.readFileSync(file,'utf-8')\n  } catch (err) {\n    return\n  }\n  return parse(content, file, 'json')\n}\n\nvar env = exports.env = function (prefix, env) {\n  env = env || process.env\n  var obj = {}\n  var l = prefix.length\n  for(var k in env) {\n    if(k.indexOf(prefix) === 0)\n      obj[k.substring(l)] = env[k]\n  }\n\n  return obj\n}\n\nexports.ConfigChain = ConfigChain\nfunction ConfigChain () {\n  EE.apply(this)\n  ProtoList.apply(this, arguments)\n  this._awaiting = 0\n  this._saving = 0\n  this.sources = {}\n}\n\n// multi-inheritance-ish\nvar extras = {\n  constructor: { value: ConfigChain }\n}\nObject.keys(EE.prototype).forEach(function (k) {\n  extras[k] = Object.getOwnPropertyDescriptor(EE.prototype, k)\n})\nConfigChain.prototype = Object.create(ProtoList.prototype, extras)\n\nConfigChain.prototype.del = function (key, where) {\n  // if not specified where, then delete from the whole chain, scorched\n  // earth style\n  if (where) {\n    var target = this.sources[where]\n    target = target && target.data\n    if (!target) {\n      return this.emit('error', new Error('not found '+where))\n    }\n    delete target[key]\n  } else {\n    for (var i = 0, l = this.list.length; i < l; i ++) {\n      delete this.list[i][key]\n    }\n  }\n  return this\n}\n\nConfigChain.prototype.set = function (key, value, where) {\n  var target\n\n  if (where) {\n    target = this.sources[where]\n    target = target && target.data\n    if (!target) {\n      return this.emit('error', new Error('not found '+where))\n    }\n  } else {\n    target = this.list[0]\n    if (!target) {\n      return this.emit('error', new Error('cannot set, no confs!'))\n    }\n  }\n  target[key] = value\n  return this\n}\n\nConfigChain.prototype.get = function (key, where) {\n  if (where) {\n    where = this.sources[where]\n    if (where) where = where.data\n    if (where && Object.hasOwnProperty.call(where, key)) return where[key]\n    return undefined\n  }\n  return this.list[0][key]\n}\n\nConfigChain.prototype.save = function (where, type, cb) {\n  if (typeof type === 'function') cb = type, type = null\n  var target = this.sources[where]\n  if (!target || !(target.path || target.source) || !target.data) {\n    // TODO: maybe save() to a url target could be a PUT or something?\n    // would be easy to swap out with a reddis type thing, too\n    return this.emit('error', new Error('bad save target: '+where))\n  }\n\n  if (target.source) {\n    var pref = target.prefix || ''\n    Object.keys(target.data).forEach(function (k) {\n      target.source[pref + k] = target.data[k]\n    })\n    return this\n  }\n\n  var type = type || target.type\n  var data = target.data\n  if (target.type === 'json') {\n    data = JSON.stringify(data)\n  } else {\n    data = ini.stringify(data)\n  }\n\n  this._saving ++\n  fs.writeFile(target.path, data, 'utf8', function (er) {\n    this._saving --\n    if (er) {\n      if (cb) return cb(er)\n      else return this.emit('error', er)\n    }\n    if (this._saving === 0) {\n      if (cb) cb()\n      this.emit('save')\n    }\n  }.bind(this))\n  return this\n}\n\nConfigChain.prototype.addFile = function (file, type, name) {\n  name = name || file\n  var marker = {__source__:name}\n  this.sources[name] = { path: file, type: type }\n  this.push(marker)\n  this._await()\n  fs.readFile(file, 'utf8', function (er, data) {\n    if (er) this.emit('error', er)\n    this.addString(data, file, type, marker)\n  }.bind(this))\n  return this\n}\n\nConfigChain.prototype.addEnv = function (prefix, env, name) {\n  name = name || 'env'\n  var data = exports.env(prefix, env)\n  this.sources[name] = { data: data, source: env, prefix: prefix }\n  return this.add(data, name)\n}\n\nConfigChain.prototype.addUrl = function (req, type, name) {\n  this._await()\n  var href = url.format(req)\n  name = name || href\n  var marker = {__source__:name}\n  this.sources[name] = { href: href, type: type }\n  this.push(marker)\n  http.request(req, function (res) {\n    var c = []\n    var ct = res.headers['content-type']\n    if (!type) {\n      type = ct.indexOf('json') !== -1 ? 'json'\n           : ct.indexOf('ini') !== -1 ? 'ini'\n           : href.match(/\\.json$/) ? 'json'\n           : href.match(/\\.ini$/) ? 'ini'\n           : null\n      marker.type = type\n    }\n\n    res.on('data', c.push.bind(c))\n    .on('end', function () {\n      this.addString(Buffer.concat(c), href, type, marker)\n    }.bind(this))\n    .on('error', this.emit.bind(this, 'error'))\n\n  }.bind(this))\n  .on('error', this.emit.bind(this, 'error'))\n  .end()\n\n  return this\n}\n\nConfigChain.prototype.addString = function (data, file, type, marker) {\n  data = this.parse(data, file, type)\n  this.add(data, marker)\n  return this\n}\n\nConfigChain.prototype.add = function (data, marker) {\n  if (marker && typeof marker === 'object') {\n    var i = this.list.indexOf(marker)\n    if (i === -1) {\n      return this.emit('error', new Error('bad marker'))\n    }\n    this.splice(i, 1, data)\n    marker = marker.__source__\n    this.sources[marker] = this.sources[marker] || {}\n    this.sources[marker].data = data\n    // we were waiting for this.  maybe emit 'load'\n    this._resolve()\n  } else {\n    if (typeof marker === 'string') {\n      this.sources[marker] = this.sources[marker] || {}\n      this.sources[marker].data = data\n    }\n    // trigger the load event if nothing was already going to do so.\n    this._await()\n    this.push(data)\n    process.nextTick(this._resolve.bind(this))\n  }\n  return this\n}\n\nConfigChain.prototype.parse = exports.parse\n\nConfigChain.prototype._await = function () {\n  this._awaiting++\n}\n\nConfigChain.prototype._resolve = function () {\n  this._awaiting--\n  if (this._awaiting === 0) this.emit('load', this)\n}\n"]}