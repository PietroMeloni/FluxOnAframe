{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/config-chain/test/chain-class.js"],"names":["test","require","CC","ConfigChain","env","foo_blaz","foo_env","jsonObj","blaz","json","iniObj","fs","ini","writeFileSync","JSON","stringify","http","reqs","createServer","q","s","close","url","setTimeout","setHeader","end","listen","t","cc","expectlist","addFile","addEnv","addUrl","on","same","list","snapshot","del","shift"],"mappings":"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","file":"chain-class.js","sourcesContent":["var test = require('tap').test\nvar CC = require('../index.js').ConfigChain\n\nvar env = { foo_blaz : 'blzaa', foo_env : 'myenv' }\nvar jsonObj = { blaz: 'json', json: true }\nvar iniObj = { 'x.y.z': 'xyz', blaz: 'ini' }\n\nvar fs = require('fs')\nvar ini = require('ini')\n\nfs.writeFileSync('/tmp/config-chain-class.json', JSON.stringify(jsonObj))\nfs.writeFileSync('/tmp/config-chain-class.ini', ini.stringify(iniObj))\n\nvar http = require('http')\nvar reqs = 0\nhttp.createServer(function (q, s) {\n  if (++reqs === 2) this.close()\n  if (q.url === '/json') {\n    // make sure that the requests come back from the server\n    // out of order.  they should still be ordered properly\n    // in the resulting config object set.\n    setTimeout(function () {\n      s.setHeader('content-type', 'application/json')\n      s.end(JSON.stringify({\n        blaz: 'http',\n        http: true,\n        json: true\n      }))\n    }, 200)\n  } else {\n    s.setHeader('content-type', 'application/ini')\n    s.end(ini.stringify({\n      blaz: 'http',\n      http: true,\n      ini: true,\n      json: false\n    }))\n  }\n}).listen(1337)\n\ntest('basic class test', function (t) {\n  var cc = new CC()\n  var expectlist =\n      [ { blaz: 'json', json: true },\n        { 'x.y.z': 'xyz', blaz: 'ini' },\n        { blaz: 'blzaa', env: 'myenv' },\n        { blaz: 'http', http: true, json: true },\n        { blaz: 'http', http: true, ini: true, json: false } ]\n\n  cc.addFile('/tmp/config-chain-class.json')\n    .addFile('/tmp/config-chain-class.ini')\n    .addEnv('foo_', env)\n    .addUrl('http://localhost:1337/json')\n    .addUrl('http://localhost:1337/ini')\n    .on('load', function () {\n      t.same(cc.list, expectlist)\n      t.same(cc.snapshot, { blaz: 'json',\n                            json: true,\n                            'x.y.z': 'xyz',\n                            env: 'myenv',\n                            http: true,\n                            ini: true })\n\n      cc.del('blaz', '/tmp/config-chain-class.json')\n      t.same(cc.snapshot, { blaz: 'ini',\n                            json: true,\n                            'x.y.z': 'xyz',\n                            env: 'myenv',\n                            http: true,\n                            ini: true })\n      cc.del('blaz')\n      t.same(cc.snapshot, { json: true,\n                            'x.y.z': 'xyz',\n                            env: 'myenv',\n                            http: true,\n                            ini: true })\n      cc.shift()\n      t.same(cc.snapshot, { 'x.y.z': 'xyz',\n                            env: 'myenv',\n                            http: true,\n                            json: true,\n                            ini: true })\n      cc.shift()\n      t.same(cc.snapshot, { env: 'myenv',\n                            http: true,\n                            json: true,\n                            ini: true })\n      cc.shift()\n      t.same(cc.snapshot, { http: true,\n                            json: true,\n                            ini: true })\n      cc.shift()\n      t.same(cc.snapshot, { http: true,\n                            ini: true,\n                            json: false })\n      cc.shift()\n      t.same(cc.snapshot, {})\n      t.end()\n    })\n})\n"]}