{"version":3,"sources":["../../../../../../../../node_modules/npm/node_modules/node-gyp/node_modules/tar/lib/entry-writer.js"],"names":["module","exports","EntryWriter","tar","require","TarHeader","Entry","inherits","BlockStream","ExtendedHeaderWriter","Stream","EOF","props","me","apply","writable","readable","_stream","on","c","emit","type","size","ustar","ustarver","path","_buffer","_didHeader","_meta","_process","prototype","write","_ended","Error","push","_needDrain","length","end","pause","_paused","resume","add","entry","parent","_header","headerBlock","encode","needExtended","er","_processing","buf","i","slice","destroy"],"mappings":"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","file":"entry-writer.js","sourcesContent":["module.exports = EntryWriter\n\nvar tar = require(\"../tar.js\")\n  , TarHeader = require(\"./header.js\")\n  , Entry = require(\"./entry.js\")\n  , inherits = require(\"inherits\")\n  , BlockStream = require(\"block-stream\")\n  , ExtendedHeaderWriter\n  , Stream = require(\"stream\").Stream\n  , EOF = {}\n\ninherits(EntryWriter, Stream)\n\nfunction EntryWriter (props) {\n  var me = this\n\n  if (!(me instanceof EntryWriter)) {\n    return new EntryWriter(props)\n  }\n\n  Stream.apply(this)\n\n  me.writable = true\n  me.readable = true\n\n  me._stream = new BlockStream(512)\n\n  me._stream.on(\"data\", function (c) {\n    me.emit(\"data\", c)\n  })\n\n  me._stream.on(\"drain\", function () {\n    me.emit(\"drain\")\n  })\n\n  me._stream.on(\"end\", function () {\n    me.emit(\"end\")\n    me.emit(\"close\")\n  })\n\n  me.props = props\n  if (props.type === \"Directory\") {\n    props.size = 0\n  }\n  props.ustar = \"ustar\\0\"\n  props.ustarver = \"00\"\n  me.path = props.path\n\n  me._buffer = []\n  me._didHeader = false\n  me._meta = false\n\n  me.on(\"pipe\", function () {\n    me._process()\n  })\n}\n\nEntryWriter.prototype.write = function (c) {\n  // console.error(\".. ew write\")\n  if (this._ended) return this.emit(\"error\", new Error(\"write after end\"))\n  this._buffer.push(c)\n  this._process()\n  this._needDrain = this._buffer.length > 0\n  return !this._needDrain\n}\n\nEntryWriter.prototype.end = function (c) {\n  // console.error(\".. ew end\")\n  if (c) this._buffer.push(c)\n  this._buffer.push(EOF)\n  this._ended = true\n  this._process()\n  this._needDrain = this._buffer.length > 0\n}\n\nEntryWriter.prototype.pause = function () {\n  // console.error(\".. ew pause\")\n  this._paused = true\n  this.emit(\"pause\")\n}\n\nEntryWriter.prototype.resume = function () {\n  // console.error(\".. ew resume\")\n  this._paused = false\n  this.emit(\"resume\")\n  this._process()\n}\n\nEntryWriter.prototype.add = function (entry) {\n  // console.error(\".. ew add\")\n  if (!this.parent) return this.emit(\"error\", new Error(\"no parent\"))\n\n  // make sure that the _header and such is emitted, and clear out\n  // the _currentEntry link on the parent.\n  if (!this._ended) this.end()\n\n  return this.parent.add(entry)\n}\n\nEntryWriter.prototype._header = function () {\n  // console.error(\".. ew header\")\n  if (this._didHeader) return\n  this._didHeader = true\n\n  var headerBlock = TarHeader.encode(this.props)\n\n  if (this.props.needExtended && !this._meta) {\n    var me = this\n\n    ExtendedHeaderWriter = ExtendedHeaderWriter ||\n      require(\"./extended-header-writer.js\")\n\n    ExtendedHeaderWriter(this.props)\n      .on(\"data\", function (c) {\n        me.emit(\"data\", c)\n      })\n      .on(\"error\", function (er) {\n        me.emit(\"error\", er)\n      })\n      .end()\n  }\n\n  // console.error(\".. .. ew headerBlock emitting\")\n  this.emit(\"data\", headerBlock)\n  this.emit(\"header\")\n}\n\nEntryWriter.prototype._process = function () {\n  // console.error(\".. .. ew process\")\n  if (!this._didHeader && !this._meta) {\n    this._header()\n  }\n\n  if (this._paused || this._processing) {\n    // console.error(\".. .. .. paused=%j, processing=%j\", this._paused, this._processing)\n    return\n  }\n\n  this._processing = true\n\n  var buf = this._buffer\n  for (var i = 0; i < buf.length; i ++) {\n    // console.error(\".. .. .. i=%d\", i)\n\n    var c = buf[i]\n\n    if (c === EOF) this._stream.end()\n    else this._stream.write(c)\n\n    if (this._paused) {\n      // console.error(\".. .. .. paused mid-emission\")\n      this._processing = false\n      if (i < buf.length) {\n        this._needDrain = true\n        this._buffer = buf.slice(i + 1)\n      }\n      return\n    }\n  }\n\n  // console.error(\".. .. .. emitted\")\n  this._buffer.length = 0\n  this._processing = false\n\n  // console.error(\".. .. .. emitting drain\")\n  this.emit(\"drain\")\n}\n\nEntryWriter.prototype.destroy = function () {}\n"]}