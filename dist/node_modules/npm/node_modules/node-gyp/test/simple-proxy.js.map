{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/node-gyp/test/simple-proxy.js"],"names":["http","require","https","server","createServer","handler","port","process","argv","prefix","upstream","calls","listen","req","res","url","indexOf","Error","upstreamUrl","substring","length","console","log","get","ures","on","close","pipe"],"mappings":";;AAAA,IAAIA,OAAOC,QAAQ,MAAR,CAAX;AAAA,IACIC,QAAQD,QAAQ,OAAR,CADZ;AAAA,IAEIE,SAASH,KAAKI,YAAL,CAAkBC,OAAlB,CAFb;AAAA,IAGIC,OAAO,CAACC,QAAQC,IAAR,CAAa,CAAb,CAHZ;AAAA,IAIIC,SAASF,QAAQC,IAAR,CAAa,CAAb,CAJb;AAAA,IAKIE,WAAWH,QAAQC,IAAR,CAAa,CAAb,CALf;AAAA,IAMIG,QAAQ,CANZ;;AAQAR,OAAOS,MAAP,CAAcN,IAAd;;AAEA,SAASD,OAAT,CAAkBQ,GAAlB,EAAuBC,GAAvB,EAA4B;AAC1B,MAAID,IAAIE,GAAJ,CAAQC,OAAR,CAAgBP,MAAhB,KAA2B,CAA/B,EACE,MAAM,IAAIQ,KAAJ,CAAU,kBAAkBJ,IAAIE,GAAtB,GAA4B,yBAA5B,GAAwDN,MAAxD,GAAiE,GAA3E,CAAN;;AAEF,MAAIS,cAAcR,WAAWG,IAAIE,GAAJ,CAAQI,SAAR,CAAkBV,OAAOW,MAAzB,CAA7B;AACAC,UAAQC,GAAR,CAAYT,IAAIE,GAAJ,GAAU,MAAV,GAAmBG,WAA/B;AACAhB,QAAMqB,GAAN,CAAUL,WAAV,EAAuB,UAAUM,IAAV,EAAgB;AACrCA,SAAKC,EAAL,CAAQ,KAAR,EAAe,YAAY;AACzB,UAAI,EAAEd,KAAF,IAAW,CAAf,EACER,OAAOuB,KAAP;AACH,KAHD;AAIAF,SAAKG,IAAL,CAAUb,GAAV;AACD,GAND;AAOD","file":"simple-proxy.js","sourcesContent":["var http = require('http')\n  , https = require('https')\n  , server = http.createServer(handler)\n  , port = +process.argv[2]\n  , prefix = process.argv[3]\n  , upstream = process.argv[4]\n  , calls = 0\n\nserver.listen(port)\n\nfunction handler (req, res) {\n  if (req.url.indexOf(prefix) != 0)\n    throw new Error('request url [' + req.url + '] does not start with [' + prefix + ']')\n\n  var upstreamUrl = upstream + req.url.substring(prefix.length)\n  console.log(req.url + ' -> ' + upstreamUrl)\n  https.get(upstreamUrl, function (ures) {\n    ures.on('end', function () {\n      if (++calls == 2)\n        server.close()\n    })\n    ures.pipe(res)\n  })\n}\n"]}