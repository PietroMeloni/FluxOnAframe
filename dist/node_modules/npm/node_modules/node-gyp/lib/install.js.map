{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/node-gyp/lib/install.js"],"names":["module","exports","gyp","argv","callback","install","fs","test","download","readCAFile","usage","require","osenv","tar","rm","path","crypto","zlib","log","semver","fstream","request","mkdir","processRelease","win","process","platform","release","version","cb","err","done","warn","commands","remove","versionDir","err2","verbose","Error","lt","prerelease","opts","nodedir","devDir","resolve","ensure","stat","code","go","eaccesFallback","installVersionFile","readFile","ver","installVersion","parseInt","package","getContentSha","res","shasum","createHash","on","chunk","update","digest","created","tarPath","tarball","badDownload","extractCount","gunzip","createGunzip","extracter","Extract","strip","filter","isValid","contentShasums","expectShasums","name","substring","length","valid","type","silly","afterTarball","input","createReadStream","pipe","req","env","tarballUrl","e","statusCode","_","checksum","filename","basename","trim","async","downloadNodeLib","deref","installVersionPath","writeFile","downloadShasums","JSON","stringify","k","shasumsPath","shasumsUrl","chunks","push","lines","Buffer","concat","toString","split","forEach","line","items","replace","dir32","dir64","libPath32","libPath64","libUrl32","libUrl64","ws","createWriteStream","file","extname","noretry","indexOf","tmpdir","user","cwd","todo","args","url","http","requestOpts","uri","headers","cafile","ca","proxyUrl","proxy","http_proxy","HTTP_PROXY","npm_config_proxy","readFileSync","re","match"],"mappings":";;AAAAA,OAAOC,OAAP,GAAiBA,UAAU,iBAAUC,GAAV,EAAeC,IAAf,EAAqBC,QAArB,EAA+B;AACxD,SAAOC,QAAQC,EAAR,EAAYJ,GAAZ,EAAiBC,IAAjB,EAAuBC,QAAvB,CAAP;AACD,CAFD;;AAIAJ,OAAOC,OAAP,CAAeM,IAAf,GAAsB;AACpBC,YAAUA,QADU;AAEpBH,WAASA,OAFW;AAGpBI,cAAYA;AAHQ,CAAtB;;AAMAR,QAAQS,KAAR,GAAgB,gEAAhB;;AAEA;;;;AAIA,IAAIJ,KAAKK,QAAQ,aAAR,CAAT;AAAA,IACIC,QAAQD,QAAQ,OAAR,CADZ;AAAA,IAEIE,MAAMF,QAAQ,KAAR,CAFV;AAAA,IAGIG,KAAKH,QAAQ,QAAR,CAHT;AAAA,IAIII,OAAOJ,QAAQ,MAAR,CAJX;AAAA,IAKIK,SAASL,QAAQ,QAAR,CALb;AAAA,IAMIM,OAAON,QAAQ,MAAR,CANX;AAAA,IAOIO,MAAMP,QAAQ,QAAR,CAPV;AAAA,IAQIQ,SAASR,QAAQ,QAAR,CARb;AAAA,IASIS,UAAUT,QAAQ,SAAR,CATd;AAAA,IAUIU,UAAUV,QAAQ,SAAR,CAVd;AAAA,IAWIW,QAAQX,QAAQ,QAAR,CAXZ;AAAA,IAYIY,iBAAiBZ,QAAQ,mBAAR,CAZrB;AAAA,IAaIa,MAAMC,QAAQC,QAAR,IAAoB,OAb9B;;AAeA,SAASrB,OAAT,CAAkBC,EAAlB,EAAsBJ,GAAtB,EAA2BC,IAA3B,EAAiCC,QAAjC,EAA2C;;AAEzC,MAAIuB,UAAUJ,eAAepB,IAAf,EAAqBD,GAArB,EAA0BuB,QAAQG,OAAlC,EAA2CH,QAAQE,OAAnD,CAAd;;AAEA;AACA,WAASE,EAAT,CAAaC,GAAb,EAAkB;AAChB,QAAID,GAAGE,IAAP,EAAa;AACbF,OAAGE,IAAH,GAAU,IAAV;AACA,QAAID,GAAJ,EAAS;AACPZ,UAAIc,IAAJ,CAAS,SAAT,EAAoB,oCAApB;AACA;AACA9B,UAAI+B,QAAJ,CAAaC,MAAb,CAAoB,CAAEP,QAAQQ,UAAV,CAApB,EAA4C,UAAUC,IAAV,EAAgB;AAC1DhC,iBAAS0B,GAAT;AACD,OAFD;AAGD,KAND,MAMO;AACL1B,eAAS,IAAT,EAAeuB,QAAQC,OAAvB;AACD;AACF;;AAED;AACAV,MAAImB,OAAJ,CAAY,SAAZ,EAAuB,yBAAvB,EAAkDV,QAAQC,OAA1D;;AAEA,MAAI,CAACD,QAAQR,MAAb,EAAqB;AACnB;AACA,WAAOf,SAAS,IAAIkC,KAAJ,CAAU,6BAA6BX,QAAQC,OAA/C,CAAT,CAAP;AACD;;AAED,MAAIT,OAAOoB,EAAP,CAAUZ,QAAQC,OAAlB,EAA2B,OAA3B,CAAJ,EAAyC;AACvC,WAAOxB,SAAS,IAAIkC,KAAJ,CAAU,wDAAwDX,QAAQC,OAA1E,CAAT,CAAP;AACD;;AAED;AACA,MAAID,QAAQR,MAAR,CAAeqB,UAAf,CAA0B,CAA1B,MAAiC,KAArC,EAA4C;AAC1CtB,QAAImB,OAAJ,CAAY,6BAAZ,EAA2CV,QAAQC,OAAnD;AACA,QAAI1B,IAAIuC,IAAJ,CAASC,OAAb,EAAsB;AACpBxB,UAAImB,OAAJ,CAAY,6CAAZ,EAA2DnC,IAAIuC,IAAJ,CAASC,OAApE;AACAtC;AACD,KAHD,MAGO;AACLA,eAAS,IAAIkC,KAAJ,CAAU,4EAAV,CAAT;AACD;AACD;AACD;;AAED;AACApB,MAAImB,OAAJ,CAAY,SAAZ,EAAuB,wBAAvB,EAAiDV,QAAQQ,UAAzD;;AAEA;AACA,MAAIQ,SAAS5B,KAAK6B,OAAL,CAAa1C,IAAIyC,MAAjB,EAAyBhB,QAAQQ,UAAjC,CAAb;;AAEA;AACA;AACA,MAAIjC,IAAIuC,IAAJ,CAASI,MAAb,EAAqB;AACnB3B,QAAImB,OAAJ,CAAY,SAAZ,EAAuB,+DAAvB;AACA/B,OAAGwC,IAAH,CAAQH,MAAR,EAAgB,UAAUb,GAAV,EAAegB,IAAf,EAAqB;AACnC,UAAIhB,GAAJ,EAAS;AACP,YAAIA,IAAIiB,IAAJ,IAAY,QAAhB,EAA0B;AACxB7B,cAAImB,OAAJ,CAAY,SAAZ,EAAuB,wDAAvB,EAAiFV,QAAQC,OAAzF;AACAoB;AACD,SAHD,MAGO,IAAIlB,IAAIiB,IAAJ,IAAY,QAAhB,EAA0B;AAC/BE,yBAAenB,GAAf;AACD,SAFM,MAEA;AACLD,aAAGC,GAAH;AACD;AACD;AACD;AACDZ,UAAImB,OAAJ,CAAY,SAAZ,EAAuB,8DAAvB;AACA,UAAIa,qBAAqBnC,KAAK6B,OAAL,CAAaD,MAAb,EAAqB,gBAArB,CAAzB;AACArC,SAAG6C,QAAH,CAAYD,kBAAZ,EAAgC,OAAhC,EAAyC,UAAUpB,GAAV,EAAesB,GAAf,EAAoB;AAC3D,YAAItB,OAAOA,IAAIiB,IAAJ,IAAY,QAAvB,EAAiC;AAC/B,iBAAOlB,GAAGC,GAAH,CAAP;AACD;AACD,YAAIuB,iBAAiBC,SAASF,GAAT,EAAc,EAAd,KAAqB,CAA1C;AACAlC,YAAImB,OAAJ,CAAY,sBAAZ,EAAoCgB,cAApC;AACAnC,YAAImB,OAAJ,CAAY,wBAAZ,EAAsCnC,IAAIqD,OAAJ,CAAYF,cAAlD;AACA,YAAIA,iBAAiBnD,IAAIqD,OAAJ,CAAYF,cAAjC,EAAiD;AAC/CnC,cAAImB,OAAJ,CAAY,SAAZ,EAAuB,kCAAvB;AACAW;AACD,SAHD,MAGO;AACL9B,cAAImB,OAAJ,CAAY,SAAZ,EAAuB,iBAAvB;AACAR;AACD;AACF,OAdD;AAeD,KA7BD;AA8BD,GAhCD,MAgCO;AACLmB;AACD;;AAED,WAASQ,aAAT,CAAuBC,GAAvB,EAA4BrD,QAA5B,EAAsC;AACpC,QAAIsD,SAAS1C,OAAO2C,UAAP,CAAkB,QAAlB,CAAb;AACAF,QAAIG,EAAJ,CAAO,MAAP,EAAe,UAAUC,KAAV,EAAiB;AAC9BH,aAAOI,MAAP,CAAcD,KAAd;AACD,KAFD,EAEGD,EAFH,CAEM,KAFN,EAEa,YAAY;AACvBxD,eAAS,IAAT,EAAesD,OAAOK,MAAP,CAAc,KAAd,CAAf;AACD,KAJD;AAKD;;AAED,WAASf,EAAT,GAAe;;AAEb9B,QAAImB,OAAJ,CAAY,6BAAZ,EAA2CM,MAA3C;;AAEA;AACArB,UAAMqB,MAAN,EAAc,UAAUb,GAAV,EAAekC,OAAf,EAAwB;AACpC,UAAIlC,GAAJ,EAAS;AACP,YAAIA,IAAIiB,IAAJ,IAAY,QAAhB,EAA0B;AACxBE,yBAAenB,GAAf;AACD,SAFD,MAEO;AACLD,aAAGC,GAAH;AACD;AACD;AACD;;AAED,UAAIkC,OAAJ,EAAa;AACX9C,YAAImB,OAAJ,CAAY,iBAAZ,EAA+B2B,OAA/B;AACD;;AAED;AACA,UAAIC,UAAU/D,IAAIuC,IAAJ,CAASyB,OAAvB;AACA,UAAIC,cAAc,KAAlB;AAAA,UACIC,eAAe,CADnB;AAAA,UAEIC,SAASpD,KAAKqD,YAAL,EAFb;AAAA,UAGIC,YAAY1D,IAAI2D,OAAJ,CAAY,EAAEzD,MAAM4B,MAAR,EAAgB8B,OAAO,CAAvB,EAA0BC,QAAQC,OAAlC,EAAZ,CAHhB;;AAKA,UAAIC,iBAAiB,EAArB;AACA,UAAIC,gBAAgB,EAApB;;AAEA;AACA;AACA,eAASF,OAAT,GAAoB;AAClB,YAAIG,OAAO,KAAK/D,IAAL,CAAUgE,SAAV,CAAoBpC,OAAOqC,MAAP,GAAgB,CAApC,CAAX;AACA,YAAIL,UAAUM,MAAMH,IAAN,CAAd;AACA,YAAIA,SAAS,EAAT,IAAe,KAAKI,IAAL,KAAc,WAAjC,EAA8C;AAC5C;AACA,iBAAO,IAAP;AACD;AACD,YAAIP,OAAJ,EAAa;AACXzD,cAAImB,OAAJ,CAAY,6BAAZ,EAA2CyC,IAA3C;AACAV;AACD,SAHD,MAGO;AACL;AACAlD,cAAIiE,KAAJ,CAAU,uBAAV,EAAmCL,IAAnC;AACD;AACD,eAAOH,OAAP;AACD;;AAEDN,aAAOT,EAAP,CAAU,OAAV,EAAmB/B,EAAnB;AACA0C,gBAAUX,EAAV,CAAa,OAAb,EAAsB/B,EAAtB;AACA0C,gBAAUX,EAAV,CAAa,KAAb,EAAoBwB,YAApB;;AAEA;;AAEA,UAAInB,OAAJ,EAAa;AACX,YAAIoB,QAAQ/E,GAAGgF,gBAAH,CAAoBrB,OAApB,CAAZ;AACAoB,cAAME,IAAN,CAAWlB,MAAX,EAAmBkB,IAAnB,CAAwBhB,SAAxB;AACA;AACD;;AAED,UAAI;AACF,YAAIiB,MAAMhF,SAASN,GAAT,EAAcuB,QAAQgE,GAAtB,EAA2B9D,QAAQ+D,UAAnC,CAAV;AACD,OAFD,CAEE,OAAOC,CAAP,EAAU;AACV,eAAO9D,GAAG8D,CAAH,CAAP;AACD;;AAED;AACAH,UAAI5B,EAAJ,CAAO,OAAP,EAAgB,UAAU9B,GAAV,EAAe;AAC7B,YAAIA,IAAIiB,IAAJ,KAAa,WAAjB,EAA8B;AAC5B,iBAAOlB,GAAG,IAAIS,KAAJ,CAAU,gFAClB,yFADkB,GAElB,mBAFQ,CAAH,CAAP;AAGD;AACD6B,sBAAc,IAAd;AACAtC,WAAGC,GAAH;AACD,OARD;;AAUA0D,UAAI5B,EAAJ,CAAO,OAAP,EAAgB,YAAY;AAC1B,YAAIQ,iBAAiB,CAArB,EAAwB;AACtBvC,aAAG,IAAIS,KAAJ,CAAU,kDAAV,CAAH;AACD;AACF,OAJD;;AAMAkD,UAAI5B,EAAJ,CAAO,UAAP,EAAmB,UAAUH,GAAV,EAAe;AAChC,YAAIA,IAAImC,UAAJ,KAAmB,GAAvB,EAA4B;AAC1BzB,wBAAc,IAAd;AACAtC,aAAG,IAAIS,KAAJ,CAAUmB,IAAImC,UAAJ,GAAiB,wBAAjB,GAA4CjE,QAAQ+D,UAA9D,CAAH;AACA;AACD;AACD;AACAlC,sBAAcC,GAAd,EAAmB,UAAUoC,CAAV,EAAaC,QAAb,EAAuB;AACxC,cAAIC,WAAWhF,KAAKiF,QAAL,CAAcrE,QAAQ+D,UAAtB,EAAkCO,IAAlC,EAAf;AACArB,yBAAemB,QAAf,IAA2BD,QAA3B;AACA5E,cAAImB,OAAJ,CAAY,kBAAZ,EAAgC0D,QAAhC,EAA0CD,QAA1C;AACD,SAJD;;AAMA;AACAN,YAAID,IAAJ,CAASlB,MAAT,EAAiBkB,IAAjB,CAAsBhB,SAAtB;AACD,OAfD;;AAiBA;AACA,eAASa,YAAT,GAAyB;AACvB,YAAIjB,WAAJ,EAAiB;AACjB,YAAIC,iBAAiB,CAArB,EAAwB;AACtB,iBAAOvC,GAAG,IAAIS,KAAJ,CAAU,oEAAV,CAAH,CAAP;AACD;AACDpB,YAAImB,OAAJ,CAAY,SAAZ,EAAuB,sBAAvB;AACA,YAAI6D,QAAQ,CAAZ;;AAEA,YAAI1E,GAAJ,EAAS;AACP;AACA0E;AACAC,0BAAgBC,KAAhB;AACD;;AAED;AACAF;AACA,YAAIG,qBAAqBtF,KAAK6B,OAAL,CAAaD,MAAb,EAAqB,gBAArB,CAAzB;AACArC,WAAGgG,SAAH,CAAaD,kBAAb,EAAiCnG,IAAIqD,OAAJ,CAAYF,cAAZ,GAA6B,IAA9D,EAAoE+C,KAApE;;AAEA;AACA,YAAI,CAACnC,OAAL,EAAc;AACZ;AACAiC;AACAK,0BAAgBH,KAAhB;AACD;;AAED,YAAIF,UAAU,CAAd,EAAiB;AACf;AACArE;AACD;;AAED,iBAASuE,KAAT,CAAgBtE,GAAhB,EAAqB;AACnB,cAAIA,GAAJ,EAAS,OAAOD,GAAGC,GAAH,CAAP;;AAEToE;AACA,cAAI,CAACA,KAAL,EAAY;AACVhF,gBAAImB,OAAJ,CAAY,4BAAZ,EAA0CmE,KAAKC,SAAL,CAAe7B,cAAf,CAA1C;AACA;AACA,iBAAK,IAAI8B,CAAT,IAAc9B,cAAd,EAA8B;AAC5B1D,kBAAImB,OAAJ,CAAY,sCAAsCqE,CAAlD,EAAqD,YAArD,EAAmE9B,eAAe8B,CAAf,CAAnE,EAAsF7B,cAAc6B,CAAd,CAAtF;AACA,kBAAI9B,eAAe8B,CAAf,MAAsB7B,cAAc6B,CAAd,CAA1B,EAA4C;AAC1C7E,mBAAG,IAAIS,KAAJ,CAAUoE,IAAI,kBAAJ,GAAyB9B,eAAe8B,CAAf,CAAzB,GAA6C,oBAA7C,GAAoE7B,cAAc6B,CAAd,CAA9E,CAAH;AACA;AACD;AACF;AACD7E;AACD;AACF;AACF;;AAED,eAAS0E,eAAT,CAAyBxE,IAAzB,EAA+B;AAC7Bb,YAAImB,OAAJ,CAAY,uEAAZ;AACA,YAAIsE,cAAc5F,KAAK6B,OAAL,CAAaD,MAAb,EAAqB,gBAArB,CAAlB;;AAEAzB,YAAImB,OAAJ,CAAY,cAAZ,EAA4BV,QAAQiF,UAApC;AACA,YAAI;AACF,cAAIpB,MAAMhF,SAASN,GAAT,EAAcuB,QAAQgE,GAAtB,EAA2B9D,QAAQiF,UAAnC,CAAV;AACD,SAFD,CAEE,OAAOjB,CAAP,EAAU;AACV,iBAAO9D,GAAG8D,CAAH,CAAP;AACD;;AAEDH,YAAI5B,EAAJ,CAAO,OAAP,EAAgB7B,IAAhB;AACAyD,YAAI5B,EAAJ,CAAO,UAAP,EAAmB,UAAUH,GAAV,EAAe;AAChC,cAAIA,IAAImC,UAAJ,KAAmB,GAAvB,EAA4B;AAC1B7D,iBAAK,IAAIO,KAAJ,CAAUmB,IAAImC,UAAJ,GAAiB,mCAA3B,CAAL;AACA;AACD;;AAED,cAAIiB,SAAS,EAAb;AACApD,cAAIG,EAAJ,CAAO,MAAP,EAAe,UAAUC,KAAV,EAAiB;AAC9BgD,mBAAOC,IAAP,CAAYjD,KAAZ;AACD,WAFD;AAGAJ,cAAIG,EAAJ,CAAO,KAAP,EAAc,YAAY;AACxB,gBAAImD,QAAQC,OAAOC,MAAP,CAAcJ,MAAd,EAAsBK,QAAtB,GAAiCjB,IAAjC,GAAwCkB,KAAxC,CAA8C,IAA9C,CAAZ;AACAJ,kBAAMK,OAAN,CAAc,UAAUC,IAAV,EAAgB;AAC5B,kBAAIC,QAAQD,KAAKpB,IAAL,GAAYkB,KAAZ,CAAkB,KAAlB,CAAZ;AACA,kBAAIG,MAAMtC,MAAN,KAAiB,CAArB,EAAwB;;AAExB;AACA,kBAAIF,OAAOwC,MAAM,CAAN,EAASC,OAAT,CAAiB,OAAjB,EAA0B,EAA1B,CAAX;AACA1C,4BAAcC,IAAd,IAAsBwC,MAAM,CAAN,CAAtB;AACD,aAPD;;AASApG,gBAAImB,OAAJ,CAAY,eAAZ,EAA6BmE,KAAKC,SAAL,CAAe5B,aAAf,CAA7B;AACA9C;AACD,WAbD;AAcD,SAxBD;AAyBD;;AAED,eAASoE,eAAT,CAA0BpE,IAA1B,EAAgC;AAC9Bb,YAAImB,OAAJ,CAAY,mCAAmCV,QAAQmD,IAA3C,GAAkD,UAA9D;AACA,YAAI0C,QAAQzG,KAAK6B,OAAL,CAAaD,MAAb,EAAqB,MAArB,CAAZ;AAAA,YACI8E,QAAQ1G,KAAK6B,OAAL,CAAaD,MAAb,EAAqB,KAArB,CADZ;AAAA,YAEI+E,YAAY3G,KAAK6B,OAAL,CAAa4E,KAAb,EAAoB7F,QAAQmD,IAAR,GAAe,MAAnC,CAFhB;AAAA,YAGI6C,YAAY5G,KAAK6B,OAAL,CAAa6E,KAAb,EAAoB9F,QAAQmD,IAAR,GAAe,MAAnC,CAHhB;;AAKA5D,YAAImB,OAAJ,CAAY,YAAYV,QAAQmD,IAApB,GAA2B,UAAvC,EAAmD0C,KAAnD;AACAtG,YAAImB,OAAJ,CAAY,YAAYV,QAAQmD,IAApB,GAA2B,UAAvC,EAAmD2C,KAAnD;AACAvG,YAAImB,OAAJ,CAAY,MAAMV,QAAQmD,IAAd,GAAqB,kBAAjC,EAAqDnD,QAAQiG,QAA7D;AACA1G,YAAImB,OAAJ,CAAY,MAAMV,QAAQmD,IAAd,GAAqB,kBAAjC,EAAqDnD,QAAQkG,QAA7D;;AAEA,YAAI3B,QAAQ,CAAZ;AACA5E,cAAMkG,KAAN,EAAa,UAAU1F,GAAV,EAAe;AAC1B,cAAIA,GAAJ,EAAS,OAAOC,KAAKD,GAAL,CAAP;AACTZ,cAAImB,OAAJ,CAAY,sBAAsBV,QAAQmD,IAA9B,GAAqC,UAAjD,EAA6D4C,SAA7D;;AAEA,cAAI;AACF,gBAAIlC,MAAMhF,SAASN,GAAT,EAAcuB,QAAQgE,GAAtB,EAA2B9D,QAAQiG,QAAnC,EAA6C/F,EAA7C,CAAV;AACD,WAFD,CAEE,OAAO8D,CAAP,EAAU;AACV,mBAAO9D,GAAG8D,CAAH,CAAP;AACD;;AAEDH,cAAI5B,EAAJ,CAAO,OAAP,EAAgB7B,IAAhB;AACAyD,cAAI5B,EAAJ,CAAO,UAAP,EAAmB,UAAUH,GAAV,EAAe;AAChC,gBAAIA,IAAImC,UAAJ,KAAmB,GAAvB,EAA4B;AAC1B7D,mBAAK,IAAIO,KAAJ,CAAUmB,IAAImC,UAAJ,GAAiB,kCAAjB,GAAsDjE,QAAQmD,IAA9D,GAAqE,MAA/E,CAAL;AACA;AACD;;AAEDtB,0BAAcC,GAAd,EAAmB,UAAUoC,CAAV,EAAaC,QAAb,EAAuB;AACxClB,6BAAejD,QAAQ+F,SAAvB,IAAoC5B,QAApC;AACA5E,kBAAImB,OAAJ,CAAY,kBAAZ,EAAgCV,QAAQ+F,SAAxC,EAAmD5B,QAAnD;AACD,aAHD;;AAKA,gBAAIgC,KAAKxH,GAAGyH,iBAAH,CAAqBL,SAArB,CAAT;AACAI,eAAGlE,EAAH,CAAM,OAAN,EAAe/B,EAAf;AACA2D,gBAAID,IAAJ,CAASuC,EAAT;AACD,WAdD;AAeAtC,cAAI5B,EAAJ,CAAO,KAAP,EAAc,YAAY;AACxB,cAAEsC,KAAF,IAAWnE,MAAX;AACD,WAFD;AAGD,SA7BD;AA8BAT,cAAMmG,KAAN,EAAa,UAAU3F,GAAV,EAAe;AAC1B,cAAIA,GAAJ,EAAS,OAAOC,KAAKD,GAAL,CAAP;AACTZ,cAAImB,OAAJ,CAAY,sBAAsBV,QAAQmD,IAA9B,GAAqC,UAAjD,EAA6D6C,SAA7D;;AAEA,cAAI;AACF,gBAAInC,MAAMhF,SAASN,GAAT,EAAcuB,QAAQgE,GAAtB,EAA2B9D,QAAQkG,QAAnC,EAA6ChG,EAA7C,CAAV;AACD,WAFD,CAEE,OAAO8D,CAAP,EAAU;AACV,mBAAO9D,GAAG8D,CAAH,CAAP;AACD;;AAEDH,cAAI5B,EAAJ,CAAO,OAAP,EAAgB7B,IAAhB;AACAyD,cAAI5B,EAAJ,CAAO,UAAP,EAAmB,UAAUH,GAAV,EAAe;AAChC,gBAAIA,IAAImC,UAAJ,KAAmB,GAAvB,EAA4B;AAC1B7D,mBAAK,IAAIO,KAAJ,CAAUmB,IAAImC,UAAJ,GAAiB,kCAAjB,GAAsDjE,QAAQmD,IAA9D,GAAqE,MAA/E,CAAL;AACA;AACD;;AAEDtB,0BAAcC,GAAd,EAAmB,UAAUoC,CAAV,EAAaC,QAAb,EAAuB;AACxClB,6BAAejD,QAAQgG,SAAvB,IAAoC7B,QAApC;AACA5E,kBAAImB,OAAJ,CAAY,kBAAZ,EAAgCV,QAAQgG,SAAxC,EAAmD7B,QAAnD;AACD,aAHD;;AAKA,gBAAIgC,KAAKxH,GAAGyH,iBAAH,CAAqBJ,SAArB,CAAT;AACAG,eAAGlE,EAAH,CAAM,OAAN,EAAe/B,EAAf;AACA2D,gBAAID,IAAJ,CAASuC,EAAT;AACD,WAdD;AAeAtC,cAAI5B,EAAJ,CAAO,KAAP,EAAc,YAAY;AACxB,cAAEsC,KAAF,IAAWnE,MAAX;AACD,WAFD;AAGD,SA7BD;AA8BD,OAlQmC,CAkQlC;AAEH,KApQD,EALa,CAyQV;AAEJ,GA3WwC,CA2WvC;;AAEF;;;;AAIA,WAASkD,KAAT,CAAgB+C,IAAhB,EAAsB;AACpB;AACA,QAAIC,UAAUlH,KAAKkH,OAAL,CAAaD,IAAb,CAAd;AACA,WAAOC,YAAY,IAAZ,IAAoBA,YAAY,OAAvC;AACD;;AAED;;;;;;;;;AASA,WAAShF,cAAT,CAAyBnB,GAAzB,EAA8B;AAC5B,QAAIoG,UAAU,6BAAd;AACA,QAAI,CAAC,CAAD,KAAO/H,KAAKgI,OAAL,CAAaD,OAAb,CAAX,EAAkC,OAAOrG,GAAGC,GAAH,CAAP;AAClC,QAAIsG,SAASxH,MAAMwH,MAAN,EAAb;AACAlI,QAAIyC,MAAJ,GAAa5B,KAAK6B,OAAL,CAAawF,MAAb,EAAqB,WAArB,CAAb;AACAlH,QAAIc,IAAJ,CAAS,QAAT,EAAmB,+DAAnB,EAAoFpB,MAAMyH,IAAN,EAApF,EAAkG1F,MAAlG;AACAzB,QAAIc,IAAJ,CAAS,QAAT,EAAmB,sDAAnB,EAA2E9B,IAAIyC,MAA/E;AACA,QAAIlB,QAAQ6G,GAAR,MAAiBF,MAArB,EAA6B;AAC3BlH,UAAImB,OAAJ,CAAY,eAAZ,EAA6B,8DAA7B;AACAnC,UAAIqI,IAAJ,CAASzB,IAAT,CAAc,EAAEhC,MAAM,QAAR,EAAkB0D,MAAMrI,IAAxB,EAAd;AACD;AACDD,QAAI+B,QAAJ,CAAa5B,OAAb,CAAqB,CAAC6H,OAAD,EAAUjB,MAAV,CAAiB9G,IAAjB,CAArB,EAA6C0B,EAA7C;AACD;AAEF;;AAED,SAASrB,QAAT,CAAmBN,GAAnB,EAAwBuF,GAAxB,EAA6BgD,GAA7B,EAAkC;AAChCvH,MAAIwH,IAAJ,CAAS,KAAT,EAAgBD,GAAhB;;AAEA,MAAIE,cAAc;AACdC,SAAKH,GADS;AAEdI,aAAS;AACP,oBAAc,eAAe3I,IAAI0B,OAAnB,GAA6B,SAA7B,GAAyCH,QAAQG,OAAjD,GAA2D;AADlE;AAFK,GAAlB;;AAOA,MAAIkH,SAAS5I,IAAIuC,IAAJ,CAASqG,MAAtB;AACA,MAAIA,MAAJ,EAAY;AACVH,gBAAYI,EAAZ,GAAiBtI,WAAWqI,MAAX,CAAjB;AACD;;AAED;AACA,MAAIE,WAAW9I,IAAIuC,IAAJ,CAASwG,KAAT,IACAxD,IAAIyD,UADJ,IAEAzD,IAAI0D,UAFJ,IAGA1D,IAAI2D,gBAHnB;AAIA,MAAIJ,QAAJ,EAAc;AACZ,QAAI,gBAAgBzI,IAAhB,CAAqByI,QAArB,CAAJ,EAAoC;AAClC9H,UAAImB,OAAJ,CAAY,UAAZ,EAAwB,uBAAxB,EAAiD2G,QAAjD;AACAL,kBAAYM,KAAZ,GAAoBD,QAApB;AACD,KAHD,MAGO;AACL9H,UAAIc,IAAJ,CAAS,UAAT,EAAqB,+CAArB,EAAsEgH,QAAtE;AACD;AACF;;AAED,MAAIxD,MAAMnE,QAAQsH,WAAR,CAAV;AACAnD,MAAI5B,EAAJ,CAAO,UAAP,EAAmB,UAAUH,GAAV,EAAe;AAChCvC,QAAIwH,IAAJ,CAASjF,IAAImC,UAAb,EAAyB6C,GAAzB;AACD,GAFD;;AAIA,SAAOjD,GAAP;AACD;;AAED,SAAS/E,UAAT,CAAqBsF,QAArB,EAA+B;AAC7B;AACA;AACA,MAAIgD,KAAKzI,GAAG+I,YAAH,CAAgBtD,QAAhB,EAA0B,MAA1B,CAAT;AACA,MAAIuD,KAAK,iEAAT;AACA,SAAOP,GAAGQ,KAAH,CAASD,EAAT,CAAP;AACD","file":"install.js","sourcesContent":["module.exports = exports = function (gyp, argv, callback) {\n  return install(fs, gyp, argv, callback)\n}\n\nmodule.exports.test = {\n  download: download,\n  install: install,\n  readCAFile: readCAFile,\n}\n\nexports.usage = 'Install node development files for the specified node version.'\n\n/**\n * Module dependencies.\n */\n\nvar fs = require('graceful-fs')\n  , osenv = require('osenv')\n  , tar = require('tar')\n  , rm = require('rimraf')\n  , path = require('path')\n  , crypto = require('crypto')\n  , zlib = require('zlib')\n  , log = require('npmlog')\n  , semver = require('semver')\n  , fstream = require('fstream')\n  , request = require('request')\n  , mkdir = require('mkdirp')\n  , processRelease = require('./process-release')\n  , win = process.platform == 'win32'\n\nfunction install (fs, gyp, argv, callback) {\n\n  var release = processRelease(argv, gyp, process.version, process.release)\n\n  // ensure no double-callbacks happen\n  function cb (err) {\n    if (cb.done) return\n    cb.done = true\n    if (err) {\n      log.warn('install', 'got an error, rolling back install')\n      // roll-back the install if anything went wrong\n      gyp.commands.remove([ release.versionDir ], function (err2) {\n        callback(err)\n      })\n    } else {\n      callback(null, release.version)\n    }\n  }\n\n  // Determine which node dev files version we are installing\n  log.verbose('install', 'input version string %j', release.version)\n\n  if (!release.semver) {\n    // could not parse the version string with semver\n    return callback(new Error('Invalid version number: ' + release.version))\n  }\n\n  if (semver.lt(release.version, '0.8.0')) {\n    return callback(new Error('Minimum target version is `0.8.0` or greater. Got: ' + release.version))\n  }\n\n  // 0.x.y-pre versions are not published yet and cannot be installed. Bail.\n  if (release.semver.prerelease[0] === 'pre') {\n    log.verbose('detected \"pre\" node version', release.version)\n    if (gyp.opts.nodedir) {\n      log.verbose('--nodedir flag was passed; skipping install', gyp.opts.nodedir)\n      callback()\n    } else {\n      callback(new Error('\"pre\" versions of node cannot be installed, use the --nodedir flag instead'))\n    }\n    return\n  }\n\n  // flatten version into String\n  log.verbose('install', 'installing version: %s', release.versionDir)\n\n  // the directory where the dev files will be installed\n  var devDir = path.resolve(gyp.devDir, release.versionDir)\n\n  // If '--ensure' was passed, then don't *always* install the version;\n  // check if it is already installed, and only install when needed\n  if (gyp.opts.ensure) {\n    log.verbose('install', '--ensure was passed, so won\\'t reinstall if already installed')\n    fs.stat(devDir, function (err, stat) {\n      if (err) {\n        if (err.code == 'ENOENT') {\n          log.verbose('install', 'version not already installed, continuing with install', release.version)\n          go()\n        } else if (err.code == 'EACCES') {\n          eaccesFallback(err)\n        } else {\n          cb(err)\n        }\n        return\n      }\n      log.verbose('install', 'version is already installed, need to check \"installVersion\"')\n      var installVersionFile = path.resolve(devDir, 'installVersion')\n      fs.readFile(installVersionFile, 'ascii', function (err, ver) {\n        if (err && err.code != 'ENOENT') {\n          return cb(err)\n        }\n        var installVersion = parseInt(ver, 10) || 0\n        log.verbose('got \"installVersion\"', installVersion)\n        log.verbose('needs \"installVersion\"', gyp.package.installVersion)\n        if (installVersion < gyp.package.installVersion) {\n          log.verbose('install', 'version is no good; reinstalling')\n          go()\n        } else {\n          log.verbose('install', 'version is good')\n          cb()\n        }\n      })\n    })\n  } else {\n    go()\n  }\n\n  function getContentSha(res, callback) {\n    var shasum = crypto.createHash('sha256')\n    res.on('data', function (chunk) {\n      shasum.update(chunk)\n    }).on('end', function () {\n      callback(null, shasum.digest('hex'))\n    })\n  }\n\n  function go () {\n\n    log.verbose('ensuring nodedir is created', devDir)\n\n    // first create the dir for the node dev files\n    mkdir(devDir, function (err, created) {\n      if (err) {\n        if (err.code == 'EACCES') {\n          eaccesFallback(err)\n        } else {\n          cb(err)\n        }\n        return\n      }\n\n      if (created) {\n        log.verbose('created nodedir', created)\n      }\n\n      // now download the node tarball\n      var tarPath = gyp.opts.tarball\n      var badDownload = false\n        , extractCount = 0\n        , gunzip = zlib.createGunzip()\n        , extracter = tar.Extract({ path: devDir, strip: 1, filter: isValid })\n\n      var contentShasums = {}\n      var expectShasums = {}\n\n      // checks if a file to be extracted from the tarball is valid.\n      // only .h header files and the gyp files get extracted\n      function isValid () {\n        var name = this.path.substring(devDir.length + 1)\n        var isValid = valid(name)\n        if (name === '' && this.type === 'Directory') {\n          // the first directory entry is ok\n          return true\n        }\n        if (isValid) {\n          log.verbose('extracted file from tarball', name)\n          extractCount++\n        } else {\n          // invalid\n          log.silly('ignoring from tarball', name)\n        }\n        return isValid\n      }\n\n      gunzip.on('error', cb)\n      extracter.on('error', cb)\n      extracter.on('end', afterTarball)\n\n      // download the tarball, gunzip and extract!\n\n      if (tarPath) {\n        var input = fs.createReadStream(tarPath)\n        input.pipe(gunzip).pipe(extracter)\n        return\n      }\n\n      try {\n        var req = download(gyp, process.env, release.tarballUrl)\n      } catch (e) {\n        return cb(e)\n      }\n\n      // something went wrong downloading the tarball?\n      req.on('error', function (err) {\n        if (err.code === 'ENOTFOUND') {\n          return cb(new Error('This is most likely not a problem with node-gyp or the package itself and\\n' +\n            'is related to network connectivity. In most cases you are behind a proxy or have bad \\n' +\n            'network settings.'))\n        }\n        badDownload = true\n        cb(err)\n      })\n\n      req.on('close', function () {\n        if (extractCount === 0) {\n          cb(new Error('Connection closed while downloading tarball file'))\n        }\n      })\n\n      req.on('response', function (res) {\n        if (res.statusCode !== 200) {\n          badDownload = true\n          cb(new Error(res.statusCode + ' response downloading ' + release.tarballUrl))\n          return\n        }\n        // content checksum\n        getContentSha(res, function (_, checksum) {\n          var filename = path.basename(release.tarballUrl).trim()\n          contentShasums[filename] = checksum\n          log.verbose('content checksum', filename, checksum)\n        })\n\n        // start unzipping and untaring\n        req.pipe(gunzip).pipe(extracter)\n      })\n\n      // invoked after the tarball has finished being extracted\n      function afterTarball () {\n        if (badDownload) return\n        if (extractCount === 0) {\n          return cb(new Error('There was a fatal problem while downloading/extracting the tarball'))\n        }\n        log.verbose('tarball', 'done parsing tarball')\n        var async = 0\n\n        if (win) {\n          // need to download node.lib\n          async++\n          downloadNodeLib(deref)\n        }\n\n        // write the \"installVersion\" file\n        async++\n        var installVersionPath = path.resolve(devDir, 'installVersion')\n        fs.writeFile(installVersionPath, gyp.package.installVersion + '\\n', deref)\n\n        // Only download SHASUMS.txt if not using tarPath override\n        if (!tarPath) {\n          // download SHASUMS.txt\n          async++\n          downloadShasums(deref)\n        }\n\n        if (async === 0) {\n          // no async tasks required\n          cb()\n        }\n\n        function deref (err) {\n          if (err) return cb(err)\n\n          async--\n          if (!async) {\n            log.verbose('download contents checksum', JSON.stringify(contentShasums))\n            // check content shasums\n            for (var k in contentShasums) {\n              log.verbose('validating download checksum for ' + k, '(%s == %s)', contentShasums[k], expectShasums[k])\n              if (contentShasums[k] !== expectShasums[k]) {\n                cb(new Error(k + ' local checksum ' + contentShasums[k] + ' not match remote ' + expectShasums[k]))\n                return\n              }\n            }\n            cb()\n          }\n        }\n      }\n\n      function downloadShasums(done) {\n        log.verbose('check download content checksum, need to download `SHASUMS256.txt`...')\n        var shasumsPath = path.resolve(devDir, 'SHASUMS256.txt')\n\n        log.verbose('checksum url', release.shasumsUrl)\n        try {\n          var req = download(gyp, process.env, release.shasumsUrl)\n        } catch (e) {\n          return cb(e)\n        }\n\n        req.on('error', done)\n        req.on('response', function (res) {\n          if (res.statusCode !== 200) {\n            done(new Error(res.statusCode + ' status code downloading checksum'))\n            return\n          }\n\n          var chunks = []\n          res.on('data', function (chunk) {\n            chunks.push(chunk)\n          })\n          res.on('end', function () {\n            var lines = Buffer.concat(chunks).toString().trim().split('\\n')\n            lines.forEach(function (line) {\n              var items = line.trim().split(/\\s+/)\n              if (items.length !== 2) return\n\n              // 0035d18e2dcf9aad669b1c7c07319e17abfe3762  ./node-v0.11.4.tar.gz\n              var name = items[1].replace(/^\\.\\//, '')\n              expectShasums[name] = items[0]\n            })\n\n            log.verbose('checksum data', JSON.stringify(expectShasums))\n            done()\n          })\n        })\n      }\n\n      function downloadNodeLib (done) {\n        log.verbose('on Windows; need to download `' + release.name + '.lib`...')\n        var dir32 = path.resolve(devDir, 'ia32')\n          , dir64 = path.resolve(devDir, 'x64')\n          , libPath32 = path.resolve(dir32, release.name + '.lib')\n          , libPath64 = path.resolve(dir64, release.name + '.lib')\n\n        log.verbose('32-bit ' + release.name + '.lib dir', dir32)\n        log.verbose('64-bit ' + release.name + '.lib dir', dir64)\n        log.verbose('`' + release.name + '.lib` 32-bit url', release.libUrl32)\n        log.verbose('`' + release.name + '.lib` 64-bit url', release.libUrl64)\n\n        var async = 2\n        mkdir(dir32, function (err) {\n          if (err) return done(err)\n          log.verbose('streaming 32-bit ' + release.name + '.lib to:', libPath32)\n\n          try {\n            var req = download(gyp, process.env, release.libUrl32, cb)\n          } catch (e) {\n            return cb(e)\n          }\n\n          req.on('error', done)\n          req.on('response', function (res) {\n            if (res.statusCode !== 200) {\n              done(new Error(res.statusCode + ' status code downloading 32-bit ' + release.name + '.lib'))\n              return\n            }\n\n            getContentSha(res, function (_, checksum) {\n              contentShasums[release.libPath32] = checksum\n              log.verbose('content checksum', release.libPath32, checksum)\n            })\n\n            var ws = fs.createWriteStream(libPath32)\n            ws.on('error', cb)\n            req.pipe(ws)\n          })\n          req.on('end', function () {\n            --async || done()\n          })\n        })\n        mkdir(dir64, function (err) {\n          if (err) return done(err)\n          log.verbose('streaming 64-bit ' + release.name + '.lib to:', libPath64)\n\n          try {\n            var req = download(gyp, process.env, release.libUrl64, cb)\n          } catch (e) {\n            return cb(e)\n          }\n\n          req.on('error', done)\n          req.on('response', function (res) {\n            if (res.statusCode !== 200) {\n              done(new Error(res.statusCode + ' status code downloading 64-bit ' + release.name + '.lib'))\n              return\n            }\n\n            getContentSha(res, function (_, checksum) {\n              contentShasums[release.libPath64] = checksum\n              log.verbose('content checksum', release.libPath64, checksum)\n            })\n\n            var ws = fs.createWriteStream(libPath64)\n            ws.on('error', cb)\n            req.pipe(ws)\n          })\n          req.on('end', function () {\n            --async || done()\n          })\n        })\n      } // downloadNodeLib()\n\n    }) // mkdir()\n\n  } // go()\n\n  /**\n   * Checks if a given filename is \"valid\" for this installation.\n   */\n\n  function valid (file) {\n    // header files\n    var extname = path.extname(file);\n    return extname === '.h' || extname === '.gypi';\n  }\n\n  /**\n   * The EACCES fallback is a workaround for npm's `sudo` behavior, where\n   * it drops the permissions before invoking any child processes (like\n   * node-gyp). So what happens is the \"nobody\" user doesn't have\n   * permission to create the dev dir. As a fallback, make the tmpdir() be\n   * the dev dir for this installation. This is not ideal, but at least\n   * the compilation will succeed...\n   */\n\n  function eaccesFallback (err) {\n    var noretry = '--node_gyp_internal_noretry'\n    if (-1 !== argv.indexOf(noretry)) return cb(err)\n    var tmpdir = osenv.tmpdir()\n    gyp.devDir = path.resolve(tmpdir, '.node-gyp')\n    log.warn('EACCES', 'user \"%s\" does not have permission to access the dev dir \"%s\"', osenv.user(), devDir)\n    log.warn('EACCES', 'attempting to reinstall using temporary dev dir \"%s\"', gyp.devDir)\n    if (process.cwd() == tmpdir) {\n      log.verbose('tmpdir == cwd', 'automatically will remove dev files after to save disk space')\n      gyp.todo.push({ name: 'remove', args: argv })\n    }\n    gyp.commands.install([noretry].concat(argv), cb)\n  }\n\n}\n\nfunction download (gyp, env, url) {\n  log.http('GET', url)\n\n  var requestOpts = {\n      uri: url\n    , headers: {\n        'User-Agent': 'node-gyp v' + gyp.version + ' (node ' + process.version + ')'\n      }\n  }\n\n  var cafile = gyp.opts.cafile\n  if (cafile) {\n    requestOpts.ca = readCAFile(cafile)\n  }\n\n  // basic support for a proxy server\n  var proxyUrl = gyp.opts.proxy\n              || env.http_proxy\n              || env.HTTP_PROXY\n              || env.npm_config_proxy\n  if (proxyUrl) {\n    if (/^https?:\\/\\//i.test(proxyUrl)) {\n      log.verbose('download', 'using proxy url: \"%s\"', proxyUrl)\n      requestOpts.proxy = proxyUrl\n    } else {\n      log.warn('download', 'ignoring invalid \"proxy\" config setting: \"%s\"', proxyUrl)\n    }\n  }\n\n  var req = request(requestOpts)\n  req.on('response', function (res) {\n    log.http(res.statusCode, url)\n  })\n\n  return req\n}\n\nfunction readCAFile (filename) {\n  // The CA file can contain multiple certificates so split on certificate\n  // boundaries.  [\\S\\s]*? is used to match everything including newlines.\n  var ca = fs.readFileSync(filename, 'utf8')\n  var re = /(-----BEGIN CERTIFICATE-----[\\S\\s]*?-----END CERTIFICATE-----)/g\n  return ca.match(re)\n}\n"]}