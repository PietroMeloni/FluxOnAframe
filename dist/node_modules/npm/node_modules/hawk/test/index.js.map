{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/hawk/test/index.js"],"names":["Url","require","Code","Hawk","Lab","internals","lab","exports","script","describe","experiment","it","test","expect","credentialsFunc","id","callback","credentials","key","algorithm","user","done","req","method","url","host","port","err","credentials1","authorization","client","header","parse","ext","field","to","exist","server","authenticate","credentials2","artifacts","not","equal","headers","payload","reqHeader","contentType","authenticatePayload","res","be","true","false","app","dlg","output","message"],"mappings":"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","file":"index.js","sourcesContent":["// Load modules\r\n\r\nvar Url = require('url');\r\nvar Code = require('code');\r\nvar Hawk = require('../lib');\r\nvar Lab = require('lab');\r\n\r\n\r\n// Declare internals\r\n\r\nvar internals = {};\r\n\r\n\r\n// Test shortcuts\r\n\r\nvar lab = exports.lab = Lab.script();\r\nvar describe = lab.experiment;\r\nvar it = lab.test;\r\nvar expect = Code.expect;\r\n\r\n\r\ndescribe('Hawk', function () {\r\n\r\n    var credentialsFunc = function (id, callback) {\r\n\r\n        var credentials = {\r\n            id: id,\r\n            key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n            algorithm: (id === '1' ? 'sha1' : 'sha256'),\r\n            user: 'steve'\r\n        };\r\n\r\n        return callback(null, credentials);\r\n    };\r\n\r\n    it('generates a header then successfully parse it (configuration)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Hawk.client.header(Url.parse('http://example.com:8080/resource/4?filter=a'), req.method, { credentials: credentials1, ext: 'some-app-data' }).field;\r\n            expect(req.authorization).to.exist();\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (node request)', function (done) {\r\n\r\n        var req = {\r\n            method: 'POST',\r\n            url: '/resource/4?filter=a',\r\n            headers: {\r\n                host: 'example.com:8080',\r\n                'content-type': 'text/plain;x=y'\r\n            }\r\n        };\r\n\r\n        var payload = 'some not so random text';\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var reqHeader = Hawk.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', payload: payload, contentType: req.headers['content-type'] });\r\n            req.headers.authorization = reqHeader.field;\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers['content-type'])).to.equal(true);\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain'\r\n                    }\r\n                };\r\n\r\n                res.headers['server-authorization'] = Hawk.server.header(credentials2, artifacts, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n                expect(res.headers['server-authorization']).to.exist();\r\n\r\n                expect(Hawk.client.authenticate(res, credentials2, artifacts, { payload: 'some reply' })).to.equal(true);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (absolute request uri)', function (done) {\r\n\r\n        var req = {\r\n            method: 'POST',\r\n            url: 'http://example.com:8080/resource/4?filter=a',\r\n            headers: {\r\n                host: 'example.com:8080',\r\n                'content-type': 'text/plain;x=y'\r\n            }\r\n        };\r\n\r\n        var payload = 'some not so random text';\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var reqHeader = Hawk.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', payload: payload, contentType: req.headers['content-type'] });\r\n            req.headers.authorization = reqHeader.field;\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers['content-type'])).to.equal(true);\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain'\r\n                    }\r\n                };\r\n\r\n                res.headers['server-authorization'] = Hawk.server.header(credentials2, artifacts, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n                expect(res.headers['server-authorization']).to.exist();\r\n\r\n                expect(Hawk.client.authenticate(res, credentials2, artifacts, { payload: 'some reply' })).to.equal(true);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (no server header options)', function (done) {\r\n\r\n        var req = {\r\n            method: 'POST',\r\n            url: '/resource/4?filter=a',\r\n            headers: {\r\n                host: 'example.com:8080',\r\n                'content-type': 'text/plain;x=y'\r\n            }\r\n        };\r\n\r\n        var payload = 'some not so random text';\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var reqHeader = Hawk.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', payload: payload, contentType: req.headers['content-type'] });\r\n            req.headers.authorization = reqHeader.field;\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers['content-type'])).to.equal(true);\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain'\r\n                    }\r\n                };\r\n\r\n                res.headers['server-authorization'] = Hawk.server.header(credentials2, artifacts);\r\n                expect(res.headers['server-authorization']).to.exist();\r\n\r\n                expect(Hawk.client.authenticate(res, credentials2, artifacts)).to.equal(true);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then fails to parse it (missing server header hash)', function (done) {\r\n\r\n        var req = {\r\n            method: 'POST',\r\n            url: '/resource/4?filter=a',\r\n            headers: {\r\n                host: 'example.com:8080',\r\n                'content-type': 'text/plain;x=y'\r\n            }\r\n        };\r\n\r\n        var payload = 'some not so random text';\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var reqHeader = Hawk.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', payload: payload, contentType: req.headers['content-type'] });\r\n            req.headers.authorization = reqHeader.field;\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers['content-type'])).to.equal(true);\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain'\r\n                    }\r\n                };\r\n\r\n                res.headers['server-authorization'] = Hawk.server.header(credentials2, artifacts);\r\n                expect(res.headers['server-authorization']).to.exist();\r\n\r\n                expect(Hawk.client.authenticate(res, credentials2, artifacts, { payload: 'some reply' })).to.equal(false);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (with hash)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Hawk.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, payload: 'hola!', ext: 'some-app-data' }).field;\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it then validate payload', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Hawk.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, payload: 'hola!', ext: 'some-app-data' }).field;\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(Hawk.server.authenticatePayload('hola!', credentials2, artifacts)).to.be.true();\r\n                expect(Hawk.server.authenticatePayload('hello!', credentials2, artifacts)).to.be.false();\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parses and validates payload', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Hawk.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, payload: 'hola!', ext: 'some-app-data' }).field;\r\n            Hawk.server.authenticate(req, credentialsFunc, { payload: 'hola!' }, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (app)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Hawk.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', app: 'asd23ased' }).field;\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(artifacts.app).to.equal('asd23ased');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (app, dlg)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Hawk.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', app: 'asd23ased', dlg: '23434szr3q4d' }).field;\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(artifacts.app).to.equal('asd23ased');\r\n                expect(artifacts.dlg).to.equal('23434szr3q4d');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then fail authentication due to bad hash', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Hawk.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, payload: 'hola!', ext: 'some-app-data' }).field;\r\n            Hawk.server.authenticate(req, credentialsFunc, { payload: 'byebye!' }, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Bad payload hash');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header for one resource then fail to authenticate another', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Hawk.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data' }).field;\r\n            req.url = '/something/else';\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(credentials2).to.exist();\r\n                done();\r\n            });\r\n        });\r\n    });\r\n});\r\n"]}