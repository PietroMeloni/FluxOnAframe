{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/hawk/test/browser.js"],"names":["Url","require","Code","Hawk","Hoek","Lab","Browser","internals","lab","exports","script","describe","experiment","it","test","expect","credentialsFunc","id","callback","credentials","key","algorithm","user","done","req","method","url","host","port","err","credentials1","bewit","client","ttlSec","ext","uri","authenticate","credentials2","attributes","to","not","exist","equal","localtimeOffsetMsec","utils","now","authorization","header","field","server","artifacts","headers","payload","reqHeader","contentType","authenticatePayload","res","getResponseHeader","toLowerCase","getHeader","setNtpOffset","artifacts2","message","output","lookup","getNtpOffset","credentials3","artifacts3","localStorage","LocalStorage","setStorage","parseInt","getItem","be","true","false","app","dlg","timestamp","nonce","parseUri","options","hash","crypto","calculatePayloadHash","ts","resource","undefined","mac","auth","authenticateMessage","creds","clone","tsm","timestampMessage","authenticateTimestamp","offset","storage","length","setItem","removeItem","clear","parallel","orig","consoleOrig","console","error","count","Error","throw","parseAuthorizationHeader","deep","parts","protocol","password","hostname","pathname","query","fragment","userInfo","authority","relative","source","str","base64str","base64urlEncode"],"mappings":"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","file":"browser.js","sourcesContent":["// Load modules\r\n\r\nvar Url = require('url');\r\nvar Code = require('code');\r\nvar Hawk = require('../lib');\r\nvar Hoek = require('hoek');\r\nvar Lab = require('lab');\r\nvar Browser = require('../lib/browser');\r\n\r\n\r\n// Declare internals\r\n\r\nvar internals = {};\r\n\r\n\r\n// Test shortcuts\r\n\r\nvar lab = exports.lab = Lab.script();\r\nvar describe = lab.experiment;\r\nvar it = lab.test;\r\nvar expect = Code.expect;\r\n\r\n\r\ndescribe('Browser', function () {\r\n\r\n    var credentialsFunc = function (id, callback) {\r\n\r\n        var credentials = {\r\n            id: id,\r\n            key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n            algorithm: (id === '1' ? 'sha1' : 'sha256'),\r\n            user: 'steve'\r\n        };\r\n\r\n        return callback(null, credentials);\r\n    };\r\n\r\n    it('should generate a bewit then successfully authenticate it', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?a=1&b=2',\r\n            host: 'example.com',\r\n            port: 80\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var bewit = Browser.client.bewit('http://example.com/resource/4?a=1&b=2', { credentials: credentials1, ttlSec: 60 * 60 * 24 * 365 * 100, ext: 'some-app-data' });\r\n            req.url += '&bewit=' + bewit;\r\n\r\n            Hawk.uri.authenticate(req, credentialsFunc, {}, function (err, credentials2, attributes) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(attributes.ext).to.equal('some-app-data');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('should generate a bewit then successfully authenticate it (no ext)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?a=1&b=2',\r\n            host: 'example.com',\r\n            port: 80\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var bewit = Browser.client.bewit('http://example.com/resource/4?a=1&b=2', { credentials: credentials1, ttlSec: 60 * 60 * 24 * 365 * 100 });\r\n            req.url += '&bewit=' + bewit;\r\n\r\n            Hawk.uri.authenticate(req, credentialsFunc, {}, function (err, credentials2, attributes) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    describe('bewit()', function () {\r\n\r\n        it('returns a valid bewit value', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('https://example.com/somewhere/over/the/rainbow', { credentials: credentials, ttlSec: 300, localtimeOffsetMsec: 1356420407232 - Hawk.utils.now(), ext: 'xandyandz' });\r\n            expect(bewit).to.equal('MTIzNDU2XDEzNTY0MjA3MDdca3NjeHdOUjJ0SnBQMVQxekRMTlBiQjVVaUtJVTl0T1NKWFRVZEc3WDloOD1ceGFuZHlhbmR6');\r\n            done();\r\n        });\r\n\r\n        it('returns a valid bewit value (explicit HTTP port)', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('http://example.com:8080/somewhere/over/the/rainbow', { credentials: credentials, ttlSec: 300, localtimeOffsetMsec: 1356420407232 - Hawk.utils.now(), ext: 'xandyandz' });\r\n            expect(bewit).to.equal('MTIzNDU2XDEzNTY0MjA3MDdcaFpiSjNQMmNLRW80a3kwQzhqa1pBa1J5Q1p1ZWc0V1NOYnhWN3ZxM3hIVT1ceGFuZHlhbmR6');\r\n            done();\r\n        });\r\n\r\n        it('returns a valid bewit value (explicit HTTPS port)', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('https://example.com:8043/somewhere/over/the/rainbow', { credentials: credentials, ttlSec: 300, localtimeOffsetMsec: 1356420407232 - Hawk.utils.now(), ext: 'xandyandz' });\r\n            expect(bewit).to.equal('MTIzNDU2XDEzNTY0MjA3MDdcL2t4UjhwK0xSaTdvQTRnUXc3cWlxa3BiVHRKYkR4OEtRMC9HRUwvVytTUT1ceGFuZHlhbmR6');\r\n            done();\r\n        });\r\n\r\n        it('returns a valid bewit value (null ext)', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('https://example.com/somewhere/over/the/rainbow', { credentials: credentials, ttlSec: 300, localtimeOffsetMsec: 1356420407232 - Hawk.utils.now(), ext: null });\r\n            expect(bewit).to.equal('MTIzNDU2XDEzNTY0MjA3MDdcSUdZbUxnSXFMckNlOEN4dktQczRKbFdJQStValdKSm91d2dBUmlWaENBZz1c');\r\n            done();\r\n        });\r\n\r\n        it('errors on invalid options', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('https://example.com/somewhere/over/the/rainbow', 4);\r\n            expect(bewit).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on missing uri', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('', { credentials: credentials, ttlSec: 300, localtimeOffsetMsec: 1356420407232 - Hawk.utils.now(), ext: 'xandyandz' });\r\n            expect(bewit).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on invalid uri', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit(5, { credentials: credentials, ttlSec: 300, localtimeOffsetMsec: 1356420407232 - Hawk.utils.now(), ext: 'xandyandz' });\r\n            expect(bewit).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on invalid credentials (id)', function (done) {\r\n\r\n            var credentials = {\r\n                key: '2983d45yun89q',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('https://example.com/somewhere/over/the/rainbow', { credentials: credentials, ttlSec: 3000, ext: 'xandyandz' });\r\n            expect(bewit).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on missing credentials', function (done) {\r\n\r\n            var bewit = Browser.client.bewit('https://example.com/somewhere/over/the/rainbow', { ttlSec: 3000, ext: 'xandyandz' });\r\n            expect(bewit).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on invalid credentials (key)', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('https://example.com/somewhere/over/the/rainbow', { credentials: credentials, ttlSec: 3000, ext: 'xandyandz' });\r\n            expect(bewit).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on invalid algorithm', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'hmac-sha-0'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('https://example.com/somewhere/over/the/rainbow', { credentials: credentials, ttlSec: 300, ext: 'xandyandz' });\r\n            expect(bewit).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on missing options', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'hmac-sha-0'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('https://example.com/somewhere/over/the/rainbow');\r\n            expect(bewit).to.equal('');\r\n            done();\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (configuration)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data' }).field;\r\n            expect(req.authorization).to.exist();\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (node request)', function (done) {\r\n\r\n        var req = {\r\n            method: 'POST',\r\n            url: '/resource/4?filter=a',\r\n            headers: {\r\n                host: 'example.com:8080',\r\n                'content-type': 'text/plain;x=y'\r\n            }\r\n        };\r\n\r\n        var payload = 'some not so random text';\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var reqHeader = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', payload: payload, contentType: req.headers['content-type'] });\r\n            req.headers.authorization = reqHeader.field;\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers['content-type'])).to.equal(true);\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                res.headers['server-authorization'] = Hawk.server.header(credentials2, artifacts, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n                expect(res.headers['server-authorization']).to.exist();\r\n\r\n                expect(Browser.client.authenticate(res, credentials2, artifacts, { payload: 'some reply' })).to.equal(true);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (browserify)', function (done) {\r\n\r\n        var req = {\r\n            method: 'POST',\r\n            url: '/resource/4?filter=a',\r\n            headers: {\r\n                host: 'example.com:8080',\r\n                'content-type': 'text/plain;x=y'\r\n            }\r\n        };\r\n\r\n        var payload = 'some not so random text';\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var reqHeader = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', payload: payload, contentType: req.headers['content-type'] });\r\n            req.headers.authorization = reqHeader.field;\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers['content-type'])).to.equal(true);\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain'\r\n                    },\r\n                    getHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                res.headers['server-authorization'] = Hawk.server.header(credentials2, artifacts, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n                expect(res.headers['server-authorization']).to.exist();\r\n\r\n                expect(Browser.client.authenticate(res, credentials2, artifacts, { payload: 'some reply' })).to.equal(true);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (time offset)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', localtimeOffsetMsec: 100000 }).field;\r\n            expect(req.authorization).to.exist();\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 100000 }, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (no server header options)', function (done) {\r\n\r\n        var req = {\r\n            method: 'POST',\r\n            url: '/resource/4?filter=a',\r\n            headers: {\r\n                host: 'example.com:8080',\r\n                'content-type': 'text/plain;x=y'\r\n            }\r\n        };\r\n\r\n        var payload = 'some not so random text';\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var reqHeader = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', payload: payload, contentType: req.headers['content-type'] });\r\n            req.headers.authorization = reqHeader.field;\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers['content-type'])).to.equal(true);\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                res.headers['server-authorization'] = Hawk.server.header(credentials2, artifacts);\r\n                expect(res.headers['server-authorization']).to.exist();\r\n\r\n                expect(Browser.client.authenticate(res, credentials2, artifacts)).to.equal(true);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (no server header)', function (done) {\r\n\r\n        var req = {\r\n            method: 'POST',\r\n            url: '/resource/4?filter=a',\r\n            headers: {\r\n                host: 'example.com:8080',\r\n                'content-type': 'text/plain;x=y'\r\n            }\r\n        };\r\n\r\n        var payload = 'some not so random text';\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var reqHeader = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', payload: payload, contentType: req.headers['content-type'] });\r\n            req.headers.authorization = reqHeader.field;\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers['content-type'])).to.equal(true);\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                expect(Browser.client.authenticate(res, credentials2, artifacts)).to.equal(true);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header with stale ts and successfully authenticate on second call', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            Browser.utils.setNtpOffset(60 * 60 * 1000);\r\n            var header = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data' });\r\n            req.authorization = header.field;\r\n            expect(req.authorization).to.exist();\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts2) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.message).to.equal('Stale timestamp');\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'www-authenticate': err.output.headers['WWW-Authenticate']\r\n                    },\r\n                    getResponseHeader: function (lookup) {\r\n\r\n                        return res.headers[lookup.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                expect(Browser.utils.getNtpOffset()).to.equal(60 * 60 * 1000);\r\n                expect(Browser.client.authenticate(res, credentials2, header.artifacts)).to.equal(true);\r\n                expect(Browser.utils.getNtpOffset()).to.equal(0);\r\n\r\n                req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials2, ext: 'some-app-data' }).field;\r\n                expect(req.authorization).to.exist();\r\n\r\n                Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials3, artifacts3) {\r\n\r\n                    expect(err).to.not.exist();\r\n                    expect(credentials3.user).to.equal('steve');\r\n                    expect(artifacts3.ext).to.equal('some-app-data');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header with stale ts and successfully authenticate on second call (manual localStorage)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var localStorage = new Browser.internals.LocalStorage();\r\n\r\n            Browser.utils.setStorage(localStorage);\r\n\r\n            Browser.utils.setNtpOffset(60 * 60 * 1000);\r\n            var header = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data' });\r\n            req.authorization = header.field;\r\n            expect(req.authorization).to.exist();\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts2) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.message).to.equal('Stale timestamp');\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'www-authenticate': err.output.headers['WWW-Authenticate']\r\n                    },\r\n                    getResponseHeader: function (lookup) {\r\n\r\n                        return res.headers[lookup.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                expect(parseInt(localStorage.getItem('hawk_ntp_offset'))).to.equal(60 * 60 * 1000);\r\n                expect(Browser.utils.getNtpOffset()).to.equal(60 * 60 * 1000);\r\n                expect(Browser.client.authenticate(res, credentials2, header.artifacts)).to.equal(true);\r\n                expect(Browser.utils.getNtpOffset()).to.equal(0);\r\n                expect(parseInt(localStorage.getItem('hawk_ntp_offset'))).to.equal(0);\r\n\r\n                req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials2, ext: 'some-app-data' }).field;\r\n                expect(req.authorization).to.exist();\r\n\r\n                Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials3, artifacts3) {\r\n\r\n                    expect(err).to.not.exist();\r\n                    expect(credentials3.user).to.equal('steve');\r\n                    expect(artifacts3.ext).to.equal('some-app-data');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then fails to parse it (missing server header hash)', function (done) {\r\n\r\n        var req = {\r\n            method: 'POST',\r\n            url: '/resource/4?filter=a',\r\n            headers: {\r\n                host: 'example.com:8080',\r\n                'content-type': 'text/plain;x=y'\r\n            }\r\n        };\r\n\r\n        var payload = 'some not so random text';\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var reqHeader = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', payload: payload, contentType: req.headers['content-type'] });\r\n            req.headers.authorization = reqHeader.field;\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers['content-type'])).to.equal(true);\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                res.headers['server-authorization'] = Hawk.server.header(credentials2, artifacts);\r\n                expect(res.headers['server-authorization']).to.exist();\r\n\r\n                expect(Browser.client.authenticate(res, credentials2, artifacts, { payload: 'some reply' })).to.equal(false);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (with hash)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, payload: 'hola!', ext: 'some-app-data' }).field;\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it then validate payload', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, payload: 'hola!', ext: 'some-app-data' }).field;\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(Hawk.server.authenticatePayload('hola!', credentials2, artifacts)).to.be.true();\r\n                expect(Hawk.server.authenticatePayload('hello!', credentials2, artifacts)).to.be.false();\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (app)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', app: 'asd23ased' }).field;\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(artifacts.app).to.equal('asd23ased');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (app, dlg)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', app: 'asd23ased', dlg: '23434szr3q4d' }).field;\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(artifacts.app).to.equal('asd23ased');\r\n                expect(artifacts.dlg).to.equal('23434szr3q4d');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then fail authentication due to bad hash', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, payload: 'hola!', ext: 'some-app-data' }).field;\r\n            Hawk.server.authenticate(req, credentialsFunc, { payload: 'byebye!' }, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Bad payload hash');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header for one resource then fail to authenticate another', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data' }).field;\r\n            req.url = '/something/else';\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(credentials2).to.exist();\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    describe('client', function () {\r\n\r\n        describe('header()', function () {\r\n\r\n            it('returns a valid authorization header (sha1)', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha1'\r\n                };\r\n\r\n                var header = Browser.client.header('http://example.net/somewhere/over/the/rainbow', 'POST', { credentials: credentials, ext: 'Bazinga!', timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about' }).field;\r\n                expect(header).to.equal('Hawk id=\"123456\", ts=\"1353809207\", nonce=\"Ygvqdz\", hash=\"bsvY3IfUllw6V5rvk4tStEvpBhE=\", ext=\"Bazinga!\", mac=\"qbf1ZPG/r/e06F4ht+T77LXi5vw=\"');\r\n                done();\r\n            });\r\n\r\n            it('returns a valid authorization header (sha256)', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST', { credentials: credentials, ext: 'Bazinga!', timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain' }).field;\r\n                expect(header).to.equal('Hawk id=\"123456\", ts=\"1353809207\", nonce=\"Ygvqdz\", hash=\"2QfCt3GuY9HQnHWyWD3wX68ZOKbynqlfYmuO2ZBRqtY=\", ext=\"Bazinga!\", mac=\"q1CwFoSHzPZSkbIvl0oYlD+91rBUEvFk763nMjMndj8=\"');\r\n                done();\r\n            });\r\n\r\n            it('returns a valid authorization header (empty payload)', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha1'\r\n                };\r\n\r\n                var header = Browser.client.header('http://example.net/somewhere/over/the/rainbow', 'POST', { credentials: credentials, ext: 'Bazinga!', timestamp: 1353809207, nonce: 'Ygvqdz', payload: '' }).field;\r\n                expect(header).to.equal('Hawk id=\\\"123456\\\", ts=\\\"1353809207\\\", nonce=\\\"Ygvqdz\\\", hash=\\\"404ghL7K+hfyhByKKejFBRGgTjU=\\\", ext=\\\"Bazinga!\\\", mac=\\\"Bh1sj1DOfFRWOdi3ww52nLCJdBE=\\\"');\r\n                done();\r\n            });\r\n\r\n            it('returns a valid authorization header (no ext)', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST', { credentials: credentials, timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain' }).field;\r\n                expect(header).to.equal('Hawk id=\"123456\", ts=\"1353809207\", nonce=\"Ygvqdz\", hash=\"2QfCt3GuY9HQnHWyWD3wX68ZOKbynqlfYmuO2ZBRqtY=\", mac=\"HTgtd0jPI6E4izx8e4OHdO36q00xFCU0FolNq3RiCYs=\"');\r\n                done();\r\n            });\r\n\r\n            it('returns a valid authorization header (null ext)', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST', { credentials: credentials, timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain', ext: null }).field;\r\n                expect(header).to.equal('Hawk id=\"123456\", ts=\"1353809207\", nonce=\"Ygvqdz\", hash=\"2QfCt3GuY9HQnHWyWD3wX68ZOKbynqlfYmuO2ZBRqtY=\", mac=\"HTgtd0jPI6E4izx8e4OHdO36q00xFCU0FolNq3RiCYs=\"');\r\n                done();\r\n            });\r\n\r\n            it('returns a valid authorization header (uri object)', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var uri = Browser.utils.parseUri('https://example.net/somewhere/over/the/rainbow');\r\n                var header = Browser.client.header(uri, 'POST', { credentials: credentials, timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain' }).field;\r\n                expect(header).to.equal('Hawk id=\"123456\", ts=\"1353809207\", nonce=\"Ygvqdz\", hash=\"2QfCt3GuY9HQnHWyWD3wX68ZOKbynqlfYmuO2ZBRqtY=\", mac=\"HTgtd0jPI6E4izx8e4OHdO36q00xFCU0FolNq3RiCYs=\"');\r\n                done();\r\n            });\r\n\r\n            it('errors on missing options', function (done) {\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST');\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Invalid argument type');\r\n                done();\r\n            });\r\n\r\n            it('errors on empty uri', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header('', 'POST', { credentials: credentials, timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain' });\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Invalid argument type');\r\n                done();\r\n            });\r\n\r\n            it('errors on invalid uri', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header(4, 'POST', { credentials: credentials, timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain' });\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Invalid argument type');\r\n                done();\r\n            });\r\n\r\n            it('errors on missing method', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', '', { credentials: credentials, timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain' });\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Invalid argument type');\r\n                done();\r\n            });\r\n\r\n            it('errors on invalid method', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 5, { credentials: credentials, timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain' });\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Invalid argument type');\r\n                done();\r\n            });\r\n\r\n            it('errors on missing credentials', function (done) {\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST', { ext: 'Bazinga!', timestamp: 1353809207 });\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Invalid credentials object');\r\n                done();\r\n            });\r\n\r\n            it('errors on invalid credentials (id)', function (done) {\r\n\r\n                var credentials = {\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST', { credentials: credentials, ext: 'Bazinga!', timestamp: 1353809207 });\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Invalid credentials object');\r\n                done();\r\n            });\r\n\r\n            it('errors on invalid credentials (key)', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST', { credentials: credentials, ext: 'Bazinga!', timestamp: 1353809207 });\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Invalid credentials object');\r\n                done();\r\n            });\r\n\r\n            it('errors on invalid algorithm', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'hmac-sha-0'\r\n                };\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST', { credentials: credentials, payload: 'something, anything!', ext: 'Bazinga!', timestamp: 1353809207 });\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Unknown algorithm');\r\n                done();\r\n            });\r\n\r\n            it('uses a pre-calculated payload hash', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var options = { credentials: credentials, ext: 'Bazinga!', timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain' };\r\n                options.hash = Browser.crypto.calculatePayloadHash(options.payload, credentials.algorithm, options.contentType);\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST', options).field;\r\n                expect(header).to.equal('Hawk id=\"123456\", ts=\"1353809207\", nonce=\"Ygvqdz\", hash=\"2QfCt3GuY9HQnHWyWD3wX68ZOKbynqlfYmuO2ZBRqtY=\", ext=\"Bazinga!\", mac=\"q1CwFoSHzPZSkbIvl0oYlD+91rBUEvFk763nMjMndj8=\"');\r\n                done();\r\n            });\r\n        });\r\n\r\n        describe('authenticate()', function () {\r\n\r\n            it('skips tsm validation when missing ts', function (done) {\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'www-authenticate': 'Hawk error=\"Stale timestamp\"'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                    algorithm: 'sha256',\r\n                    user: 'steve'\r\n                };\r\n\r\n                var artifacts = {\r\n                    ts: 1402135580,\r\n                    nonce: 'iBRB6t',\r\n                    method: 'GET',\r\n                    resource: '/resource/4?filter=a',\r\n                    host: 'example.com',\r\n                    port: '8080',\r\n                    ext: 'some-app-data'\r\n                };\r\n\r\n                expect(Browser.client.authenticate(res, credentials, artifacts)).to.equal(true);\r\n                done();\r\n            });\r\n\r\n            it('returns false on invalid header', function (done) {\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'server-authorization': 'Hawk mac=\"abc\", bad=\"xyz\"'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                expect(Browser.client.authenticate(res, {})).to.equal(false);\r\n                done();\r\n            });\r\n\r\n            it('returns false on invalid mac', function (done) {\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain',\r\n                        'server-authorization': 'Hawk mac=\"_IJRsMl/4oL+nn+vKoeVZPdCHXB4yJkNnBbTbHFZUYE=\", hash=\"f9cDF/TDm7TkYRLnGwRMfeDzT6LixQVLvrIKhh0vgmM=\", ext=\"response-specific\"'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                var artifacts = {\r\n                    method: 'POST',\r\n                    host: 'example.com',\r\n                    port: '8080',\r\n                    resource: '/resource/4?filter=a',\r\n                    ts: '1362336900',\r\n                    nonce: 'eb5S_L',\r\n                    hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                    ext: 'some-app-data',\r\n                    app: undefined,\r\n                    dlg: undefined,\r\n                    mac: 'BlmSe8K+pbKIb6YsZCnt4E1GrYvY1AaYayNR82dGpIk=',\r\n                    id: '123456'\r\n                };\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                    algorithm: 'sha256',\r\n                    user: 'steve'\r\n                };\r\n\r\n                expect(Browser.client.authenticate(res, credentials, artifacts)).to.equal(false);\r\n                done();\r\n            });\r\n\r\n            it('returns true on ignoring hash', function (done) {\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain',\r\n                        'server-authorization': 'Hawk mac=\"XIJRsMl/4oL+nn+vKoeVZPdCHXB4yJkNnBbTbHFZUYE=\", hash=\"f9cDF/TDm7TkYRLnGwRMfeDzT6LixQVLvrIKhh0vgmM=\", ext=\"response-specific\"'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                var artifacts = {\r\n                    method: 'POST',\r\n                    host: 'example.com',\r\n                    port: '8080',\r\n                    resource: '/resource/4?filter=a',\r\n                    ts: '1362336900',\r\n                    nonce: 'eb5S_L',\r\n                    hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                    ext: 'some-app-data',\r\n                    app: undefined,\r\n                    dlg: undefined,\r\n                    mac: 'BlmSe8K+pbKIb6YsZCnt4E1GrYvY1AaYayNR82dGpIk=',\r\n                    id: '123456'\r\n                };\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                    algorithm: 'sha256',\r\n                    user: 'steve'\r\n                };\r\n\r\n                expect(Browser.client.authenticate(res, credentials, artifacts)).to.equal(true);\r\n                done();\r\n            });\r\n\r\n            it('errors on invalid WWW-Authenticate header format', function (done) {\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'www-authenticate': 'Hawk ts=\"1362346425875\", tsm=\"PhwayS28vtnn3qbv0mqRBYSXebN/zggEtucfeZ620Zo=\", x=\"Stale timestamp\"'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                expect(Browser.client.authenticate(res, {})).to.equal(false);\r\n                done();\r\n            });\r\n\r\n            it('errors on invalid WWW-Authenticate header format', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                    algorithm: 'sha256',\r\n                    user: 'steve'\r\n                };\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'www-authenticate': 'Hawk ts=\"1362346425875\", tsm=\"hwayS28vtnn3qbv0mqRBYSXebN/zggEtucfeZ620Zo=\", error=\"Stale timestamp\"'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                expect(Browser.client.authenticate(res, credentials)).to.equal(false);\r\n                done();\r\n            });\r\n        });\r\n\r\n        describe('message()', function () {\r\n\r\n            it('generates an authorization then successfully parse it', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                    var auth = Browser.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                    expect(auth).to.exist();\r\n\r\n                    Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, {}, function (err, credentials2) {\r\n\r\n                        expect(err).to.not.exist();\r\n                        expect(credentials2.user).to.equal('steve');\r\n                        done();\r\n                    });\r\n                });\r\n            });\r\n\r\n            it('generates an authorization using custom nonce/timestamp', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var auth = Browser.client.message('example.com', 8080, 'some message', { credentials: credentials, nonce: 'abc123', timestamp: 1398536270957 });\r\n                    expect(auth).to.exist();\r\n                    expect(auth.nonce).to.equal('abc123');\r\n                    expect(auth.ts).to.equal(1398536270957);\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on missing host', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var auth = Browser.client.message(null, 8080, 'some message', { credentials: credentials });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on invalid host', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var auth = Browser.client.message(5, 8080, 'some message', { credentials: credentials });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on missing port', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var auth = Browser.client.message('example.com', 0, 'some message', { credentials: credentials });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on invalid port', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var auth = Browser.client.message('example.com', 'a', 'some message', { credentials: credentials });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on missing message', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var auth = Browser.client.message('example.com', 8080, undefined, { credentials: credentials });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on null message', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var auth = Browser.client.message('example.com', 8080, null, { credentials: credentials });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on invalid message', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var auth = Browser.client.message('example.com', 8080, 5, { credentials: credentials });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on missing credentials', function (done) {\r\n\r\n                var auth = Browser.client.message('example.com', 8080, 'some message', {});\r\n                expect(auth).to.not.exist();\r\n                done();\r\n            });\r\n\r\n            it('errors on missing options', function (done) {\r\n\r\n                var auth = Browser.client.message('example.com', 8080, 'some message');\r\n                expect(auth).to.not.exist();\r\n                done();\r\n            });\r\n\r\n            it('errors on invalid credentials (id)', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var creds = Hoek.clone(credentials);\r\n                    delete creds.id;\r\n                    var auth = Browser.client.message('example.com', 8080, 'some message', { credentials: creds });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on invalid credentials (key)', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var creds = Hoek.clone(credentials);\r\n                    delete creds.key;\r\n                    var auth = Browser.client.message('example.com', 8080, 'some message', { credentials: creds });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on invalid algorithm', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var creds = Hoek.clone(credentials);\r\n                    creds.algorithm = 'blah';\r\n                    var auth = Browser.client.message('example.com', 8080, 'some message', { credentials: creds });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        describe('authenticateTimestamp()', function (done) {\r\n\r\n            it('validates a timestamp', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var tsm = Hawk.crypto.timestampMessage(credentials);\r\n                    expect(Browser.client.authenticateTimestamp(tsm, credentials)).to.equal(true);\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('validates a timestamp without updating local time', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var offset = Browser.utils.getNtpOffset();\r\n                    var tsm = Hawk.crypto.timestampMessage(credentials, 10000);\r\n                    expect(Browser.client.authenticateTimestamp(tsm, credentials, false)).to.equal(true);\r\n                    expect(offset).to.equal(Browser.utils.getNtpOffset());\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('detects a bad timestamp', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var tsm = Hawk.crypto.timestampMessage(credentials);\r\n                    tsm.ts = 4;\r\n                    expect(Browser.client.authenticateTimestamp(tsm, credentials)).to.equal(false);\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n    });\r\n\r\n    describe('internals', function () {\r\n\r\n        describe('LocalStorage', function () {\r\n\r\n            it('goes through the full lifecycle', function (done) {\r\n\r\n                var storage = new Browser.internals.LocalStorage();\r\n                expect(storage.length).to.equal(0);\r\n                expect(storage.getItem('a')).to.equal(null);\r\n                storage.setItem('a', 5);\r\n                expect(storage.length).to.equal(1);\r\n                expect(storage.key()).to.equal('a');\r\n                expect(storage.key(0)).to.equal('a');\r\n                expect(storage.getItem('a')).to.equal('5');\r\n                storage.setItem('b', 'test');\r\n                expect(storage.key()).to.equal('a');\r\n                expect(storage.key(0)).to.equal('a');\r\n                expect(storage.key(1)).to.equal('b');\r\n                expect(storage.length).to.equal(2);\r\n                expect(storage.getItem('b')).to.equal('test');\r\n                storage.removeItem('a');\r\n                expect(storage.length).to.equal(1);\r\n                expect(storage.getItem('a')).to.equal(null);\r\n                expect(storage.getItem('b')).to.equal('test');\r\n                storage.clear();\r\n                expect(storage.length).to.equal(0);\r\n                expect(storage.getItem('a')).to.equal(null);\r\n                expect(storage.getItem('b')).to.equal(null);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    describe('utils', function () {\r\n\r\n        describe('setStorage()', function () {\r\n\r\n            it('sets storage for the first time', function (done) {\r\n\r\n                Browser.utils.storage = new Browser.internals.LocalStorage();        // Reset state\r\n\r\n                expect(Browser.utils.storage.getItem('hawk_ntp_offset')).to.not.exist();\r\n                Browser.utils.storage.setItem('test', '1');\r\n                Browser.utils.setStorage(new Browser.internals.LocalStorage());\r\n                expect(Browser.utils.storage.getItem('test')).to.not.exist();\r\n                Browser.utils.storage.setItem('test', '2');\r\n                expect(Browser.utils.storage.getItem('test')).to.equal('2');\r\n                done();\r\n            });\r\n        });\r\n\r\n        describe('setNtpOffset()', function (done) {\r\n\r\n            it('catches localStorage errors', { parallel: false }, function (done) {\r\n\r\n                var orig = Browser.utils.storage.setItem;\r\n                var consoleOrig = console.error;\r\n                var count = 0;\r\n                console.error = function () {\r\n\r\n                    if (count++ === 2) {\r\n\r\n                        console.error = consoleOrig;\r\n                    }\r\n                };\r\n\r\n                Browser.utils.storage.setItem = function () {\r\n\r\n                    Browser.utils.storage.setItem = orig;\r\n                    throw new Error();\r\n                };\r\n\r\n                expect(function () {\r\n\r\n                    Browser.utils.setNtpOffset(100);\r\n                }).not.to.throw();\r\n\r\n                done();\r\n            });\r\n        });\r\n\r\n        describe('parseAuthorizationHeader()', function (done) {\r\n\r\n            it('returns null on missing header', function (done) {\r\n\r\n                expect(Browser.utils.parseAuthorizationHeader()).to.equal(null);\r\n                done();\r\n            });\r\n\r\n            it('returns null on bad header syntax (structure)', function (done) {\r\n\r\n                expect(Browser.utils.parseAuthorizationHeader('Hawk')).to.equal(null);\r\n                done();\r\n            });\r\n\r\n            it('returns null on bad header syntax (parts)', function (done) {\r\n\r\n                expect(Browser.utils.parseAuthorizationHeader(' ')).to.equal(null);\r\n                done();\r\n            });\r\n\r\n            it('returns null on bad scheme name', function (done) {\r\n\r\n                expect(Browser.utils.parseAuthorizationHeader('Basic asdasd')).to.equal(null);\r\n                done();\r\n            });\r\n\r\n            it('returns null on bad attribute value', function (done) {\r\n\r\n                expect(Browser.utils.parseAuthorizationHeader('Hawk test=\"\\t\"', ['test'])).to.equal(null);\r\n                done();\r\n            });\r\n\r\n            it('returns null on duplicated attribute', function (done) {\r\n\r\n                expect(Browser.utils.parseAuthorizationHeader('Hawk test=\"a\", test=\"b\"', ['test'])).to.equal(null);\r\n                done();\r\n            });\r\n        });\r\n\r\n        describe('parseUri()', function () {\r\n\r\n            it('returns empty object on invalid', function (done) {\r\n\r\n                var uri = Browser.utils.parseUri('ftp');\r\n                expect(uri).to.deep.equal({ host: '', port: '', resource: '' });\r\n                done();\r\n            });\r\n\r\n            it('returns empty port when unknown scheme', function (done) {\r\n\r\n                var uri = Browser.utils.parseUri('ftp://example.com');\r\n                expect(uri.port).to.equal('');\r\n                done();\r\n            });\r\n\r\n            it('returns default port when missing', function (done) {\r\n\r\n                var uri = Browser.utils.parseUri('http://example.com');\r\n                expect(uri.port).to.equal('80');\r\n                done();\r\n            });\r\n\r\n            it('handles unusual characters correctly', function (done) {\r\n\r\n                var parts = {\r\n                    protocol: 'http+vnd.my-extension',\r\n                    user: 'user!$&\\'()*+,;=%40my-domain.com',\r\n                    password: 'pass!$&\\'()*+,;=%40:word',\r\n                    hostname: 'foo-bar.com',\r\n                    port: '99',\r\n                    pathname: '/path/%40/!$&\\'()*+,;=:@/',\r\n                    query: 'query%40/!$&\\'()*+,;=:@/?',\r\n                    fragment: 'fragm%40/!$&\\'()*+,;=:@/?'\r\n                };\r\n\r\n                parts.userInfo = parts.user + ':' + parts.password;\r\n                parts.authority = parts.userInfo + '@' + parts.hostname + ':' + parts.port;\r\n                parts.relative = parts.pathname + '?' + parts.query;\r\n                parts.resource = parts.relative + '#' + parts.fragment;\r\n                parts.source = parts.protocol + '://' + parts.authority + parts.resource;\r\n\r\n                var uri = Browser.utils.parseUri(parts.source);\r\n                expect(uri.host).to.equal('foo-bar.com');\r\n                expect(uri.port).to.equal('99');\r\n                expect(uri.resource).to.equal(parts.pathname + '?' + parts.query);\r\n                done();\r\n            });\r\n        });\r\n\r\n        var str = 'https://www.google.ca/webhp?sourceid=chrome-instant&ion=1&espv=2&ie=UTF-8#q=url';\r\n        var base64str = 'aHR0cHM6Ly93d3cuZ29vZ2xlLmNhL3dlYmhwP3NvdXJjZWlkPWNocm9tZS1pbnN0YW50Jmlvbj0xJmVzcHY9MiZpZT1VVEYtOCNxPXVybA';\r\n\r\n        describe('base64urlEncode()', function () {\r\n\r\n            it('should base64 URL-safe decode a string', function (done) {\r\n\r\n                expect(Browser.utils.base64urlEncode(str)).to.equal(base64str);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n});\r\n"]}