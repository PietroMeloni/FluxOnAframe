{"version":3,"sources":["../../../../../node_modules/npm/node_modules/parallel-transform/index.js"],"names":["Transform","require","inherits","cyclist","util","ParallelTransform","maxParallel","opts","ontransform","highWaterMark","Math","max","objectMode","call","_maxParallel","_ontransform","_destroyed","_flushed","_ordered","ordered","_buffer","_top","_bottom","_ondrain","prototype","destroy","emit","_transform","chunk","enc","callback","self","pos","err","data","push","put","undefined","_drain","_flush","get","del","length","pop","_drained","ondrain","diff","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["var Transform = require('readable-stream').Transform;\nvar inherits = require('inherits');\nvar cyclist = require('cyclist');\nvar util = require('util');\n\nvar ParallelTransform = function(maxParallel, opts, ontransform) {\n\tif (!(this instanceof ParallelTransform)) return new ParallelTransform(maxParallel, opts, ontransform);\n\n\tif (typeof maxParallel === 'function') {\n\t\tontransform = maxParallel;\n\t\topts = null;\n\t\tmaxParallel = 1;\n\t}\n\tif (typeof opts === 'function') {\n\t\tontransform = opts;\n\t\topts = null;\n\t}\n\n\tif (!opts) opts = {};\n\tif (!opts.highWaterMark) opts.highWaterMark = Math.max(maxParallel, 16);\n\tif (opts.objectMode !== false) opts.objectMode = true;\n\n\tTransform.call(this, opts);\n\n\tthis._maxParallel = maxParallel;\n\tthis._ontransform = ontransform;\n\tthis._destroyed = false;\n\tthis._flushed = false;\n\tthis._ordered = opts.ordered !== false;\n\tthis._buffer = this._ordered ? cyclist(maxParallel) : [];\n\tthis._top = 0;\n\tthis._bottom = 0;\n\tthis._ondrain = null;\n};\n\ninherits(ParallelTransform, Transform);\n\nParallelTransform.prototype.destroy = function() {\n\tif (this._destroyed) return;\n\tthis._destroyed = true;\n\tthis.emit('close');\n};\n\nParallelTransform.prototype._transform = function(chunk, enc, callback) {\n\tvar self = this;\n\tvar pos = this._top++;\n\n\tthis._ontransform(chunk, function(err, data) {\n\t\tif (self._destroyed) return;\n\t\tif (err) {\n\t\t\tself.emit('error', err);\n\t\t\tself.push(null);\n\t\t\tself.destroy();\n\t\t\treturn;\n\t\t}\n\t\tif (self._ordered) {\n\t\t\tself._buffer.put(pos, (data === undefined || data === null) ? null : data);\n\t\t}\n\t\telse {\n\t\t\tself._buffer.push(data);\n\t\t}\n\t\tself._drain();\n\t});\n\n\tif (this._top - this._bottom < this._maxParallel) return callback();\n\tthis._ondrain = callback;\n};\n\nParallelTransform.prototype._flush = function(callback) {\n\tthis._flushed = true;\n\tthis._ondrain = callback;\n\tthis._drain();\n};\n\nParallelTransform.prototype._drain = function() {\n\tif (this._ordered) {\n\t\twhile (this._buffer.get(this._bottom) !== undefined) {\n\t\t\tvar data = this._buffer.del(this._bottom++);\n\t\t\tif (data === null) continue;\n\t\t\tthis.push(data);\n\t\t}\n\t}\n\telse {\n\t\twhile (this._buffer.length > 0) {\n\t\t\tvar data =  this._buffer.pop();\n\t\t\tthis._bottom++;\n\t\t\tif (data === null) continue;\n\t\t\tthis.push(data);\n\t\t}\n\t}\n\n\n\tif (!this._drained() || !this._ondrain) return;\n\n\tvar ondrain = this._ondrain;\n\tthis._ondrain = null;\n\tondrain();\n};\n\nParallelTransform.prototype._drained = function() {\n\tvar diff = this._top - this._bottom;\n\treturn this._flushed ? !diff : diff < this._maxParallel;\n};\n\nmodule.exports = ParallelTransform;\n"]}