{"version":3,"sources":["../../../../../node_modules/npm/node_modules/stream-iterate/index.js"],"names":["Readable","require","shift","stream2","stream","_readableState","objectMode","highWaterMark","wrap","module","exports","ended","data","err","destroyed","fn","consume","e","destroy","onresult","tmp","undefined","update","onend","on","callback"],"mappings":";;AAAA,IAAIA,WAAWC,QAAQ,iBAAR,EAA2BD,QAA1C;AACA,IAAIE,QAAQD,QAAQ,cAAR,CAAZ;;AAEA,IAAIE,UAAU,SAAVA,OAAU,CAAUC,MAAV,EAAkB;AAC9B,MAAIA,OAAOC,cAAX,EAA2B,OAAOD,MAAP;AAC3B,SAAO,IAAIJ,QAAJ,CAAa,EAACM,YAAY,IAAb,EAAmBC,eAAe,EAAlC,EAAb,EAAoDC,IAApD,CAAyDJ,MAAzD,CAAP;AACD,CAHD;;AAKAK,OAAOC,OAAP,GAAiB,UAAUN,MAAV,EAAkB;AACjCA,WAASD,QAAQC,MAAR,CAAT;;AAEA,MAAIO,QAAQ,KAAZ;AACA,MAAIC,OAAO,IAAX;AACA,MAAIC,MAAM,IAAV;AACA,MAAIC,YAAY,KAAhB;AACA,MAAIC,KAAK,IAAT;;AAEA,MAAIC,UAAU,SAAVA,OAAU,CAAUC,CAAV,EAAa;AACzB,QAAIA,CAAJ,EAAO;AACLH,kBAAY,IAAZ;AACA,UAAIV,OAAOc,OAAX,EAAoBd,OAAOc,OAAP,CAAeD,CAAf;AACpB;AACD;;AAEDL,WAAO,IAAP;AACAC,UAAM,IAAN;AACD,GATD;;AAWA,MAAIM,WAAW,SAAXA,QAAW,GAAY;AACzB,QAAI,CAACJ,EAAL,EAAS;AACT,QAAIK,MAAML,EAAV;AACAA,SAAKM,SAAL;AACAD,QAAIP,GAAJ,EAASD,IAAT,EAAeI,OAAf;AACD,GALD;;AAOA,MAAIM,SAAS,SAATA,MAAS,GAAY;AACvB,QAAI,CAACP,EAAL,EAAS;AACTH,WAAOV,MAAME,MAAN,CAAP;AACA,QAAIQ,SAAS,IAAT,IAAiB,CAACD,KAAtB,EAA6B;AAC7BQ;AACD,GALD;;AAOA,MAAII,QAAQ,SAARA,KAAQ,GAAY;AACtBZ,YAAQ,IAAR;AACAQ;AACD,GAHD;;AAKAf,SAAOoB,EAAP,CAAU,UAAV,EAAsBF,MAAtB;;AAEAlB,SAAOoB,EAAP,CAAU,OAAV,EAAmB,UAAUP,CAAV,EAAa;AAC9BJ,UAAMI,CAAN;AACAE;AACD,GAHD;;AAKAf,SAAOoB,EAAP,CAAU,OAAV,EAAmB,YAAY;AAC7B,QAAIpB,OAAOC,cAAP,CAAsBM,KAA1B,EAAiC;AACjCY;AACD,GAHD;;AAKAnB,SAAOoB,EAAP,CAAU,KAAV,EAAiBD,KAAjB;;AAEA,SAAO,UAAUE,QAAV,EAAoB;AACzB,QAAIX,SAAJ,EAAe;AACf,QAAID,GAAJ,EAAS,OAAOY,SAASZ,GAAT,EAAc,IAAd,EAAoBG,OAApB,CAAP;AACT,QAAIJ,IAAJ,EAAU,OAAOa,SAAS,IAAT,EAAeb,IAAf,EAAqBI,OAArB,CAAP;AACV,QAAIL,KAAJ,EAAW,OAAOc,SAAS,IAAT,EAAe,IAAf,EAAqBT,OAArB,CAAP;AACXD,SAAKU,QAAL;AACAH;AACD,GAPD;AAQD,CA7DD","file":"index.js","sourcesContent":["var Readable = require('readable-stream').Readable\nvar shift = require('stream-shift')\n\nvar stream2 = function (stream) {\n  if (stream._readableState) return stream\n  return new Readable({objectMode: true, highWaterMark: 16}).wrap(stream)\n}\n\nmodule.exports = function (stream) {\n  stream = stream2(stream)\n\n  var ended = false\n  var data = null\n  var err = null\n  var destroyed = false\n  var fn = null\n\n  var consume = function (e) {\n    if (e) {\n      destroyed = true\n      if (stream.destroy) stream.destroy(e)\n      return\n    }\n\n    data = null\n    err = null\n  }\n\n  var onresult = function () {\n    if (!fn) return\n    var tmp = fn\n    fn = undefined\n    tmp(err, data, consume)\n  }\n\n  var update = function () {\n    if (!fn) return\n    data = shift(stream)\n    if (data === null && !ended) return\n    onresult()\n  }\n\n  var onend = function () {\n    ended = true\n    onresult()\n  }\n\n  stream.on('readable', update)\n\n  stream.on('error', function (e) {\n    err = e\n    onresult()\n  })\n\n  stream.on('close', function () {\n    if (stream._readableState.ended) return\n    onend()\n  })\n\n  stream.on('end', onend)\n\n  return function (callback) {\n    if (destroyed) return\n    if (err) return callback(err, null, consume)\n    if (data) return callback(null, data, consume)\n    if (ended) return callback(null, null, consume)\n    fn = callback\n    update()\n  }\n}\n"]}