{"version":3,"sources":["../../../../../node_modules/npm/node_modules/readdir-scoped-modules/readdir.js"],"names":["fs","require","dz","once","path","debug","module","exports","readdir","dir","cb","er","kids","readScopes","data","sort","a","b","root","scopes","filter","kid","charAt","length","l","forEach","scope","scopedir","resolve","then","bind","scopekids","scopekid","push","apply","map"],"mappings":";;AAAA,IAAIA,KAAKC,QAAS,aAAT,CAAT;AACA,IAAIC,KAAKD,QAAS,SAAT,CAAT;AACA,IAAIE,OAAOF,QAAS,MAAT,CAAX;AACA,IAAIG,OAAOH,QAAS,MAAT,CAAX;AACA,IAAII,QAAQJ,QAAS,UAAT,EAAsB,KAAtB,CAAZ;;AAEAK,OAASC,OAAT,GAAmBC,OAAnB;;AAEA,SAASA,OAAT,CAAkBC,GAAlB,EAAuBC,EAAvB,EAA2B;AACzBV,KAAKQ,OAAL,CAAcC,GAAd,EAAmB,UAAUE,EAAV,EAAcC,IAAd,EAAoB;AACrC,QAAID,EAAJ,EACE,OAAOD,GAAIC,EAAJ,CAAP;;AAEFN,UAAO,iBAAP,EAA0BI,GAA1B,EAA+BG,IAA/B;AACAC,eAAYJ,GAAZ,EAAiBG,IAAjB,EAAuB,UAAUD,EAAV,EAAcG,IAAd,EAAoB;AACzC,UAAIH,EAAJ,EACE,OAAOD,GAAIC,EAAJ,CAAP;;AAEF;AACAG,aAAOA,KAAOC,IAAP,CAAa,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAClC,eAAOD,IAAIC,CAAJ,GAAQ,CAAR,GAAY,CAAC,CAApB;AACD,OAFM,CAAP;;AAIA,aAAOP,GAAI,IAAJ,EAAUI,IAAV,CAAP;AACD,KAVD;AAWD,GAhBD;AAiBD;;AAED;AACA;AACA,SAASD,UAAT,CAAqBK,IAArB,EAA2BN,IAA3B,EAAiCF,EAAjC,EAAqC;AACnC,MAAIS,SAASP,KAAOQ,MAAP,CAAe,UAAUC,GAAV,EAAe;AACzC,WAAOA,IAAMC,MAAN,CAAc,CAAd,MAAqB,GAA5B;AACD,GAFY,CAAb;;AAIAV,SAAOA,KAAOQ,MAAP,CAAe,UAAUC,GAAV,EAAe;AACnC,WAAOA,IAAMC,MAAN,CAAc,CAAd,MAAqB,GAA5B;AACD,GAFM,CAAP;;AAIAjB,QAAO,WAAP,EAAoBc,MAApB;;AAEA,MAAIA,OAASI,MAAT,KAAoB,CAAxB,EACErB,GAAIQ,EAAJ,EAAS,IAAT,EAAeE,IAAf,EAZiC,CAYZ;;AAEvBF,OAAKP,KAAMO,EAAN,CAAL;AACA,MAAIc,IAAIL,OAASI,MAAjB;AACAJ,SAASM,OAAT,CAAkB,UAAUC,KAAV,EAAiB;AACjC,QAAIC,WAAWvB,KAAOwB,OAAP,CAAgBV,IAAhB,EAAsBQ,KAAtB,CAAf;AACArB,UAAO,8BAAP,EAAuCa,IAAvC,EAA6CQ,KAA7C,EAAoDC,QAApD;AACA3B,OAAKQ,OAAL,CAAcmB,QAAd,EAAwBE,KAAOC,IAAP,CAAa,IAAb,EAAmBJ,KAAnB,CAAxB;AACD,GAJD;;AAMA,WAASG,IAAT,CAAeH,KAAf,EAAsBf,EAAtB,EAA0BoB,SAA1B,EAAqC;AACnC,QAAIpB,EAAJ,EACE,OAAOD,GAAIC,EAAJ,CAAP;;AAEF;AACAoB,gBAAYA,UAAYX,MAAZ,CAAoB,UAAUY,QAAV,EAAoB;AAClD,aAAO,EAAEA,aAAa,GAAb,IAAoBA,aAAa,IAAjC,IAAyC,CAACA,QAA5C,CAAP;AACD,KAFW,CAAZ;;AAIApB,SAAOqB,IAAP,CAAcC,KAAd,CAAqBtB,IAArB,EAA2BmB,UAAYI,GAAZ,CAAiB,UAAUH,QAAV,EAAoB;AAC9D,aAAON,QAAQ,GAAR,GAAcM,QAArB;AACD,KAF0B,CAA3B;;AAIA3B,UAAO,+BAAP,EAAwCqB,KAAxC,EAA+CK,SAA/C,EAA0DnB,IAA1D;;AAEA,QAAI,EAAEY,CAAF,KAAQ,CAAZ,EACEd,GAAI,IAAJ,EAAUE,IAAV;AACH;AACF","file":"readdir.js","sourcesContent":["var fs = require ('graceful-fs')\nvar dz = require ('dezalgo')\nvar once = require ('once')\nvar path = require ('path')\nvar debug = require ('debuglog') ('rds')\n\nmodule . exports = readdir\n\nfunction readdir (dir, cb) {\n  fs . readdir (dir, function (er, kids) {\n    if (er)\n      return cb (er)\n\n    debug ('dir=%j, kids=%j', dir, kids)\n    readScopes (dir, kids, function (er, data) {\n      if (er)\n        return cb (er)\n\n      // Sort for bonus consistency points\n      data = data . sort (function (a, b) {\n        return a > b ? 1 : -1\n      })\n\n      return cb (null, data)\n    })\n  })\n}\n\n// Turn [ 'a', '@scope' ] into\n// ['a', '@scope/foo', '@scope/bar']\nfunction readScopes (root, kids, cb) {\n  var scopes = kids . filter (function (kid) {\n    return kid . charAt (0) === '@'\n  })\n\n  kids = kids . filter (function (kid) {\n    return kid . charAt (0) !== '@'\n  })\n\n  debug ('scopes=%j', scopes)\n\n  if (scopes . length === 0)\n    dz (cb) (null, kids) // prevent maybe-sync zalgo release\n\n  cb = once (cb)\n  var l = scopes . length\n  scopes . forEach (function (scope) {\n    var scopedir = path . resolve (root, scope)\n    debug ('root=%j scope=%j scopedir=%j', root, scope, scopedir)\n    fs . readdir (scopedir, then . bind (null, scope))\n  })\n\n  function then (scope, er, scopekids) {\n    if (er)\n      return cb (er)\n\n    // XXX: Not sure how old this node bug is. Maybe superstition?\n    scopekids = scopekids . filter (function (scopekid) {\n      return !(scopekid === '.' || scopekid === '..' || !scopekid)\n    })\n\n    kids . push . apply (kids, scopekids . map (function (scopekid) {\n      return scope + '/' + scopekid\n    }))\n\n    debug ('scope=%j scopekids=%j kids=%j', scope, scopekids, kids)\n\n    if (--l === 0)\n      cb (null, kids)\n  }\n}\n"]}