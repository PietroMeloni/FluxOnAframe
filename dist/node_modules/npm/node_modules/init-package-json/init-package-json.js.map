{"version":3,"sources":["../../../../../node_modules/npm/node_modules/init-package-json/init-package-json.js"],"names":["module","exports","init","yes","PZ","require","PromZard","path","def","resolve","fs","semver","read","readJson","conf","get","dir","input","config","cb","data","k","toJSON","packageFile","pkg","ctx","es","extraSet","filter","fn","name","er","d","filename","dirname","basename","version","valid","package","pz","backupFile","on","Object","keys","forEach","undefined","extras","unParsePeople","readme","readmeFilename","_id","gitHead","repository","description","JSON","stringify","write","writeFile","console","log","prompt","default","ok","toLowerCase","charAt","author","unParsePerson","set","Array","isArray","map","person","u","url","web","e","email","mail"],"mappings":"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","file":"init-package-json.js","sourcesContent":["\nmodule.exports = init\nmodule.exports.yes = yes\n\nvar PZ = require('promzard').PromZard\nvar path = require('path')\nvar def = require.resolve('./default-input.js')\n\nvar fs = require('fs')\nvar semver = require('semver')\nvar read = require('read')\n\n// to validate the data object at the end as a worthwhile package\n// and assign default values for things.\n// readJson.extras(file, data, cb)\nvar readJson = require('read-package-json')\n\nfunction yes (conf) {\n  return !!(\n    conf.get('yes') || conf.get('y') ||\n    conf.get('force') || conf.get('f')\n  )\n}\n\nfunction init (dir, input, config, cb) {\n  if (typeof config === 'function')\n    cb = config, config = {}\n\n  // accept either a plain-jane object, or a config object\n  // with a \"get\" method.\n  if (typeof config.get !== 'function') {\n    var data = config\n    config = {\n      get: function (k) {\n        return data[k]\n      },\n      toJSON: function () {\n        return data\n      }\n    }\n  }\n\n  var packageFile = path.resolve(dir, 'package.json')\n  input = path.resolve(input)\n  var pkg\n  var ctx = { yes: yes(config) }\n\n  var es = readJson.extraSet\n  readJson.extraSet = es.filter(function (fn) {\n    return fn.name !== 'authors' && fn.name !== 'mans'\n  })\n  readJson(packageFile, function (er, d) {\n    readJson.extraSet = es\n\n    if (er) pkg = {}\n    else pkg = d\n\n    ctx.filename = packageFile\n    ctx.dirname = path.dirname(packageFile)\n    ctx.basename = path.basename(ctx.dirname)\n    if (!pkg.version || !semver.valid(pkg.version))\n      delete pkg.version\n\n    ctx.package = pkg\n    ctx.config = config || {}\n\n    // make sure that the input is valid.\n    // if not, use the default\n    var pz = new PZ(input, ctx)\n    pz.backupFile = def\n    pz.on('error', cb)\n    pz.on('data', function (data) {\n      Object.keys(data).forEach(function (k) {\n        if (data[k] !== undefined && data[k] !== null) pkg[k] = data[k]\n      })\n\n      // only do a few of these.\n      // no need for mans or contributors if they're in the files\n      var es = readJson.extraSet\n      readJson.extraSet = es.filter(function (fn) {\n        return fn.name !== 'authors' && fn.name !== 'mans'\n      })\n      readJson.extras(packageFile, pkg, function (er, pkg) {\n        readJson.extraSet = es\n        if (er) return cb(er, pkg)\n        pkg = unParsePeople(pkg)\n        // no need for the readme now.\n        delete pkg.readme\n        delete pkg.readmeFilename\n\n        // really don't want to have this lying around in the file\n        delete pkg._id\n\n        // ditto\n        delete pkg.gitHead\n\n        // if the repo is empty, remove it.\n        if (!pkg.repository)\n          delete pkg.repository\n\n        // readJson filters out empty descriptions, but init-package-json\n        // traditionally leaves them alone\n        if (!pkg.description)\n          pkg.description = data.description\n\n        var d = JSON.stringify(pkg, null, 2) + '\\n'\n        function write (yes) {\n          fs.writeFile(packageFile, d, 'utf8', function (er) {\n            if (!er && yes && !config.get('silent')) {\n              console.log('Wrote to %s:\\n\\n%s\\n', packageFile, d)\n            }\n            return cb(er, pkg)\n          })\n        }\n        if (ctx.yes) {\n          return write(true)\n        }\n        console.log('About to write to %s:\\n\\n%s\\n', packageFile, d)\n        read({prompt:'Is this OK? ', default: 'yes'}, function (er, ok) {\n          if (er) {\n            return cb(er)\n          }\n          if (!ok || ok.toLowerCase().charAt(0) !== 'y') {\n            console.log('Aborted.')\n          } else {\n            return write()\n          }\n        })\n      })\n    })\n  })\n\n}\n\n// turn the objects into somewhat more humane strings.\nfunction unParsePeople (data) {\n  if (data.author) data.author = unParsePerson(data.author)\n  ;[\"maintainers\", \"contributors\"].forEach(function (set) {\n    if (!Array.isArray(data[set])) return;\n    data[set] = data[set].map(unParsePerson)\n  })\n  return data\n}\n\nfunction unParsePerson (person) {\n  if (typeof person === \"string\") return person\n  var name = person.name || \"\"\n  var u = person.url || person.web\n  var url = u ? (\" (\"+u+\")\") : \"\"\n  var e = person.email || person.mail\n  var email = e ? (\" <\"+e+\">\") : \"\"\n  return name+email+url\n}\n\n"]}