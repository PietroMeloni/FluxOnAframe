{"version":3,"sources":["../../../../../../node_modules/npm/node_modules/http-cache-semantics/node4/index.js"],"names":["_classCallCheck","instance","Constructor","TypeError","statusCodeCacheableByDefault","understoodStatuses","hopByHopHeaders","excludedFromRevalidationUpdate","parseCacheControl","header","cc","parts","trim","split","_iterator","_isArray","Array","isArray","_i","Symbol","iterator","_ref","length","next","done","value","part","_part$split","k","v","undefined","replace","formatCacheControl","push","join","module","exports","CachePolicy","req","res","_ref2","arguments","shared","cacheHeuristic","immutableMinTimeToLive","ignoreCargoCult","_fromObject","headers","Error","_assertRequestHasHeaders","_responseTime","now","_isShared","_cacheHeuristic","_immutableMinTtl","_status","status","_resHeaders","_rescc","_method","method","_url","url","_host","host","_noAuthorization","authorization","_reqHeaders","vary","_reqcc","Object","assign","expires","pragma","test","prototype","Date","storable","_hasExplicitExpiration","indexOf","private","_allowsStoringAuthenticated","public","satisfiesWithoutRevalidation","requestCC","age","timeToLive","stale","allowsStale","maxAge","_requestMatches","allowHeadMethod","_varyMatches","fields","toLowerCase","_iterator2","_isArray2","_i2","_ref3","name","_copyWithoutHopByHopHeaders","inHeaders","connection","tokens","_iterator3","_isArray3","_i3","_ref4","_name","warning","warnings","filter","responseHeaders","Math","round","date","dateValue","parse","maxClockDrift","Number","isNaN","max","ageValue","_ageValue","residentTime","parseInt","isFinite","immutable","defaultMinTtl","lastModified","fromObject","obj","t","sh","ch","imm","st","resh","rescc","m","u","h","a","reqh","reqcc","toObject","revalidationHeaders","incomingReq","etag","forbidsWeakValidators","etags","revalidatedPolicy","request","response","matches","policy","constructor","modified","newResponse"],"mappings":"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","file":"index.js","sourcesContent":["'use strict';\n// rfc7231 6.1\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar statusCodeCacheableByDefault = [200, 203, 204, 206, 300, 301, 404, 405, 410, 414, 501];\n\n// This implementation does not understand partial responses (206)\nvar understoodStatuses = [200, 203, 204, 300, 301, 302, 303, 307, 308, 404, 405, 410, 414, 501];\n\nvar hopByHopHeaders = { 'connection': true, 'keep-alive': true, 'proxy-authenticate': true, 'proxy-authorization': true, 'te': true, 'trailer': true, 'transfer-encoding': true, 'upgrade': true };\nvar excludedFromRevalidationUpdate = {\n    // Since the old body is reused, it doesn't make sense to change properties of the body\n    'content-length': true, 'content-encoding': true, 'transfer-encoding': true,\n    'content-range': true\n};\n\nfunction parseCacheControl(header) {\n    var cc = {};\n    if (!header) return cc;\n\n    // TODO: When there is more than one value present for a given directive (e.g., two Expires header fields, multiple Cache-Control: max-age directives),\n    // the directive's value is considered invalid. Caches are encouraged to consider responses that have invalid freshness information to be stale\n    var parts = header.trim().split(/\\s*,\\s*/); // TODO: lame parsing\n    for (var _iterator = parts, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n        var _ref;\n\n        if (_isArray) {\n            if (_i >= _iterator.length) break;\n            _ref = _iterator[_i++];\n        } else {\n            _i = _iterator.next();\n            if (_i.done) break;\n            _ref = _i.value;\n        }\n\n        var part = _ref;\n\n        var _part$split = part.split(/\\s*=\\s*/, 2),\n            k = _part$split[0],\n            v = _part$split[1];\n\n        cc[k] = v === undefined ? true : v.replace(/^\"|\"$/g, ''); // TODO: lame unquoting\n    }\n\n    return cc;\n}\n\nfunction formatCacheControl(cc) {\n    var parts = [];\n    for (var k in cc) {\n        var v = cc[k];\n        parts.push(v === true ? k : k + '=' + v);\n    }\n    if (!parts.length) {\n        return undefined;\n    }\n    return parts.join(', ');\n}\n\nmodule.exports = function () {\n    function CachePolicy(req, res) {\n        var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n            shared = _ref2.shared,\n            cacheHeuristic = _ref2.cacheHeuristic,\n            immutableMinTimeToLive = _ref2.immutableMinTimeToLive,\n            ignoreCargoCult = _ref2.ignoreCargoCult,\n            _fromObject = _ref2._fromObject;\n\n        _classCallCheck(this, CachePolicy);\n\n        if (_fromObject) {\n            this._fromObject(_fromObject);\n            return;\n        }\n\n        if (!res || !res.headers) {\n            throw Error(\"Response headers missing\");\n        }\n        this._assertRequestHasHeaders(req);\n\n        this._responseTime = this.now();\n        this._isShared = shared !== false;\n        this._cacheHeuristic = undefined !== cacheHeuristic ? cacheHeuristic : 0.1; // 10% matches IE\n        this._immutableMinTtl = undefined !== immutableMinTimeToLive ? immutableMinTimeToLive : 24 * 3600 * 1000;\n\n        this._status = 'status' in res ? res.status : 200;\n        this._resHeaders = res.headers;\n        this._rescc = parseCacheControl(res.headers['cache-control']);\n        this._method = 'method' in req ? req.method : 'GET';\n        this._url = req.url;\n        this._host = req.headers.host;\n        this._noAuthorization = !req.headers.authorization;\n        this._reqHeaders = res.headers.vary ? req.headers : null; // Don't keep all request headers if they won't be used\n        this._reqcc = parseCacheControl(req.headers['cache-control']);\n\n        // Assume that if someone uses legacy, non-standard uncecessary options they don't understand caching,\n        // so there's no point stricly adhering to the blindly copy&pasted directives.\n        if (ignoreCargoCult && \"pre-check\" in this._rescc && \"post-check\" in this._rescc) {\n            delete this._rescc['pre-check'];\n            delete this._rescc['post-check'];\n            delete this._rescc['no-cache'];\n            delete this._rescc['no-store'];\n            delete this._rescc['must-revalidate'];\n            this._resHeaders = Object.assign({}, this._resHeaders, { 'cache-control': formatCacheControl(this._rescc) });\n            delete this._resHeaders.expires;\n            delete this._resHeaders.pragma;\n        }\n\n        // When the Cache-Control header field is not present in a request, caches MUST consider the no-cache request pragma-directive\n        // as having the same effect as if \"Cache-Control: no-cache\" were present (see Section 5.2.1).\n        if (!res.headers['cache-control'] && /no-cache/.test(res.headers.pragma)) {\n            this._rescc['no-cache'] = true;\n        }\n    }\n\n    CachePolicy.prototype.now = function now() {\n        return Date.now();\n    };\n\n    CachePolicy.prototype.storable = function storable() {\n        // The \"no-store\" request directive indicates that a cache MUST NOT store any part of either this request or any response to it.\n        return !!(!this._reqcc['no-store'] && (\n        // A cache MUST NOT store a response to any request, unless:\n        // The request method is understood by the cache and defined as being cacheable, and\n        'GET' === this._method || 'HEAD' === this._method || 'POST' === this._method && this._hasExplicitExpiration()) &&\n        // the response status code is understood by the cache, and\n        understoodStatuses.indexOf(this._status) !== -1 &&\n        // the \"no-store\" cache directive does not appear in request or response header fields, and\n        !this._rescc['no-store'] && (\n        // the \"private\" response directive does not appear in the response, if the cache is shared, and\n        !this._isShared || !this._rescc.private) && (\n        // the Authorization header field does not appear in the request, if the cache is shared,\n        !this._isShared || this._noAuthorization || this._allowsStoringAuthenticated()) && (\n        // the response either:\n\n        // contains an Expires header field, or\n        this._resHeaders.expires ||\n        // contains a max-age response directive, or\n        // contains a s-maxage response directive and the cache is shared, or\n        // contains a public response directive.\n        this._rescc.public || this._rescc['max-age'] || this._rescc['s-maxage'] ||\n        // has a status code that is defined as cacheable by default\n        statusCodeCacheableByDefault.indexOf(this._status) !== -1));\n    };\n\n    CachePolicy.prototype._hasExplicitExpiration = function _hasExplicitExpiration() {\n        // 4.2.1 Calculating Freshness Lifetime\n        return this._isShared && this._rescc['s-maxage'] || this._rescc['max-age'] || this._resHeaders.expires;\n    };\n\n    CachePolicy.prototype._assertRequestHasHeaders = function _assertRequestHasHeaders(req) {\n        if (!req || !req.headers) {\n            throw Error(\"Request headers missing\");\n        }\n    };\n\n    CachePolicy.prototype.satisfiesWithoutRevalidation = function satisfiesWithoutRevalidation(req) {\n        this._assertRequestHasHeaders(req);\n\n        // When presented with a request, a cache MUST NOT reuse a stored response, unless:\n        // the presented request does not contain the no-cache pragma (Section 5.4), nor the no-cache cache directive,\n        // unless the stored response is successfully validated (Section 4.3), and\n        var requestCC = parseCacheControl(req.headers['cache-control']);\n        if (requestCC['no-cache'] || /no-cache/.test(req.headers.pragma)) {\n            return false;\n        }\n\n        if (requestCC['max-age'] && this.age() > requestCC['max-age']) {\n            return false;\n        }\n\n        if (requestCC['min-fresh'] && this.timeToLive() < 1000 * requestCC['min-fresh']) {\n            return false;\n        }\n\n        // the stored response is either:\n        // fresh, or allowed to be served stale\n        if (this.stale()) {\n            var allowsStale = requestCC['max-stale'] && !this._rescc['must-revalidate'] && (true === requestCC['max-stale'] || requestCC['max-stale'] > this.age() - this.maxAge());\n            if (!allowsStale) {\n                return false;\n            }\n        }\n\n        return this._requestMatches(req, false);\n    };\n\n    CachePolicy.prototype._requestMatches = function _requestMatches(req, allowHeadMethod) {\n        // The presented effective request URI and that of the stored response match, and\n        return (!this._url || this._url === req.url) && this._host === req.headers.host && (\n        // the request method associated with the stored response allows it to be used for the presented request, and\n        !req.method || this._method === req.method || allowHeadMethod && 'HEAD' === req.method) &&\n        // selecting header fields nominated by the stored response (if any) match those presented, and\n        this._varyMatches(req);\n    };\n\n    CachePolicy.prototype._allowsStoringAuthenticated = function _allowsStoringAuthenticated() {\n        //  following Cache-Control response directives (Section 5.2.2) have such an effect: must-revalidate, public, and s-maxage.\n        return this._rescc['must-revalidate'] || this._rescc.public || this._rescc['s-maxage'];\n    };\n\n    CachePolicy.prototype._varyMatches = function _varyMatches(req) {\n        if (!this._resHeaders.vary) {\n            return true;\n        }\n\n        // A Vary header field-value of \"*\" always fails to match\n        if (this._resHeaders.vary === '*') {\n            return false;\n        }\n\n        var fields = this._resHeaders.vary.trim().toLowerCase().split(/\\s*,\\s*/);\n        for (var _iterator2 = fields, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {\n            var _ref3;\n\n            if (_isArray2) {\n                if (_i2 >= _iterator2.length) break;\n                _ref3 = _iterator2[_i2++];\n            } else {\n                _i2 = _iterator2.next();\n                if (_i2.done) break;\n                _ref3 = _i2.value;\n            }\n\n            var name = _ref3;\n\n            if (req.headers[name] !== this._reqHeaders[name]) return false;\n        }\n        return true;\n    };\n\n    CachePolicy.prototype._copyWithoutHopByHopHeaders = function _copyWithoutHopByHopHeaders(inHeaders) {\n        var headers = {};\n        for (var name in inHeaders) {\n            if (hopByHopHeaders[name]) continue;\n            headers[name] = inHeaders[name];\n        }\n        // 9.1.  Connection\n        if (inHeaders.connection) {\n            var tokens = inHeaders.connection.trim().split(/\\s*,\\s*/);\n            for (var _iterator3 = tokens, _isArray3 = Array.isArray(_iterator3), _i3 = 0, _iterator3 = _isArray3 ? _iterator3 : _iterator3[Symbol.iterator]();;) {\n                var _ref4;\n\n                if (_isArray3) {\n                    if (_i3 >= _iterator3.length) break;\n                    _ref4 = _iterator3[_i3++];\n                } else {\n                    _i3 = _iterator3.next();\n                    if (_i3.done) break;\n                    _ref4 = _i3.value;\n                }\n\n                var _name = _ref4;\n\n                delete headers[_name];\n            }\n        }\n        if (headers.warning) {\n            var warnings = headers.warning.split(/,/).filter(function (warning) {\n                return !/^\\s*1[0-9][0-9]/.test(warning);\n            });\n            if (!warnings.length) {\n                delete headers.warning;\n            } else {\n                headers.warning = warnings.join(',').trim();\n            }\n        }\n        return headers;\n    };\n\n    CachePolicy.prototype.responseHeaders = function responseHeaders() {\n        var headers = this._copyWithoutHopByHopHeaders(this._resHeaders);\n        var age = this.age();\n\n        // A cache SHOULD generate 113 warning if it heuristically chose a freshness\n        // lifetime greater than 24 hours and the response's age is greater than 24 hours.\n        if (age > 3600 * 24 && !this._hasExplicitExpiration() && this.maxAge() > 3600 * 24) {\n            headers.warning = (headers.warning ? `${headers.warning}, ` : '') + '113 - \"rfc7234 5.5.4\"';\n        }\n        headers.age = `${Math.round(age)}`;\n        return headers;\n    };\n\n    /**\n     * Value of the Date response header or current time if Date was demed invalid\n     * @return timestamp\n     */\n\n\n    CachePolicy.prototype.date = function date() {\n        var dateValue = Date.parse(this._resHeaders.date);\n        var maxClockDrift = 8 * 3600 * 1000;\n        if (Number.isNaN(dateValue) || dateValue < this._responseTime - maxClockDrift || dateValue > this._responseTime + maxClockDrift) {\n            return this._responseTime;\n        }\n        return dateValue;\n    };\n\n    /**\n     * Value of the Age header, in seconds, updated for the current time.\n     * May be fractional.\n     *\n     * @return Number\n     */\n\n\n    CachePolicy.prototype.age = function age() {\n        var age = Math.max(0, (this._responseTime - this.date()) / 1000);\n        if (this._resHeaders.age) {\n            var ageValue = this._ageValue();\n            if (ageValue > age) age = ageValue;\n        }\n\n        var residentTime = (this.now() - this._responseTime) / 1000;\n        return age + residentTime;\n    };\n\n    CachePolicy.prototype._ageValue = function _ageValue() {\n        var ageValue = parseInt(this._resHeaders.age);\n        return isFinite(ageValue) ? ageValue : 0;\n    };\n\n    /**\n     * Value of applicable max-age (or heuristic equivalent) in seconds. This counts since response's `Date`.\n     *\n     * For an up-to-date value, see `timeToLive()`.\n     *\n     * @return Number\n     */\n\n\n    CachePolicy.prototype.maxAge = function maxAge() {\n        if (!this.storable() || this._rescc['no-cache']) {\n            return 0;\n        }\n\n        // Shared responses with cookies are cacheable according to the RFC, but IMHO it'd be unwise to do so by default\n        // so this implementation requires explicit opt-in via public header\n        if (this._isShared && this._resHeaders['set-cookie'] && !this._rescc.public && !this._rescc.immutable) {\n            return 0;\n        }\n\n        if (this._resHeaders.vary === '*') {\n            return 0;\n        }\n\n        if (this._isShared) {\n            if (this._rescc['proxy-revalidate']) {\n                return 0;\n            }\n            // if a response includes the s-maxage directive, a shared cache recipient MUST ignore the Expires field.\n            if (this._rescc['s-maxage']) {\n                return parseInt(this._rescc['s-maxage'], 10);\n            }\n        }\n\n        // If a response includes a Cache-Control field with the max-age directive, a recipient MUST ignore the Expires field.\n        if (this._rescc['max-age']) {\n            return parseInt(this._rescc['max-age'], 10);\n        }\n\n        var defaultMinTtl = this._rescc.immutable ? this._immutableMinTtl : 0;\n\n        var dateValue = this.date();\n        if (this._resHeaders.expires) {\n            var expires = Date.parse(this._resHeaders.expires);\n            // A cache recipient MUST interpret invalid date formats, especially the value \"0\", as representing a time in the past (i.e., \"already expired\").\n            if (Number.isNaN(expires) || expires < dateValue) {\n                return 0;\n            }\n            return Math.max(defaultMinTtl, (expires - dateValue) / 1000);\n        }\n\n        if (this._resHeaders['last-modified']) {\n            var lastModified = Date.parse(this._resHeaders['last-modified']);\n            if (isFinite(lastModified) && dateValue > lastModified) {\n                return Math.max(defaultMinTtl, (dateValue - lastModified) / 1000 * this._cacheHeuristic);\n            }\n        }\n\n        return defaultMinTtl;\n    };\n\n    CachePolicy.prototype.timeToLive = function timeToLive() {\n        return Math.max(0, this.maxAge() - this.age()) * 1000;\n    };\n\n    CachePolicy.prototype.stale = function stale() {\n        return this.maxAge() <= this.age();\n    };\n\n    CachePolicy.fromObject = function fromObject(obj) {\n        return new this(undefined, undefined, { _fromObject: obj });\n    };\n\n    CachePolicy.prototype._fromObject = function _fromObject(obj) {\n        if (this._responseTime) throw Error(\"Reinitialized\");\n        if (!obj || obj.v !== 1) throw Error(\"Invalid serialization\");\n\n        this._responseTime = obj.t;\n        this._isShared = obj.sh;\n        this._cacheHeuristic = obj.ch;\n        this._immutableMinTtl = obj.imm !== undefined ? obj.imm : 24 * 3600 * 1000;\n        this._status = obj.st;\n        this._resHeaders = obj.resh;\n        this._rescc = obj.rescc;\n        this._method = obj.m;\n        this._url = obj.u;\n        this._host = obj.h;\n        this._noAuthorization = obj.a;\n        this._reqHeaders = obj.reqh;\n        this._reqcc = obj.reqcc;\n    };\n\n    CachePolicy.prototype.toObject = function toObject() {\n        return {\n            v: 1,\n            t: this._responseTime,\n            sh: this._isShared,\n            ch: this._cacheHeuristic,\n            imm: this._immutableMinTtl,\n            st: this._status,\n            resh: this._resHeaders,\n            rescc: this._rescc,\n            m: this._method,\n            u: this._url,\n            h: this._host,\n            a: this._noAuthorization,\n            reqh: this._reqHeaders,\n            reqcc: this._reqcc\n        };\n    };\n\n    /**\n     * Headers for sending to the origin server to revalidate stale response.\n     * Allows server to return 304 to allow reuse of the previous response.\n     *\n     * Hop by hop headers are always stripped.\n     * Revalidation headers may be added or removed, depending on request.\n     */\n\n\n    CachePolicy.prototype.revalidationHeaders = function revalidationHeaders(incomingReq) {\n        this._assertRequestHasHeaders(incomingReq);\n        var headers = this._copyWithoutHopByHopHeaders(incomingReq.headers);\n\n        // This implementation does not understand range requests\n        delete headers['if-range'];\n\n        if (!this._requestMatches(incomingReq, true) || !this.storable()) {\n            // revalidation allowed via HEAD\n            // not for the same resource, or wasn't allowed to be cached anyway\n            delete headers['if-none-match'];\n            delete headers['if-modified-since'];\n            return headers;\n        }\n\n        /* MUST send that entity-tag in any cache validation request (using If-Match or If-None-Match) if an entity-tag has been provided by the origin server. */\n        if (this._resHeaders.etag) {\n            headers['if-none-match'] = headers['if-none-match'] ? `${headers['if-none-match']}, ${this._resHeaders.etag}` : this._resHeaders.etag;\n        }\n\n        // Clients MAY issue simple (non-subrange) GET requests with either weak validators or strong validators. Clients MUST NOT use weak validators in other forms of request.\n        var forbidsWeakValidators = headers['accept-ranges'] || headers['if-match'] || headers['if-unmodified-since'] || this._method && this._method != 'GET';\n\n        /* SHOULD send the Last-Modified value in non-subrange cache validation requests (using If-Modified-Since) if only a Last-Modified value has been provided by the origin server.\n        Note: This implementation does not understand partial responses (206) */\n        if (forbidsWeakValidators) {\n            delete headers['if-modified-since'];\n\n            if (headers['if-none-match']) {\n                var etags = headers['if-none-match'].split(/,/).filter(function (etag) {\n                    return !/^\\s*W\\//.test(etag);\n                });\n                if (!etags.length) {\n                    delete headers['if-none-match'];\n                } else {\n                    headers['if-none-match'] = etags.join(',').trim();\n                }\n            }\n        } else if (this._resHeaders['last-modified'] && !headers['if-modified-since']) {\n            headers['if-modified-since'] = this._resHeaders['last-modified'];\n        }\n\n        return headers;\n    };\n\n    /**\n     * Creates new CachePolicy with information combined from the previews response,\n     * and the new revalidation response.\n     *\n     * Returns {policy, modified} where modified is a boolean indicating\n     * whether the response body has been modified, and old cached body can't be used.\n     *\n     * @return {Object} {policy: CachePolicy, modified: Boolean}\n     */\n\n\n    CachePolicy.prototype.revalidatedPolicy = function revalidatedPolicy(request, response) {\n        this._assertRequestHasHeaders(request);\n        if (!response || !response.headers) {\n            throw Error(\"Response headers missing\");\n        }\n\n        // These aren't going to be supported exactly, since one CachePolicy object\n        // doesn't know about all the other cached objects.\n        var matches = false;\n        if (response.status !== undefined && response.status != 304) {\n            matches = false;\n        } else if (response.headers.etag && !/^\\s*W\\//.test(response.headers.etag)) {\n            // \"All of the stored responses with the same strong validator are selected.\n            // If none of the stored responses contain the same strong validator,\n            // then the cache MUST NOT use the new response to update any stored responses.\"\n            matches = this._resHeaders.etag && this._resHeaders.etag.replace(/^\\s*W\\//, '') === response.headers.etag;\n        } else if (this._resHeaders.etag && response.headers.etag) {\n            // \"If the new response contains a weak validator and that validator corresponds\n            // to one of the cache's stored responses,\n            // then the most recent of those matching stored responses is selected for update.\"\n            matches = this._resHeaders.etag.replace(/^\\s*W\\//, '') === response.headers.etag.replace(/^\\s*W\\//, '');\n        } else if (this._resHeaders['last-modified']) {\n            matches = this._resHeaders['last-modified'] === response.headers['last-modified'];\n        } else {\n            // If the new response does not include any form of validator (such as in the case where\n            // a client generates an If-Modified-Since request from a source other than the Last-Modified\n            // response header field), and there is only one stored response, and that stored response also\n            // lacks a validator, then that stored response is selected for update.\n            if (!this._resHeaders.etag && !this._resHeaders['last-modified'] && !response.headers.etag && !response.headers['last-modified']) {\n                matches = true;\n            }\n        }\n\n        if (!matches) {\n            return {\n                policy: new this.constructor(request, response),\n                modified: true\n            };\n        }\n\n        // use other header fields provided in the 304 (Not Modified) response to replace all instances\n        // of the corresponding header fields in the stored response.\n        var headers = {};\n        for (var k in this._resHeaders) {\n            headers[k] = k in response.headers && !excludedFromRevalidationUpdate[k] ? response.headers[k] : this._resHeaders[k];\n        }\n\n        var newResponse = Object.assign({}, response, {\n            status: this._status,\n            method: this._method,\n            headers\n        });\n        return {\n            policy: new this.constructor(request, newResponse),\n            modified: false\n        };\n    };\n\n    return CachePolicy;\n}();"]}